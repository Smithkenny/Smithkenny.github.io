<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>pve优化 - Peng</title><meta name=Description content="One World,One Dream!"><meta property="og:title" content="pve优化"><meta property="og:description" content="pve优化 1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知 Proxmox VE(PVE)系统安装完成后，输入账号密码登录系统后会有提示：无有效订阅，本文"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.haipengv.com/pve%E4%BC%98%E5%8C%96/"><meta property="og:image" content="https://blog.haipengv.com/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-11T13:10:12+00:00"><meta property="article:modified_time" content="2022-11-11T13:10:12+00:00"><meta property="og:site_name" content="我的网站"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.haipengv.com/logo.png"><meta name=twitter:title content="pve优化"><meta name=twitter:description content="pve优化 1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知 Proxmox VE(PVE)系统安装完成后，输入账号密码登录系统后会有提示：无有效订阅，本文"><meta name=application-name content="我的网站"><meta name=apple-mobile-web-app-title content="我的网站"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.haipengv.com/pve%E4%BC%98%E5%8C%96/><link rel=prev href=https://blog.haipengv.com/centos7.9%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0/><link rel=next href=https://blog.haipengv.com/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%94%B1%E4%BA%8Ekswapd0%E8%BF%9B%E7%A8%8B%E5%AF%BC%E8%87%B4%E7%B3%BB%E7%BB%9F%E5%BC%82%E5%B8%B8/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"pve优化","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.haipengv.com\/pve%E4%BC%98%E5%8C%96\/"},"genre":"posts","wordcount":2293,"url":"https:\/\/blog.haipengv.com\/pve%E4%BC%98%E5%8C%96\/","datePublished":"2022-11-11T13:10:12+00:00","dateModified":"2022-11-11T13:10:12+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Peng"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/links/>友链 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/links/ title>友链</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">pve优化</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Peng</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-11-11>2022-11-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2293 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#pve优化>pve优化</a></li><li><a href=#1proxmox-vepve系统移除无有效订阅弹窗提示通知>1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知</a></li><li><a href=#2proxmox-ve更换apt源并更新软件包数据库>2.Proxmox VE更换apt源并更新软件包数据库</a></li><li><a href=#3pve更改安装时绑定的网卡>3.PVE更改安装时绑定的网卡</a></li><li><a href=#4pve中虚拟机无法关闭解决方法>4.pve中虚拟机无法关闭，解决方法。</a></li><li><a href=#5centos79常用工具一键安装>5.centos7.9常用工具一键安装</a></li><li><a href=#6proxmox-ve-72-iso-镜像重置-pve-root密码>6.Proxmox VE 7.2 iso 镜像重置 pve root密码</a></li><li><a href=#7proxmox集群部分节点出现问号>7.Proxmox集群部分节点出现问号</a></li><li><a href=#8解决pve创建的虚拟机无法复制粘贴>8.解决pve创建的虚拟机无法复制粘贴</a></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=pve优化>pve优化</h3><h3 id=1proxmox-vepve系统移除无有效订阅弹窗提示通知>1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知</h3><p>Proxmox VE(PVE)系统安装完成后，输入账号密码登录系统后会有提示：无有效订阅，本文主要介绍如何去除此弹窗提示。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>提示：无有效订阅
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You do not have a valid subscription for this server. Please visit www.proxmox.com to get a list of available options.
</span></span></code></pre></td></tr></table></div></div><p>形成此问题的主要原因是因为我们使用的是免费版Proxmox VE系统，所以每次登录后都会提示这个《无有效订阅》弹窗。</p><p>此教程演示系统环境为：Proxmox Virtual Environment 7.2 ，更新日期为：2022年11月10日，其他版本请参考本教程.</p><p>需要修改文件路径为：/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js 修改之前请做好文件备份，防止误操作造成不可预知的错误。</p><p>解决方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>搜索关键词：Ext.Msg.show
</span></span><span class=line><span class=cl>将：Ext.Msg.show<span class=o>({</span>修改为：Ext.Msg.noshow<span class=o>({</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>文件修改后保存上传，执行 systemctl restart pveproxy 命令重启网页服务
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@pve:~# systemctl restart pveproxy
</span></span></code></pre></td></tr></table></div></div><p>注销后登陆，使用 CTRL+F5 快捷键强制重新加载网页页面，或清理浏览器缓存（很多修改后没有反应的童学记得清缓存）</p><p>再次打开登陆 Proxmox VE系统控制台主界面，就没有弹窗提示了。</p><p>注意：此方法可能在升级 pve 后失效，失效后再修改即可。</p><h3 id=2proxmox-ve更换apt源并更新软件包数据库>2.Proxmox VE更换apt源并更新软件包数据库</h3><p>1、查看当前镜像源配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cat /etc/apt/sources.list
</span></span></code></pre></td></tr></table></div></div><p>2、查看当前pve版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pveversion -v
</span></span></code></pre></td></tr></table></div></div><p>3、注释默认配置，修改为中科大镜像源</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nano /etc/apt/sources.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>deb https://mirrors.ustc.edu.cn/debian bullseye main contrib
</span></span><span class=line><span class=cl>deb https://mirrors.ustc.edu.cn/debian bullseye-updates main contrib
</span></span><span class=line><span class=cl>deb https://mirrors.ustc.edu.cn/debian-security bullseye-security main contrib
</span></span></code></pre></td></tr></table></div></div><p>4、注释proxmox企业版更新源
因为我们安装的是社区版，没有订阅企业版的服务，这个默认启用，所以会报错，使用时我们可以注释掉它。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nano /etc/apt/sources.list.d/pve-enterprise.list
</span></span></code></pre></td></tr></table></div></div><p>5、运行 <code>apt update</code> 更新索引以生效</p><p>6、查看可以更新的包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apt list --upgradable
</span></span></code></pre></td></tr></table></div></div><p>7、执行软件包数据库更新</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apt update &amp;&amp; apt upgrade -y
</span></span></code></pre></td></tr></table></div></div><p>8、也可以在页面更新</p><p><strong>pve-更新-刷新</strong></p><h3 id=3pve更改安装时绑定的网卡>3.PVE更改安装时绑定的网卡</h3><p>当服务器有多个网卡时，安装pve后，绑定的网卡非管理口网卡导致局域网中机器无法连接pve。此时需要更改pve安装时绑定的网卡。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@www:~#  ip a
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>    inet 127.0.0.1/8 scope host lo
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 ::1/128 scope host 
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>2: eno1: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 3c:ec:ef:90:ea:96 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    altname enp181s0f0
</span></span><span class=line><span class=cl>3: enp101s0f0: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 58:53:c0:64:19:94 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>4: eno2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc mq master vmbr0 state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 3c:ec:ef:90:ea:97 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    altname enp181s0f1
</span></span><span class=line><span class=cl>5: enp23s0f0: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 68:91:d0:6a:66:a6 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>6: enp101s0f1: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 58:53:c0:64:19:95 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>7: enp23s0f1: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 68:91:d0:6a:66:a7 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>8: enp182s0f0: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 68:91:d0:6a:66:a0 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>9: enp182s0f1: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 68:91:d0:6a:66:a1 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>10: vmbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc noqueue state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 3c:ec:ef:90:ea:97 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 192.168.1.191/24 scope global vmbr0
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 fe80::3eec:efff:fe90:ea97/64 scope link 
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>12: tap100i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc pfifo_fast master vmbr0 state UNKNOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 2e:dd:9f:18:5d:41 brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></td></tr></table></div></div><p>由以上信息可知pve的虚拟网卡vmbr0是桥接到mac为3c:ec:ef:90:ea:97的网卡即eno2上，需要将vmbr0更改桥接到eno1上。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano /etc/network/interfaces
</span></span></code></pre></td></tr></table></div></div><p>原内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>auto lo
</span></span><span class=line><span class=cl>iface lo inet loopback
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface eno2 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>auto vmbr0
</span></span><span class=line><span class=cl>iface vmbr0 inet static
</span></span><span class=line><span class=cl>        address 192.168.1.191/24
</span></span><span class=line><span class=cl>        gateway 192.168.1.254
</span></span><span class=line><span class=cl>        bridge-ports eno2
</span></span><span class=line><span class=cl>        bridge-stp off
</span></span><span class=line><span class=cl>        bridge-fd <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp101s0f0 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp101s0f1 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp23s0f0 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp23s0f1 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface eno2 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp182s0f0 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp182s0f1 inet manual
</span></span></code></pre></td></tr></table></div></div><p>需要更改为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>auto lo
</span></span><span class=line><span class=cl>iface lo inet loopback
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface eno1 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>auto vmbr0
</span></span><span class=line><span class=cl>iface vmbr0 inet static
</span></span><span class=line><span class=cl>        address 192.168.1.191/24
</span></span><span class=line><span class=cl>        gateway 192.168.1.254
</span></span><span class=line><span class=cl>        bridge-ports eno1
</span></span><span class=line><span class=cl>        bridge-stp off
</span></span><span class=line><span class=cl>        bridge-fd <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp101s0f0 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp101s0f1 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp23s0f0 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp23s0f1 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface eno2 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp182s0f0 inet manual
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iface enp182s0f1 inet manual
</span></span></code></pre></td></tr></table></div></div><p>重启机器</p><h3 id=4pve中虚拟机无法关闭解决方法>4.pve中虚拟机无法关闭，解决方法。</h3><p>删除虚拟机ID对应的配置文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> rm /var/lock/qemu-server/lock-102.conf    <span class=c1>#102是你的虚拟机编号</span>
</span></span></code></pre></td></tr></table></div></div><p>然后关闭虚拟机</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>qm stop <span class=m>102</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=5centos79常用工具一键安装>5.centos7.9常用工具一键安装</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum -y install wget gcc gcc-c++ pcre pcre-devel zlib zlib-devel ruby openssl openssl-devel patch lsof unzip zip lrzsz bash-completion net-tools nmap-ncat
</span></span></code></pre></td></tr></table></div></div><h3 id=6proxmox-ve-72-iso-镜像重置-pve-root密码>6.Proxmox VE 7.2 iso 镜像重置 pve root密码</h3><ul><li><p>u盘引导进入pve安装界面，选择Advanced Options。</p></li><li><p>选择 Debug mode</p></li><li><p>进入后发现默认在/路径下，继续按CTRL D，进入root@proxmox:/</p></li><li><p>验证LVM并挂载</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#查看VG，输出应该是有VG PVE</span>
</span></span><span class=line><span class=cl>vgs
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>#查看LV，可以看到 data root </span>
</span></span><span class=line><span class=cl>lvs
</span></span></code></pre></td></tr></table></div></div><ul><li>激活VG</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vgchange -a y 
</span></span></code></pre></td></tr></table></div></div><ul><li>挂载lvm</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mount /dev/mapper/pve-root /mnt
</span></span></code></pre></td></tr></table></div></div><ul><li>chroot</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chroot /mnt
</span></span></code></pre></td></tr></table></div></div><ul><li>修改root密码，更改完成密码重启服务器</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>passwd root
</span></span></code></pre></td></tr></table></div></div><h3 id=7proxmox集群部分节点出现问号>7.Proxmox集群部分节点出现问号</h3><p>决定pve上状态的服务是pvestat daemon，也就是<code>pvestatd</code>，因此查看它的运行状况，果然有问题！</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@www:~# service pvestatd status
</span></span><span class=line><span class=cl>● pvestatd.service - PVE Status Daemon
</span></span><span class=line><span class=cl>     Loaded: loaded <span class=o>(</span>/lib/systemd/system/pvestatd.service<span class=p>;</span> enabled<span class=p>;</span> vendor preset: enabled<span class=o>)</span>
</span></span><span class=line><span class=cl>     Active: failed <span class=o>(</span>Result: signal<span class=o>)</span> since Wed 2022-11-16 09:23:04 CST<span class=p>;</span> 10min ago
</span></span><span class=line><span class=cl>    Process: <span class=m>1146</span> <span class=nv>ExecStart</span><span class=o>=</span>/usr/bin/pvestatd start <span class=o>(</span><span class=nv>code</span><span class=o>=</span>killed, <span class=nv>signal</span><span class=o>=</span>KILL<span class=o>)</span>
</span></span><span class=line><span class=cl>        CPU: 286ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nov <span class=m>16</span> 09:23:03 www systemd<span class=o>[</span>1<span class=o>]</span>: Starting PVE Status Daemon...
</span></span><span class=line><span class=cl>Nov <span class=m>16</span> 09:23:04 www systemd<span class=o>[</span>1<span class=o>]</span>: pvestatd.service: Control process exited, <span class=nv>code</span><span class=o>=</span>killed, <span class=nv>status</span><span class=o>=</span>9/KILL
</span></span><span class=line><span class=cl>Nov <span class=m>16</span> 09:23:04 www systemd<span class=o>[</span>1<span class=o>]</span>: pvestatd.service: Failed with result <span class=s1>&#39;signal&#39;</span>.
</span></span><span class=line><span class=cl>Nov <span class=m>16</span> 09:23:04 www systemd<span class=o>[</span>1<span class=o>]</span>: Failed to start PVE Status Daemon.
</span></span></code></pre></td></tr></table></div></div><p>重启该服务状态恢复正常</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@www:~# service pvestatd restart 
</span></span><span class=line><span class=cl>root@www:~# service pvestatd status
</span></span><span class=line><span class=cl>● pvestatd.service - PVE Status Daemon
</span></span><span class=line><span class=cl>     Loaded: loaded <span class=o>(</span>/lib/systemd/system/pvestatd.service<span class=p>;</span> enabled<span class=p>;</span> vendor preset: enabled<span class=o>)</span>
</span></span><span class=line><span class=cl>     Active: active <span class=o>(</span>running<span class=o>)</span> since Wed 2022-11-16 09:34:06 CST<span class=p>;</span> 1s ago
</span></span><span class=line><span class=cl>    Process: <span class=m>1510</span> <span class=nv>ExecStart</span><span class=o>=</span>/usr/bin/pvestatd start <span class=o>(</span><span class=nv>code</span><span class=o>=</span>exited, <span class=nv>status</span><span class=o>=</span>0/SUCCESS<span class=o>)</span>
</span></span><span class=line><span class=cl>   Main PID: <span class=m>1511</span> <span class=o>(</span>pvestatd<span class=o>)</span>
</span></span><span class=line><span class=cl>      Tasks: <span class=m>1</span> <span class=o>(</span>limit: 18701<span class=o>)</span>
</span></span><span class=line><span class=cl>     Memory: 79.2M
</span></span><span class=line><span class=cl>        CPU: 851ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/pvestatd.service
</span></span><span class=line><span class=cl>             └─1511 pvestatd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nov <span class=m>16</span> 09:34:05 www systemd<span class=o>[</span>1<span class=o>]</span>: Starting PVE Status Daemon...
</span></span><span class=line><span class=cl>Nov <span class=m>16</span> 09:34:06 www pvestatd<span class=o>[</span>1511<span class=o>]</span>: starting server
</span></span><span class=line><span class=cl>Nov <span class=m>16</span> 09:34:06 www systemd<span class=o>[</span>1<span class=o>]</span>: Started PVE Status Daemon.
</span></span></code></pre></td></tr></table></div></div><h3 id=8解决pve创建的虚拟机无法复制粘贴>8.解决pve创建的虚拟机无法复制粘贴</h3><p><strong>配置xterm.js</strong></p><p>PVE创建虚拟机后默认只有novnc方法连接虚拟机，无法复制粘贴，很不方便，因此可以打开xterm.js的方式弥补此缺陷。</p><p>关闭 VM，并且新增 serial port 给 VM 在PVE Host 中用 qm 命令建立 serial port，假设我的 VM ID 是 100</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>qm set 100 -serial0 socket
</span></span></code></pre></td></tr></table></div></div><p>重新开启 VM，用 dmesg 验证是否有 ttyS 出现。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>dmesg | grep ttyS
</span></span></code></pre></td></tr></table></div></div><p>如果出现如下代表有了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[    3.521757] 00:04: ttyS0 at I/O 0x3f8 (irq = 4, base_baud = 115200) is a 16550A
</span></span></code></pre></td></tr></table></div></div><p>接下来配置VM的grub，进入VM的ssh</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd /etc/default/
</span></span><span class=line><span class=cl>vi grub
</span></span></code></pre></td></tr></table></div></div><p>修改grub中的GRUB_CMDLINE_LINUX值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GRUB_CMDLINE_LINUX=&#34;quiet console=tty0 console=ttyS0,115200”
</span></span></code></pre></td></tr></table></div></div><p>更新grub</p><p>debian based</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>update-grub
</span></span></code></pre></td></tr></table></div></div><p>redhat based</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>grub2-mkconfig --output<span class=o>=</span>/boot/grub2/grub.cfg
</span></span></code></pre></td></tr></table></div></div><p>在虚拟机添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/etc/init/ttyS0.conf
</span></span></code></pre></td></tr></table></div></div><p>并添加如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># ttyS0 - getty
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># This service maintains a getty on ttyS0 from the point the system is
</span></span><span class=line><span class=cl># started until it is shut down again.
</span></span><span class=line><span class=cl>start on stopped rc RUNLEVEL=[12345]
</span></span><span class=line><span class=cl>stop on runlevel [!12345]
</span></span><span class=line><span class=cl>respawn
</span></span><span class=line><span class=cl>exec /sbin/getty -L 115200 ttyS0 vt102
</span></span></code></pre></td></tr></table></div></div><p>设置自启动</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>systemctl enable serial-getty@ttyS0.service
</span></span><span class=line><span class=cl>systemctl start serial-getty@ttyS0.service
</span></span></code></pre></td></tr></table></div></div><p>重启VM，测试xterm，已经可以用。</p><p>官方文档如下：https://pve.proxmox.com/wiki/Serial_Terminal</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-11-11</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/pve%E4%BC%98%E5%8C%96/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/centos7.9%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0/ class=prev rel=prev title=centos7.9更换网卡名称><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>centos7.9更换网卡名称</a>
<a href=/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%94%B1%E4%BA%8Ekswapd0%E8%BF%9B%E7%A8%8B%E5%AF%BC%E8%87%B4%E7%B3%BB%E7%BB%9F%E5%BC%82%E5%B8%B8/ class=next rel=next title=记一次由于kswapd0进程导致cpu占满>记一次由于kswapd0进程导致cpu占满<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Peng</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:0},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>