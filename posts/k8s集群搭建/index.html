<!doctype html><html lang=zh-CN><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content="K8sé›†ç¾¤æ­å»º - https://www.haipengv.com/posts/k8s%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><meta name=author content="Smith - https://www.haipengv.com/"><meta name=msvalidate.01 content="B46311949B856F2A7015F366FB3CE878"><title>K8sé›†ç¾¤æ­å»º</title><base target=_self><link rel=icon type=image/png href=/favicon.ico><link rel=stylesheet href=https://www.haipengv.com/style.min.9a0cea23154ac1941e15c25aa2d31b77285a217d2606ec05b55236428cf1c3e6.css><script>const DARK=!1</script><script type=text/javascript src=/main.js defer></script></head><body class=active-animate><div class=cool-before></div><div id=header><div class=container-header><div class=right><h1 class=title>K8sé›†ç¾¤æ­å»º</h1><div id=toc>ğŸ“œ</div></div></div></div><div id=content><div class="container-main container-page"><div class=rel><div class=curtag-desc><a href=https://www.haipengv.com/tags/kubernetes/><img src=/imgs/icons/tag.svg width=16> ç›¸å…³æ–‡ç« ï¼šKubernetes <sup>4</sup></a></div><div class=curtag-post><div class=curtag-post-item><a href=https://www.haipengv.com/posts/ceph%E6%90%AD%E5%BB%BA/>CEPHæ­å»º</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/cks%E5%88%9D%E5%A7%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/>CKSåˆå§‹ç¯å¢ƒæ­å»º</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/k8s%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/>K8sç½‘ç»œé€šä¿¡</a></div><div class="curtag-post-item curtag-post-item--active"><a href=https://www.haipengv.com/posts/k8s%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/>K8sé›†ç¾¤æ­å»º</a></div></div></div><div class=desc><span><svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667l-324.522666 324.48c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334L685.098667 499.2 524.885333 338.986667zM585.258667 278.656l160.170666 160.213333 102.144-102.144a19.712 19.712.0 000-27.861333l-132.48-132.437333a19.456 19.456.0 00-27.605333.0L585.258667 278.613333zM701.312 85.333333c27.946667.0 54.741333 11.136 74.282667 30.848L907.904 248.490667a105.045333 105.045333.0 010 148.565333L424.874667 879.957333C395.050667 914.304 352.768 935.424 304.426667 938.752H85.333333v-42.666667l.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666a104.789333 104.789333.0 0174.24-30.933334z" p-id="7410" fill="#adb5bd"/></svg>2025-03-16&nbsp;&nbsp;&nbsp;<svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859.0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775.0-360.398 149.372-360.398 356.147S305.225 870.23 512 870.23c206.775.0 357.467-151.455 357.467-358.23.0-23.859 23.634-50.706 53.413-50.706 29.78.0 49.92 26.847 49.92 50.706.0 254.493-206.307 460.8-460.8 460.8s-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4.0 226.684 33.296 312.264 117.369.358.351.358-24.052.0-73.209z" p-id="23839" fill="#adb5bd"/></svg>
2025-03-16&nbsp;&nbsp;&nbsp;</span>
<span><svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028c-70.774903.0-128.089859 57.325793-128.089859 128.03206v446.793671c0 70.7171050000001 57.314956 128.154884 128.089859 128.154884h133.353183a63.940169 63.940169.0 0155.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169.0 0155.212517-31.551041h133.54103c70.576219.0 127.732228-57.289669 127.732227-127.800865V192.391272c0-70.536482-57.181295-127.728615-127.786414-127.728615zM895.884854 639.842407A63.85347 63.85347.0 01832.092795 703.703103h-133.54103a127.753903 127.753903.0 00-110.349172 63.09847l-76.222461 129.856342a.274545.274545.0 010-.050574h-.032512s-.021675.061411-.032512.061412l-76.1466-129.85273a127.804477 127.804477.0 00-110.385297-63.11292H192.030028A64.207489 64.207489.0 01127.880338 639.488388V192.694717a64.102729 64.102729.0 0164.14969-64.091891h640.00858a63.799284 63.799284.0 0163.846246 63.788446v447.451135z" fill="#adb5bd" p-id="33867"/><path d="M608.154093 288.092004a31.970084 31.970084.0 00-31.970084 31.970085v160.078006L441.53396 300.861976a31.970084 31.970084.0 00-57.531702 19.200113v255.760676a31.970084 31.970084.0 0063.940169.0V415.863969l134.650048 179.274507a31.970084 31.970084.0 0057.531703-19.200113V320.062089a31.970084 31.970084.0 00-31.970085-31.970085z" fill="#adb5bd" p-id="33868"/></svg>3773 å­—</span>&nbsp;
<span><svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667zm0 810.666666C307.2 885.333333 138.666667 716.8 138.666667 512S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"/><path d="M695.466667 567.466667 544 497.066667V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666L669.866667 627.2c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8.0 23.466667-6.4 29.866666-19.2 6.4-14.933333.0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"/></svg>8 åˆ†é’Ÿ</span><div class=container-ctgtag><div class=taxonomy><div class=tag><a href=/tags/kubernetes>Kubernetes</a></div></div></div></div><div class=toc><div class=container-page-operation><div class=page-operation><div><a href=/><img src=/imgs/icons/home-2.svg alt></a></div><div><a href=/nav><img src=/imgs/icons/iov-navigate-1.svg alt></a></div><div><a href=/wiki><img src=/imgs/icons/wiki.svg alt></a></div><div><a href=/tags><img src=/imgs/icons/treetags.svg alt></a></div><div id=light-dark><a><img src=/imgs/icons/moon2.svg alt></a></div><div><a href=#><img src=/imgs/icons/up2.svg alt></a></div></div></div><nav id=TableOfContents><ul><li><a href=#å®‰è£…å‰å‡†å¤‡å·¥ä½œ>å®‰è£…å‰å‡†å¤‡å·¥ä½œ</a><ul><li><a href=#é‡è¦å®‰è£…k8s-1222-ç‰ˆæœ¬éœ€è¦çš„ç¡¬ä»¶æ¡ä»¶>ï¼ˆé‡è¦ï¼ï¼‰å®‰è£…k8s 1.22.2 ç‰ˆæœ¬éœ€è¦çš„ç¡¬ä»¶æ¡ä»¶ï¼š</a></li><li><a href=#1-è®¾ç½®hostsè§£æ>1. è®¾ç½®hostsè§£æ</a></li><li><a href=#2-è°ƒæ•´ç³»ç»Ÿé…ç½®>2. è°ƒæ•´ç³»ç»Ÿé…ç½®</a></li><li><a href=#3-å®‰è£…docker>3. å®‰è£…docker</a></li><li><a href=#ç»™kubectl-è®¾ç½®åˆ«åä¸ºkæ°¸ä¹…ç”Ÿæ•ˆ>ç»™kubectl è®¾ç½®åˆ«åä¸ºkï¼Œæ°¸ä¹…ç”Ÿæ•ˆã€‚</a></li><li><a href=#ä½¿ç”¨kubectlä¸­çš„å¼ºåˆ¶åˆ é™¤å‘½ä»¤>ä½¿ç”¨kubectlä¸­çš„å¼ºåˆ¶åˆ é™¤å‘½ä»¤</a></li><li><a href=#è‡ªåŠ¨è¡¥å…¨>è‡ªåŠ¨è¡¥å…¨</a></li></ul></li><li><a href=#éƒ¨ç½²kubernetes>éƒ¨ç½²kubernetes</a><ul><li><a href=#1-å®‰è£…-kubeadm-kubelet-å’Œ-kubectl>1. å®‰è£… kubeadm, kubelet å’Œ kubectl</a></li><li><a href=#2-åˆå§‹åŒ–é…ç½®æ–‡ä»¶>2. åˆå§‹åŒ–é…ç½®æ–‡ä»¶</a></li><li><a href=#3-æå‰ä¸‹è½½é•œåƒ>3. æå‰ä¸‹è½½é•œåƒ</a></li><li><a href=#4-åˆå§‹åŒ–masterèŠ‚ç‚¹>4. åˆå§‹åŒ–masterèŠ‚ç‚¹</a></li><li><a href=#5-æ·»åŠ slaveèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­>5. æ·»åŠ slaveèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­</a></li><li><a href=#6-å®‰è£…calicoæ’ä»¶>6. å®‰è£…calicoæ’ä»¶</a></li><li><a href=#7-éªŒè¯é›†ç¾¤>7. éªŒè¯é›†ç¾¤</a></li><li><a href=#8-æ¸…ç†ç¯å¢ƒ>8. æ¸…ç†ç¯å¢ƒ</a></li></ul></li></ul></nav></div><div class=content><h1 id=kubernetes-1222å®‰è£…æ‰‹å†Œubuntuéé«˜å¯ç”¨ç‰ˆ>Kubernetes ï¼ˆ1.22.2ï¼‰å®‰è£…æ‰‹å†Œï¼ˆUbuntuéé«˜å¯ç”¨ç‰ˆï¼‰</h1><h2 id=å®‰è£…å‰å‡†å¤‡å·¥ä½œ>å®‰è£…å‰å‡†å¤‡å·¥ä½œ</h2><h3 id=é‡è¦å®‰è£…k8s-1222-ç‰ˆæœ¬éœ€è¦çš„ç¡¬ä»¶æ¡ä»¶>ï¼ˆé‡è¦ï¼ï¼‰å®‰è£…k8s 1.22.2 ç‰ˆæœ¬éœ€è¦çš„ç¡¬ä»¶æ¡ä»¶ï¼š</h3><p>æ‰€æœ‰èŠ‚ç‚¹ï¼š</p><p><strong>cpuæ•°é‡2ä¸ªåŠä»¥ä¸Š</strong></p><p>4G ä»¥ä¸Šå†…å­˜</p><p>ä¸ç”¨å¼€è™šæ‹ŸåŒ–</p><p><strong>(é‡è¦ï¼ï¼)è™šæ‹Ÿæœºä¸è¦ç”¨å…‹éš†ï¼Œæ¯å°éƒ½è¦å•ç‹¬åˆ›å»ºå¦åˆ™ä¼šå‡ºé—®é¢˜ã€‚</strong></p><p>æœªå®‰è£…docker ä¹‹å‰åˆ›å»ºä¸€ä¸ªå¿«ç…§ã€‚</p><p>å®‰è£…dockerã€kubeletï¼Œå¹¶åˆå§‹åŒ–é›†ç¾¤ååœ¨åˆ›å»ºä¸€ä¸ªå¿«ç…§ã€‚</p><p>æœªå®‰è£…cniæ’ä»¶ä¹‹å‰åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œä»¥ä¾¿äºéšæ—¶æ›´æ”¹calico å’Œfluence</p><p>kubeadm åˆå§‹åŒ–å¤±è´¥æ£€æŸ¥ï¼Œé‡ç½®kubeadmã€‚</p><p>ip åœ°å€è§„åˆ’ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>master: 10.4.7.60/24 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gw:10.4.7.254
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dns:114.114.114.114
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>worker1: 10.4.7.61/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gw:10.4.7.254
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dns:114.114.114.114
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>worker1: 10.4.7.61/24
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gw:10.4.7.254
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dns:114.114.114.114
</span></span></code></pre></td></tr></table></div></div><p><strong>å„èŠ‚ç‚¹å®‰è£…æ—¶éœ€è¦æ›´æ¢aptæºï¼š(æ›´æ–°å’Œå®‰è£…debåŒ…éƒ½å¾ˆå¿«ï¼ï¼ï¼)</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>http://mirrors.tuna.tsinghua.edu.cn/ubuntu/
</span></span></code></pre></td></tr></table></div></div><h3 id=1-è®¾ç½®hostsè§£æ>1. è®¾ç½®hostsè§£æ</h3><p>æ“ä½œèŠ‚ç‚¹ï¼šæ‰€æœ‰èŠ‚ç‚¹ï¼ˆ<code>master</code>ï¼‰å‡éœ€æ‰§è¡Œ</p><ul><li><strong>ä¿®æ”¹hostname</strong>
hostnameå¿…é¡»åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€","ã€"-"ï¼Œä¸”å¼€å¤´ç»“å°¾å¿…é¡»æ˜¯å°å†™å­—æ¯æˆ–æ•°å­—</li></ul><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic># åœ¨masterèŠ‚ç‚¹</span>
</span></span><span style=display:flex><span>hostnamectl set-hostname master <span style=color:#998;font-style:italic>#è®¾ç½®masterèŠ‚ç‚¹çš„hostname</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># slave1èŠ‚ç‚¹</span>
</span></span><span style=display:flex><span>hostnamectl set-hostname worker1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># slave2èŠ‚ç‚¹</span>
</span></span><span style=display:flex><span>hostnamectl set-hostname worker2
</span></span></code></pre></td></tr></table></div></div><h3 id=2-è°ƒæ•´ç³»ç»Ÿé…ç½®>2. è°ƒæ•´ç³»ç»Ÿé…ç½®</h3><p>æ“ä½œèŠ‚ç‚¹ï¼š æ‰€æœ‰çš„masterå’ŒslaveèŠ‚ç‚¹ï¼ˆ<code>master,k8s-slave</code>ï¼‰éœ€è¦æ‰§è¡Œ</p><blockquote><p>æœ¬ç« ä¸‹è¿°æ“ä½œå‡ä»¥masterä¸ºä¾‹ï¼Œå…¶ä»–èŠ‚ç‚¹å‡æ˜¯ç›¸åŒçš„æ“ä½œï¼ˆipå’Œhostnameçš„å€¼æ¢æˆå¯¹åº”æœºå™¨çš„çœŸå®å€¼ï¼‰</p></blockquote><p><strong>è®¾ç½®iptables</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>iptables -P FORWARD ACCEPT
</span></span><span style=display:flex><span>/etc/init.d/ufw stop
</span></span><span style=display:flex><span>ufw disable
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>å…³é—­swap</strong></li></ul><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>swapoff -a
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># é˜²æ­¢å¼€æœºè‡ªåŠ¨æŒ‚è½½ swap åˆ†åŒº</span>
</span></span><span style=display:flex><span>rm /swap.img  
</span></span><span style=display:flex><span>sed -i <span style=color:#d14>&#39;/ swap / s/^\(.*\)$/#\1/g&#39;</span> /etc/fstab
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>ä¿®æ”¹å†…æ ¸å‚æ•°</strong></li></ul><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>cat <span style=color:#d14>&lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#d14>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style=display:flex><span><span style=color:#d14>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style=display:flex><span><span style=color:#d14>net.ipv4.ip_forward=1
</span></span></span><span style=display:flex><span><span style=color:#d14>vm.max_map_count=262144
</span></span></span><span style=display:flex><span><span style=color:#d14>EOF</span>
</span></span><span style=display:flex><span>modprobe br_netfilter
</span></span><span style=display:flex><span>sysctl -p /etc/sysctl.d/k8s.conf
</span></span></code></pre></td></tr></table></div></div><ul><li>è®¾ç½®aptæº</li></ul><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>apt-get update <span style=color:#000;font-weight:700>&amp;&amp;</span> apt-get install -y apt-transport-https ca-certificates software-properties-common 
</span></span><span style=display:flex><span>curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - 
</span></span><span style=display:flex><span>curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
</span></span><span style=display:flex><span>add-apt-repository <span style=color:#d14>&#34;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu </span><span style=color:#000;font-weight:700>$(</span>lsb_release -cs<span style=color:#000;font-weight:700>)</span><span style=color:#d14> stable&#34;</span>
</span></span><span style=display:flex><span>add-apt-repository <span style=color:#d14>&#34;deb [arch=amd64] https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apt-get update   
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#è‹¥ä¸Šæ­¥å‡ºç°NO_PUBLICKEYé—®é¢˜ï¼Œå‚è€ƒhttps://www.cnblogs.com/jiangzuo/p/13667011.html</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-å®‰è£…docker>3. å®‰è£…docker</h3><p>æ“ä½œèŠ‚ç‚¹ï¼š æ‰€æœ‰èŠ‚ç‚¹</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>apt<span style=color:#000;font-weight:700>-</span>get install docker<span style=color:#000;font-weight:700>-</span>ce<span style=color:#000;font-weight:700>=</span><span style=color:#099>5</span>:<span style=color:#099>20.10.9</span><span style=color:#000;font-weight:700>~</span><span style=color:#099>3</span><span style=color:#000;font-weight:700>-</span><span style=color:#099>0</span><span style=color:#000;font-weight:700>~</span>ubuntu<span style=color:#000;font-weight:700>-</span>focal
</span></span><span style=display:flex><span>systemctl enable docker <span style=color:#000;font-weight:700>&amp;&amp;</span> systemctl start docker
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„è¦å…³é—­docker é»˜è®¤çš„cgroup å¦åˆ™ä¼šå‡ºç°kubeadm åˆå§‹åŒ–å¤±è´¥ï¼ï¼ï¼ï¼</p><p>è¿™æ˜¯cgroupé©±åŠ¨é—®é¢˜ã€‚é»˜è®¤æƒ…å†µä¸‹Kubernetes cgroupé©±åŠ¨ç¨‹åºè®¾ç½®ä¸ºsystemï¼Œä½†dockerè®¾ç½®ä¸ºsystemdã€‚æˆ‘ä»¬éœ€è¦æ›´æ”¹Docker cgroupé©±åŠ¨ï¼Œé€šè¿‡åˆ›å»ºé…ç½®æ–‡ä»¶<code>/etc/docker/daemon.json</code>å¹¶æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>{<span style=color:#d14>&#34;exec-opts&#34;</span><span style=color:#000;font-weight:700>:</span> [<span style=color:#d14>&#34;native.cgroupdriver=systemd&#34;</span>]}
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åï¼Œä¸ºä½¿é…ç½®ç”Ÿæ•ˆï¼Œä½ å¿…é¡»é‡å¯dockerå’Œkubeletã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>systemctl daemon-reloadsystemctl restart dockersystemctl restart kubelet
</span></span></code></pre></td></tr></table></div></div><p>é‡ç½®kubeadm</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>sudo kubeadm reset
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹æ˜¯å¦æœ‰æ±¡ç‚¹</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get nodes -o json | jq <span style=color:#d14>&#39;.items[].spec.taints&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç»™kubectl-è®¾ç½®åˆ«åä¸ºkæ°¸ä¹…ç”Ÿæ•ˆ>ç»™kubectl è®¾ç½®åˆ«åä¸ºkï¼Œæ°¸ä¹…ç”Ÿæ•ˆã€‚</h3><p>é€€å‡ºå½“å‰ç”¨æˆ·åœ¨è¿›å…¥å°±ç”Ÿæ•ˆäº†ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>vi .bashrc
</span></span><span style=display:flex><span><span style=color:#0086b3>alias</span> <span style=color:teal>k</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;kubectl&#39;</span>
</span></span><span style=display:flex><span><span style=color:#0086b3>source</span> ~/.bashrc
</span></span></code></pre></td></tr></table></div></div><p>åˆ é™¤masterèŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹ï¼Œåˆ é™¤åpodå¯ä»¥è°ƒåº¦åˆ°masterä¸Šã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl taint nodes --all node-role.kubernetes.io/master-
</span></span></code></pre></td></tr></table></div></div><h3 id=ä½¿ç”¨kubectlä¸­çš„å¼ºåˆ¶åˆ é™¤å‘½ä»¤>ä½¿ç”¨kubectlä¸­çš„å¼ºåˆ¶åˆ é™¤å‘½ä»¤</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl delete pod podName -n NAMESPACE --force --grace-period<span style=color:#000;font-weight:700>=</span><span style=color:#099>0</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è‡ªåŠ¨è¡¥å…¨>è‡ªåŠ¨è¡¥å…¨</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>apt install bash-completion
</span></span><span style=display:flex><span>// locate bash_completion
</span></span><span style=display:flex><span><span style=color:#0086b3>source</span> /usr/share/bash-completion/bash_completion
</span></span><span style=display:flex><span><span style=color:#0086b3>source</span> &lt;<span style=color:#000;font-weight:700>(</span>kubectl completion bash<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#0086b3>echo</span> <span style=color:#d14>&#34;source &lt;(kubectl completion bash)&#34;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span><span style=color:#0086b3>source</span> ~/.bashrc
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹æ‰€æœ‰pod</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get po -owide  -A 
</span></span></code></pre></td></tr></table></div></div><h2 id=éƒ¨ç½²kubernetes>éƒ¨ç½²kubernetes</h2><h3 id=1-å®‰è£…-kubeadm-kubelet-å’Œ-kubectl>1. å®‰è£… kubeadm, kubelet å’Œ kubectl</h3><p>æ“ä½œèŠ‚ç‚¹ï¼š æ‰€æœ‰çš„masterå’ŒslaveèŠ‚ç‚¹(<code>master,k8s-slave</code>) éœ€è¦æ‰§è¡Œ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>apt-get install <span style=color:teal>kubelet</span><span style=color:#000;font-weight:700>=</span>1.22.2-00 <span style=color:teal>kubectl</span><span style=color:#000;font-weight:700>=</span>1.22.2-00 <span style=color:teal>kubeadm</span><span style=color:#000;font-weight:700>=</span>1.22.2-00
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>## æŸ¥çœ‹kubeadm ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>kubeadm version
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>## è®¾ç½®kubeletå¼€æœºå¯åŠ¨</span>
</span></span><span style=display:flex><span>systemctl <span style=color:#0086b3>enable</span> kubelet 
</span></span></code></pre></td></tr></table></div></div><h3 id=2-åˆå§‹åŒ–é…ç½®æ–‡ä»¶>2. åˆå§‹åŒ–é…ç½®æ–‡ä»¶</h3><p>æ“ä½œèŠ‚ç‚¹ï¼š åªåœ¨masterèŠ‚ç‚¹ï¼ˆ<code>master</code>ï¼‰æ‰§è¡Œ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubeadm config print init-defaults &gt; kubeadm.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style=display:flex><span>bootstrapTokens:
</span></span><span style=display:flex><span>- groups:
</span></span><span style=display:flex><span>  - system:bootstrappers:kubeadm:default-node-token
</span></span><span style=display:flex><span>  token: abcdef.0123456789abcdef
</span></span><span style=display:flex><span>  ttl: 24h0m0s
</span></span><span style=display:flex><span>  usages:
</span></span><span style=display:flex><span>  - signing
</span></span><span style=display:flex><span>  - authentication
</span></span><span style=display:flex><span>kind: InitConfigurationx
</span></span><span style=display:flex><span>localAPIEndpoint:
</span></span><span style=display:flex><span>  advertiseAddress: 10.4.7.60 <span style=color:#998;font-style:italic>#ä¿®æ”¹ä¸ºmaster çš„IP</span>
</span></span><span style=display:flex><span>  bindPort: <span style=color:#099>6443</span>
</span></span><span style=display:flex><span>nodeRegistration:
</span></span><span style=display:flex><span>  criSocket: /var/run/dockershim.sock
</span></span><span style=display:flex><span>  name: node     <span style=color:#998;font-style:italic># åˆ æ‰æ­¤è¡Œï¼Œåˆ æ‰æ­¤è¡Œï¼Œåˆ æ‰æ­¤è¡Œ</span>
</span></span><span style=display:flex><span>  imagePullPolicy: IfNotPresent
</span></span><span style=display:flex><span>  taints: null
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiServer:
</span></span><span style=display:flex><span>  timeoutForControlPlane: 4m0s
</span></span><span style=display:flex><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style=display:flex><span>certificatesDir: /etc/kubernetes/pki
</span></span><span style=display:flex><span>clusterName: kubernetes
</span></span><span style=display:flex><span>controllerManager: <span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>dns: <span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>etcd:
</span></span><span style=display:flex><span>  local:
</span></span><span style=display:flex><span>    dataDir: /var/lib/etcd
</span></span><span style=display:flex><span>imageRepository: registry.aliyuncs.com/google_containers
</span></span><span style=display:flex><span>kind: ClusterConfiguration
</span></span><span style=display:flex><span>kubernetesVersion: 1.22.2
</span></span><span style=display:flex><span>networking:
</span></span><span style=display:flex><span>  dnsDomain: cluster.local
</span></span><span style=display:flex><span>  podSubnet: 10.244.0.0/16   <span style=color:#998;font-style:italic>#æ·»åŠ æ­¤è¡Œ</span>
</span></span><span style=display:flex><span>  serviceSubnet: 10.96.0.0/12
</span></span><span style=display:flex><span>scheduler: <span style=color:#000;font-weight:700>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-æå‰ä¸‹è½½é•œåƒ>3. æå‰ä¸‹è½½é•œåƒ</h3><p>æ“ä½œèŠ‚ç‚¹ï¼šåªåœ¨masterèŠ‚ç‚¹ï¼ˆ<code>master</code>ï¼‰æ‰§è¡Œ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic># æå‰ä¸‹è½½é•œåƒåˆ°æœ¬åœ°</span>
</span></span><span style=display:flex><span>kubeadm config images pull --config kubeadm.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>config/images<span style=color:#000;font-weight:700>]</span> Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.22.2
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>config/images<span style=color:#000;font-weight:700>]</span> Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.22.2
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>config/images<span style=color:#000;font-weight:700>]</span> Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.22.2
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>config/images<span style=color:#000;font-weight:700>]</span> Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.22.2
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>config/images<span style=color:#000;font-weight:700>]</span> Pulled registry.aliyuncs.com/google_containers/pause:3.5
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>config/images<span style=color:#000;font-weight:700>]</span> Pulled registry.aliyuncs.com/google_containers/etcd:3.5.0-0
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>config/images<span style=color:#000;font-weight:700>]</span> Pulled registry.aliyuncs.com/google_containers/coredns:v1.8.4
</span></span></code></pre></td></tr></table></div></div><h3 id=4-åˆå§‹åŒ–masterèŠ‚ç‚¹>4. åˆå§‹åŒ–masterèŠ‚ç‚¹</h3><p>æ“ä½œèŠ‚ç‚¹ï¼šåªåœ¨masterèŠ‚ç‚¹ï¼ˆ<code>k8s-master</code>ï¼‰æ‰§è¡Œ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubeadm init --config kubeadm.yaml
</span></span></code></pre></td></tr></table></div></div><p>è‹¥åˆå§‹åŒ–æˆåŠŸåï¼Œæœ€åä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>...
</span></span><span style=display:flex><span>To start using your cluster, you need to run the following as a regular user:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mkdir -p <span style=color:teal>$HOME</span>/.kube
</span></span><span style=display:flex><span>  sudo cp -i /etc/kubernetes/admin.conf <span style=color:teal>$HOME</span>/.kube/config
</span></span><span style=display:flex><span>  sudo chown <span style=color:#000;font-weight:700>$(</span>id -u<span style=color:#000;font-weight:700>)</span>:<span style=color:#000;font-weight:700>$(</span>id -g<span style=color:#000;font-weight:700>)</span> <span style=color:teal>$HOME</span>/.kube/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Alternatively, <span style=color:#000;font-weight:700>if</span> you are the root user, you can run:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#0086b3>export</span> <span style=color:teal>KUBECONFIG</span><span style=color:#000;font-weight:700>=</span>/etc/kubernetes/admin.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>You should now deploy a pod network to the cluster.
</span></span><span style=display:flex><span>Run <span style=color:#d14>&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span style=display:flex><span>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubeadm join 10.4.7.60:6443 --token abcdef.0123456789abcdef <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>        --discovery-token-ca-cert-hash sha256:3a7987c9f5007ebac7980e6614281ee0e064c760c8db012471f9f662289cc9ce
</span></span></code></pre></td></tr></table></div></div><p>æ¥ä¸‹æ¥æŒ‰ç…§ä¸Šè¿°æç¤ºä¿¡æ¯æ“ä½œï¼Œé…ç½®kubectlå®¢æˆ·ç«¯çš„è®¤è¯</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mkdir -p <span style=color:teal>$HOME</span>/.kube
</span></span><span style=display:flex><span>sudo cp -i /etc/kubernetes/admin.conf <span style=color:teal>$HOME</span>/.kube/config
</span></span><span style=display:flex><span>sudo chown <span style=color:#000;font-weight:700>$(</span>id -u<span style=color:#000;font-weight:700>)</span>:<span style=color:#000;font-weight:700>$(</span>id -g<span style=color:#000;font-weight:700>)</span> <span style=color:teal>$HOME</span>/.kube/config
</span></span></code></pre></td></tr></table></div></div><blockquote><p>**âš ï¸æ³¨æ„ï¼š**æ­¤æ—¶ä½¿ç”¨ kubectl get nodesæŸ¥çœ‹èŠ‚ç‚¹åº”è¯¥å¤„äºnotReadyçŠ¶æ€ï¼Œå› ä¸ºè¿˜æœªé…ç½®ç½‘ç»œæ’ä»¶</p><p>è‹¥æ‰§è¡Œåˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œæ ¹æ®é”™è¯¯ä¿¡æ¯è°ƒæ•´åï¼Œæ‰§è¡Œkubeadm resetåå†æ¬¡æ‰§è¡Œinitæ“ä½œå³å¯</p></blockquote><h3 id=5-æ·»åŠ slaveèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­>5. æ·»åŠ slaveèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­</h3><p>æ“ä½œèŠ‚ç‚¹ï¼šæ‰€æœ‰çš„slaveèŠ‚ç‚¹ï¼ˆ<code>worker1</code>`worker2`ï¼‰éœ€è¦æ‰§è¡Œ
åœ¨æ¯å°slaveèŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ˜¯åœ¨kubeadm initæˆåŠŸåæç¤ºä¿¡æ¯ä¸­æ‰“å°å‡ºæ¥çš„ï¼Œéœ€è¦æ›¿æ¢æˆå®é™…initåæ‰“å°å‡ºçš„å‘½ä»¤ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubeadm join 10.4.7.60:6443 --token abcdef.0123456789abcdef <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>        --discovery-token-ca-cert-hash sha256:3a7987c9f5007ebac7980e6614281ee0e064c760c8db012471f9f662289cc9ce
</span></span></code></pre></td></tr></table></div></div><h3 id=6-å®‰è£…calicoæ’ä»¶>6. å®‰è£…calicoæ’ä»¶</h3><p>æ“ä½œèŠ‚ç‚¹ï¼šåªåœ¨masterèŠ‚ç‚¹ï¼ˆ<code>master</code>ï¼‰æ‰§è¡Œ</p><p><strong>æ–¹å¼ä¸€ï¼šç›´æ¥å®‰è£…</strong>ï¼ˆæœªä½¿ç”¨ï¼ï¼ï¼ï¼‰</p><ul><li><p>ä¸‹è½½èµ„æºæ–‡ä»¶</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>wget https://docs.projectcalico.org/manifests/calico-etcd.yaml
</span></span></code></pre></td></tr></table></div></div></li><li><p>ä¿®æ”¹é…ç½®</p><ul><li><p>æ³¨é‡Šæ‰æ–‡ä»¶çš„å‰22è¡Œ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#099>1</span><span style=color:#bbb> </span>---<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>2 # Source</span>:<span style=color:#bbb> </span>calico/templates/calico-etcd-secrets.yaml<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#099>3</span><span style=color:#bbb> </span><span style=color:#998;font-style:italic># The following contains k8s Secrets for use with a TLS enabled etcd cluster.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#099>4</span><span style=color:#bbb> </span><span style=color:#998;font-style:italic># For information on populating Secrets, see http://kubernetes.io/docs/user-guide/secrets/</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>5 #apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>6 #kind</span>:<span style=color:#bbb> </span>Secret<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>7 #type</span>:<span style=color:#bbb> </span>Opaque<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>8 #metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>9 #  name</span>:<span style=color:#bbb> </span>calico-etcd-secrets<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>10 #  namespace</span>:<span style=color:#bbb> </span>kube-system<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>11 #data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>12</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># Populate the following with etcd TLS configuration if desired, but leave blank if</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>13</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># not using TLS for etcd.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>14</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># The keys below should be uncommented and the values populated with the base64</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>15</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># encoded contents of each file that would be associated with the TLS data.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>16   # Example command for encoding a file contents</span>:<span style=color:#bbb> </span>cat &lt;file&gt; | base64 -w 0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>17   # etcd-key</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>18   # etcd-cert</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>19   # etcd-ca</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>20</span><span style=color:#bbb> </span>---<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>21 # Source</span>:<span style=color:#bbb> </span>calico/templates/calico-config.yaml<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>22</span><span style=color:#bbb> </span><span style=color:#998;font-style:italic># This ConfigMap is used to configure a self-hosted Calico installation.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>23 kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>24 apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>25 metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>26   name</span>:<span style=color:#bbb> </span>calico-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>27   namespace</span>:<span style=color:#bbb> </span>kube-system<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span>...<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>ä¿®æ”¹configmap</p><p>æ³¨æ„30-35è¡Œï¼Œå…¶ä¸­etcd_endpointsæ¢æˆç¯å¢ƒçš„etcdåœ°å€</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>23 kind</span>:<span style=color:#bbb> </span>ConfigMap<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>24 apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>25 metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>26   name</span>:<span style=color:#bbb> </span>calico-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>27   namespace</span>:<span style=color:#bbb> </span>kube-system<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>28 data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>29</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># Configure this with the location of your etcd cluster.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>30   etcd_endpoints</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;https://10.4.7.60:2379&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>31</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># If you&#39;re using TLS enabled etcd uncomment the following.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>32</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># You must also populate the Secret below with these files.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>33   etcd_ca</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;/calico-secrets/etcd-ca&#34;</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># &#34;/calico-secrets/etcd-ca&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>34   etcd_cert</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;/calico-secrets/etcd-cert&#34;</span><span style=color:#bbb> </span><span style=color:#998;font-style:italic># &#34;/calico-secrets/etcd-cert&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>35   etcd_key</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;/calico-secrets/etcd-key&#34;</span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># &#34;/calico-secrets/etcd-key&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>36</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># Typha is disabled.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>37   typha_service_name</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;none&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#099>38</span><span style=color:#bbb>   </span><span style=color:#998;font-style:italic># Configure the backend to use.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:navy>39   calico_backend</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;bird&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>æ·»åŠ calico-nodeç¯å¢ƒå˜é‡</p><p>æ³¨æ„297-302è¡Œä¸ºæ–°æ·»åŠ </p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:navy>285       containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#099>286</span><span style=color:#bbb>         </span><span style=color:#998;font-style:italic># Runs calico-node container on each Kubernetes node. This</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#099>287</span><span style=color:#bbb>         </span><span style=color:#998;font-style:italic># container programs network policy and routes on each</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#099>288</span><span style=color:#bbb>         </span><span style=color:#998;font-style:italic># host.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>289         - name</span>:<span style=color:#bbb> </span>calico-node<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>290           image</span>:<span style=color:#bbb> </span>docker.io/calico/node:v3.20.0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>291           envFrom</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>292           - configMapRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#099>293</span><span style=color:#bbb>               </span><span style=color:#998;font-style:italic># Allow KUBERNETES_SERVICE_HOST and KUBERNETES_SERVICE_PORT to be overridden for eBPF mode.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>294               name</span>:<span style=color:#bbb> </span>kubernetes-services-endpoint<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>295               optional</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>296           env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>297             - name</span>:<span style=color:#bbb> </span>KUBERNETES_SERVICE_HOST<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>298               value</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;10.4.7.60&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>299             - name</span>:<span style=color:#bbb> </span>KUBERNETES_SERVICE_PORT<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>300               value</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;6443&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>301             - name</span>:<span style=color:#bbb> </span>KUBERNETES_SERVICE_PORT_HTTPS<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>302               value</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;6443&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#099>303</span><span style=color:#bbb>             </span><span style=color:#998;font-style:italic># The location of the etcd cluster.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>304             - name</span>:<span style=color:#bbb> </span>ETCD_ENDPOINTS<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>305               valueFrom</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>306                 configMapKeyRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>307                   name</span>:<span style=color:#bbb> </span>calico-config<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>308                   key</span>:<span style=color:#bbb> </span>etcd_endpoints<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#099>309</span><span style=color:#bbb>             </span><span style=color:#998;font-style:italic># Location of the CA certificate for etcd.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>310             - name</span>:<span style=color:#bbb> </span>ETCD_CA_CERT_FILE<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>ä¿®æ”¹CIDR</p><p>æ³¨æ„371-372è¡Œï¼Œvalueå€¼ä¸ºk8sé›†ç¾¤åˆå§‹åŒ–çš„pod-network-cidr</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#099>370</span><span style=color:#bbb>             </span><span style=color:#998;font-style:italic># no effect. This should fall within `--cluster-cidr`.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>371             - name</span>:<span style=color:#bbb> </span>CALICO_IPV4POOL_CIDR<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>372               value</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;10.244.0.0/16&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#099>373</span><span style=color:#bbb>             </span><span style=color:#998;font-style:italic># Disable file logging so `kubectl logs` works.</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>374             - name</span>:<span style=color:#bbb> </span>CALICO_DISABLE_FILE_LOGGING<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>375               value</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;true&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>åˆ›å»ºsecret</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl -n kube-system create secret generic calico-etcd-secrets --from-file<span style=color:#000;font-weight:700>=</span>etcd-ca<span style=color:#000;font-weight:700>=</span>/etc/kubernetes/pki/etcd/ca.crt --from-file<span style=color:#000;font-weight:700>=</span>etcd-cert<span style=color:#000;font-weight:700>=</span>/etc/kubernetes/pki/etcd/healthcheck-client.crt --from-file<span style=color:#000;font-weight:700>=</span>etcd-key<span style=color:#000;font-weight:700>=</span>/etc/kubernetes/pki/etcd/healthcheck-client.key
</span></span></code></pre></td></tr></table></div></div><p>åˆ›å»ºcalicoèµ„æºæ¸…å•</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl apply -f calico-etcd.yaml
</span></span></code></pre></td></tr></table></div></div></li></ul></li></ul><p>â€‹ ç­‰å¾…podå¯åŠ¨å®Œæˆ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl -n kube-system get po 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>calico-kube-controllers-59db5cf8fd-fpzdq   1/1     Running   <span style=color:#099>1</span>          32m
</span></span><span style=display:flex><span>calico-node-d2xq4                          1/1     Running   <span style=color:#099>1</span>          32m
</span></span><span style=display:flex><span>calico-node-ppzjk     
</span></span></code></pre></td></tr></table></div></div><p>calicoæ’ä»¶åŒ…ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>docker.io/calico/cni:v3.20.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker.io/calico/pod2daemon-flexvol:v3.20.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker.io/calico/node:v3.20.2
</span></span></code></pre></td></tr></table></div></div><p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨operatorå®‰è£…</strong>(å·²æˆåŠŸï¼ï¼ï¼ï¼ï¼ï¼)</p><ul><li><p>å®‰è£…operator</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl create -f https://docs.projectcalico.org/manifests/tigera-operator.yaml
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç­‰å¾…operator podå®‰è£…å¯åŠ¨å®Œæˆ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl -n tigera-operator get po
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                               READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>tigera-operator-698876cbb5-kfpb2   1/1     Running   <span style=color:#099>0</span>          38m
</span></span></code></pre></td></tr></table></div></div><blockquote><p>é•œåƒæ‹‰å–æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥æ‰‹åŠ¨å»èŠ‚ç‚¹docker pullæ‹‰å–</p></blockquote></li><li><p>ç¼–è¾‘calicoé…ç½®</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>vim custom-resources.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apiVersion: operator.tigera.io/v1
</span></span><span style=display:flex><span>kind: Installation
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: default
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  <span style=color:#998;font-style:italic># Configures Calico networking.</span>
</span></span><span style=display:flex><span>  calicoNetwork:
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic># Note: The ipPools section cannot be modified post-install.</span>
</span></span><span style=display:flex><span>    ipPools:
</span></span><span style=display:flex><span>    - blockSize: <span style=color:#099>26</span>
</span></span><span style=display:flex><span>      cidr: 10.244.0.0/16        <span style=color:#998;font-style:italic>#ä¿®æ”¹å’Œpod cidrä¸€è‡´</span>
</span></span><span style=display:flex><span>      encapsulation: VXLANCrossSubnet
</span></span><span style=display:flex><span>      natOutgoing: Enabled
</span></span><span style=display:flex><span>      nodeSelector: all<span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># This section configures the Calico API server.</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># For more information, see: https://docs.projectcalico.org/v3.20/reference/installation/api#operator.tigera.io/v1.APIServer</span>
</span></span><span style=display:flex><span>apiVersion: operator.tigera.io/v1
</span></span><span style=display:flex><span>kind: APIServer
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: default
</span></span><span style=display:flex><span>spec: <span style=color:#000;font-weight:700>{}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>åˆ›å»ºcalicoé…ç½®</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl apply -f custom-resources.yaml
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç­‰å¾…operatorè‡ªåŠ¨åˆ›å»ºcalicoçš„pod</p></li></ul><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic># operatorä¼šè‡ªåŠ¨åˆ›å»ºcalico-apiserverå’Œcalico-systemä¸¤ä¸ªå‘½åç©ºé—´ä»¥åŠå¿…è¦çš„podï¼Œç­‰å¾…podå¯åŠ¨å®Œæˆå³å¯</span>
</span></span><span style=display:flex><span>kubectl get ns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME               STATUS   AGE
</span></span><span style=display:flex><span>calico-apiserver   Active   13m
</span></span><span style=display:flex><span>calico-system      Active   19m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n calico-apiserver get po
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>calico-apiserver-554fbf9554-b6kzv   1/1     Running   <span style=color:#099>0</span>          13m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n calico-system get po
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>calico-kube-controllers-868b656ff4-hn6qv   1/1     Running   <span style=color:#099>0</span>          20m
</span></span><span style=display:flex><span>calico-node-qqrp9                          1/1     Running   <span style=color:#099>0</span>          20m
</span></span><span style=display:flex><span>calico-node-r45z2                          1/1     Running   <span style=color:#099>0</span>          20m
</span></span><span style=display:flex><span>calico-typha-5b64cf4b48-vws5j              1/1     Running   <span style=color:#099>0</span>          20m
</span></span><span style=display:flex><span>calico-typha-5b64cf4b48-w6wqf              1/1     Running   <span style=color:#099>0</span>          20m
</span></span></code></pre></td></tr></table></div></div><h3 id=7-éªŒè¯é›†ç¾¤>7. éªŒè¯é›†ç¾¤</h3><p>æ“ä½œèŠ‚ç‚¹ï¼š åœ¨masterèŠ‚ç‚¹ï¼ˆ<code>k8s-master</code>ï¼‰æ‰§è¡Œ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get nodes  <span style=color:#998;font-style:italic>#è§‚å¯Ÿé›†ç¾¤èŠ‚ç‚¹æ˜¯å¦å…¨éƒ¨Ready</span>
</span></span></code></pre></td></tr></table></div></div><p>åˆ›å»ºæµ‹è¯•nginxæœåŠ¡</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl run  test-nginx --image<span style=color:#000;font-weight:700>=</span>nginx:alpine
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹podæ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œå¹¶è®¿é—®pod ipæµ‹è¯•æ˜¯å¦å¯ç”¨</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>kubectl get po -o wide
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                          READY   STATUS    RESTARTS   AGE   IP           NODE         NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>test-nginx-5bd8859b98-5nnnw   1/1     Running   <span style=color:#099>0</span>          9s    10.244.1.2   k8s-slave1   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>curl 10.244.1.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span style=display:flex><span>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span style=display:flex><span>working. Further configuration is required.&lt;/p&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;p&gt;For online documentation and support please refer to
</span></span><span style=display:flex><span>&lt;a <span style=color:teal>href</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span style=display:flex><span>Commercial support is available at
</span></span><span style=display:flex><span>&lt;a <span style=color:teal>href</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;p&gt;&lt;em&gt;Thank you <span style=color:#000;font-weight:700>for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><h3 id=8-æ¸…ç†ç¯å¢ƒ>8. æ¸…ç†ç¯å¢ƒ</h3><p>å¦‚æœä½ çš„é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°äº†å…¶ä»–é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è¿›è¡Œé‡ç½®ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic># åœ¨å…¨éƒ¨é›†ç¾¤èŠ‚ç‚¹æ‰§è¡Œ</span>
</span></span><span style=display:flex><span>kubeadm reset
</span></span><span style=display:flex><span>ifconfig cni0 down <span style=color:#000;font-weight:700>&amp;&amp;</span> ip link delete cni0
</span></span><span style=display:flex><span>ifconfig flannel.1 down <span style=color:#000;font-weight:700>&amp;&amp;</span> ip link delete flannel.1
</span></span><span style=display:flex><span>rm -rf /run/flannel/subnet.env
</span></span><span style=display:flex><span>rm -rf /var/lib/cni/
</span></span><span style=display:flex><span>mv /etc/kubernetes/ /tmp
</span></span><span style=display:flex><span>mv /var/lib/etcd /tmp
</span></span><span style=display:flex><span>mv ~/.kube /tmp
</span></span><span style=display:flex><span>iptables -F
</span></span><span style=display:flex><span>iptables -t nat -F
</span></span><span style=display:flex><span>ipvsadm -C
</span></span><span style=display:flex><span>ip link del kube-ipvs0
</span></span><span style=display:flex><span>ip link del dummy0
</span></span></code></pre></td></tr></table></div></div><p>è®¾ç½®aptæºæŠ¥é”™ã€‚æ¢æº</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>apt-get update <span style=color:#000;font-weight:700>&amp;&amp;</span> apt-get install -y apt-transport-https ca-certificates software-properties-common 
</span></span><span style=display:flex><span>curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - 
</span></span><span style=display:flex><span>curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | apt-key add -
</span></span><span style=display:flex><span>add-apt-repository <span style=color:#d14>&#34;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu </span><span style=color:#000;font-weight:700>$(</span>lsb_release -cs<span style=color:#000;font-weight:700>)</span><span style=color:#d14> stable&#34;</span>
</span></span><span style=display:flex><span>add-apt-repository <span style=color:#d14>&#34;deb [arch=amd64] https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apt-get update   
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#è‹¥ä¸Šæ­¥å‡ºç°NO_PUBLICKEYé—®é¢˜ï¼Œå‚è€ƒhttps://www.cnblogs.com/jiangzuo/p/13667011.html</span>
</span></span></code></pre></td></tr></table></div></div><p>æœªå®‰è£…cniæ’ä»¶podçŠ¶æ€</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span> coredns-7f6cbbb7b8-c778v pod ä¸èƒ½å¯åŠ¨å› ä¸ºæœªå®‰è£…cniæ’ä»¶ã€‚ 
</span></span><span style=display:flex><span>  events:
</span></span><span style=display:flex><span>  Warning  FailedScheduling  43s <span style=color:#000;font-weight:700>(</span>x2 over 2m13s<span style=color:#000;font-weight:700>)</span>  default-scheduler  0/3 nodes are available: <span style=color:#099>3</span> node<span style=color:#000;font-weight:700>(</span>s<span style=color:#000;font-weight:700>)</span> had taint <span style=color:#000;font-weight:700>{</span>node.kubernetes.io/not-ready: <span style=color:#000;font-weight:700>}</span>, that the pod didn<span style=color:#a61717;background-color:#e3d2d2>&#39;</span>t tolerate.
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  root@master:~# k get po -A -owide 
</span></span><span style=display:flex><span>NAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE     IP          NODE      NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>kube-system   coredns-7f6cbbb7b8-c778v         0/1     Pending   <span style=color:#099>0</span>          3m54s   &lt;none&gt;      &lt;none&gt;    &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   coredns-7f6cbbb7b8-px7cm         0/1     Pending   <span style=color:#099>0</span>          3m54s   &lt;none&gt;      &lt;none&gt;    &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   etcd-master                      1/1     Running   <span style=color:#099>0</span>          4m7s    10.4.7.70   master    &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   kube-apiserver-master            1/1     Running   <span style=color:#099>0</span>          4m7s    10.4.7.70   master    &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   kube-controller-manager-master   1/1     Running   <span style=color:#099>0</span>          4m7s    10.4.7.70   master    &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   kube-proxy-5w6c4                 1/1     Running   <span style=color:#099>0</span>          3m23s   10.4.7.71   worker1   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   kube-proxy-6jnkr                 1/1     Running   <span style=color:#099>0</span>          3m20s   10.4.7.72   worker2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   kube-proxy-hcwtz                 1/1     Running   <span style=color:#099>0</span>          3m54s   10.4.7.70   master    &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kube-system   kube-scheduler-master            1/1     Running   <span style=color:#099>0</span>          4m8s    10.4.7.70   master    &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=footer><div class=container-footer><div class=beian><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="></a><a href target=_blank><span class=some>icp...<span></a></div><div class=info><a href=https://github.com/loveminimal/hugo-theme-virgo>ğŸ•Šï¸</a> 2021 - <span id=info-date></span></div></div></div><div class=cool-after></div></body></html>