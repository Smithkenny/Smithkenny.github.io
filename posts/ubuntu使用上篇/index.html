<!doctype html><html lang=zh-CN><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content="Ubuntuä½¿ç”¨ä¸Šç¯‡ - https://www.haipengv.com/posts/ubuntu%E4%BD%BF%E7%94%A8%E4%B8%8A%E7%AF%87/"><meta name=author content="Smith - https://www.haipengv.com/"><meta name=msvalidate.01 content="B46311949B856F2A7015F366FB3CE878"><title>Ubuntuä½¿ç”¨ä¸Šç¯‡</title><base target=_self><link rel=icon type=image/png href=/favicon.ico><link rel=stylesheet href=https://www.haipengv.com/style.min.9a0cea23154ac1941e15c25aa2d31b77285a217d2606ec05b55236428cf1c3e6.css><script>const DARK=!1</script><script type=text/javascript src=/main.js defer></script></head><body class=active-animate><div class=cool-before></div><div id=header><div class=container-header><div class=right><h1 class=title>Ubuntuä½¿ç”¨ä¸Šç¯‡</h1><div id=toc>ğŸ“œ</div></div></div></div><div id=content><div class="container-main container-page"><div class=rel><div class=curtag-desc><a href=https://www.haipengv.com/tags/linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/><img src=/imgs/icons/tag.svg width=16> ç›¸å…³æ–‡ç« ï¼šLinuxåŸºç¡€çŸ¥è¯† <sup>41</sup></a></div><div class=curtag-post><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/>CentOS7 å‡çº§å†…æ ¸</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7.9%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E7%BB%BC%E5%90%88%E6%8C%87%E5%8D%97/>CentOS7.9ç³»ç»Ÿç®¡ç†ä¸æœåŠ¡é…ç½®ç»¼åˆæŒ‡å—</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7%E4%BD%BF%E7%94%A8systemd%E7%AE%A1%E7%90%86%E7%A8%8B%E5%BA%8F/>Centos7ä½¿ç”¨systemdç®¡ç†ç¨‹åº</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7-%E5%B8%B8%E8%A7%84%E5%91%BD%E4%BB%A4/>CentOS7å¸¸è§„å‘½ä»¤</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7%E7%BD%91%E5%8D%A1%E6%94%B9%E5%9B%9Eeth0%E6%98%BE%E7%A4%BA/>Centos7ç½‘å¡æ”¹å›eth0æ˜¾ç¤º</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos8%E9%85%8D%E7%BD%AEyum%E6%BA%90/>CentOS8é…ç½®yumæº</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/>Centosæ­å»ºå†…ç½‘é‚®ä»¶æœåŠ¡å™¨</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/crontab%E8%B8%A9%E5%9D%91%E8%AE%B0/>Crontabè¸©å‘è®°</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/git%E5%85%A5%E9%97%A8/>Gitå…¥é—¨</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/http%E5%92%8Chttps%E5%90%84%E7%A7%8D%E6%96%B9%E6%B3%95%E6%B5%8B%E8%AF%95/>Httpå’ŒHttpså„ç§æ–¹æ³•æµ‹è¯•</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/iptables%E5%B8%B8%E7%94%A8%E6%80%BB%E7%BB%93/>Iptableså¸¸ç”¨æ€»ç»“</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux-oom%E4%BB%8B%E7%BB%8D/>Linux OOMä»‹ç»</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%B8%8B%E6%B7%B7%E6%9D%82%E6%A8%A1%E5%BC%8F%E5%88%A4%E6%96%AD/>Linuxä¸‹æ··æ‚æ¨¡å¼åˆ¤æ–­</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%B8%AD%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/>Linuxä¸­ç¯å¢ƒå˜é‡</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%B8%AD%E7%9A%84%E9%9A%94%E7%A6%BB/>Linuxä¸­çš„éš”ç¦»</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E5%91%BD%E4%BB%A4/>Linuxä¿¡æ¯æŸ¥è¯¢å‘½ä»¤</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E5%9E%83%E5%9C%BE%E6%A1%B6/>Linuxåƒåœ¾æ¡¶</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/>Linuxå°æŠ€å·§æ±‡æ€»</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E6%97%A5%E5%BF%97%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%87%E5%89%B2/>Linuxæ—¥å¿—å¤§æ–‡ä»¶åˆ‡å‰²</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E6%9F%A5%E7%9C%8B%E7%A8%8B%E5%BA%8F%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4/>LinuxæŸ¥çœ‹ç¨‹åºè¿›ç¨‹å¯åŠ¨æ—¶é—´</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E6%A0%B9%E5%88%86%E5%8C%BA%E6%BB%A1%E4%BA%86%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95/>Linuxæ ¹åˆ†åŒºæ»¡äº†å¤„ç†æ–¹æ³•</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E7%A1%AC%E7%9B%98%E6%89%A9%E5%AE%B9%E5%92%8C%E7%BC%A9%E5%AE%B9/>Linuxç¡¬ç›˜æ‰©å®¹å’Œç¼©å®¹</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/pam%E6%A8%A1%E5%9D%97%E9%99%90%E5%88%B6%E7%99%BB%E5%BD%95/>Pamæ¨¡å—é™åˆ¶ç™»å½•</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/postman%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/>Postmanç®€å•ä½¿ç”¨</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/rsyslog%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/>Rsyslogæ—¥å¿—æœåŠ¡å™¨æ­å»º</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/ssh%E7%9B%B8%E5%85%B3%E8%AF%B4%E6%98%8E/>SSHç›¸å…³è¯´æ˜</a></div><div class="curtag-post-item curtag-post-item--active"><a href=https://www.haipengv.com/posts/ubuntu%E4%BD%BF%E7%94%A8%E4%B8%8A%E7%AF%87/>Ubuntuä½¿ç”¨ä¸Šç¯‡</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/ubuntu%E4%BD%BF%E7%94%A8%E4%B8%8B%E7%AF%87/>Ubuntuä½¿ç”¨ä¸‹ç¯‡</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/vsftpd%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/>Vsftpdç›¸å…³é…ç½®</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/>Vsftpä¸åŒç”¨æˆ·æ‹¥æœ‰ä¸åŒæƒé™</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E4%BD%BF%E7%94%A8logrotate%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2/>ä½¿ç”¨logrotateè¿›è¡Œæ—¥å¿—åˆ‡å‰²</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E4%BD%BF%E7%94%A8sed%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E7%BD%91%E5%9D%80/>ä½¿ç”¨sedæ‰¹é‡ä¿®æ”¹ç½‘å€</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E4%BD%BF%E7%94%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%99%BB%E5%BD%95linux%E6%9C%8D%E5%8A%A1%E5%99%A8/>ä½¿ç”¨æµè§ˆå™¨ç™»å½•linuxæœåŠ¡å™¨</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93ssh%E6%90%AD%E5%BB%BA%E6%96%B9%E6%B3%95/>å†…ç½‘éš§é“sshæ­å»ºæ–¹æ³•</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%85%B7-inxi/>åŠŸèƒ½å¼ºå¤§çš„ç¡¬ä»¶ä¿¡æ¯è·å–å·¥å…·-Inxi</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%8E%8B%E7%BC%A9%E4%B8%8E%E8%A7%A3%E5%8E%8B/>å‹ç¼©ä¸è§£å‹</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%A6%82%E4%BD%95%E7%AD%9B%E9%80%89%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E6%AE%B5%E5%86%85%E7%9A%84%E6%97%A5%E5%BF%97/>å¦‚ä½•ç­›é€‰æŒ‡å®šæ—¶é—´æ®µå†…çš„æ—¥å¿—</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E6%90%AD%E5%BB%BArss%E8%AE%A2%E9%98%85%E5%99%A8/>æ­å»ºrssè®¢é˜…å™¨</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E6%96%B0%E7%89%A9%E7%90%86%E7%A3%81%E7%9B%98%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%88%86%E5%8C%BA%E6%8C%82%E8%BD%BD%E8%BF%87%E7%A8%8B/>æ–°ç‰©ç†ç£ç›˜æ ¼å¼åŒ–ã€åˆ†åŒºã€æŒ‚è½½è¿‡ç¨‹</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%97%B6%E9%97%B4/>æŸ¥çœ‹ç³»ç»Ÿå®‰è£…æ—¶é—´</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E6%A8%A1%E6%8B%9Fssh%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4/>æ¨¡æ‹Ÿsshæ‰§è¡Œè¿œç¨‹å‘½ä»¤</a></div></div></div><div class=desc><span><svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667l-324.522666 324.48c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334L685.098667 499.2 524.885333 338.986667zM585.258667 278.656l160.170666 160.213333 102.144-102.144a19.712 19.712.0 000-27.861333l-132.48-132.437333a19.456 19.456.0 00-27.605333.0L585.258667 278.613333zM701.312 85.333333c27.946667.0 54.741333 11.136 74.282667 30.848L907.904 248.490667a105.045333 105.045333.0 010 148.565333L424.874667 879.957333C395.050667 914.304 352.768 935.424 304.426667 938.752H85.333333v-42.666667l.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666a104.789333 104.789333.0 0174.24-30.933334z" p-id="7410" fill="#adb5bd"/></svg>2025-03-16&nbsp;&nbsp;&nbsp;<svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859.0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775.0-360.398 149.372-360.398 356.147S305.225 870.23 512 870.23c206.775.0 357.467-151.455 357.467-358.23.0-23.859 23.634-50.706 53.413-50.706 29.78.0 49.92 26.847 49.92 50.706.0 254.493-206.307 460.8-460.8 460.8s-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4.0 226.684 33.296 312.264 117.369.358.351.358-24.052.0-73.209z" p-id="23839" fill="#adb5bd"/></svg>
2025-03-16&nbsp;&nbsp;&nbsp;</span>
<span><svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028c-70.774903.0-128.089859 57.325793-128.089859 128.03206v446.793671c0 70.7171050000001 57.314956 128.154884 128.089859 128.154884h133.353183a63.940169 63.940169.0 0155.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169.0 0155.212517-31.551041h133.54103c70.576219.0 127.732228-57.289669 127.732227-127.800865V192.391272c0-70.536482-57.181295-127.728615-127.786414-127.728615zM895.884854 639.842407A63.85347 63.85347.0 01832.092795 703.703103h-133.54103a127.753903 127.753903.0 00-110.349172 63.09847l-76.222461 129.856342a.274545.274545.0 010-.050574h-.032512s-.021675.061411-.032512.061412l-76.1466-129.85273a127.804477 127.804477.0 00-110.385297-63.11292H192.030028A64.207489 64.207489.0 01127.880338 639.488388V192.694717a64.102729 64.102729.0 0164.14969-64.091891h640.00858a63.799284 63.799284.0 0163.846246 63.788446v447.451135z" fill="#adb5bd" p-id="33867"/><path d="M608.154093 288.092004a31.970084 31.970084.0 00-31.970084 31.970085v160.078006L441.53396 300.861976a31.970084 31.970084.0 00-57.531702 19.200113v255.760676a31.970084 31.970084.0 0063.940169.0V415.863969l134.650048 179.274507a31.970084 31.970084.0 0057.531703-19.200113V320.062089a31.970084 31.970084.0 00-31.970085-31.970085z" fill="#adb5bd" p-id="33868"/></svg>14957 å­—</span>&nbsp;
<span><svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667zm0 810.666666C307.2 885.333333 138.666667 716.8 138.666667 512S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"/><path d="M695.466667 567.466667 544 497.066667V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666L669.866667 627.2c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8.0 23.466667-6.4 29.866666-19.2 6.4-14.933333.0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"/></svg>30 åˆ†é’Ÿ</span><div class=container-ctgtag><div class=taxonomy><div class=tag><a href=/tags/linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86>LinuxåŸºç¡€çŸ¥è¯†</a></div></div></div></div><div class=toc><div class=container-page-operation><div class=page-operation><div><a href=/><img src=/imgs/icons/home-2.svg alt></a></div><div><a href=/nav><img src=/imgs/icons/iov-navigate-1.svg alt></a></div><div><a href=/wiki><img src=/imgs/icons/wiki.svg alt></a></div><div><a href=/tags><img src=/imgs/icons/treetags.svg alt></a></div><div id=light-dark><a><img src=/imgs/icons/moon2.svg alt></a></div><div><a href=#><img src=/imgs/icons/up2.svg alt></a></div></div></div><nav id=TableOfContents><ul><li><ul><li><a href=#ä¸€ubuntu2010-server-ltså®‰è£…>ä¸€ã€Ubuntu20.10 server LTSå®‰è£…</a></li><li><a href=#äºŒåŒ…ç®¡ç†>äºŒã€åŒ…ç®¡ç†</a></li><li><a href=#ä¸‰æ— äººå€¼å®ˆæ‰¹é‡å®‰è£…ubuntu-server-20043>ä¸‰ã€æ— äººå€¼å®ˆæ‰¹é‡å®‰è£…Ubuntu server 20.04.3</a></li><li><a href=#å››ubuntu-ç½‘ç»œé…ç½®>å››ã€Ubuntu ç½‘ç»œé…ç½®</a></li><li><a href=#äº”å®‰å…¨>äº”ã€å®‰å…¨</a></li><li><a href=#å…­é˜²ç«å¢™>å…­ã€é˜²ç«å¢™</a></li><li><a href=#ä¸ƒæ—¥å¿—>ä¸ƒã€æ—¥å¿—</a></li></ul></li></ul></nav></div><div class=content><h3 id=ä¸€ubuntu2010-server-ltså®‰è£…>ä¸€ã€Ubuntu20.10 server LTSå®‰è£…</h3><p>LTSï¼ˆé•¿æœŸæ”¯æŒç‰ˆï¼‰</p><p>æ”¯æŒä»¥ä¸‹å¤„ç†å™¨</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>amd64 <span style=color:#000;font-weight:700>(</span>Intel/AMD 64-bit<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>arm64 <span style=color:#000;font-weight:700>(</span>64-bit ARM<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>ppc64el <span style=color:#000;font-weight:700>(</span>POWER8 and POWER9<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>s390x <span style=color:#000;font-weight:700>(</span>IBM Z and LinuxONE<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><p>æœ€ä½é…ç½®</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>CPU: 1gæˆ–è€…æ›´é«˜
</span></span><span style=display:flex><span>RAM: 1gæˆ–è€…æ›´é«˜
</span></span><span style=display:flex><span>Disk: ä¸å°äº2.5G
</span></span></code></pre></td></tr></table></div></div><h4 id=æ¡Œé¢ç‰ˆå’ŒæœåŠ¡å™¨ç‰ˆä¸åŒ><strong>æ¡Œé¢ç‰ˆå’ŒæœåŠ¡å™¨ç‰ˆä¸åŒ</strong></h4><p>UbuntuæœåŠ¡å™¨ç‰ˆå’ŒUbuntuæ¡Œé¢ç‰ˆä½¿ç”¨ç›¸åŒçš„Aptåº“ã€‚</p><p>ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯ç”¨äºæ¡Œé¢ç‰ˆçš„å›¾å½¢ç¯å¢ƒæ²¡æœ‰ä¸ºæœåŠ¡å™¨å®‰è£…ã€‚è¿™åŒ…æ‹¬å›¾å½¢æœåŠ¡å™¨æœ¬èº«ã€å›¾å½¢å®ç”¨ç¨‹åºå’Œåº”ç”¨ç¨‹åºï¼Œä»¥åŠæ¡Œé¢ç”¨æˆ·æ‰€éœ€çš„å„ç§ç”¨æˆ·æ”¯æŒæœåŠ¡ã€‚</p><h4 id=é•œåƒä¸‹è½½åœ°å€>é•œåƒä¸‹è½½åœ°å€</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>https://releases.ubuntu.com/20.04/
</span></span></code></pre></td></tr></table></div></div><p>å¼€æœºå¼•å¯¼å¯åŠ¨</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ESCã€F2ã€F10ã€æˆ–F12
</span></span></code></pre></td></tr></table></div></div><p>å¿«æ·é”®</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ESC	go back
</span></span><span style=display:flex><span>F1	open <span style=color:#0086b3>help</span> menu
</span></span><span style=display:flex><span>Control-Z, F2	switch to shell
</span></span><span style=display:flex><span>Control-L, F3	redraw screen
</span></span><span style=display:flex><span>Control-T, F4	toggle rich mode <span style=color:#000;font-weight:700>(</span>colour, unicode<span style=color:#000;font-weight:700>)</span> on and off
</span></span></code></pre></td></tr></table></div></div><h4 id=æ›´æ¢æ¸…åæº>æ›´æ¢æ¸…åæº</h4><p><a href=https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/>å‚è€ƒ</a></p><p>1.å¤‡ä»½æºæ–‡ä»¶</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
</span></span></code></pre></td></tr></table></div></div><p>2.æ‰“å¼€sources.list:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo gedit /etc/apt/sources.list
</span></span></code></pre></td></tr></table></div></div><p>åŠ å…¥æ¸…åæº</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal universe
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates universe
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal multiverse
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates multiverse
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security universe
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security multiverse
</span></span></code></pre></td></tr></table></div></div><p>3.åˆ·æ–°è½¯ä»¶æºä¿¡æ¯ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt-get update
</span></span></code></pre></td></tr></table></div></div><p>4.æ›´æ–°è½¯ä»¶</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt-get upgrade
</span></span></code></pre></td></tr></table></div></div><p>5.å¦‚æœæ›´æ–°æŠ¥ä»¥ä¸‹é”™è¯¯</p><pre tabindex=0><code>Ign:1 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal InRelease
Ign:2 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates InRelease
Ign:3 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-backports InRelease
Ign:4 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-security InRelease
Err:5 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal Release
  Certificate verification failed: The certificate is NOT trusted. The certificate chain uses expired certificate.  Could not handshake: Error in the certificate verification. [IP: 101.6.15.130 443]
Err:6 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates Release
  Certificate verification failed: The certificate is NOT trusted. The certificate chain uses expired certificate.  Could not handshake: Error in the certificate verification. [IP: 101.6.15.130 443]
Err:7 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-backports Release
  Certificate verification failed: The certificate is NOT trusted. The certificate chain uses expired certificate.  Could not handshake: Error in the certificate verification. [IP: 101.6.15.130 443]
Err:8 https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-security Release
  Certificate verification failed: The certificate is NOT trusted. The certificate chain uses expired certificate.  Could not handshake: Error in the certificate verification. [IP: 101.6.15.130 443]
</code></pre><p>å°†æºä¸­<code>https</code>æ”¹ä¸º<code>http</code>å³å¯</p><h3 id=äºŒåŒ…ç®¡ç†>äºŒã€åŒ…ç®¡ç†</h3><p><strong>åç¼€åä¸º.deb</strong></p><h4 id=å®‰è£…è½¯ä»¶åŒ…nmap><strong>å®‰è£…è½¯ä»¶åŒ…nmap</strong></h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install nmap
</span></span></code></pre></td></tr></table></div></div><h4 id=å¸è½½è½¯ä»¶åŒ…nmap><strong>å¸è½½è½¯ä»¶åŒ…nmap</strong></h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt remove nmap
</span></span></code></pre></td></tr></table></div></div><p>å¸è½½å¤šä¸ªåŒ…ç”¨ç©ºæ ¼åˆ†éš”ã€‚</p><h4 id=æ›´æ–°åŒ…ç´¢å¼•><strong>æ›´æ–°åŒ…ç´¢å¼•</strong></h4><p>APT åŒ…ç´¢å¼•æœ¬è´¨ä¸Šæ˜¯<code>/etc/apt/sources.list</code>æ–‡ä»¶å’Œ<code>/etc/apt/sources.list.d</code>ç›®å½•ä¸­å®šä¹‰çš„å­˜å‚¨åº“ä¸­å¯ç”¨åŒ…çš„æ•°æ®åº“ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt update
</span></span></code></pre></td></tr></table></div></div><h4 id=aptitude-åŒ…ç®¡ç†å·¥å…·>aptitude-åŒ…ç®¡ç†å·¥å…·</h4><p>aptitude åœ¨åˆ é™¤ä¸€ä¸ªåŒ…æ—¶ï¼Œä¼šåŒæ—¶åˆ é™¤æœ¬èº«æ‰€ä¾èµ–çš„åŒ…ã€‚è¿™æ ·ï¼Œç³»ç»Ÿä¸­ä¸ä¼šæ®‹ç•™æ— ç”¨çš„åŒ…ï¼Œæ•´ä¸ªç³»ç»Ÿæ›´ä¸ºå¹²å‡€ã€‚</p><h4 id=å¸¸ç”¨åŒ…ç®¡ç†å‘½ä»¤><strong>å¸¸ç”¨åŒ…ç®¡ç†å‘½ä»¤</strong></h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>aptitude update                æ›´æ–°å¯ç”¨çš„åŒ…åˆ—è¡¨
</span></span><span style=display:flex><span>aptitude upgrade               å‡çº§å¯ç”¨çš„åŒ…
</span></span><span style=display:flex><span>aptitude dist-upgrade          å°†ç³»ç»Ÿå‡çº§åˆ°æ–°çš„å‘è¡Œç‰ˆ
</span></span><span style=display:flex><span>aptitude install pkgname       å®‰è£…åŒ…
</span></span><span style=display:flex><span>aptitude remove pkgname        åˆ é™¤åŒ…
</span></span><span style=display:flex><span>aptitude purge pkgname         åˆ é™¤åŒ…åŠå…¶é…ç½®æ–‡ä»¶
</span></span><span style=display:flex><span>aptitude search string         æœç´¢åŒ…
</span></span><span style=display:flex><span>aptitude show pkgname          æ˜¾ç¤ºåŒ…çš„è¯¦ç»†ä¿¡æ¯
</span></span><span style=display:flex><span>aptitude clean                 åˆ é™¤ä¸‹è½½çš„åŒ…æ–‡ä»¶
</span></span><span style=display:flex><span>aptitude autoclean             ä»…åˆ é™¤è¿‡æœŸçš„åŒ…æ–‡ä»¶
</span></span></code></pre></td></tr></table></div></div><h4 id=æŸ¥çœ‹ç¨‹åºæ‰€éœ€ä¾èµ–åŒ…><strong>æŸ¥çœ‹ç¨‹åºæ‰€éœ€ä¾èµ–åŒ…</strong></h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@liujie-desktop:~# apt-cache depends freeradius
</span></span><span style=display:flex><span>freeradius
</span></span><span style=display:flex><span>  ä¾èµ–: lsb-base
</span></span><span style=display:flex><span>  ä¾èµ–: libc6
</span></span><span style=display:flex><span>  ä¾èµ–: libfreeradius2
</span></span><span style=display:flex><span>  ä¾èµ–: libgdbm3
</span></span><span style=display:flex><span>  ä¾èµ–: libltdl7
</span></span><span style=display:flex><span>  ä¾èµ–: libpam0g
</span></span><span style=display:flex><span>  ä¾èµ–: libperl5.10
</span></span><span style=display:flex><span>  ä¾èµ–: libpython2.6
</span></span><span style=display:flex><span>  ä¾èµ–: libssl0.9.8
</span></span><span style=display:flex><span>  ä¾èµ–: zlib1g
</span></span><span style=display:flex><span>  ä¾èµ–: freeradius-common
</span></span><span style=display:flex><span>  ä¾èµ–: ssl-cert
</span></span><span style=display:flex><span>  ä¾èµ–: adduser
</span></span><span style=display:flex><span>  å»ºè®®: freeradius-ldap
</span></span><span style=display:flex><span>  å»ºè®®: freeradius-postgresql
</span></span><span style=display:flex><span>  å»ºè®®: freeradius-mysql
</span></span><span style=display:flex><span>  å»ºè®®: freeradius-krb5
</span></span></code></pre></td></tr></table></div></div><h4 id=aptitude-å®‰è£…nmap>aptitude å®‰è£…nmap</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo aptitude install nmap
</span></span></code></pre></td></tr></table></div></div><h4 id=aptitude-å¸è½½nmap>aptitude å¸è½½nmap</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo aptitude remove nmap
</span></span></code></pre></td></tr></table></div></div><h4 id=dpkg-åŒ…ç®¡ç†å™¨>dpkg-åŒ…ç®¡ç†å™¨</h4><p><strong>å®ƒå¯ä»¥å®‰è£…ã€åˆ é™¤å’Œæ„å»ºåŒ…ï¼Œä½†ä¸å…¶ä»–åŒ…ç®¡ç†ç³»ç»Ÿä¸åŒï¼Œå®ƒä¸èƒ½è‡ªåŠ¨ä¸‹è½½å’Œå®‰è£…åŒ…æˆ–å…¶ä¾èµ–é¡¹ã€‚Aptå’ŒAptitude æ˜¯è¾ƒæ–°çš„ï¼Œå¹¶ä¸”åœ¨ dpkg ä¹‹ä¸Šæ·»åŠ äº†é™„åŠ åŠŸèƒ½ã€‚</strong></p><p>åˆ—å‡ºç³»ç»ŸåŒ…æ•°æ®åº“ä¸­çš„æ‰€æœ‰åŒ…ï¼ŒåŒ…æ‹¬æ‰€æœ‰å·²å®‰è£…å’Œå·²å¸è½½çš„åŒ…ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dpkg -l
</span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡ grep ç®¡é“è¾“å‡ºä»¥æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†ç‰¹å®šçš„åŒ…ï¼š</p><pre tabindex=0><code>dpkg -l | grep apache2
</code></pre><p>è¦åˆ—å‡ºåŒ…å®‰è£…çš„æ–‡ä»¶ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º ufw åŒ…ï¼Œè¯·è¾“å…¥ï¼š</p><pre tabindex=0><code>dpkg -L ufw
</code></pre><p>å¦‚æœä½ ä¸ç¡®å®šå®‰è£…äº†å“ªä¸ªåŒ…çš„æ–‡ä»¶ï¼Œ<code>dpkg -S</code>ä¹Ÿè®¸å¯ä»¥å‘Šè¯‰ä½ ã€‚ä¾‹å¦‚ï¼š</p><pre tabindex=0><code>dpkg -S /etc/host.conf base-files: /etc/host.conf
</code></pre><p>è¾“å‡ºæ˜¾ç¤º<code>/etc/host.conf</code>å±äº base-files åŒ…ã€‚</p><p>æ‚¨å¯ä»¥<code>.deb</code>é€šè¿‡è¾“å…¥ä»¥ä¸‹å†…å®¹æ¥å®‰è£…æœ¬åœ°æ–‡ä»¶ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo dpkg -i zip_3.0-4_amd64.deb
</span></span></code></pre></td></tr></table></div></div><p>å¸è½½è½¯ä»¶åŒ…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®Œæˆï¼š</p><pre tabindex=0><code>sudo dpkg -r zip
</code></pre><p>æ³¨æ„ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸æ¨èä½¿ç”¨ dpkg å¸è½½è½¯ä»¶åŒ…ã€‚æœ€å¥½ä½¿ç”¨å¤„ç†ä¾èµ–å…³ç³»çš„åŒ…ç®¡ç†å™¨ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿå¤„äºä¸€è‡´çŠ¶æ€ã€‚å®ƒä¸ä¼šå¸è½½ç›¸å…³ä¾èµ–åŒ…ã€‚</p><h3 id=ä¸‰æ— äººå€¼å®ˆæ‰¹é‡å®‰è£…ubuntu-server-20043>ä¸‰ã€æ— äººå€¼å®ˆæ‰¹é‡å®‰è£…Ubuntu server 20.04.3</h3><p>ä½¿ç”¨PXEè‡ªåŠ¨ä»ç½‘ç»œåŠ è½½å®‰è£…ç¨‹åºï¼Œå‘èµ·å®‰è£…ã€‚</p><p>ä½¿ç”¨Ubuntuçš„è‡ªåŠ¨å®‰è£…åŠŸèƒ½ï¼Œè‡ªåŠ¨åŠ è½½cloud-initå®‰è£…é…ç½®ï¼Œå®Œæˆæ“ä½œç³»ç»Ÿçš„è‡ªåŠ¨é€‰æ‹©ã€‚</p><p>éœ€è¦è£…æœ‰pxeçš„æœåŠ¡ç«¯ï¼ŒæœåŠ¡å™¨éœ€è¦å®‰è£…çš„è½¯ä»¶æœ‰tftpå®¢æˆ·ç«¯ï¼Œdnsmasq æœåŠ¡ç«¯ï¼ŒtftpæœåŠ¡ç«¯å¯ä»¥åœ¨dnsmasq.confä¸­é…ç½®ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apt install tftp
</span></span><span style=display:flex><span>apt install dnsmasq
</span></span></code></pre></td></tr></table></div></div><p>éœ€è¦å®‰è£…ç³»ç»Ÿçš„å®¢æˆ·ç«¯ï¼ˆæ­¤æ—¶ç”¨è™šæ‹Ÿæœºåˆ›å»ºä¸€ä¸ªç©ºçš„è™šæ‹Ÿæœºã€‚éœ€è¦ç¬¬ä¸€å¯åŠ¨é¡¹ä¸ºç½‘å¡å¯åŠ¨ï¼Œå¹¶ä¸”é»˜è®¤uefiå¯åŠ¨ï¼‰</p><h4 id=pxe-å®‰è£…æµç¨‹>PXE å®‰è£…æµç¨‹</h4><p>â€‹ PXEï¼ˆPre-boot Execution Environment/é¢„å¯åŠ¨æ‰§è¡Œç¯å¢ƒï¼‰çš„å®ç°ä¾èµ–äºç½‘å¡ï¼Œåªæœ‰æ”¯æŒPXE Clientçš„ç½‘å¡æ‰èƒ½å®ç°ç½‘ç»œè‡ªåŠ¨å®‰è£…ã€‚è¿™ç§ç½‘å¡å®ç°DHCP Clientå’Œ TFTP Clientï¼Œåœ¨BIOSçš„å¼•å¯¼ä¸‹é€šè¿‡DHCPåè®®è‡ªåŠ¨åˆ†é…IPåœ°å€ï¼Œé€šè¿‡TFTPè·å–æœ€å°å†…æ ¸ï¼Œç„¶ååœ¨æœ€å°å†…æ ¸ç¯å¢ƒä¸‹é€šè¿‡HTTPåè®®æˆ–NFSåè®®è·å–Ubuntuå®‰è£…ç‰ˆæœ¬ã€‚ä¹‹åæœ€å°å†…æ ¸å¼•å¯¼è¿›è¡ŒUbuntu 20.04çš„å®‰è£…ã€‚ä¸‹å›¾æ˜¯è¯¦ç»†çš„å®‰è£…æµç¨‹ã€‚</p><p><img src=/postimages/auto-install1.webp alt=æ— äººå€¼å®ˆ1></p><p>ä¸Šå›¾æœ‰å‡ ä¸ªå‰æï¼š</p><ol><li>ç½‘å¡æ”¯æŒPXEï¼Œä»Šå¹´æ–°å‡ºçš„ç½‘å¡åŸºæœ¬éƒ½æ”¯æŒï¼ŒåŒæ—¶BIOSçš„å¯åŠ¨é¡¹ä¹Ÿè¦é…ç½®ï¼Œè¯·å¤§å®¶è‡ªè¡Œç ”ç©¶ã€‚</li><li>UEFIå¯åŠ¨æ‰ä¼šè¯·æ±‚bootx64.efiï¼Œå¦‚æœæ˜¯ä¼ ç»Ÿå¯åŠ¨æ¨¡å¼ï¼ˆLegacyï¼‰ï¼Œé‚£ä¹ˆPXE Clientä¼šè¯·æ±‚pxelinux.0ã€‚</li><li>å¯ä»¥é‡‡ç”¨nfsbootæ–¹å¼ï¼Œè¿™ä¸ªæµç¨‹é‡‡ç”¨çš„æ˜¯isoé•œåƒä¸‹è½½å†å®‰è£…çš„æ–¹å¼ã€‚</li></ol><p>ä»¥ä¸‹å¼•å¯¼æ–¹å¼ä¸ºuefiï¼Œè™šæ‹Ÿæœºå®¢æˆ·ç«¯éœ€è¦å°†biosæ¨¡å¼æ”¹ä¸ºuefiæ¨¡å¼ï¼ŒåŒæ—¶ï¼Œå°†å¼€æœºå¯åŠ¨é¡¹å°†ä»ç½‘å¡å¯åŠ¨è®¾ç½®ä¸ºç¬¬ä¸€å¯åŠ¨é¡¹ã€‚</p><p><img src=/postimages/auto-install2.webp alt=æ— äººå€¼å®ˆ2></p><p><img src=/postimages/noskip.webp alt=noskip></p><h4 id=å®‰è£…å¿…é¡»çš„æœåŠ¡ç«¯è½¯ä»¶>å®‰è£…å¿…é¡»çš„æœåŠ¡ç«¯è½¯ä»¶</h4><ol><li>å®‰è£…DHCPã€TFTPæœåŠ¡å™¨
dnsmasqåŒæ—¶å®ç°äº†DHCPã€TFTPã€DNSä¸‰ç§æœåŠ¡å™¨
<code>sudo apt-get install dnsmasq</code></li><li>å®‰è£…HTTPæœåŠ¡å™¨
HTTP Serveræœ‰å¾ˆå¤šï¼Œå¤§å®¶å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç†Ÿæ‚‰çš„æœåŠ¡å™¨å¦‚nginxï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯apache2
<code>sudo apt-get install apache2</code></li></ol><h4 id=å‡†å¤‡å¯åŠ¨æ–‡ä»¶>å‡†å¤‡å¯åŠ¨æ–‡ä»¶</h4><ol><li><p>ä¸‹è½½uefi å¼•å¯¼æ–‡ä»¶ï¼Œshim.signedã€grub-efi-amd64-signed å®‰å…¨å¯åŠ¨é“¾åŠ è½½çš„å¼•å¯¼ç¨‹åº</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-arduino data-lang=arduino><span style=display:flex><span>apt<span style=color:#000;font-weight:700>-</span><span style=color:#900;font-weight:700>get</span> download shim.<span style=color:#458;font-weight:700>signed</span>
</span></span><span style=display:flex><span>apt<span style=color:#000;font-weight:700>-</span><span style=color:#900;font-weight:700>get</span> download grub<span style=color:#000;font-weight:700>-</span>efi<span style=color:#000;font-weight:700>-</span>amd64<span style=color:#000;font-weight:700>-</span><span style=color:#458;font-weight:700>signed</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>ä¸‹è½½ubuntu 20.04 server iso
è¿™ä¸ªç›´æ¥å»å®˜ç½‘ä¸‹è½½ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯<code>ubuntu-20.04.3-live-server-amd64.iso</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åªæœ‰liveç‰ˆæœ¬æ‰èƒ½æ”¯æŒsubiquity
<code>https://ubuntu.com/download/server</code></p></li></ol><h4 id=åˆ›å»ºtftp-æ–‡ä»¶å¤¹>åˆ›å»ºTFTP æ–‡ä»¶å¤¹</h4><p>TFTP æ–‡ä»¶å¤¹æ˜¯TFTPæœåŠ¡çš„æ ¹ç›®å½•ï¼ŒPXEå¯åŠ¨è¿‡ç¨‹ä¸­ä¸‹è½½çš„æ–‡ä»¶éƒ½å­˜åœ¨åœ¨è¯¥ç›®å½•ä¸­</p><pre tabindex=0><code class=language-mipsasm data-lang=mipsasm>tftp
â”œâ”€â”€ boot
â”‚   â””â”€â”€ live-server
â”‚       â”œâ”€â”€ initrd
â”‚       â””â”€â”€ vmlinuz
â”œâ”€â”€ grub
â”‚   â”œâ”€â”€ bootx64.efi
â”‚   â”œâ”€â”€ font.pf2
â”‚   â””â”€â”€ grub.cfg
â””â”€â”€ grubx64.efi
</code></pre><h4 id=è¯´æ˜>è¯´æ˜</h4><ol><li>bootx64.efiã€grubx64.efi å¼•å¯¼ç¨‹åºï¼Œæ¥è‡ªshim.signed å®‰è£…åŒ…</li><li>grub.cfg è‡ªå»º</li><li>å…¶ä»–æ–‡ä»¶æ¥è‡ª ubuntuå®‰è£…åŒ…</li><li>äº”ä¸ªæ–‡ä»¶æ˜¯éœ€è¦çš„ï¼Œä½†æ˜¯ç›®å½•ç»“æ„æ˜¯æˆ‘è‡ªå»ºçš„ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½ä¿®æ”¹</li></ol><h4 id=åˆ›å»ºç›®å½•>åˆ›å»ºç›®å½•</h4><p>åœ¨ /tftp (å¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹)ç›®å½•ä¸‹åˆ›å»º tftpç›®å½•</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span>mkdir <span style=color:#000;font-weight:700>/</span>tftp
</span></span><span style=display:flex><span>mkdir <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>grub
</span></span><span style=display:flex><span>mkdir <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>boot
</span></span><span style=display:flex><span>mkdir <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>boot<span style=color:#000;font-weight:700>/</span>live<span style=color:#000;font-weight:700>-</span>server
</span></span></code></pre></td></tr></table></div></div><h4 id=è·å–å¼•å¯¼æ–‡ä»¶>è·å–å¼•å¯¼æ–‡ä»¶</h4><p>åœ¨å®‰è£…åŒ…ä¸‹è½½ç›®å½•åˆ›å»ºä¸€ä¸ªshimæ–‡ä»¶å¤¹</p><p>è§£å‹shimå®‰è£…åŒ…åˆ°shimæ–‡ä»¶å¤¹
<code>dpkg -x &lt;%åˆšæ‰ä¸‹è½½çš„shim.signed å®‰è£…åŒ…åŒ…å%> shim</code></p><p>è§£å‹grubå®‰è£…åŒ…åˆ°grubæ–‡ä»¶å¤¹</p><p>æ‹·è´å¼•å¯¼æ–‡ä»¶åˆ°tftpç›®å½•</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span>cp .<span style=color:#000;font-weight:700>/</span>root<span style=color:#000;font-weight:700>/</span>grub<span style=color:#000;font-weight:700>/</span>usr<span style=color:#000;font-weight:700>/</span>lib<span style=color:#000;font-weight:700>/</span>grub<span style=color:#000;font-weight:700>/</span>x86_64<span style=color:#000;font-weight:700>-</span>efi<span style=color:#000;font-weight:700>-</span>signed<span style=color:#000;font-weight:700>/</span>grubnetx64.efi.signed  <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>grubx64.efi
</span></span><span style=display:flex><span>cp .<span style=color:#000;font-weight:700>/</span>root<span style=color:#000;font-weight:700>/</span>shim<span style=color:#000;font-weight:700>/</span>usr<span style=color:#000;font-weight:700>/</span>lib<span style=color:#000;font-weight:700>/</span>shim<span style=color:#000;font-weight:700>/</span>shimx64.efi.signed  <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>grub<span style=color:#000;font-weight:700>/</span>bootx64.efi
</span></span></code></pre></td></tr></table></div></div><h4 id=è·å–å†…æ ¸é•œåƒæ–‡ä»¶>è·å–å†…æ ¸é•œåƒæ–‡ä»¶</h4><p>åœ¨ä¸‹è½½ç›®å½•mount isoæ–‡ä»¶</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#000;font-weight:700>sudo</span> <span style=color:#d14>mount</span> <span style=color:#d14>ubuntu-20.04.3-live-server-amd64.iso</span> <span style=color:#d14>/media</span>
</span></span></code></pre></td></tr></table></div></div><p>ç³»ç»Ÿä¼šæç¤ºåªè¯»ï¼Œä¸å½±å“ä½¿ç”¨</p><pre tabindex=0><code class=language-pgsql data-lang=pgsql>mount: /media: WARNING: device write-protected, mounted read-only.
</code></pre><p>æ‹·è´å†…æ ¸é•œåƒæ–‡ä»¶</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span>cp <span style=color:#000;font-weight:700>/</span>media<span style=color:#000;font-weight:700>/</span>casper<span style=color:#000;font-weight:700>/</span>initrd       <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>boot<span style=color:#000;font-weight:700>/</span>live<span style=color:#000;font-weight:700>-</span>server
</span></span><span style=display:flex><span>cp <span style=color:#000;font-weight:700>/</span>media<span style=color:#000;font-weight:700>/</span>casper<span style=color:#000;font-weight:700>/</span>vmlinuz      <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>boot<span style=color:#000;font-weight:700>/</span>live<span style=color:#000;font-weight:700>-</span>server
</span></span></code></pre></td></tr></table></div></div><p>æ‹·è´grubæ–‡ä»¶
grub.cfgæ‹·è´è¿‡æ¥åšä¸ªå‚è€ƒï¼Œå†…å®¹ä¼šè¢«å…¨éƒ¨ä¿®æ”¹æ‰</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span>cp <span style=color:#000;font-weight:700>/</span>media<span style=color:#000;font-weight:700>/</span>grub<span style=color:#000;font-weight:700>/</span>font.pf2       <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>grub
</span></span><span style=display:flex><span>cp <span style=color:#000;font-weight:700>/</span>media<span style=color:#000;font-weight:700>/</span>grub<span style=color:#000;font-weight:700>/</span>grub.cfg       <span style=color:#000;font-weight:700>/</span>tftp<span style=color:#000;font-weight:700>/</span>grub
</span></span></code></pre></td></tr></table></div></div><h4 id=é…ç½®dnsmasqé»˜è®¤ç«¯å£53udp>é…ç½®dnsmasqï¼ˆé»˜è®¤ç«¯å£53udpï¼‰</h4><p>tftpé»˜è®¤ç«¯å£69</p><p>å…³é”®é…ç½®æœ‰ä»¥ä¸‹å‡ ä¸ª</p><ol><li>é…ç½®DHCP åœ°å€æ®µ</li><li>é…ç½®å¼•å¯¼æ–‡ä»¶ç›®å½•</li><li>é…ç½®tftp æ ¹ç›®å½•</li><li>é…ç½®æ—¥å¿—è·¯å¾„</li><li>é…ç½®æœåŠ¡ç½‘å¡ï¼Œå¤šç½‘å¡æœºå™¨éœ€å…³æ³¨</li></ol><pre tabindex=0><code class=language-routeros data-lang=routeros># é…ç½®å¤–ç½‘DNSæœåŠ¡å™¨åœ°å€
server=10.4.7.254
# æŒ‡å®šæœåŠ¡çš„ç½‘å¡
interface=ens33,lo
# ç»‘å®šç«¯å£
bind-interfaces
# è®¾ç½®DHCPåˆ†å‘IPç«¯èŒƒå›´ã€åœ°å€æ©ç ã€IPåœ°å€æœ‰æ•ˆæ—¶é—´
dhcp-range=10.4.7.240,10.4.7.241,255.255.255.0,12h
# æŒ‡å®šç½‘å…³åœ°å€   å’Œå®‰è£…æ— å…³ï¼Œåº”è¯¥å¯ä»¥ä¸é…ç½®
dhcp-option=3,10.4.7.254
# æŒ‡å®šDNSæœåŠ¡å™¨åœ°å€  å’Œå®‰è£…æ— å…³ï¼Œåº”è¯¥å¯ä»¥ä¸é…ç½®
dhcp-option=6,10.4.7.254
# è®¾ç½®å¼•å¯¼ç¨‹åºç›¸å¯¹tftpæ ¹ç›®å½•çš„è·¯å¾„
dhcp-match=set:efi-x86_64,option:client-arch,7
dhcp-boot=tag:efi-x86_64,grub/bootx64.efi
# æ‰“å¼€tftpæœåŠ¡
enable-tftp
# è®¾ç½®tftpæ ¹è·¯å¾„
tftp-root=/tftp
# è®¾ç½®æ—¥å¿—è·¯å¾„
log-facility=/var/log/dnsmasq.log
</code></pre><p>ä¿®æ”¹é…ç½®åï¼Œé‡å¯dnsmasqæœåŠ¡æ‰èƒ½ç”Ÿæ•ˆã€‚</p><h4 id=åˆ›å»ºhttpæ–‡ä»¶å¤¹>åˆ›å»ºHTTPæ–‡ä»¶å¤¹</h4><p>apache2çš„é»˜è®¤æœåŠ¡æ ¹ç›®å½•æ˜¯ /var/www/htmlï¼Œä¸ä¿®æ”¹ä»–ï¼Œåœ¨ä»–ä¸‹é¢åˆ›å»ºç›®å½•</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#900;font-weight:700>html</span><span style=color:#000;font-weight:700>/</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>â”œâ”€â”€</span> autoinstall
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>â”‚</span>   <span style=color:#a61717;background-color:#e3d2d2>â”œâ”€â”€</span> meta<span style=color:#000;font-weight:700>-</span><span style=color:#000;font-weight:700>data</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>â”‚</span>   <span style=color:#a61717;background-color:#e3d2d2>â””â”€â”€</span> user<span style=color:#000;font-weight:700>-</span><span style=color:#000;font-weight:700>data</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>â”œâ”€â”€</span> index<span style=color:#000;font-weight:700>.</span>html
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>â””â”€â”€</span> iso
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>â””â”€â”€</span> ubuntu<span style=color:#000;font-weight:700>-</span><span style=color:#099>20.04</span><span style=color:#000;font-weight:700>.</span><span style=color:#099>2</span><span style=color:#000;font-weight:700>-</span>live<span style=color:#000;font-weight:700>-</span>server<span style=color:#000;font-weight:700>-</span>amd64<span style=color:#000;font-weight:700>.</span>iso
</span></span></code></pre></td></tr></table></div></div><h4 id=è¯´æ˜-1>è¯´æ˜</h4><p>autoinstall ç›®å½•å­˜æ”¾å‚æ•°è‡ªåŠ¨é…ç½®æ–‡ä»¶ï¼Œuser-dataã€meta-dataæ˜¯cloud-initè¦æ±‚çš„æ–‡ä»¶å</p><p>iso ç›®å½•å­˜æ”¾æ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶</p><h4 id=åˆ›å»ºç›®å½•-1>åˆ›å»ºç›®å½•</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span>mkdir <span style=color:#000;font-weight:700>/</span>var<span style=color:#000;font-weight:700>/</span>www<span style=color:#000;font-weight:700>/</span>html<span style=color:#000;font-weight:700>/</span>autoinstall
</span></span><span style=display:flex><span>mkdir <span style=color:#000;font-weight:700>/</span>var<span style=color:#000;font-weight:700>/</span>www<span style=color:#000;font-weight:700>/</span>html<span style=color:#000;font-weight:700>/</span>iso
</span></span></code></pre></td></tr></table></div></div><h4 id=æ‹·è´isoæ–‡ä»¶>æ‹·è´isoæ–‡ä»¶</h4><p>åˆ°ä¸‹è½½ç›®å½•æ‹·è´isoæ–‡ä»¶
<code>cp ubuntu-20.04.3-live-server-amd64.iso /var/www/html/iso</code></p><h4 id=åˆ›å»ºå‚æ•°è‡ªåŠ¨é…ç½®æ–‡ä»¶>åˆ›å»ºå‚æ•°è‡ªåŠ¨é…ç½®æ–‡ä»¶</h4><p>å…ˆåˆ›å»ºç©ºæ–‡ä»¶ï¼Œmeta-dataæ— éœ€ä¿®æ”¹ï¼Œuser-dataåç»­ç« èŠ‚ä¼šè¯¦ç»†æè¿°é…ç½®</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-awk data-lang=awk><span style=display:flex><span>touch <span style=color:#000;font-weight:700>/</span>var<span style=color:#000;font-weight:700>/</span>www<span style=color:#000;font-weight:700>/</span>html<span style=color:#000;font-weight:700>/</span>autoinstall<span style=color:#000;font-weight:700>/</span>user<span style=color:#000;font-weight:700>-</span>data
</span></span><span style=display:flex><span>touch <span style=color:#000;font-weight:700>/</span>var<span style=color:#000;font-weight:700>/</span>www<span style=color:#000;font-weight:700>/</span>html<span style=color:#000;font-weight:700>/</span>autoinstall<span style=color:#000;font-weight:700>/</span>meta<span style=color:#000;font-weight:700>-</span>data
</span></span></code></pre></td></tr></table></div></div><h4 id=é…ç½®grubcfg>é…ç½®grub.cfg</h4><pre tabindex=0><code class=language-routeros data-lang=routeros>if loadfont /grub/font.pf2 ; then
        set gfxmode=auto
        insmod efi_gop
        insmod efi_uga
        insmod gfxterm
        terminal_output gfxterm
fi

set menu_color_normal=white/black
set menu_color_highlight=black/light-gray
set timeout=5

menuentry &#34;Ubuntu server 20.04.3 autoinstall&#34; {
        set gfxpayload=keep
        linux  /boot/live-server/vmlinuz root=/dev/ram0 ramdisk_size=1500000 ip=dhcp url=&#39;http://10.4.7.150/iso/ubuntu-20.04.3-live-server-amd64.iso&#39; autoinstall ds=nocloud-net\;s=http://10.4.7.150/autoinstall/ ---
        initrd /boot/live-server/initrd
}
</code></pre><p>menuentry ä¹‹å‰æ˜¯é…ç½®æ ·å¼ï¼Œä¹Ÿå¯ä»¥åˆ é™¤ï¼Œé‡ç‚¹å…³æ³¨<code>menuentry "Ubuntu server 20.04 autoinstall"</code>
å†…çš„é…ç½®ã€‚</p><ol><li>æŒ‡å®šé•œåƒæ–‡ä»¶ç›¸å¯¹äºtftpæ ¹ç›®å½•çš„è·¯å¾„ /boot/live-server/initrd</li><li>root=/dev/ram0 ramdisk_size=1500000 ä¸ºäº†æŒ‡å®šå†…æ ¸é•œåƒæŒ‚è½½ç©ºé—´ï¼Œæ˜¯å¦å¯åˆ é™¤å¾…ç¡®è®¤</li><li>ip=dhcp æŒ‡å®šå†…æ ¸é•œåƒæŒ‚è½½åä½¿ç”¨DHCP è·å–IPåœ°å€</li><li>url= æŒ‡å®šISOæ–‡ä»¶çš„ç½‘ç»œå­˜æ”¾è·¯å¾„</li><li><code>autoinstall ds=nocloud-net\;s=http://10.4.7.150/autoinstall/ </code>&mdash;è¯¥é…ç½®æŒ‡æ˜å‚æ•°è‡ªåŠ¨å¡«å†™ï¼Œå¹¶æŒ‡æ˜é…ç½®æ–‡ä»¶æ‰€åœ¨è·¯å¾„</li></ol><h4 id=å‘>å‘</h4><p>ç½‘ä¸Šå¾ˆå¤šæ–‡ç« é…ç½®æ˜¯è¿™ä¹ˆå†™çš„<code>ds=nocloud-net;s=http://10.4.7.150/autoinstall/</code>ï¼Œæˆ‘è¯•äº†å¾ˆå¤šæ¬¡ï¼Œéƒ½æ²¡æœ‰è‡ªåŠ¨å®‰è£…ã€‚
åœ¨ç½‘ä¸ŠæŸ¥åˆ°ï¼Œç”±äºUEFIå¯åŠ¨ä½¿ç”¨äº†grubï¼Œgrubå°†<code>;</code>è¯†åˆ«ä¸ºäº†ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥è¦åœ¨<code>;</code>å‰åŠ <code>\</code>è½¬ä¹‰ã€‚</p><h4 id=é…ç½®user-data>é…ç½®user-data</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#998;font-style:italic>#cloud-config</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:navy>autoinstall</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>version</span>:<span style=color:#bbb> </span><span style=color:#099>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># ä¿®æ”¹aptæœåŠ¡åœ°å€</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>apt</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>primary</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:navy>arches</span>:<span style=color:#bbb> </span>[default]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:navy>uri</span>:<span style=color:#bbb> </span>https://mirrors.tuna.tsinghua.edu.cn/ubuntu<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>user-data</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#998;font-style:italic># é…ç½®æ—¶åŒº</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>timezone</span>:<span style=color:#bbb> </span>Asia/Shanghai<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#998;font-style:italic># ä½¿ç”¨rootè´¦å·</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>disable_root</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># é…ç½®ç”¨æˆ·  </span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>identity</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>hostname</span>:<span style=color:#bbb> </span>ubuntu-server<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>password</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;yours&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>username</span>:<span style=color:#bbb> </span>ubuntu<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># é…ç½®é”®ç›˜  </span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>keyboard</span>:<span style=color:#bbb> </span>{<span style=color:navy>layout: us, variant</span>:<span style=color:#bbb> </span><span style=color:#d14>&#39;us&#39;</span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>locale</span>:<span style=color:#bbb> </span>en_US.UTF-8<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># é»˜è®¤å®‰è£…ssh server</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>ssh</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>install-server</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># æŒ‡å®šå®‰è£…çš„åŒ…</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>packages</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- net-tools<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- python3-pip<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># é…ç½®ç£ç›˜åˆ†åŒº</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:navy>storage</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>grub</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:navy>reorder_uefi</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>False</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:navy>config</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:navy>ptable: gpt, path: /dev/sda, wipe: superblock-recursive, preserve: false, name</span>:<span style=color:#bbb> </span><span style=color:#d14>&#39;&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:navy>grub_device: false, type: disk, id</span>:<span style=color:#bbb> </span>disk-sda}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:navy>device: disk-sda, size: 536870912, wipe: superblock, flag: boot, number</span>:<span style=color:#bbb> </span><span style=color:#099>1</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:navy>preserve: false, grub_device: true, type: partition, id</span>:<span style=color:#bbb> </span>partition-0}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:navy>fstype: fat32, volume: partition-0, preserve: false, type: format, id</span>:<span style=color:#bbb> </span>format-0}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:navy>device: disk-sda, size: -1, wipe: superblock, flag: &#39;&#39;, number</span>:<span style=color:#bbb> </span><span style=color:#099>2</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:navy>preserve: false, type: partition, id</span>:<span style=color:#bbb> </span>partition-1}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:navy>fstype: ext4, volume: partition-1, preserve: false, type: format, id</span>:<span style=color:#bbb> </span>format-1}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:navy>device: format-1, path: /, type: mount, id</span>:<span style=color:#bbb> </span>mount-1}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- {<span style=color:navy>device: format-0, path: /boot/efi, type: mount, id</span>:<span style=color:#bbb> </span>mount-0}<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>è¯´æ˜</p><ol><li>å¯†ç éœ€è¦åŠ å¯†ï¼Œå¯ä»¥å…ˆç”¨å·¥å…·å¯¹è‡ªå·±çš„å¯†ç è¿›è¡ŒåŠ å¯†åå¡«å…¥</li><li>ä»£ç†ä¸æ˜¯å¿…é¡»çš„é…ç½®ï¼Œä¸ç½‘ç»œæ‹“æ‰‘æœ‰å…³</li><li>ç£ç›˜åˆ†åŒºé…ç½®è¦æ³¨æ„ï¼Œé…ç½®ä¸å¯¹ä¼šå¯¼è‡´è‡ªåŠ¨å®‰è£…èµ°ä¸ä¸‹å»ï¼Œæç¤ºcrashï¼›è¿™ä¸ªé…ç½®çš„æ•´ä½“æ€è·¯æ˜¯å…ˆæ ¼å¼åŒ–disk-sdaï¼Œç„¶ååœ¨disk-sdaä¸‹åˆ’åˆ†/dev/sda1 ã€/dev/sda2 ï¼Œç„¶ååˆ†åˆ«mount /,/boot/efiç›®å½•</li><li>å®‰è£…è¿‡ç¨‹æ—¥å¿—åœ¨ /var/log/installer/ï¼Œå¦‚æœå®‰è£…å¤±è´¥å¯ä»¥é€šè¿‡nc ç­‰å·¥å…·å®æ—¶å‘å‡ºå»</li></ol><h4 id=ç½‘ç»œæ‹“æ‰‘>ç½‘ç»œæ‹“æ‰‘</h4><ol><li>æˆ‘åœ¨ç”µè„‘ä¸Šæ­å»ºäº†DHCPã€TFTPã€HTTPä¸‰ç§æœåŠ¡</li><li>ç›®æ ‡æœºå™¨ä¸èƒ½ä¸Šç½‘ï¼Œä¸‰å°æœºå™¨åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘</li></ol><p>dnsmasq.log</p><p><img src=/postimages/auto-install3.webp alt=æ— äººå€¼å®ˆ3></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:26:56 dnsmasq-dhcp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: DHCP, IP range 10.4.7.240 -- 10.4.7.241, lease <span style=color:#0086b3>time</span> 12h
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:26:56 dnsmasq-dhcp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: DHCP, sockets bound exclusively to interface ens33
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:26:56 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: TFTP root is /tftp  
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:29:33 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: failed sending /tftp/grubx64.efi to 10.4.7.140
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:37 dnsmasq-dhcp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: DHCPDISCOVER<span style=color:#000;font-weight:700>(</span>ens33<span style=color:#000;font-weight:700>)</span> 00:0c:29:68:21:9a 
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:37 dnsmasq-dhcp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: DHCPOFFER<span style=color:#000;font-weight:700>(</span>ens33<span style=color:#000;font-weight:700>)</span> 10.4.7.240 00:0c:29:68:21:9a 
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:38 dnsmasq-dhcp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: DHCPREQUEST<span style=color:#000;font-weight:700>(</span>ens33<span style=color:#000;font-weight:700>)</span> 10.4.7.240 00:0c:29:68:21:9a 
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:38 dnsmasq-dhcp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: DHCPACK<span style=color:#000;font-weight:700>(</span>ens33<span style=color:#000;font-weight:700>)</span> 10.4.7.240 00:0c:29:68:21:9a 
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:38 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: error <span style=color:#099>8</span> User aborted the transfer received from 10.4.7.240
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:38 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: sent /tftp/grub/bootx64.efi to 10.4.7.240
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:38 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: sent /tftp/grub/bootx64.efi to 10.4.7.240
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:40 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: sent /tftp/grubx64.efi to 10.4.7.240
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:40 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: file /tftp/grub/x86_64-efi/command.lst not found
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:40 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: file /tftp/grub/x86_64-efi/fs.lst not found
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:40 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: file /tftp/grub/x86_64-efi/crypto.lst not found
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:40 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: file /tftp/grub/x86_64-efi/terminal.lst not found
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:40 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: sent /tftp/grub/grub.cfg to 10.4.7.240
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:40 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: sent /tftp/grub/font.pf2 to 10.4.7.240
</span></span><span style=display:flex><span>Sep <span style=color:#099>21</span> 19:35:51 dnsmasq-tftp<span style=color:#000;font-weight:700>[</span>1910<span style=color:#000;font-weight:700>]</span>: sent /tftp/boot/live-server/vmlinuz to 10.4.7.240
</span></span></code></pre></td></tr></table></div></div><h3 id=å››ubuntu-ç½‘ç»œé…ç½®>å››ã€Ubuntu ç½‘ç»œé…ç½®</h3><p>è¦å¿«é€Ÿè¯†åˆ«æ‰€æœ‰å¯ç”¨çš„ä»¥å¤ªç½‘æ¥å£ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ ip å‘½ä»¤ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@lhp-server:/etc/netplan# ip a
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#099>65536</span> qdisc noqueue state UNKNOWN group default qlen <span style=color:#099>1000</span>
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 ::1/128 scope host 
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#099>1500</span> qdisc fq_codel state UP group default qlen <span style=color:#099>1000</span>
</span></span><span style=display:flex><span>    link/ether 00:0c:29:da:c6:09 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 10.4.7.142/24 brd 10.4.7.255 scope global ens33
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::20c:29ff:feda:c609/64 scope link 
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></td></tr></table></div></div><p>å¦ä¸€ä¸ªå¯ä»¥å¸®åŠ©è¯†åˆ«ç³»ç»Ÿå¯ç”¨çš„æ‰€æœ‰ç½‘ç»œæ¥å£çš„åº”ç”¨ç¨‹åºæ˜¯ lshw å‘½ä»¤ã€‚æ­¤å‘½ä»¤æä¾›æœ‰å…³ç‰¹å®šé€‚é…å™¨çš„ç¡¬ä»¶åŠŸèƒ½çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œlshw æ˜¾ç¤ºäº†ä¸€ä¸ªå…·æœ‰<em>eth1</em>é€»è¾‘åç§°çš„ä»¥å¤ªç½‘æ¥å£ä»¥åŠæ€»çº¿ä¿¡æ¯ã€é©±åŠ¨ç¨‹åºè¯¦ç»†ä¿¡æ¯å’Œæ‰€æœ‰æ”¯æŒçš„åŠŸèƒ½ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@lhp-server:/etc/netplan# lshw -class network
</span></span><span style=display:flex><span>  *-network                 
</span></span><span style=display:flex><span>       description: Ethernet interface
</span></span><span style=display:flex><span>       product: 82545EM Gigabit Ethernet Controller <span style=color:#000;font-weight:700>(</span>Copper<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       vendor: Intel Corporation
</span></span><span style=display:flex><span>       physical id: <span style=color:#099>1</span>
</span></span><span style=display:flex><span>       bus info: pci@0000:02:01.0
</span></span><span style=display:flex><span>       logical name: ens33
</span></span><span style=display:flex><span>       version: <span style=color:#099>01</span>
</span></span><span style=display:flex><span>       serial: 00:0c:29:da:c6:09
</span></span><span style=display:flex><span>       size: 1Gbit/s
</span></span><span style=display:flex><span>       capacity: 1Gbit/s
</span></span><span style=display:flex><span>       width: <span style=color:#099>64</span> bits
</span></span><span style=display:flex><span>       clock: 66MHz
</span></span><span style=display:flex><span>       capabilities: pm pcix bus_master cap_list rom ethernet physical logical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation
</span></span><span style=display:flex><span>       configuration: <span style=color:teal>autonegotiation</span><span style=color:#000;font-weight:700>=</span>on <span style=color:teal>broadcast</span><span style=color:#000;font-weight:700>=</span>yes <span style=color:teal>driver</span><span style=color:#000;font-weight:700>=</span>e1000 <span style=color:teal>driverversion</span><span style=color:#000;font-weight:700>=</span>7.3.21-k8-NAPI <span style=color:teal>duplex</span><span style=color:#000;font-weight:700>=</span>full <span style=color:teal>ip</span><span style=color:#000;font-weight:700>=</span>10.4.7.142 <span style=color:teal>latency</span><span style=color:#000;font-weight:700>=</span><span style=color:#099>0</span> <span style=color:teal>link</span><span style=color:#000;font-weight:700>=</span>yes <span style=color:teal>mingnt</span><span style=color:#000;font-weight:700>=</span><span style=color:#099>255</span> <span style=color:teal>multicast</span><span style=color:#000;font-weight:700>=</span>yes <span style=color:teal>port</span><span style=color:#000;font-weight:700>=</span>twisted pair <span style=color:teal>speed</span><span style=color:#000;font-weight:700>=</span>1Gbit/s
</span></span><span style=display:flex><span>       resources: irq:19 memory:fd5c0000-fd5dffff memory:fdff0000-fdffffff ioport:2000<span style=color:#000;font-weight:700>(</span><span style=color:teal>size</span><span style=color:#000;font-weight:700>=</span>64<span style=color:#000;font-weight:700>)</span> memory:fd500000-fd50ffff
</span></span></code></pre></td></tr></table></div></div><p>ethtool æ˜¯ä¸€ä¸ªç¨‹åºï¼Œç”¨äºæ˜¾ç¤ºå’Œæ›´æ”¹ä»¥å¤ªç½‘å¡è®¾ç½®ï¼Œä¾‹å¦‚è‡ªåŠ¨åå•†ã€ç«¯å£é€Ÿåº¦ã€åŒå·¥æ¨¡å¼å’Œ LAN å”¤é†’ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•æŸ¥çœ‹ä»¥å¤ªç½‘æ¥å£æ”¯æŒçš„åŠŸèƒ½å’Œé…ç½®è®¾ç½®çš„ç¤ºä¾‹ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@lhp-server:/etc/netplan# ethtool ens33 
</span></span><span style=display:flex><span>Settings <span style=color:#000;font-weight:700>for</span> ens33:
</span></span><span style=display:flex><span>	Supported ports: <span style=color:#000;font-weight:700>[</span> TP <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>	Supported link modes:   10baseT/Half 10baseT/Full 
</span></span><span style=display:flex><span>	                        100baseT/Half 100baseT/Full 
</span></span><span style=display:flex><span>	                        1000baseT/Full 
</span></span><span style=display:flex><span>	Supported pause frame use: No
</span></span><span style=display:flex><span>	Supports auto-negotiation: Yes
</span></span><span style=display:flex><span>	Supported FEC modes: Not reported
</span></span><span style=display:flex><span>	Advertised link modes:  10baseT/Half 10baseT/Full 
</span></span><span style=display:flex><span>	                        100baseT/Half 100baseT/Full 
</span></span><span style=display:flex><span>	                        1000baseT/Full 
</span></span><span style=display:flex><span>	Advertised pause frame use: No
</span></span><span style=display:flex><span>	Advertised auto-negotiation: Yes
</span></span><span style=display:flex><span>	Advertised FEC modes: Not reported
</span></span><span style=display:flex><span>	Speed: 1000Mb/s
</span></span><span style=display:flex><span>	Duplex: Full
</span></span><span style=display:flex><span>	Port: Twisted Pair
</span></span><span style=display:flex><span>	PHYAD: <span style=color:#099>0</span>
</span></span><span style=display:flex><span>	Transceiver: internal
</span></span><span style=display:flex><span>	Auto-negotiation: on
</span></span><span style=display:flex><span>	MDI-X: off <span style=color:#000;font-weight:700>(</span>auto<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	Supports Wake-on: d
</span></span><span style=display:flex><span>	Wake-on: d
</span></span><span style=display:flex><span>	Current message level: 0x00000007 <span style=color:#000;font-weight:700>(</span>7<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>			       drv probe link
</span></span><span style=display:flex><span>	Link detected: yes
</span></span></code></pre></td></tr></table></div></div><p>è¦ä¸´æ—¶é…ç½® IP åœ°å€ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ ip å‘½ä»¤ã€‚ä¿®æ”¹ IP åœ°å€å’Œå­ç½‘æ©ç ä»¥ç¬¦åˆæ‚¨çš„ç½‘ç»œè¦æ±‚ã€‚ip å‘½ä»¤å…è®¸æ‚¨é…ç½®ç«‹å³ç”Ÿæ•ˆçš„è®¾ç½®ï¼Œä½†æ˜¯å®ƒä»¬ä¸æ˜¯æŒä¹…çš„å¹¶ä¸”ä¼šåœ¨é‡æ–°å¯åŠ¨åä¸¢å¤±ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo ip addr add 10.102.66.200/24 dev ens33
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åå¯ä»¥ä½¿ç”¨ ip æ¥è®¾ç½®é“¾æ¥çš„å¼€å¯æˆ–å…³é—­ã€‚</p><pre tabindex=0><code>ip link set dev ens33 up
ip link set dev ens33 down
</code></pre><p>éªŒè¯enp0s25çš„IPåœ°å€é…ç½®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ipå‘½ä»¤ã€‚</p><pre tabindex=0><code>ip address show dev enp0s25
10: enp0s25: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:16:3e:e2:52:42 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.102.66.200/24 brd 10.102.66.255 scope global dynamic eth0
       valid_lft 2857sec preferred_lft 2857sec
    inet6 fe80::216:3eff:fee2:5242/64 scope link
       valid_lft forever preferred_lft forever6
</code></pre><p>è¦é…ç½®é»˜è®¤ç½‘å…³ï¼Œæ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ ip å‘½ä»¤ã€‚ä¿®æ”¹é»˜è®¤ç½‘å…³åœ°å€ä»¥ç¬¦åˆæ‚¨çš„ç½‘ç»œè¦æ±‚ã€‚</p><pre tabindex=0><code>sudo ip route add default via 10.102.66.1
</code></pre><p>è¦éªŒè¯æ‚¨çš„é»˜è®¤ç½‘å…³é…ç½®ï¼Œæ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ ip å‘½ä»¤ã€‚</p><pre tabindex=0><code>ip route show
default via 10.102.66.1 dev eth0 proto dhcp src 10.102.66.200 metric 100
10.102.66.0/24 dev eth0 proto kernel scope link src 10.102.66.200
10.102.66.1 dev eth0 proto dhcp scope link src 10.102.66.200 metric 100 
</code></pre><p>å¦‚æœæ‚¨çš„ä¸´æ—¶ç½‘ç»œé…ç½®éœ€è¦ DNSï¼Œæ‚¨å¯ä»¥åœ¨æ–‡ä»¶ä¸­æ·»åŠ  DNS æœåŠ¡å™¨ IP åœ°å€<code>/etc/resolv.conf</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>/etc/resolv.conf</code>ä¸å»ºè®®ç›´æ¥ç¼–è¾‘ï¼Œä½†è¿™æ˜¯ä¸€ç§ä¸´æ—¶ä¸”éæŒä¹…çš„é…ç½®ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•å°†ä¸¤ä¸ª DNS æœåŠ¡å™¨è¾“å…¥åˆ° ä¸­<code>/etc/resolv.conf</code>ï¼Œåº”å°†å…¶æ›´æ”¹ä¸ºé€‚åˆæ‚¨ç½‘ç»œçš„æœåŠ¡å™¨ã€‚ä»¥ä¸‹éƒ¨åˆ†è¯¦ç»†ä»‹ç»äº†è¿›è¡Œ DNS å®¢æˆ·ç«¯é…ç½®çš„æ­£ç¡®æŒä¹…æ–¹å¼ã€‚</p><pre tabindex=0><code>nameserver 8.8.8.8
nameserver 8.8.4.4
</code></pre><p>å¦‚æœæ‚¨ä¸å†éœ€è¦æ­¤é…ç½®å¹¶å¸Œæœ›ä»æ¥å£ä¸­æ¸…é™¤æ‰€æœ‰ IP é…ç½®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¸¦æœ‰flush é€‰é¡¹çš„ip å‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre tabindex=0><code>ip addr flush eth0
</code></pre><blockquote><p><strong>ç¬”è®°</strong></p><p>ä½¿ç”¨ ip å‘½ä»¤åˆ·æ–° IP é…ç½®ä¸ä¼šæ¸…é™¤<code>/etc/resolv.conf</code>. æ‚¨å¿…é¡»æ‰‹åŠ¨åˆ é™¤æˆ–ä¿®æ”¹è¿™äº›æ¡ç›®ï¼Œæˆ–è€…é‡æ–°å¯åŠ¨ï¼Œè¿™ä¹Ÿåº”è¯¥å¯¼è‡´<code>/etc/resolv.conf</code>ï¼Œå®ƒæ˜¯åˆ° çš„ç¬¦å·é“¾æ¥<code>/run/systemd/resolve/stub-resolv.conf</code>ï¼Œè¢«é‡å†™ã€‚</p></blockquote><h4 id=åŠ¨æ€-ip-åœ°å€åˆ†é…dhcp-å®¢æˆ·ç«¯>åŠ¨æ€ IP åœ°å€åˆ†é…ï¼ˆDHCP å®¢æˆ·ç«¯ï¼‰</h4><p>è¦å°†æ‚¨çš„æœåŠ¡å™¨é…ç½®ä¸ºä½¿ç”¨ DHCP è¿›è¡ŒåŠ¨æ€åœ°å€åˆ†é…ï¼Œè¯·åœ¨æ–‡ä»¶<code>/etc/netplan/99_config.yaml</code>. ä¸‹é¢çš„ç¤ºä¾‹å‡è®¾æ‚¨æ­£åœ¨é…ç½®æ ‡è¯†ä¸º<em>enp3s0 çš„</em>ç¬¬ä¸€ä¸ªä»¥å¤ªç½‘æ¥å£ã€‚</p><pre tabindex=0><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      dhcp4: true
</code></pre><p>ç„¶åå¯ä»¥ä½¿ç”¨ netplan å‘½ä»¤åº”ç”¨é…ç½®ã€‚</p><pre tabindex=0><code>sudo netplan apply
</code></pre><h4 id=é™æ€-ip-åœ°å€åˆ†é…>é™æ€ IP åœ°å€åˆ†é…</h4><p>è¦å°†ç³»ç»Ÿé…ç½®ä¸ºä½¿ç”¨é™æ€åœ°å€åˆ†é…ï¼Œè¯·åœ¨æ–‡ä»¶<code>/etc/netplan/99_config.yaml</code>. ä¸‹é¢çš„ç¤ºä¾‹å‡è®¾æ‚¨æ­£åœ¨é…ç½®æ ‡è¯†ä¸º<em>eth0 çš„</em>ç¬¬ä¸€ä¸ªä»¥å¤ªç½‘æ¥å£ã€‚æ›´æ”¹<em>address</em>ã€<em>gateway4</em>å’Œ<em>nameservers</em>å€¼ä»¥æ»¡è¶³æ‚¨çš„ç½‘ç»œè¦æ±‚ã€‚</p><pre tabindex=0><code>network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      addresses:
        - 10.10.10.2/24
      gateway4: 10.10.10.1
      nameservers:
          search: [mydomain, otherdomain]
          addresses: [10.10.10.1, 1.1.1.1]
</code></pre><p>ç„¶åå¯ä»¥ä½¿ç”¨ netplan å‘½ä»¤åº”ç”¨é…ç½®ã€‚</p><pre tabindex=0><code>sudo netplan apply
</code></pre><p><strong>æ³¨ï¼šæ—©æœŸç‰ˆæœ¬å¦‚ï¼šUbuntu 18.04ç­‰ç­‰ï¼Œå®ƒä»¬çš„é…ç½®æ–‡ä»¶åœ¨/etc/network/interfaceæ–‡ä»¶ä¸­ã€‚</strong></p><p>ç½‘å¡é‡å¯ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ip link <span style=color:#0086b3>set</span> ens33 down ip link <span style=color:#0086b3>set</span> ens33 up 
</span></span></code></pre></td></tr></table></div></div><h4 id=ç¯å›æ¥å£>ç¯å›æ¥å£</h4><p>ç¯å›æ¥å£ç”±ç³»ç»Ÿæ ‡è¯†ä¸º<em>lo</em>ï¼Œé»˜è®¤ IP åœ°å€ä¸º 127.0.0.1ã€‚å¯ä»¥ä½¿ç”¨ipå‘½ä»¤æŸ¥çœ‹ã€‚</p><pre tabindex=0><code>ip address show lo
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
</code></pre><h4 id=åç§°è§£æ>åç§°è§£æ</h4><p>ä¸ IP ç½‘ç»œç›¸å…³çš„åç§°è§£ææ˜¯å°† IP åœ°å€æ˜ å°„åˆ°ä¸»æœºåçš„è¿‡ç¨‹ï¼Œä»è€Œæ›´å®¹æ˜“è¯†åˆ«ç½‘ç»œä¸Šçš„èµ„æºã€‚ä»¥ä¸‹éƒ¨åˆ†å°†è§£é‡Šå¦‚ä½•æ­£ç¡®é…ç½®ç³»ç»Ÿä»¥ä½¿ç”¨ DNS å’Œé™æ€ä¸»æœºåè®°å½•è¿›è¡Œåç§°è§£æã€‚</p><h4 id=dns-å®¢æˆ·ç«¯é…ç½®>DNS å®¢æˆ·ç«¯é…ç½®</h4><p>ä¼ ç»Ÿä¸Šï¼Œè¯¥æ–‡ä»¶<code>/etc/resolv.conf</code>æ˜¯ä¸€ä¸ªé™æ€é…ç½®æ–‡ä»¶ï¼Œå¾ˆå°‘éœ€è¦æ›´æ”¹æˆ–é€šè¿‡ DCHP å®¢æˆ·ç«¯æŒ‚é’©è‡ªåŠ¨æ›´æ”¹ã€‚Systemd-resolved å¤„ç†åç§°æœåŠ¡å™¨é…ç½®ï¼Œå®ƒåº”è¯¥é€šè¿‡<code>systemd-resolve</code>å‘½ä»¤è¿›è¡Œäº¤äº’ã€‚Netplan é…ç½® systemd-resolved ä»¥ç”Ÿæˆè¦æ”¾å…¥çš„åç§°æœåŠ¡å™¨å’ŒåŸŸåˆ—è¡¨<code>/etc/resolv.conf</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼š</p><pre tabindex=0><code>/etc/resolv.conf -&gt; ../run/systemd/resolve/stub-resolv.conf
</code></pre><p>è¦é…ç½®è§£æå™¨ï¼Œè¯·å°†é€‚åˆæ‚¨ç½‘ç»œçš„åç§°æœåŠ¡å™¨çš„ IP åœ°å€æ·»åŠ åˆ° netplan é…ç½®æ–‡ä»¶ä¸­ã€‚æ‚¨è¿˜å¯ä»¥æ·»åŠ å¯é€‰çš„ DNS åç¼€æœç´¢åˆ—è¡¨ä»¥åŒ¹é…æ‚¨çš„ç½‘ç»œåŸŸåã€‚ç”Ÿæˆçš„æ–‡ä»¶å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre tabindex=0><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s25:
      addresses:
        - 192.168.0.100/24
      gateway4: 192.168.0.1
      nameservers:
          search: [mydomain, otherdomain]
          addresses: [1.1.1.1, 8.8.8.8, 4.4.4.4]
</code></pre><p>è¯¥æœç´¢é€‰é¡¹ä¹Ÿå¯ä»¥ç”¨å¤šä¸ªåŸŸåä½¿ç”¨ï¼Œä½¿å¾—DNSæŸ¥è¯¢å°†æŒ‰ç…§å®ƒä»¬çš„è¾“å…¥é¡ºåºè¿½åŠ ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„ç½‘ç»œå¯èƒ½æœ‰å¤šä¸ªè¦æœç´¢çš„å­åŸŸçš„çˆ¶åŸŸ*<code>example.com</code><em>ï¼Œå’Œä¸¤ä¸ªå­åŸŸï¼Œ</em><code>sales.example.com</code><em>ä»¥åŠ</em><code>dev.example.com</code>*.</p><p>å¦‚æœæ‚¨æœ‰å¤šä¸ªè¦æœç´¢çš„åŸŸï¼Œæ‚¨çš„é…ç½®å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre tabindex=0><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s25:
      addresses:
        - 192.168.0.100/24
      gateway4: 192.168.0.1
      nameservers:
          search: [example.com, sales.example.com, dev.example.com]
          addresses: [1.1.1.1, 8.8.8.8, 4.4.4.4]
</code></pre><p>å¦‚æœæ‚¨å°è¯• ping åä¸º<em>server1</em>çš„ä¸»æœºï¼Œæ‚¨çš„ç³»ç»Ÿå°†æŒ‰ä»¥ä¸‹é¡ºåºè‡ªåŠ¨æŸ¥è¯¢ DNS ä»¥è·å–å…¶å®Œå…¨é™å®šåŸŸå (FQDN)ï¼š</p><ol><li><code>server1.example.com</code></li><li><code>server1.sales.example.com</code></li><li><code>server1.dev.example.com</code></li></ol><p>å¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼ŒDNS æœåŠ¡å™¨å°†æä¾›<em>notfound</em>ç»“æœå¹¶ä¸” DNS æŸ¥è¯¢å°†å¤±è´¥ã€‚</p><h4 id=é™æ€ä¸»æœºå>é™æ€ä¸»æœºå</h4><p>é™æ€ä¸»æœºåæ˜¯ä½äºæ–‡ä»¶ä¸­çš„æœ¬åœ°å®šä¹‰çš„ä¸»æœºååˆ° IP çš„æ˜ å°„<code>/etc/hosts</code>ã€‚<code>hosts</code>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶ä¸­çš„æ¡ç›®ä¼˜å…ˆäº DNSã€‚è¿™æ„å‘³ç€å¦‚æœæ‚¨çš„ç³»ç»Ÿå°è¯•è§£æä¸»æœºåå¹¶ä¸”å®ƒä¸ /etc/hosts ä¸­çš„æ¡ç›®åŒ¹é…ï¼Œåˆ™å®ƒä¸ä¼šå°è¯•åœ¨ DNS ä¸­æŸ¥æ‰¾è®°å½•ã€‚åœ¨æŸäº›é…ç½®ä¸­ï¼Œå°¤å…¶æ˜¯å½“ä¸éœ€è¦è®¿é—® Internet æ—¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†ä¸æœ‰é™æ•°é‡èµ„æºé€šä¿¡çš„æœåŠ¡å™¨è®¾ç½®ä¸ºä½¿ç”¨é™æ€ä¸»æœºåè€Œä¸æ˜¯ DNSã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ª<code>hosts</code>æ–‡ä»¶ç¤ºä¾‹ï¼Œå…¶ä¸­é€šè¿‡ç®€å•çš„ä¸»æœºåã€åˆ«ååŠå…¶ç­‰æ•ˆçš„å®Œå…¨é™å®šåŸŸå (FQDN) æ ‡è¯†äº†å¤šä¸ªæœ¬åœ°æœåŠ¡å™¨ã€‚</p><pre tabindex=0><code>127.0.0.1   localhost
127.0.1.1   ubuntu-server
10.0.0.11   server1 server1.example.com vpn
10.0.0.12   server2 server2.example.com mail
10.0.0.13   server3 server3.example.com www
10.0.0.14   server4 server4.example.com file
</code></pre><blockquote><p><strong>ç¬”è®°</strong></p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯·æ³¨æ„ï¼Œé™¤äº†ä¸“æœ‰åç§°å’Œ FQDN ä¹‹å¤–ï¼Œæ¯ä¸ªæœåŠ¡å™¨è¿˜è¢«èµ‹äºˆäº†åˆ«åã€‚<em>Server1</em>å·²æ˜ å°„åˆ°åç§°<em>vpn</em>ï¼Œ<em>server2</em>ç§°ä¸º<em>mail</em>ï¼Œ<em>server3</em>ç§°ä¸º<em>www</em>ï¼Œ<em>server4</em>ç§°ä¸º<em>file</em>ã€‚</p></blockquote><h4 id=åç§°æœåŠ¡äº¤æ¢æœºé…ç½®>åç§°æœåŠ¡äº¤æ¢æœºé…ç½®</h4><p>ç³»ç»Ÿé€‰æ‹©å°†ä¸»æœºåè§£æä¸º IP åœ°å€çš„æ–¹æ³•çš„é¡ºåºç”±åç§°æœåŠ¡äº¤æ¢æœº (NSS) é…ç½®æ–‡ä»¶æ§åˆ¶<code>/etc/nsswitch.conf</code>ã€‚å¦‚ä¸Šä¸€èŠ‚æ‰€è¿°ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿ<code>/etc/hosts</code>æ–‡ä»¶ä¸­å®šä¹‰çš„é™æ€ä¸»æœºåä¼˜å…ˆäºä» DNS è§£æçš„åç§°ã€‚ä»¥ä¸‹æ˜¯è´Ÿè´£æ–‡ä»¶ä¸­ä¸»æœºåæŸ¥æ‰¾é¡ºåºçš„è¡Œçš„ç¤ºä¾‹<code>/etc/nsswitch.conf</code>ã€‚</p><pre tabindex=0><code>hosts:          files mdns4_minimal [NOTFOUND=return] dns mdns4
</code></pre><ul><li><strong>æ–‡ä»¶</strong>é¦–å…ˆå°è¯•è§£æä½äº<code>/etc/hosts</code>.</li><li><strong>mdns4_minimal</strong>å°è¯•ä½¿ç”¨å¤šæ’­ DNS è§£æåç§°ã€‚</li><li>**[NOTFOUND =è¿”å›]**æ„å‘³ç€ä»»ä½•å“åº”<em>NOTFOUND</em>ç”±å‰è¿°<em>mdns4_minimal</em>è¿‡ç¨‹åº”ä¸ºæƒå¨å¹¶ä¸”è¯¥ç³»ç»Ÿä¸åº”è¯¥è¯•å›¾ç»§ç»­ç‹©çŒçš„ç­”æ¡ˆè¿›è¡Œå¤„ç†ã€‚</li><li><strong>dns</strong>ä»£è¡¨ä¼ ç»Ÿçš„å•æ’­ DNS æŸ¥è¯¢ã€‚</li><li><strong>mdns4</strong>è¡¨ç¤ºå¤šæ’­ DNS æŸ¥è¯¢ã€‚</li></ul><p>è¦ä¿®æ”¹ä¸Šè¿°åç§°è§£ææ–¹æ³•çš„é¡ºåºï¼Œæ‚¨å¯ä»¥ç®€å•åœ°å°†*hosts:*å­—ç¬¦ä¸²æ›´æ”¹ä¸ºæ‚¨é€‰æ‹©çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨ä¼ ç»Ÿçš„å•æ’­ DNS è€Œä¸æ˜¯å¤šæ’­ DNSï¼Œæ‚¨å¯ä»¥æ›´æ”¹å­—ç¬¦ä¸²ï¼Œ<code>/etc/nsswitch.conf</code>å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre tabindex=0><code>hosts: files dns [NOTFOUND=return] mdns4_minimal mdns4
</code></pre><h4 id=æ¡¥æ¥>æ¡¥æ¥</h4><p>æ¡¥æ¥å¤šä¸ªæ¥å£æ˜¯ä¸€ç§æ›´é«˜çº§çš„é…ç½®ï¼Œä½†åœ¨å¤šä¸ªåœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚ä¸€ç§æ–¹æ¡ˆæ˜¯å»ºç«‹å…·æœ‰å¤šä¸ªç½‘ç»œæ¥å£çš„ç½‘æ¡¥ï¼Œç„¶åä½¿ç”¨é˜²ç«å¢™è¿‡æ»¤ä¸¤ä¸ªç½‘æ®µä¹‹é—´çš„æµé‡ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯åœ¨å…·æœ‰ä¸€ä¸ªæ¥å£çš„ç³»ç»Ÿä¸Šä½¿ç”¨æ¡¥æ¥å™¨ï¼Œä»¥å…è®¸è™šæ‹Ÿæœºç›´æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚ä»¥ä¸‹ç¤ºä¾‹æ¶µç›–äº†åä¸€ç§æƒ…å†µã€‚</p><p>é€šè¿‡ç¼–è¾‘æ‚¨åœ¨<code>/etc/netplan/</code>ä»¥ä¸‹ä½ç½®æ‰¾åˆ°çš„ netplan é…ç½®æ¥é…ç½®ç½‘æ¡¥ï¼š</p><pre tabindex=0><code>network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      dhcp4: no
  bridges:
    br0:
      dhcp4: yes
      interfaces:
        - enp3s0
</code></pre><blockquote><p><strong>ç¬”è®°</strong></p><p>ä¸ºæ‚¨çš„ç‰©ç†æ¥å£å’Œç½‘ç»œè¾“å…¥é€‚å½“çš„å€¼ã€‚</p></blockquote><p>ç°åœ¨åº”ç”¨é…ç½®ä»¥å¯ç”¨ç½‘æ¡¥ï¼š</p><pre tabindex=0><code>sudo netplan apply
</code></pre><p>æ–°çš„æ¡¥æ¥æ¥å£ç°åœ¨åº”è¯¥å·²ç»å¯åŠ¨å¹¶è¿è¡Œäº†ã€‚brctl æä¾›æœ‰å…³ç½‘æ¡¥çŠ¶æ€çš„æœ‰ç”¨ä¿¡æ¯ï¼Œæ§åˆ¶å“ªäº›æ¥å£æ˜¯ç½‘æ¡¥çš„ä¸€éƒ¨åˆ†ç­‰ã€‚æœ‰å…³<code>man brctl</code>æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€‚</p><h4 id=dhcp>DHCP</h4><p>DHCP æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æä¾›é…ç½®è®¾ç½®ï¼š</p><ul><li>æ‰‹åŠ¨åˆ†é…ï¼ˆMAC åœ°å€ï¼‰
è¿™ç§æ–¹æ³•éœ€è¦ä½¿ç”¨ DHCP æ¥è¯†åˆ«è¿æ¥åˆ°ç½‘ç»œçš„æ¯ä¸ªç½‘å¡çš„å”¯ä¸€ç¡¬ä»¶åœ°å€ï¼Œç„¶ååœ¨æ¯æ¬¡ DHCP å®¢æˆ·ç«¯ä½¿ç”¨è¯¥ç½‘ç»œè®¾å¤‡å‘ DHCP æœåŠ¡å™¨å‘å‡ºè¯·æ±‚æ—¶ä¸æ–­æä¾›æ’å®šé…ç½®ã€‚è¿™å¯ç¡®ä¿æ ¹æ®å…¶ MAC åœ°å€è‡ªåŠ¨å°†ç‰¹å®šåœ°å€åˆ†é…ç»™è¯¥ç½‘å¡ã€‚</li><li>åŠ¨æ€åˆ†é…ï¼ˆåœ°å€æ± ï¼‰
åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼ŒDHCP æœåŠ¡å™¨å°†ä»åœ°å€æ± ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºèŒƒå›´æˆ–èŒƒå›´ï¼‰ä¸­åˆ†é…ä¸€ä¸ª IP åœ°å€ï¼Œç”¨äºä¸€æ®µæ—¶é—´æˆ–ç§Ÿç”¨ï¼Œå³åœ¨æœåŠ¡å™¨ä¸Šé…ç½®æˆ–ç›´åˆ°å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨å®ƒä¸å†éœ€è¦è¯¥åœ°å€ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯å°†åœ¨â€œå…ˆåˆ°å…ˆå¾—â€çš„åŸºç¡€ä¸ŠåŠ¨æ€æ¥æ”¶å…¶é…ç½®å±æ€§ã€‚å½“ DHCP å®¢æˆ·ç«¯åœ¨æŒ‡å®šæ—¶é—´æ®µå†…ä¸å†ä½äºç½‘ç»œä¸Šæ—¶ï¼Œé…ç½®å°†è¿‡æœŸå¹¶é‡Šæ”¾å›åœ°å€æ± ä»¥ä¾›å…¶ä»– DHCP å®¢æˆ·ç«¯ä½¿ç”¨ã€‚è¿™æ ·ï¼Œä¸€ä¸ªåœ°å€å¯ä»¥è¢«ç§Ÿç”¨æˆ–ä½¿ç”¨ä¸€æ®µæ—¶é—´ã€‚åœ¨æ­¤æœŸé—´ä¹‹åï¼Œå®¢æˆ·ç«¯å¿…é¡»ä¸æœåŠ¡å™¨é‡æ–°åå•†ç§Ÿç”¨ä»¥ç»´æŒåœ°å€çš„ä½¿ç”¨ã€‚</li><li>è‡ªåŠ¨åˆ†é…
ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼ŒDHCP ä¼šè‡ªåŠ¨ä¸ºè®¾å¤‡æ°¸ä¹…åˆ†é…ä¸€ä¸ª IP åœ°å€ï¼Œä»å¯ç”¨åœ°å€æ± ä¸­é€‰æ‹©å®ƒã€‚é€šå¸¸ DHCP ç”¨äºä¸ºå®¢æˆ·ç«¯åˆ†é…ä¸´æ—¶åœ°å€ï¼Œä½† DHCP æœåŠ¡å™¨å¯ä»¥å…è®¸æ— é™çš„ç§Ÿç”¨æ—¶é—´ã€‚</li></ul><p>åä¸¤ç§æ–¹æ³•å¯ä»¥è¢«è®¤ä¸ºæ˜¯â€œè‡ªåŠ¨çš„â€ï¼Œå› ä¸ºåœ¨æ¯ç§æƒ…å†µä¸‹ï¼ŒDHCP æœåŠ¡å™¨éƒ½ä¼šåˆ†é…ä¸€ä¸ªåœ°å€ï¼Œè€Œæ— éœ€é¢å¤–å¹²é¢„ã€‚å®ƒä»¬ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«åœ¨äº IP åœ°å€çš„ç§Ÿç”¨æ—¶é—´é•¿çŸ­ï¼Œæ¢å¥è¯è¯´ï¼Œå®¢æˆ·ç«¯çš„åœ°å€æ˜¯å¦éšæ—¶é—´å˜åŒ–ã€‚Ubuntu æä¾›çš„ DHCP æœåŠ¡å™¨æ˜¯ dhcpdï¼ˆåŠ¨æ€ä¸»æœºé…ç½®åè®®å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œå®ƒæ˜“äºå®‰è£…å’Œé…ç½®ï¼Œå¹¶ä¸”ä¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ã€‚</p><p>å®‰è£…</p><p>åœ¨ç»ˆç«¯æç¤ºç¬¦ä¸‹ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… dhcpdï¼š</p><pre tabindex=0><code>sudo apt install isc-dhcp-server
</code></pre><p>æ³¨æ„ï¼šdhcpd çš„æ¶ˆæ¯æ­£åœ¨å‘é€åˆ° syslogã€‚åœ¨é‚£é‡ŒæŸ¥æ‰¾è¯Šæ–­æ¶ˆæ¯ã€‚</p><p>é…ç½®</p><p>æ‚¨å¯èƒ½éœ€è¦é€šè¿‡ç¼–è¾‘æ¥æ›´æ”¹é»˜è®¤é…ç½®<code>/etc/dhcp/dhcpd.conf</code>ä»¥æ»¡è¶³æ‚¨çš„éœ€è¦å’Œç‰¹å®šé…ç½®ã€‚</p><p>æœ€å¸¸è§çš„æ˜¯ï¼Œæ‚¨æƒ³è¦åšçš„æ˜¯éšæœºåˆ†é…ä¸€ä¸ª IP åœ°å€ã€‚è¿™å¯ä»¥é€šè¿‡å¦‚ä¸‹è®¾ç½®æ¥å®Œæˆï¼š</p><pre tabindex=0><code># minimal sample /etc/dhcp/dhcpd.conf
default-lease-time 600;
max-lease-time 7200;
ddns-update-style none;

subnet 10.4.7.0 netmask 255.255.255.0 {
  range 10.4.7.220 10.4.7.230;
  option routers 10.4.7.254;
  option subnet-mask 255.255.255.0;
  option broadcast-address 10.4.7.255;
  option domain-name-servers 10.4.7.254;
  option ntp-servers 10.4.7.254;
  option netbios-name-servers 10.4.7.254;
  option netbios-node-type 8;
}
</code></pre><p>è¿™å°†å¯¼è‡´ DHCP æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªèŒƒå›´ä¸º 10.4.7.220-10.4.7.230 çš„ IP åœ°å€ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸è¦æ±‚ç‰¹å®šçš„æ—¶é—´èŒƒå›´ï¼Œå®ƒå°†ç§Ÿç”¨ä¸€ä¸ª IP åœ°å€ 600 ç§’ã€‚å¦åˆ™æœ€å¤§ï¼ˆå…è®¸ï¼‰ç§ŸæœŸå°†ä¸º 7200 ç§’ã€‚æœåŠ¡å™¨è¿˜å°†â€œå»ºè®®â€å®¢æˆ·ç«¯ä½¿ç”¨ 10.4.7.254 ä½œä¸ºé»˜è®¤ç½‘å…³ï¼Œä½¿ç”¨ 10.4.7.254 ä½œä¸ºå…¶ DNS æœåŠ¡å™¨ã€‚ä½¿ç”¨10.4.7.254 ä½œä¸ºntpæœåŠ¡å™¨ã€‚ä½¿ç”¨10.4.7.254ä½œä¸ºå±€åŸŸç½‘å†…éƒ¨ä¸»æœºåå¯¹åº”çš„IPã€‚</p><p>æ‚¨å¯èƒ½è¿˜éœ€è¦ç¼–è¾‘<code>/etc/default/isc-dhcp-server</code>ä»¥æŒ‡å®š dhcpd åº”ä¾¦å¬çš„æ¥å£ã€‚</p><pre tabindex=0><code>INTERFACESv4=&#34;eth4&#34;
</code></pre><p>æ›´æ”¹é…ç½®æ–‡ä»¶åï¼Œæ‚¨å¿…é¡»é‡æ–°å¯åŠ¨ dhcpd æœåŠ¡ï¼š</p><pre tabindex=0><code>sudo systemctl restart isc-dhcp-server.service
</code></pre><h4 id=ntp>NTP</h4><p>NTP æ˜¯ä¸€ç§ TCP/IP åè®®ï¼Œç”¨äºé€šè¿‡ç½‘ç»œåŒæ­¥æ—¶é—´ã€‚åŸºæœ¬ä¸Šï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡å™¨è¯·æ±‚å½“å‰æ—¶é—´ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è®¾ç½®è‡ªå·±çš„æ—¶é’Ÿã€‚</p><p>åœ¨è¿™ä¸ªç®€å•çš„æè¿°èƒŒåï¼Œæœ‰å¾ˆå¤šå¤æ‚æ€§â€”â€”NTP æœåŠ¡å™¨æœ‰å¾ˆå¤šå±‚ï¼Œç¬¬ä¸€å±‚ NTP æœåŠ¡å™¨è¿æ¥åˆ°åŸå­é’Ÿï¼Œè€Œç¬¬äºŒå±‚å’Œç¬¬ä¸‰å±‚æœåŠ¡å™¨åˆ™é€šè¿‡ Internet åˆ†æ•£å®é™…å¤„ç†è¯·æ±‚çš„è´Ÿè½½ã€‚Ubuntu é»˜è®¤ä½¿ç”¨<em>timedatectl / timesyncd</em>æ¥åŒæ­¥æ—¶é—´ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨ chrony æ¥ä¸ºç½‘ç»œæ—¶é—´åè®®æä¾›æœåŠ¡ã€‚</p><p>åŒæ­¥æ—¶é—´</p><p>Ubuntu 16.04 <em>timedatectl / timesyncd</em>ï¼ˆå®ƒä»¬æ˜¯ systemd çš„ä¸€éƒ¨åˆ†ï¼‰æ›¿æ¢äº†å¤§éƒ¨åˆ†<em>ntpdate / ntp</em>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œtimesyncd æ˜¯å¯ç”¨çš„ï¼Œå®ƒä¸ä»…æ›¿æ¢ ntpdateï¼Œè€Œä¸”æ›¿æ¢ chronyï¼ˆæˆ–ä»¥å‰çš„ ntpdï¼‰çš„å®¢æˆ·ç«¯éƒ¨åˆ†ã€‚å› æ­¤ï¼Œé™¤äº† ntpdate åœ¨å¯åŠ¨å’Œç½‘ç»œæ¿€æ´»æ—¶æä¾›çš„ä¸€æ¬¡æ€§æ“ä½œä¹‹å¤–ï¼Œç°åœ¨é»˜è®¤æƒ…å†µä¸‹ timesyncd ä¼šå®šæœŸæ£€æŸ¥å¹¶ä¿æŒæœ¬åœ°æ—¶é—´åŒæ­¥ã€‚å®ƒè¿˜åœ¨æœ¬åœ°å­˜å‚¨æ—¶é—´æ›´æ–°ï¼Œä»¥ä¾¿åœ¨é‡æ–°å¯åŠ¨åå•è°ƒå‰è¿›ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ã€‚</p><p>å¦‚æœå®‰è£…äº† chronyï¼Œtimedatectl ä¼šé€€å›è®© chrony è¿›è¡Œè®¡æ—¶ã€‚è¿™å°†ç¡®ä¿æ²¡æœ‰ä¸¤ä¸ªæ—¶é—´åŒæ­¥æœåŠ¡å‘ç”Ÿå†²çªã€‚è™½ç„¶ä¸å†æ¨èä½¿ç”¨ï¼Œä½†è¿™ä»ç„¶é€‚ç”¨äºå®‰è£… ntpd ä»¥ä¿ç•™æ‚¨é€šè¿‡å‡çº§è·å¾—çš„ä»»ä½•ç±»å‹çš„æ—§è¡Œä¸º/é…ç½®ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€åœ¨ä»ä»¥å‰çš„ç‰ˆæœ¬å‡çº§æ—¶å¯èƒ½ä»ä¼šå®‰è£… ntp/ntpdateï¼Œå› æ­¤ä¼šç¦ç”¨æ–°çš„åŸºäº systemd çš„æœåŠ¡ã€‚</p><p>ntpdate è¢«è®¤ä¸ºå·²å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ timedatectlï¼ˆæˆ– chronyï¼‰ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¸å†å®‰è£…ã€‚timesyncd é€šå¸¸ä¼šåšæ­£ç¡®çš„äº‹æƒ…ï¼Œä½¿æ‚¨çš„æ—¶é—´ä¿æŒåŒæ­¥ï¼Œè€Œ chrony å°†å¸®åŠ©å¤„ç†æ›´å¤æ‚çš„æƒ…å†µã€‚</p><p>éœ€è¦ä¸€æ¬¡æ€§åŒæ­¥ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chronyd -q
</span></span></code></pre></td></tr></table></div></div><p>éœ€è¦ä¸€æ¬¡æ€§æ£€æŸ¥æ—¶é—´ï¼Œè€Œä¸è®¾ç½®æ—¶é—´:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chronyd -Q
</span></span></code></pre></td></tr></table></div></div><p>timesyncd å’Œchronyd åŒæ—¶å­˜åœ¨æ—¶ï¼Œåªæœ‰ä¸€ä¸ªç”Ÿæ•ˆï¼Œå¦‚æœchronydæ­£åœ¨è¿è¡Œï¼Œé‚£ä¹ˆchronydç”Ÿæ•ˆã€‚</p><p>é€šè¿‡ timedatectl å’Œ timesyncd å¯ä»¥æ£€æŸ¥æ—¶é—´å’Œæ—¶é—´é…ç½®çš„å½“å‰çŠ¶æ€<code>timedatectl status</code>ã€‚</p><pre tabindex=0><code class=language-auto data-lang=auto>$ timedatectl status
                       Local time: Fr 2018-02-23 08:47:13 UTC
                   Universal time: Fr 2018-02-23 08:47:13 UTC
                         RTC time: Fr 2018-02-23 08:47:13
                        Time zone: Etc/UTC (UTC, +0000)
        System clock synchronized: yes
 systemd-timesyncd.service active: yes
                  RTC in local TZ: no
</code></pre><p>å¦‚æœ chrony æ­£åœ¨è¿è¡Œï¼Œå®ƒå°†è‡ªåŠ¨åˆ‡æ¢åˆ°ï¼š</p><pre tabindex=0><code class=language-auto data-lang=auto>[...]
 systemd-timesyncd.service active: no 
</code></pre><p>é€šè¿‡ timedatectl ç®¡ç†å‘˜å¯ä»¥æ§åˆ¶æ—¶åŒºã€ç³»ç»Ÿæ—¶é’Ÿåº”è¯¥å¦‚ä½•ä¸ hwclock ç›¸å…³ä»¥åŠæ˜¯å¦åº”è¯¥å¯ç”¨æ°¸ä¹…åŒæ­¥ã€‚æœ‰å…³<code>man timedatectl</code>æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€‚</p><p>timesyncd æœ¬èº«ä»ç„¶æ˜¯ä¸€ä¸ªæ­£å¸¸çš„æœåŠ¡ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ƒæ›´è¯¦ç»†åœ°æ£€æŸ¥å®ƒçš„çŠ¶æ€ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@lhp-server:~# systemctl status systemd-timesyncd 
</span></span><span style=display:flex><span>â— systemd-timesyncd.service
</span></span><span style=display:flex><span>     Loaded: masked <span style=color:#000;font-weight:700>(</span>Reason: Unit systemd-timesyncd.service is masked.<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     Active: inactive <span style=color:#000;font-weight:700>(</span>dead<span style=color:#000;font-weight:700>)</span> since Thu 2021-09-23 02:41:56 UTC; 35min ago
</span></span><span style=display:flex><span>   Main PID: <span style=color:#099>736</span> <span style=color:#000;font-weight:700>(</span><span style=color:teal>code</span><span style=color:#000;font-weight:700>=</span>exited, <span style=color:teal>status</span><span style=color:#000;font-weight:700>=</span>0/SUCCESS<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>     Status: <span style=color:#d14>&#34;Shutting down...&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 01:53:57 lhp-server systemd<span style=color:#000;font-weight:700>[</span>1<span style=color:#000;font-weight:700>]</span>: Starting Network Time Synchronization...
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 01:53:57 lhp-server systemd<span style=color:#000;font-weight:700>[</span>1<span style=color:#000;font-weight:700>]</span>: Started Network Time Synchronization.
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 01:54:05 lhp-server systemd-timesyncd<span style=color:#000;font-weight:700>[</span>736<span style=color:#000;font-weight:700>]</span>: Network configuration changed, trying to establish connection.
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 01:54:06 lhp-server systemd-timesyncd<span style=color:#000;font-weight:700>[</span>736<span style=color:#000;font-weight:700>]</span>: Network configuration changed, trying to establish connection.
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 01:54:39 lhp-server systemd-timesyncd<span style=color:#000;font-weight:700>[</span>736<span style=color:#000;font-weight:700>]</span>: Initial synchronization to <span style=color:#0086b3>time</span> server 91.189.89.199:123 <span style=color:#000;font-weight:700>(</span>ntp.ubuntu.com<span style=color:#000;font-weight:700>)</span>.
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 02:41:56 lhp-server systemd<span style=color:#000;font-weight:700>[</span>1<span style=color:#000;font-weight:700>]</span>: Stopping Network Time Synchronization...
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 02:41:56 lhp-server systemd<span style=color:#000;font-weight:700>[</span>1<span style=color:#000;font-weight:700>]</span>: systemd-timesyncd.service: Succeeded.
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 02:41:56 lhp-server systemd<span style=color:#000;font-weight:700>[</span>1<span style=color:#000;font-weight:700>]</span>: Stopped Network Time Synchronization.
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥ä»è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­è·å–åˆ°æ ¹åŸŸåæœåŠ¡å™¨çš„æ—¶é—´ï¼š/etc/systemd/timesyncd.confå’Œ/etc/systemd/timesyncd.conf.d/ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹man timesyncd.confã€‚</p><h4 id=chrony>Chrony</h4><p>å®‰è£…</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install chrony
</span></span></code></pre></td></tr></table></div></div><p>è¿™å°†æä¾›ä¸¤ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p><ul><li>chronyd - é€šè¿‡ NTP åè®®åŒæ­¥å’ŒæœåŠ¡çš„å®é™…å®ˆæŠ¤è¿›ç¨‹</li><li>chronyc - chrony å®ˆæŠ¤è¿›ç¨‹çš„å‘½ä»¤è¡Œç•Œé¢</li></ul><p>é…ç½®ï¼š</p><p>ç¼–è¾‘<code>/etc/chrony/chrony.conf</code>ä»¥æ·»åŠ /åˆ é™¤æœåŠ¡å™¨è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æœåŠ¡å™¨é…ç½®ä¸ºï¼š</p><pre tabindex=0><code># Use servers from the NTP Pool Project. Approved by Ubuntu Technical Board
# on 2011-02-08 (LP: #104525). See http://www.pool.ntp.org/join.html for
# more information.
pool 0.ubuntu.pool.ntp.org iburst
pool 1.ubuntu.pool.ntp.org iburst
pool 2.ubuntu.pool.ntp.org iburst
pool 3.ubuntu.pool.ntp.org iburst
</code></pre><p>æœ‰å…³<code>man chrony.conf</code>é…ç½®é€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€‚æ›´æ”¹ä»»ä½•é…ç½®æ–‡ä»¶åï¼Œæ‚¨å¿…é¡»é‡æ–°å¯åŠ¨chronyï¼š</p><pre tabindex=0><code>sudo systemctl restart chrony.service
</code></pre><p>å¦‚æœéœ€è¦ï¼Œ<code>pool 2.ubuntu.pool.ntp.org</code>ä»¥åŠ<code>ntp.ubuntu.com</code>è¿˜æ”¯æŒ ipv6ã€‚å¦‚æœéœ€è¦å¼ºåˆ¶ä½¿ç”¨ ipv6 <code>ipv6.ntp.ubuntu.com</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ²¡æœ‰é…ç½®ã€‚</p><p>æŸ¥çœ‹çŠ¶æ€</p><p>ä½¿ç”¨ chronyc æŸ¥çœ‹æŸ¥è¯¢ chrony å®ˆæŠ¤è¿›ç¨‹çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œè·å–å½“å‰å¯ç”¨å’Œé€‰å®šæ—¶é—´æºçš„æ¦‚è§ˆ.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@lhp-server:~# chronyc sources <span style=color:#099>210</span> Number of <span style=color:teal>sources</span> <span style=color:#000;font-weight:700>=</span> 8MS Name/IP address         Stratum Poll Reach LastRx Last <span style=color:teal>sample</span>               <span style=color:#000;font-weight:700>===============================================================================</span>^- chilipepper.canonical.com     <span style=color:#099>2</span>   <span style=color:#099>6</span>   <span style=color:#099>377</span>    <span style=color:#099>43</span>  +8909us<span style=color:#000;font-weight:700>[</span>+8909us<span style=color:#000;font-weight:700>]</span> +/-  192ms^- alphyn.canonical.com          <span style=color:#099>2</span>   <span style=color:#099>7</span>   <span style=color:#099>175</span>   <span style=color:#099>108</span>    +15ms<span style=color:#000;font-weight:700>[</span>  +15ms<span style=color:#000;font-weight:700>]</span> +/-  167ms^- golem.canonical.com           <span style=color:#099>2</span>   <span style=color:#099>6</span>   <span style=color:#099>377</span>    <span style=color:#099>49</span>    +17ms<span style=color:#000;font-weight:700>[</span>  +17ms<span style=color:#000;font-weight:700>]</span> +/-  188ms^- pugot.canonical.com           <span style=color:#099>2</span>   <span style=color:#099>6</span>   <span style=color:#099>377</span>    <span style=color:#099>51</span>    +16ms<span style=color:#000;font-weight:700>[</span>  +16ms<span style=color:#000;font-weight:700>]</span> +/-  178ms^- 139.199.215.251               <span style=color:#099>2</span>   <span style=color:#099>6</span>   <span style=color:#099>377</span>    <span style=color:#099>53</span>  -1308us<span style=color:#000;font-weight:700>[</span>-1350us<span style=color:#000;font-weight:700>]</span> +/-   32ms^* 202.118.1.130                 <span style=color:#099>1</span>   <span style=color:#099>6</span>   <span style=color:#099>377</span>    <span style=color:#099>53</span>   -113us<span style=color:#000;font-weight:700>[</span> -155us<span style=color:#000;font-weight:700>]</span> +/- 8565us^- tock.ntp.infomaniak.ch        <span style=color:#099>1</span>   <span style=color:#099>6</span>   <span style=color:#099>377</span>    <span style=color:#099>49</span>    +36ms<span style=color:#000;font-weight:700>[</span>  +36ms<span style=color:#000;font-weight:700>]</span> +/-  118ms^- 111.230.189.174               <span style=color:#099>2</span>   <span style=color:#099>7</span>   <span style=color:#099>237</span>    <span style=color:#099>54</span>  -2129us<span style=color:#000;font-weight:700>[</span>-2171us<span style=color:#000;font-weight:700>]</span> +/-   27ms
</span></span></code></pre></td></tr></table></div></div><p>æŸäº› chronyc å‘½ä»¤æ˜¯ç‰¹æƒå‘½ä»¤ï¼Œæœªç»æ˜ç¡®å…è®¸æ— æ³•é€šè¿‡ç½‘ç»œè¿è¡Œã€‚è§<em>æŒ‡æŒ¥å’Œç›‘æ§è®¿é—®</em>ä¸­<code>man chrony.conf</code>äº†è§£æ›´å¤šè¯¦æƒ…ã€‚æœ¬åœ°ç®¡ç†å‘˜é€šå¸¸å¯ä»¥ä½¿ç”¨ sudo ï¼Œå› ä¸ºè¿™å°†æˆäºˆä»–è®¿é—®æœ¬åœ°ç®¡ç†å‘˜å¥—æ¥å­—çš„æƒé™<code>/var/run/chrony/chronyd.sock</code>ã€‚</p><h3 id=äº”å®‰å…¨>äº”ã€å®‰å…¨</h3><h4 id=ç”¨æˆ·ç®¡ç†>ç”¨æˆ·ç®¡ç†</h4><p>rootç”¨æˆ·é»˜è®¤ç¦æ­¢è®¿é—®ã€‚</p><p>é¼“åŠ±ç”¨æˆ·ä½¿ç”¨åä¸ºâ€œsudoâ€çš„å·¥å…·æ¥æ‰§è¡Œç³»ç»Ÿç®¡ç†èŒè´£ã€‚Sudo å…è®¸æˆæƒç”¨æˆ·ä½¿ç”¨ä»–ä»¬è‡ªå·±çš„å¯†ç ä¸´æ—¶æå‡ä»–ä»¬çš„æƒé™ï¼Œè€Œä¸å¿…çŸ¥é“å±äº root å¸æˆ·çš„å¯†ç ã€‚è¿™ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•ä¸ºæ‰€æœ‰ç”¨æˆ·æ“ä½œæä¾›äº†é—®è´£åˆ¶ï¼Œå¹¶ä½¿ç®¡ç†å‘˜å¯ä»¥ç²¾ç»†æ§åˆ¶ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ‰€è¿°æƒé™æ‰§è¡Œå“ªäº›æ“ä½œã€‚</p><p>å¯ç”¨rootç”¨æˆ·å¹¶è®¾ç½®æ–°å¯†ç ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo passwd
</span></span></code></pre></td></tr></table></div></div><p>Sudo å°†æç¤ºæ‚¨è¾“å…¥å¯†ç ï¼Œç„¶åè¦æ±‚æ‚¨ä¸º root æä¾›ä¸€ä¸ªæ–°å¯†ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre tabindex=0><code>[sudo] password for username: (enter your own password)
Enter new UNIX password: (enter a new password for root)
Retype new UNIX password: (repeat new password for root)
passwd: password updated successfully
</code></pre><p>ç¦ç”¨ root å¸æˆ·å¯†ç </p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo passwd -l root
</span></span></code></pre></td></tr></table></div></div><p>æ›´å¤šsudo</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>man sudo 
</span></span></code></pre></td></tr></table></div></div><p>æ·»åŠ å’Œåˆ é™¤ç”¨æˆ·</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo adduser username
</span></span></code></pre></td></tr></table></div></div><p>åˆ é™¤ç”¨æˆ·å¸æˆ·åŠå…¶ä¸»è¦ç»„ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><pre tabindex=0><code>sudo deluser username
</code></pre><ul><li><p>åˆ é™¤å¸æˆ·ä¸ä¼šåˆ é™¤å…¶å„è‡ªçš„ä¸»æ–‡ä»¶å¤¹ã€‚æ‚¨æ˜¯å¦å¸Œæœ›æ‰‹åŠ¨åˆ é™¤æ–‡ä»¶å¤¹æˆ–æ ¹æ®æ‰€éœ€çš„ä¿ç•™ç­–ç•¥ä¿ç•™å®ƒå–å†³äºæ‚¨ã€‚</p><p>è¯·è®°ä½ï¼Œå¦‚æœæ‚¨æ²¡æœ‰é‡‡å–å¿…è¦çš„é¢„é˜²æªæ–½ï¼Œä»»ä½•åæ¥æ·»åŠ çš„ä¸å‰ä¸€ä¸ªæ‰€æœ‰è€…å…·æœ‰ç›¸åŒ UID/GID çš„ç”¨æˆ·ç°åœ¨éƒ½å¯ä»¥è®¿é—®æ­¤æ–‡ä»¶å¤¹ã€‚</p><p>æ‚¨å¯èƒ½å¸Œæœ›å°†è¿™äº› UID/GID å€¼æ›´æ”¹ä¸ºæ›´åˆé€‚çš„å€¼ï¼Œä¾‹å¦‚ root å¸æˆ·ï¼Œç”šè‡³å¯èƒ½é‡æ–°å®šä½æ–‡ä»¶å¤¹ä»¥é¿å…å°†æ¥å‘ç”Ÿå†²çªï¼š</p><pre tabindex=0><code>sudo chown -R root:root /home/username/
sudo mkdir /home/archived_users/
sudo mv /home/username /home/archived_users/
</code></pre></li><li><p>è¦ä¸´æ—¶é”å®šæˆ–è§£é”ç”¨æˆ·å¯†ç ï¼Œè¯·åˆ†åˆ«ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><pre tabindex=0><code>sudo passwd -l username
sudo passwd -u username
</code></pre></li><li><p>è¦æ·»åŠ æˆ–åˆ é™¤ä¸ªæ€§åŒ–ç»„ï¼Œè¯·åˆ†åˆ«ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><pre tabindex=0><code>sudo addgroup groupname
sudo delgroup groupname
</code></pre></li><li><p>è¦å°†ç”¨æˆ·æ·»åŠ åˆ°ç»„ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><pre tabindex=0><code>sudo adduser username groupname
</code></pre></li></ul><h4 id=ç”¨æˆ·é…ç½®æ–‡ä»¶å®‰å…¨>ç”¨æˆ·é…ç½®æ–‡ä»¶å®‰å…¨</h4><p>åˆ›å»ºæ–°ç”¨æˆ·æ—¶ï¼Œ adduser å®ç”¨ç¨‹åºä¼šåˆ›å»ºä¸€ä¸ªåä¸º çš„å…¨æ–°ä¸»ç›®å½•<code>/home/username</code>ã€‚é»˜è®¤é…ç½®æ–‡ä»¶ä»¥ ç›®å½•ä¸­çš„å†…å®¹ä¸ºæ¨¡å‹<code>/etc/skel</code>ï¼Œå…¶ä¸­åŒ…æ‹¬æ‰€æœ‰é…ç½®æ–‡ä»¶åŸºç¡€ã€‚</p><p>å¦‚æœæ‚¨çš„æœåŠ¡å™¨å°†æœ‰å¤šä¸ªç”¨æˆ·ä½¿ç”¨ï¼Œåˆ™åº”å¯†åˆ‡æ³¨æ„ç”¨æˆ·ä¸»ç›®å½•çš„æƒé™ä»¥ç¡®ä¿æœºå¯†æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒUbuntu ä¸­çš„ç”¨æˆ·ä¸»ç›®å½•æ˜¯ä½¿ç”¨å…¨å±€è¯»å–/æ‰§è¡Œæƒé™åˆ›å»ºçš„ã€‚è¿™æ„å‘³ç€æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æµè§ˆå’Œè®¿é—®å…¶ä»–ç”¨æˆ·ä¸»ç›®å½•çš„å†…å®¹ã€‚è¿™å¯èƒ½ä¸é€‚åˆæ‚¨çš„ç¯å¢ƒã€‚</p><ul><li><p>è¦éªŒè¯æ‚¨å½“å‰çš„ç”¨æˆ·ä¸»ç›®å½•æƒé™ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><pre tabindex=0><code>ls -ld /home/username
</code></pre><p>ä»¥ä¸‹è¾“å‡ºæ˜¾ç¤ºè¯¥ç›®å½•<code>/home/username</code>å…·æœ‰å…¨çƒå¯è¯»çš„æƒé™ï¼š</p><pre tabindex=0><code>drwxr-xr-x  2 username username    4096 2007-10-02 20:03 username
</code></pre></li><li><p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•åˆ é™¤ä¸–ç•Œå¯è¯»æƒé™ï¼š</p><pre tabindex=0><code>sudo chmod 0750 /home/username
</code></pre><blockquote><p><strong>ç¬”è®°</strong></p><p>æœ‰äº›äººå€¾å‘äºä¸åŠ é€‰æ‹©åœ°ä½¿ç”¨é€’å½’é€‰é¡¹ (-R) æ¥ä¿®æ”¹æ‰€æœ‰å­æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šäº§ç”Ÿå…¶ä»–ä¸è‰¯ç»“æœã€‚ä»…çˆ¶ç›®å½•å°±è¶³ä»¥é˜²æ­¢æœªç»æˆæƒè®¿é—®çˆ¶ç›®å½•ä¸‹çš„ä»»ä½•å†…å®¹ã€‚</p></blockquote><p>ä¸€ä¸ªæ›´æœ‰æ•ˆçš„æ–¹æ³•æ˜¯åœ¨åˆ›å»ºç”¨æˆ·ä¸»æ–‡ä»¶å¤¹æ—¶ä¿®æ”¹ adduser å…¨å±€é»˜è®¤æƒé™ã€‚åªéœ€ç¼–è¾‘æ–‡ä»¶<code>/etc/adduser.conf</code>å¹¶å°†<code>DIR_MODE</code>å˜é‡ä¿®æ”¹ä¸ºé€‚å½“çš„å†…å®¹ï¼Œä»¥ä¾¿æ‰€æœ‰æ–°çš„ä¸»ç›®å½•éƒ½å°†è·å¾—æ­£ç¡®çš„æƒé™ã€‚</p><pre tabindex=0><code>DIR_MODE=0750
</code></pre></li><li><p>ä½¿ç”¨å‰é¢æåˆ°çš„ä»»ä½•æŠ€æœ¯æ›´æ­£ç›®å½•æƒé™åï¼Œä½¿ç”¨ä»¥ä¸‹è¯­æ³•éªŒè¯ç»“æœï¼š</p><pre tabindex=0><code>ls -ld /home/username
</code></pre><p>ä¸‹é¢çš„ç»“æœè¡¨æ˜ï¼Œä¸–ç•Œå¯è¯»çš„æƒé™å·²è¢«åˆ é™¤ï¼š</p><pre tabindex=0><code>drwxr-x---   2 username username    4096 2007-10-02 20:03 username
</code></pre></li></ul><h4 id=å¯†ç ç­–ç•¥>å¯†ç ç­–ç•¥</h4><p>æœ€å°é•¿åº¦å¯†ç </p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒUbuntu éœ€è¦æœ€å°‘ 6 ä¸ªå­—ç¬¦çš„å¯†ç é•¿åº¦ï¼Œä»¥åŠä¸€äº›åŸºæœ¬çš„ç†µæ£€æŸ¥ã€‚è¿™äº›å€¼åœ¨æ–‡ä»¶ ä¸­æ§åˆ¶ï¼Œ<code>/etc/pam.d/common-password</code>æ¦‚è¿°å¦‚ä¸‹ã€‚</p><pre tabindex=0><code>password        [success=1 default=ignore]      pam_unix.so obscure sha512
</code></pre><p>å¦‚æœè¦å°†æœ€å°é•¿åº¦è°ƒæ•´ä¸º 8 ä¸ªå­—ç¬¦ï¼Œè¯·å°†é€‚å½“çš„å˜é‡æ›´æ”¹ä¸º min=8ã€‚ä¿®æ”¹æ¦‚è¿°å¦‚ä¸‹ã€‚</p><pre tabindex=0><code>password        [success=1 default=ignore]      pam_unix.so obscure sha512 minlen=8
</code></pre><blockquote><p><strong>ç¬”è®°</strong></p><p>åŸºæœ¬å¯†ç ç†µæ£€æŸ¥å’Œæœ€å°é•¿åº¦è§„åˆ™ä¸é€‚ç”¨äºä½¿ç”¨ sudo çº§åˆ«å‘½ä»¤è®¾ç½®æ–°ç”¨æˆ·çš„ç®¡ç†å‘˜ã€‚</p></blockquote><p>å¯†ç è¿‡æœŸ</p><p>åˆ›å»ºç”¨æˆ·å¸æˆ·æ—¶ï¼Œæ‚¨åº”è¯¥åˆ¶å®šä¸€é¡¹ç­–ç•¥ï¼Œè®¾ç½®æœ€çŸ­å’Œæœ€é•¿å¯†ç æœŸé™ï¼Œè¿«ä½¿ç”¨æˆ·åœ¨å¯†ç åˆ°æœŸæ—¶æ›´æ”¹å¯†ç ã€‚</p><ul><li><p>è¦è½»æ¾æŸ¥çœ‹ç”¨æˆ·å¸æˆ·çš„å½“å‰çŠ¶æ€ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><pre tabindex=0><code>sudo chage -l username
</code></pre><p>ä¸‹é¢çš„è¾“å‡ºæ˜¾ç¤ºäº†æœ‰å…³ç”¨æˆ·å¸æˆ·çš„æœ‰è¶£äº‹å®ï¼Œå³æ²¡æœ‰åº”ç”¨ä»»ä½•ç­–ç•¥ï¼š</p><pre tabindex=0><code>Last password change                                    : Jan 20, 2015
Password expires                                        : never
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 99999
Number of days of warning before password expires       : 7
</code></pre></li><li><p>è¦è®¾ç½®è¿™äº›å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œåªéœ€ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼Œå¹¶æŒ‰ç…§äº¤äº’å¼æç¤ºè¿›è¡Œæ“ä½œï¼š</p><pre tabindex=0><code>sudo chage username
</code></pre><p>ä¸‹é¢ä¹Ÿæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•æ‰‹åŠ¨å°†æ˜¾å¼åˆ°æœŸæ—¥æœŸ (-E) æ›´æ”¹ä¸º 01/31/2015ã€æœ€çŸ­å¯†ç æœŸé™ (-m) ä¸º 5 å¤©ã€æœ€é•¿å¯†ç æœŸé™ (-M) ä¸º 90 å¤©ã€ä¸æ´»åŠ¨å¯†ç åˆ°æœŸå 30 å¤©çš„æ—¶é—´æ®µ (-I)ï¼Œä»¥åŠå¯†ç åˆ°æœŸå‰ 14 å¤©çš„è­¦å‘Šæ—¶é—´æ®µ (-W)ï¼š</p><pre tabindex=0><code>sudo chage -E 01/31/2015 -m 5 -M 90 -I 30 -W 14 username
</code></pre></li><li><p>è¦éªŒè¯æ›´æ”¹ï¼Œè¯·ä½¿ç”¨ä¸å‰é¢æåˆ°çš„ç›¸åŒçš„è¯­æ³•ï¼š</p><pre tabindex=0><code>sudo chage -l username
</code></pre><p>ä¸‹é¢çš„è¾“å‡ºæ˜¾ç¤ºäº†ä¸ºè´¦æˆ·å»ºç«‹çš„æ–°ç­–ç•¥ï¼š</p><pre tabindex=0><code>Last password change                                    : Jan 20, 2015
Password expires                                        : Apr 19, 2015
Password inactive                                       : May 19, 2015
Account expires                                         : Jan 31, 2015
Minimum number of days between password change          : 5
Maximum number of days between password change          : 90
Number of days of warning before password expires       : 14
</code></pre></li></ul><p>å¯¹äºè¢«ç¦ç”¨çš„ç”¨æˆ·sshçš„è®¿é—®</p><p>å¦‚æœç”¨æˆ·ä¹‹å‰å·²ç»è®¾ç½®äº† SSH å…¬é’¥èº«ä»½éªŒè¯ï¼Œåˆ™ç®€å•åœ°ç¦ç”¨/é”å®šç”¨æˆ·å¯†ç ä¸ä¼šé˜»æ­¢ç”¨æˆ·è¿œç¨‹ç™»å½•æ‚¨çš„æœåŠ¡å™¨ã€‚ä»–ä»¬ä»ç„¶èƒ½å¤Ÿè·å¾—å¯¹æœåŠ¡å™¨çš„ shell è®¿é—®ï¼Œè€Œæ— éœ€ä»»ä½•å¯†ç ã€‚è¯·è®°ä½æ£€æŸ¥ç”¨æˆ·ä¸»ç›®å½•ä¸­æ˜¯å¦æœ‰å…è®¸æ­¤ç±»ç»è¿‡èº«ä»½éªŒè¯çš„ SSH è®¿é—®çš„æ–‡ä»¶ï¼Œä¾‹å¦‚<code>/home/username/.ssh/authorized_keys</code>.</p><p>åˆ é™¤æˆ–é‡å‘½å<code>.ssh/</code>ç”¨æˆ·ä¸»æ–‡ä»¶å¤¹ä¸­çš„ç›®å½•ï¼Œä»¥é˜²æ­¢è¿›ä¸€æ­¥çš„ SSH èº«ä»½éªŒè¯åŠŸèƒ½ã€‚</p><p>è¯·åŠ¡å¿…æ£€æŸ¥ç¦ç”¨ç”¨æˆ·å»ºç«‹çš„ä»»ä½• SSH è¿æ¥ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½å·²ç»å­˜åœ¨å…¥ç«™æˆ–å‡ºç«™è¿æ¥ã€‚æ€æ­»ä»»ä½•æ‰¾åˆ°çš„äººã€‚</p><pre tabindex=0><code>who | grep username  (to get the pts/# terminal)
sudo pkill -f pts/#
</code></pre><p>å°† SSH è®¿é—®é™åˆ¶ä¸ºåªæœ‰åº”è¯¥æ‹¥æœ‰å®ƒçš„ç”¨æˆ·å¸æˆ·ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºâ€œsshloginâ€çš„ç»„ï¼Œå¹¶å°†ç»„åæ·»åŠ ä¸ºä¸<code>AllowGroups</code>æ–‡ä»¶ä¸­çš„å˜é‡å…³è”çš„å€¼<code>/etc/ssh/sshd_config</code>ã€‚</p><pre tabindex=0><code>AllowGroups sshlogin
</code></pre><p>ç„¶åå°†æ‚¨å…è®¸çš„ SSH ç”¨æˆ·æ·»åŠ åˆ°â€œsshloginâ€ç»„ä¸­ï¼Œå¹¶é‡æ–°å¯åŠ¨ SSH æœåŠ¡ã€‚</p><pre tabindex=0><code>sudo adduser username sshlogin
sudo systemctl restart sshd.service
</code></pre><p>æŸ¥çœ‹ç™»å½•æ—¥å¿—</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tail -f /var/log/auth.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 07:32:58 lhp-server sshd<span style=color:#000;font-weight:700>[</span>5801<span style=color:#000;font-weight:700>]</span>: User <span style=color:#0086b3>test</span> from 10.4.7.1 not allowed because none of user<span style=color:#a61717;background-color:#e3d2d2>&#39;</span>s groups are listed in AllowGroups
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 07:33:01 lhp-server sshd<span style=color:#000;font-weight:700>[</span>5801<span style=color:#000;font-weight:700>]</span>: pam_unix<span style=color:#000;font-weight:700>(</span>sshd:auth<span style=color:#000;font-weight:700>)</span>: authentication failure; <span style=color:teal>logname</span><span style=color:#000;font-weight:700>=</span> <span style=color:teal>uid</span><span style=color:#000;font-weight:700>=</span><span style=color:#099>0</span> <span style=color:teal>euid</span><span style=color:#000;font-weight:700>=</span><span style=color:#099>0</span> <span style=color:teal>tty</span><span style=color:#000;font-weight:700>=</span>ssh <span style=color:teal>ruser</span><span style=color:#000;font-weight:700>=</span> <span style=color:teal>rhost</span><span style=color:#000;font-weight:700>=</span>10.4.7.1  <span style=color:teal>user</span><span style=color:#000;font-weight:700>=</span><span style=color:#0086b3>test</span>
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 07:33:03 lhp-server sshd<span style=color:#000;font-weight:700>[</span>5801<span style=color:#000;font-weight:700>]</span>: Failed password <span style=color:#000;font-weight:700>for</span> invalid user <span style=color:#0086b3>test</span> from 10.4.7.1 port <span style=color:#099>1047</span> ssh2
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 07:33:07 lhp-server sshd<span style=color:#000;font-weight:700>[</span>5801<span style=color:#000;font-weight:700>]</span>: error: Received disconnect from 10.4.7.1 port 1047:0:  <span style=color:#000;font-weight:700>[</span>preauth<span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>Sep <span style=color:#099>23</span> 07:33:07 lhp-server sshd<span style=color:#000;font-weight:700>[</span>5801<span style=color:#000;font-weight:700>]</span>: Disconnected from invalid user <span style=color:#0086b3>test</span> 10.4.7.1 port <span style=color:#099>1047</span> <span style=color:#000;font-weight:700>[</span>preauth<span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å…­é˜²ç«å¢™>å…­ã€é˜²ç«å¢™</h3><p><strong>ufw</strong></p><p>Ubuntu çš„é»˜è®¤é˜²ç«å¢™é…ç½®å·¥å…·æ˜¯ ufwã€‚ä¸ºç®€åŒ– iptables é˜²ç«å¢™é…ç½®è€Œå¼€å‘ï¼Œufw æä¾›äº†ä¸€ç§ç”¨æˆ·å‹å¥½çš„æ–¹å¼æ¥åˆ›å»ºåŸºäº IPv4 æˆ– IPv6 çš„åŸºäºä¸»æœºçš„é˜²ç«å¢™ã€‚</p><h4 id=å¯ç”¨><strong>å¯ç”¨</strong></h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo ufw <span style=color:#0086b3>enable</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æ·»åŠ ç«¯å£æœ¬ä¾‹ä¸­ä¸º-ssh>æ·»åŠ ç«¯å£ï¼ˆæœ¬ä¾‹ä¸­ä¸º SSHï¼‰</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo ufw allow <span style=color:#099>22</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ä½¿ç”¨ç¼–å·æ ¼å¼æ·»åŠ >ä½¿ç”¨ç¼–å·æ ¼å¼æ·»åŠ </h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo ufw insert <span style=color:#099>1</span> allow <span style=color:#099>80</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=å…³é—­è¦æ‰“å¼€çš„ç«¯å£>å…³é—­è¦æ‰“å¼€çš„ç«¯å£</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo ufw deny <span style=color:#099>22</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=è¦åˆ é™¤è§„åˆ™è¯·ä½¿ç”¨-delete-åè·Ÿè§„åˆ™>è¦åˆ é™¤è§„åˆ™ï¼Œè¯·ä½¿ç”¨ delete åè·Ÿè§„åˆ™</h4><pre tabindex=0><code>sudo ufw delete deny 22
</code></pre><p>è¿˜å¯ä»¥å…è®¸ä»ç‰¹å®šä¸»æœºæˆ–ç½‘ç»œè®¿é—®æŸä¸ªç«¯å£ã€‚ä»¥ä¸‹ç¤ºä¾‹å…è®¸ä»ä¸»æœº 192.168.0.2 SSH è®¿é—®æ­¤ä¸»æœºä¸Šçš„ä»»ä½• IP åœ°å€ï¼š</p><pre tabindex=0><code>sudo ufw allow proto tcp from 192.168.0.2 to any port 22
</code></pre><p>å°† 192.168.0.2 æ›¿æ¢ä¸º 192.168.0.0/24 ä»¥å…è®¸ä»æ•´ä¸ªå­ç½‘è¿›è¡Œ SSH è®¿é—®ã€‚</p><ul><li><p>å‘<em>ufw</em>å‘½ä»¤æ·»åŠ *â€“dry-run*é€‰é¡¹å°†è¾“å‡ºç»“æœè§„åˆ™ï¼Œä½†ä¸ä¼šåº”ç”¨å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‰“å¼€ HTTP ç«¯å£ï¼Œå°†åº”ç”¨ä»¥ä¸‹å†…å®¹ï¼š</p><pre tabindex=0><code class=language-auto data-lang=auto> sudo ufw --dry-run allow http
</code></pre><pre tabindex=0><code>*filter
:ufw-user-input - [0:0]
:ufw-user-output - [0:0]
:ufw-user-forward - [0:0]
:ufw-user-limit - [0:0]
:ufw-user-limit-accept - [0:0]
### RULES ###

### tuple ### allow tcp 80 0.0.0.0/0 any 0.0.0.0/0
-A ufw-user-input -p tcp --dport 80 -j ACCEPT

### END RULES ###
-A ufw-user-input -j RETURN
-A ufw-user-output -j RETURN
-A ufw-user-forward -j RETURN
-A ufw-user-limit -m limit --limit 3/minute -j LOG --log-prefix &#34;[UFW LIMIT]: &#34;
-A ufw-user-limit -j REJECT
-A ufw-user-limit-accept -j ACCEPT
COMMIT
Rules updated
</code></pre></li><li><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¦ç”¨ ufwï¼š</p><pre tabindex=0><code>sudo ufw disable
</code></pre></li><li><p>è¦æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ï¼Œè¯·è¾“å…¥ï¼š</p><pre tabindex=0><code>sudo ufw status
</code></pre></li><li><p>å¯¹äºæ›´è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ï¼š</p><pre tabindex=0><code>sudo ufw status verbose
</code></pre></li><li><p>æŸ¥çœ‹ç¼–å·æ ¼å¼ï¼š</p><pre tabindex=0><code>sudo ufw status numbered
</code></pre></li></ul><blockquote><p><strong>ç¬”è®°</strong></p><p>å¦‚æœè¦æ‰“å¼€æˆ–å…³é—­<code>/etc/services</code>çš„ç«¯å£åœ¨ ä¸­å®šä¹‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç«¯å£åç§°è€Œä¸æ˜¯ç¼–å·ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå°†<em>22</em>æ›¿æ¢ä¸º<em>ssh</em>ã€‚</p></blockquote><p>æ›´å¤šè¯¦ç»†å‚æ•°è§ï¼šman ufwæ‰‹å†Œ</p><h4 id=ufw-åº”ç”¨é›†æˆ><strong>ufw åº”ç”¨é›†æˆ</strong></h4><p>æ‰“å¼€ç«¯å£çš„åº”ç”¨ç¨‹åºå¯ä»¥åŒ…å«ä¸€ä¸ª ufw é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­è¯¦ç»†è¯´æ˜äº†åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œæ‰€éœ€çš„ç«¯å£ã€‚é…ç½®æ–‡ä»¶ä¿å­˜åœ¨ ä¸­<code>/etc/ufw/applications.d</code>ï¼Œå¦‚æœé»˜è®¤ç«¯å£å·²æ›´æ”¹ï¼Œåˆ™å¯ä»¥å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚</p><ul><li><p>è¦æŸ¥çœ‹å“ªäº›åº”ç”¨ç¨‹åºå®‰è£…äº†é…ç½®æ–‡ä»¶ï¼Œè¯·åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><pre tabindex=0><code>sudo ufw app list
</code></pre></li><li><p>ç±»ä¼¼äºå…è®¸æµé‡åˆ°ç«¯å£ï¼Œä½¿ç”¨åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶æ˜¯é€šè¿‡è¾“å…¥ï¼š</p><pre tabindex=0><code>sudo ufw allow Samba
</code></pre></li><li><p>æ‰©å±•è¯­æ³•ä¹Ÿå¯ç”¨ï¼š</p><pre tabindex=0><code>ufw allow from 192.168.0.0/24 to any app Samba
</code></pre><p>å°†<em>Samba</em>å’Œ<em>192.168.0.0/24</em>æ›¿æ¢ä¸ºæ‚¨æ­£åœ¨ä½¿ç”¨çš„åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ä»¥åŠæ‚¨ç½‘ç»œçš„ IP èŒƒå›´ã€‚</p><blockquote><p><strong>ç¬”è®°</strong></p><p>æ— éœ€ä¸ºåº”ç”¨ç¨‹åºæŒ‡å®š<em>åè®®</em>ï¼Œå› ä¸ºè¯¥ä¿¡æ¯åœ¨é…ç½®æ–‡ä»¶ä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚å¦è¯·æ³¨æ„ï¼Œ<em>åº”ç”¨ç¨‹åº</em>åç§°æ›¿æ¢äº†<em>ç«¯å£</em>å·ã€‚</p></blockquote></li><li><p>è¦æŸ¥çœ‹æœ‰å…³ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰çš„ç«¯å£ã€åè®®ç­‰çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·è¾“å…¥ï¼š</p><pre tabindex=0><code>sudo ufw app info Samba
</code></pre></li></ul><h4 id=ipä¼ªè£…>IPä¼ªè£…</h4><p>IP ä¼ªè£…çš„ç›®çš„æ˜¯å…è®¸ç½‘ç»œä¸Šå…·æœ‰ç§æœ‰ã€ä¸å¯è·¯ç”± IP åœ°å€çš„æœºå™¨é€šè¿‡æ‰§è¡Œä¼ªè£…çš„æœºå™¨è®¿é—® Internetã€‚å¿…é¡»å¯¹æ¥è‡ªæ‚¨çš„ä¸“ç”¨ç½‘ç»œçš„å‘å¾€ Internet çš„æµé‡è¿›è¡Œå¤„ç†ï¼Œä»¥ä¾¿å›å¤å¯è·¯ç”±å›å‘å‡ºè¯·æ±‚çš„æœºå™¨ã€‚ä¸ºæ­¤ï¼Œå†…æ ¸å¿…é¡»ä¿®æ”¹æ¯ä¸ªæ•°æ®åŒ…çš„<em>æº</em>IP åœ°å€ï¼Œä»¥ä¾¿å°†å›å¤è·¯ç”±å›å®ƒï¼Œè€Œä¸æ˜¯å‘é€åˆ°å‘å‡ºè¯·æ±‚çš„ç§æœ‰ IP åœ°å€ï¼Œè¿™åœ¨ Internet ä¸Šæ˜¯ä¸å¯èƒ½çš„ã€‚Linux ä½¿ç”¨<em>è¿æ¥è·Ÿè¸ª</em>(conntrack) è·Ÿè¸ªå“ªäº›è¿æ¥å±äºå“ªäº›æœºå™¨å¹¶ç›¸åº”åœ°é‡æ–°è·¯ç”±æ¯ä¸ªè¿”å›æ•°æ®åŒ…ã€‚å› æ­¤ï¼Œç¦»å¼€æ‚¨çš„ä¸“ç”¨ç½‘ç»œçš„æµé‡è¢«â€œä¼ªè£…â€ä¸ºæºè‡ªæ‚¨çš„ Ubuntu ç½‘å…³æœºå™¨ã€‚æ­¤è¿‡ç¨‹åœ¨ Microsoft æ–‡æ¡£ä¸­ç§°ä¸º Internet è¿æ¥å…±äº«ã€‚</p><h4 id=ufw-ä¼ªè£…>ufw ä¼ªè£…</h4><p>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ ufw è§„åˆ™æ¥å®ç° IP ä¼ªè£…ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º ufw çš„å½“å‰åç«¯æ˜¯ iptables-restoreï¼Œè§„åˆ™æ–‡ä»¶ä½äº<code>/etc/ufw/*.rules</code>. è¿™äº›æ–‡ä»¶æ˜¯æ·»åŠ ä¸ä½¿ç”¨ ufw ä½¿ç”¨çš„é—ç•™ iptables è§„åˆ™çš„å¥½åœ°æ–¹ï¼Œä»¥åŠä¸ç½‘å…³æˆ–ç½‘æ¡¥ç›¸å…³çš„è§„åˆ™ã€‚</p><p>è§„åˆ™åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ï¼Œåº”è¯¥åœ¨ufwå‘½ä»¤è¡Œè§„åˆ™ä¹‹å‰æ‰§è¡Œçš„è§„åˆ™ï¼Œä»¥åŠåœ¨ufwå‘½ä»¤è¡Œè§„åˆ™ä¹‹åæ‰§è¡Œçš„è§„åˆ™ã€‚</p><ul><li><p>é¦–å…ˆéœ€è¦åœ¨ufwä¸­å¼€å¯æ•°æ®åŒ…è½¬å‘ã€‚éœ€è¦è°ƒæ•´ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œå°†<em>DEFAULT_FORWARD_POLICY</em><code>/etc/default/ufw</code>æ›´æ”¹ä¸ºâ€œACCEPTâ€ï¼š</p><pre tabindex=0><code>DEFAULT_FORWARD_POLICY=&#34;ACCEPT&#34;
</code></pre><p>ç„¶åç¼–è¾‘<code>/etc/ufw/sysctl.conf</code>å¹¶å–æ¶ˆæ³¨é‡Šï¼š</p><pre tabindex=0><code>net/ipv4/ip_forward=1
</code></pre><p>åŒæ ·ï¼Œå¯¹äº IPv6 è½¬å‘å–æ¶ˆæ³¨é‡Šï¼š</p><pre tabindex=0><code>net/ipv6/conf/default/forwarding=1
</code></pre></li><li><p>ç°åœ¨å°†è§„åˆ™æ·»åŠ åˆ°<code>/etc/ufw/before.rules</code>æ–‡ä»¶ä¸­ã€‚é»˜è®¤è§„åˆ™åªé…ç½®<em>è¿‡æ»¤</em>è¡¨ï¼Œå¹¶ä¸”å¯ç”¨ä¼ªè£…<em>nat</em>è¡¨éœ€è¦é…ç½®ã€‚å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶é¡¶éƒ¨çš„æ ‡é¢˜æ³¨é‡Šä¹‹åï¼š</p><pre tabindex=0><code># nat Table rules
*nat
:POSTROUTING ACCEPT [0:0]

# Forward traffic from eth1 through eth0.
-A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE

# don&#39;t delete the &#39;COMMIT&#39; line or these nat table rules won&#39;t be processed
COMMIT
</code></pre><p>æ³¨é‡Šä¸æ˜¯ç»å¯¹å¿…è¦çš„ï¼Œä½†è®°å½•æ‚¨çš„é…ç½®è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ã€‚æ­¤å¤–ï¼Œåœ¨ä¿®æ”¹ ä¸­çš„ä»»ä½•<em>è§„åˆ™</em>æ–‡ä»¶æ—¶<code>/etc/ufw</code>ï¼Œè¯·ç¡®ä¿è¿™äº›è¡Œæ˜¯æ¯ä¸ªä¿®æ”¹è¡¨çš„æœ€åä¸€è¡Œï¼š</p><pre tabindex=0><code># don&#39;t delete the &#39;COMMIT&#39; line or these rules won&#39;t be processed
COMMIT
</code></pre><p>å¯¹äºæ¯ä¸ª<em>è¡¨ï¼Œ<em>éƒ½éœ€è¦ä¸€ä¸ªç›¸åº”çš„</em>COMMIT</em>è¯­å¥ã€‚åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œåªæ˜¾ç¤ºäº†<em>nat</em>å’Œ<em>filter</em>è¡¨ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä¸º<em>raw</em>å’Œ<em>mangle</em>è¡¨æ·»åŠ è§„åˆ™ã€‚</p><blockquote><p><strong>ç¬”è®°</strong></p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå°†<em>eth0</em>ã€<em>eth1</em>å’Œ<em>192.168.0.0/24</em>æ›¿æ¢ä¸ºé€‚åˆæ‚¨ç½‘ç»œçš„æ¥å£å’Œ IP èŒƒå›´ã€‚</p></blockquote></li><li><p>æœ€åï¼Œç¦ç”¨å¹¶é‡æ–°å¯ç”¨ ufw ä»¥åº”ç”¨æ›´æ”¹ï¼š</p><pre tabindex=0><code>sudo ufw disable &amp;&amp; sudo ufw enable
</code></pre></li></ul><p>ç°åœ¨åº”è¯¥å¯ç”¨ IP ä¼ªè£…ã€‚æ‚¨è¿˜å¯ä»¥å°†ä»»ä½•å…¶ä»– FORWARD è§„åˆ™æ·»åŠ åˆ°<code>/etc/ufw/before.rules</code>. å»ºè®®å°†è¿™äº›é™„åŠ è§„åˆ™æ·»åŠ åˆ°<code>ufw-before-forward</code>é“¾ä¸­ã€‚</p><h4 id=iptables-ä¼ªè£…>iptables ä¼ªè£…</h4><p>iptables ä¹Ÿå¯ç”¨äºå¯ç”¨ä¼ªè£…ã€‚</p><ul><li><p>ä¸ ufw ç±»ä¼¼ï¼Œç¬¬ä¸€æ­¥æ˜¯é€šè¿‡ç¼–è¾‘<code>/etc/sysctl.conf</code>å¹¶å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œæ¥å¯ç”¨ IPv4 æ•°æ®åŒ…è½¬å‘ï¼š</p><pre tabindex=0><code>net.ipv4.ip_forward=1
</code></pre><p>å¦‚æœæ‚¨å¸Œæœ›å¯ç”¨ IPv6 è½¬å‘ä¹Ÿå–æ¶ˆæ³¨é‡Šï¼š</p><pre tabindex=0><code>net.ipv6.conf.default.forwarding=1
</code></pre></li><li><p>æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œ sysctl å‘½ä»¤ä»¥å¯ç”¨é…ç½®æ–‡ä»¶ä¸­çš„æ–°è®¾ç½®ï¼š</p><pre tabindex=0><code>sudo sysctl -p
</code></pre></li><li><p>ç°åœ¨å¯ä»¥ä½¿ç”¨å•ä¸ª iptables è§„åˆ™å®Œæˆ IP ä¼ªè£…ï¼Œæ ¹æ®æ‚¨çš„ç½‘ç»œé…ç½®ï¼Œè¯¥è§„åˆ™å¯èƒ½ç•¥æœ‰ä¸åŒï¼š</p><pre tabindex=0><code>sudo iptables -t nat -A POSTROUTING -s 192.168.0.0/16 -o ppp0 -j MASQUERADE
</code></pre><p>ä¸Šè¿°å‘½ä»¤å‡è®¾æ‚¨çš„ç§æœ‰åœ°å€ç©ºé—´æ˜¯ 192.168.0.0/16ï¼Œå¹¶ä¸”æ‚¨çš„é¢å‘ Internet çš„è®¾å¤‡æ˜¯ ppp0ã€‚è¯­æ³•åˆ†è§£å¦‚ä¸‹ï¼š</p><ul><li>-t nat â€“ è§„åˆ™æ˜¯è¿›å…¥ nat è¡¨</li><li>-A POSTROUTING â€“ è§„åˆ™å°†è¢«é™„åŠ  (-A) åˆ° POSTROUTING é“¾</li><li>-s 192.168.0.0/16 â€“ è¯¥è§„åˆ™é€‚ç”¨äºæºè‡ªæŒ‡å®šåœ°å€ç©ºé—´çš„æµé‡</li><li>-o ppp0 â€“ è¯¥è§„åˆ™é€‚ç”¨äºè®¡åˆ’é€šè¿‡æŒ‡å®šç½‘ç»œè®¾å¤‡è·¯ç”±çš„æµé‡</li><li>-j MASQUERADE - ä¸æ­¤è§„åˆ™åŒ¹é…çš„æµé‡å°†â€œè·³è½¬â€ï¼ˆ-jï¼‰åˆ°è¦æ“ä½œçš„ MASQUERADE ç›®æ ‡ï¼Œå¦‚ä¸Šæ‰€è¿°</li></ul></li><li><p>æ­¤å¤–ï¼Œè¿‡æ»¤å™¨è¡¨ä¸­çš„æ¯ä¸ªé“¾ï¼ˆé»˜è®¤è¡¨ï¼Œä»¥åŠå¤§å¤šæ•°æˆ–æ‰€æœ‰æ•°æ®åŒ…è¿‡æ»¤å‘ç”Ÿçš„åœ°æ–¹ï¼‰éƒ½æœ‰ä¸€ä¸ªé»˜è®¤<em>ç­–ç•¥</em>ACCEPTï¼Œä½†å¦‚æœé™¤äº†ç½‘å…³è®¾å¤‡ä¹‹å¤–ï¼Œæ‚¨è¿˜åˆ›å»ºäº†é˜²ç«å¢™ï¼Œæ‚¨å¯èƒ½å·²å°†ç­–ç•¥è®¾ç½®ä¸ºDROP æˆ– REJECTï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„ä¼ªè£…æµé‡éœ€è¦é€šè¿‡ FORWARD é“¾å…è®¸æ‰èƒ½ä½¿ä¸Šè¿°è§„åˆ™èµ·ä½œç”¨ï¼š</p><pre tabindex=0><code>sudo iptables -A FORWARD -s 192.168.0.0/16 -o ppp0 -j ACCEPT
sudo iptables -A FORWARD -d 192.168.0.0/16 -m state \
--state ESTABLISHED,RELATED -i ppp0 -j ACCEPT
</code></pre><p>ä¸Šè¿°å‘½ä»¤å°†å…è®¸ä»æœ¬åœ°ç½‘ç»œåˆ° Internet çš„æ‰€æœ‰è¿æ¥ä»¥åŠä¸è¿™äº›è¿æ¥ç›¸å…³çš„æ‰€æœ‰æµé‡è¿”å›åˆ°å¯åŠ¨å®ƒä»¬çš„æœºå™¨ã€‚</p></li><li><p>å¦‚æœæ‚¨å¸Œæœ›åœ¨é‡æ–°å¯åŠ¨æ—¶å¯ç”¨ä¼ªè£…ï¼ˆæ‚¨å¯èƒ½ä¼šè¿™æ ·åšï¼‰ï¼Œè¯·ç¼–è¾‘<code>/etc/rc.local</code>å¹¶æ·»åŠ ä¸Šé¢ä½¿ç”¨çš„ä»»ä½•å‘½ä»¤ã€‚ä¾‹å¦‚æ·»åŠ ç¬¬ä¸€ä¸ªæ²¡æœ‰è¿‡æ»¤çš„å‘½ä»¤ï¼š</p><pre tabindex=0><code>iptables -t nat -A POSTROUTING -s 192.168.0.0/16 -o ppp0 -j MASQUERADE
</code></pre></li></ul><h3 id=ä¸ƒæ—¥å¿—>ä¸ƒã€æ—¥å¿—</h3><p>é˜²ç«å¢™æ—¥å¿—å¯¹äºè¯†åˆ«æ”»å‡»ã€æ’é™¤é˜²ç«å¢™è§„åˆ™æ•…éšœä»¥åŠæ³¨æ„ç½‘ç»œä¸Šçš„å¼‚å¸¸æ´»åŠ¨è‡³å…³é‡è¦ã€‚ä½†æ˜¯ï¼Œæ‚¨å¿…é¡»åœ¨é˜²ç«å¢™ä¸­åŒ…å«æ—¥å¿—è§„åˆ™æ‰èƒ½ç”Ÿæˆå®ƒä»¬ï¼Œå¹¶ä¸”æ—¥å¿—è§„åˆ™å¿…é¡»å‡ºç°åœ¨ä»»ä½•é€‚ç”¨çš„ç»ˆæ­¢è§„åˆ™ï¼ˆå…·æœ‰å†³å®šæ•°æ®åŒ…å‘½è¿çš„ç›®æ ‡çš„è§„åˆ™ï¼Œä¾‹å¦‚ ACCEPTã€DROP æˆ– REJECTï¼‰ä¹‹å‰ã€‚</p><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ ufwï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹æ¥æ‰“å¼€æ—¥å¿—è®°å½•ï¼š</p><pre tabindex=0><code>sudo ufw logging on
</code></pre><p>è¦åœ¨ ufw ä¸­å…³é—­æ³¨é”€ï¼Œåªéœ€åœ¨ä¸Šè¿°å‘½ä»¤ä¸­å°†<em>on</em>æ›¿æ¢ä¸º<em>off</em>ã€‚</p><p>å¦‚æœä½¿ç”¨ iptables è€Œä¸æ˜¯ ufwï¼Œè¯·è¾“å…¥ï¼š</p><pre tabindex=0><code>sudo iptables -A INPUT -m state --state NEW -p tcp --dport 80 \ 
-j LOG --log-prefix &#34;NEW_HTTP_CONN: &#34;
</code></pre><p>ç„¶åï¼Œæ¥è‡ªæœ¬åœ°è®¡ç®—æœºçš„ç«¯å£ 80 ä¸Šçš„è¯·æ±‚å°†åœ¨ dmesg ä¸­ç”Ÿæˆå¦‚ä¸‹æ‰€ç¤ºçš„æ—¥å¿—ï¼ˆå°†å•è¡Œæ‹†åˆ†ä¸º 3 è¡Œä»¥é€‚åˆæ­¤æ–‡æ¡£ï¼‰ï¼š</p><pre tabindex=0><code>[4304885.870000] NEW_HTTP_CONN: IN=lo OUT= MAC=00:00:00:00:00:00:00:00:00:00:00:00:08:00
SRC=127.0.0.1 DST=127.0.0.1 LEN=60 TOS=0x00 PREC=0x00 TTL=64 ID=58288 DF PROTO=TCP
SPT=53981 DPT=80 WINDOW=32767 RES=0x00 SYN URGP=0
</code></pre><p>ä¸Šé¢çš„æ—¥å¿—ä¹Ÿä¼šå‡ºç°åœ¨<code>/var/log/messages</code>ã€<code>/var/log/syslog</code>ã€ å’Œ ä¸­<code>/var/log/kern.log</code>ã€‚å¯ä»¥é€šè¿‡<code>/etc/syslog.conf</code>é€‚å½“ç¼–è¾‘æˆ–å®‰è£…å’Œé…ç½® ulogd å¹¶ä½¿ç”¨ ULOG ç›®æ ‡è€Œä¸æ˜¯ LOGæ¥ä¿®æ”¹æ­¤è¡Œä¸ºã€‚ulogd å®ˆæŠ¤è¿›ç¨‹æ˜¯ä¸€ä¸ªç”¨æˆ·ç©ºé—´æœåŠ¡å™¨ï¼Œå®ƒä¸“é—¨ä¸ºé˜²ç«å¢™ä¾¦å¬æ¥è‡ªå†…æ ¸çš„æ—¥å¿—è®°å½•æŒ‡ä»¤ï¼Œå¹¶ä¸”å¯ä»¥è®°å½•åˆ°æ‚¨å–œæ¬¢çš„ä»»ä½•æ–‡ä»¶ï¼Œç”šè‡³æ˜¯ PostgreSQL æˆ– MySQL æ•°æ®åº“ã€‚ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·ï¼ˆä¾‹å¦‚ logwatchã€fwanalogã€fwlogwatch æˆ– lireï¼‰å¯ä»¥ç®€åŒ–ç†è§£é˜²ç«å¢™æ—¥å¿—çš„è¿‡ç¨‹ã€‚</p></div></div></div><div id=footer><div class=container-footer><div class=beian><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="></a><a href target=_blank><span class=some>icp...<span></a></div><div class=info><a href=https://github.com/loveminimal/hugo-theme-virgo>ğŸ•Šï¸</a> 2021 - <span id=info-date></span></div></div></div><div class=cool-after></div></body></html>