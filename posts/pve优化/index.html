<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>pve优化 - My New Hugo Site</title><meta name=Description content="This is my cool site"><meta property="og:title" content="pve优化"><meta property="og:description" content="pve优化 1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知 Proxmox VE(PVE)系统安装完成后，输入账号密码登录系统后会有提示：无有效订阅，本文主要介绍如何去除此弹窗提示。
提示：无有效订阅 You do not have a valid subscription for this server. Please visit www.proxmox.com to get a list of available options. 形成此问题的主要原因是因为我们使用的是免费版Proxmox VE系统，所以每次登录后都会提示这个《无有效订阅》弹窗。
此教程演示系统环境为：Proxmox Virtual Environment 7.2 ，更新日期为：2022年11月10日，其他版本请参考本教程.
需要修改文件路径为：/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js 修改之前请做好文件备份，防止误操作造成不可预知的错误。
解决方法
搜索关键词：Ext.Msg.show 将：Ext.Msg.show({修改为：Ext.Msg.noshow({ 文件修改后保存上传，执行 systemctl restart pveproxy 命令重启网页服务 root@pve:~# systemctl restart pveproxy 注销后登陆，使用 CTRL+F5 快捷键强制重新加载网页页面，或清理浏览器缓存（很多修改后没有反应的童学记得清缓存）
再次打开登陆 Proxmox VE系统控制台主界面，就没有弹窗提示了。
注意：此方法可能在升级 pve 后失效，失效后再修改即可。
2.Proxmox VE更换apt源并更新软件包数据库 1、查看当前镜像源配置
cat /etc/apt/sources.list 2、查看当前pve版本
pveversion -v 3、注释默认配置，修改为中科大镜像源
nano /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/debian bullseye main contrib deb https://mirrors."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/posts/pve%E4%BC%98%E5%8C%96/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-11T13:10:12+00:00"><meta property="article:modified_time" content="2022-11-11T13:10:12+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="pve优化"><meta name=twitter:description content="pve优化 1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知 Proxmox VE(PVE)系统安装完成后，输入账号密码登录系统后会有提示：无有效订阅，本文主要介绍如何去除此弹窗提示。
提示：无有效订阅 You do not have a valid subscription for this server. Please visit www.proxmox.com to get a list of available options. 形成此问题的主要原因是因为我们使用的是免费版Proxmox VE系统，所以每次登录后都会提示这个《无有效订阅》弹窗。
此教程演示系统环境为：Proxmox Virtual Environment 7.2 ，更新日期为：2022年11月10日，其他版本请参考本教程.
需要修改文件路径为：/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js 修改之前请做好文件备份，防止误操作造成不可预知的错误。
解决方法
搜索关键词：Ext.Msg.show 将：Ext.Msg.show({修改为：Ext.Msg.noshow({ 文件修改后保存上传，执行 systemctl restart pveproxy 命令重启网页服务 root@pve:~# systemctl restart pveproxy 注销后登陆，使用 CTRL+F5 快捷键强制重新加载网页页面，或清理浏览器缓存（很多修改后没有反应的童学记得清缓存）
再次打开登陆 Proxmox VE系统控制台主界面，就没有弹窗提示了。
注意：此方法可能在升级 pve 后失效，失效后再修改即可。
2.Proxmox VE更换apt源并更新软件包数据库 1、查看当前镜像源配置
cat /etc/apt/sources.list 2、查看当前pve版本
pveversion -v 3、注释默认配置，修改为中科大镜像源
nano /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/debian bullseye main contrib deb https://mirrors."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://example.org/posts/pve%E4%BC%98%E5%8C%96/><link rel=prev href=http://example.org/posts/centos7.9%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0/><link rel=next href=http://example.org/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%94%B1%E4%BA%8Ekswapd0%E8%BF%9B%E7%A8%8B%E5%AF%BC%E8%87%B4%E7%B3%BB%E7%BB%9F%E5%BC%82%E5%B8%B8/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"pve优化","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/example.org\/posts\/pve%E4%BC%98%E5%8C%96\/"},"genre":"posts","wordcount":801,"url":"http:\/\/example.org\/posts\/pve%E4%BC%98%E5%8C%96\/","datePublished":"2022-11-11T13:10:12+00:00","dateModified":"2022-11-11T13:10:12+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Author"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu><div class=menu-inner><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">pve优化</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Author</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-11-11>2022-11-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;801 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#pve优化>pve优化</a></li><li><a href=#1proxmox-vepve系统移除无有效订阅弹窗提示通知>1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知</a></li><li><a href=#2proxmox-ve更换apt源并更新软件包数据库>2.Proxmox VE更换apt源并更新软件包数据库</a></li><li><a href=#3pve更改安装时绑定的网卡>3.PVE更改安装时绑定的网卡</a></li><li><a href=#4pve中虚拟机无法关闭解决方法>4.pve中虚拟机无法关闭，解决方法。</a></li><li><a href=#5centos79常用工具一键安装>5.centos7.9常用工具一键安装</a></li><li><a href=#6proxmox-ve-72-iso-镜像重置-pve-root密码>6.Proxmox VE 7.2 iso 镜像重置 pve root密码</a></li><li><a href=#7proxmox集群部分节点出现问号>7.Proxmox集群部分节点出现问号</a></li><li><a href=#8解决pve创建的虚拟机无法复制粘贴>8.解决pve创建的虚拟机无法复制粘贴</a></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=pve优化>pve优化</h3><h3 id=1proxmox-vepve系统移除无有效订阅弹窗提示通知>1.Proxmox VE(PVE)系统移除《无有效订阅》弹窗提示通知</h3><p>Proxmox VE(PVE)系统安装完成后，输入账号密码登录系统后会有提示：无有效订阅，本文主要介绍如何去除此弹窗提示。</p><pre tabindex=0><code>提示：无有效订阅

You do not have a valid subscription for this server. Please visit www.proxmox.com to get a list of available options.
</code></pre><p>形成此问题的主要原因是因为我们使用的是免费版Proxmox VE系统，所以每次登录后都会提示这个《无有效订阅》弹窗。</p><p>此教程演示系统环境为：Proxmox Virtual Environment 7.2 ，更新日期为：2022年11月10日，其他版本请参考本教程.</p><p>需要修改文件路径为：/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js 修改之前请做好文件备份，防止误操作造成不可预知的错误。</p><p>解决方法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>搜索关键词：Ext.Msg.show
</span></span><span style=display:flex><span>将：Ext.Msg.show<span style=color:#f92672>({</span>修改为：Ext.Msg.noshow<span style=color:#f92672>({</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>文件修改后保存上传，执行 systemctl restart pveproxy 命令重启网页服务
</span></span></code></pre></div><pre tabindex=0><code>root@pve:~# systemctl restart pveproxy
</code></pre><p>注销后登陆，使用 CTRL+F5 快捷键强制重新加载网页页面，或清理浏览器缓存（很多修改后没有反应的童学记得清缓存）</p><p>再次打开登陆 Proxmox VE系统控制台主界面，就没有弹窗提示了。</p><p>注意：此方法可能在升级 pve 后失效，失效后再修改即可。</p><h3 id=2proxmox-ve更换apt源并更新软件包数据库>2.Proxmox VE更换apt源并更新软件包数据库</h3><p>1、查看当前镜像源配置</p><pre tabindex=0><code>cat /etc/apt/sources.list
</code></pre><p>2、查看当前pve版本</p><pre tabindex=0><code>pveversion -v
</code></pre><p>3、注释默认配置，修改为中科大镜像源</p><pre tabindex=0><code>nano /etc/apt/sources.list

deb https://mirrors.ustc.edu.cn/debian bullseye main contrib
deb https://mirrors.ustc.edu.cn/debian bullseye-updates main contrib
deb https://mirrors.ustc.edu.cn/debian-security bullseye-security main contrib
</code></pre><p>4、注释proxmox企业版更新源
因为我们安装的是社区版，没有订阅企业版的服务，这个默认启用，所以会报错，使用时我们可以注释掉它。</p><pre tabindex=0><code>nano /etc/apt/sources.list.d/pve-enterprise.list
</code></pre><p>5、运行 <code>apt update</code> 更新索引以生效</p><p>6、查看可以更新的包</p><pre tabindex=0><code>apt list --upgradable
</code></pre><p>7、执行软件包数据库更新</p><pre tabindex=0><code>apt update &amp;&amp; apt upgrade -y
</code></pre><p>8、也可以在页面更新</p><p><strong>pve-更新-刷新</strong></p><h3 id=3pve更改安装时绑定的网卡>3.PVE更改安装时绑定的网卡</h3><p>当服务器有多个网卡时，安装pve后，绑定的网卡非管理口网卡导致局域网中机器无法连接pve。此时需要更改pve安装时绑定的网卡。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>root@www:~#  ip a
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>65536</span> qdisc noqueue state UNKNOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 ::1/128 scope host 
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>2: eno1: &lt;BROADCAST,MULTICAST&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noop state DOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 3c:ec:ef:90:ea:96 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    altname enp181s0f0
</span></span><span style=display:flex><span>3: enp101s0f0: &lt;BROADCAST,MULTICAST&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noop state DOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 58:53:c0:64:19:94 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>4: eno2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc mq master vmbr0 state UP group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 3c:ec:ef:90:ea:97 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    altname enp181s0f1
</span></span><span style=display:flex><span>5: enp23s0f0: &lt;BROADCAST,MULTICAST&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noop state DOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 68:91:d0:6a:66:a6 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>6: enp101s0f1: &lt;BROADCAST,MULTICAST&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noop state DOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 58:53:c0:64:19:95 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>7: enp23s0f1: &lt;BROADCAST,MULTICAST&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noop state DOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 68:91:d0:6a:66:a7 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>8: enp182s0f0: &lt;BROADCAST,MULTICAST&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noop state DOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 68:91:d0:6a:66:a0 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>9: enp182s0f1: &lt;BROADCAST,MULTICAST&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noop state DOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 68:91:d0:6a:66:a1 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>10: vmbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc noqueue state UP group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 3c:ec:ef:90:ea:97 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 192.168.1.191/24 scope global vmbr0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::3eec:efff:fe90:ea97/64 scope link 
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>12: tap100i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc pfifo_fast master vmbr0 state UNKNOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 2e:dd:9f:18:5d:41 brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><p>由以上信息可知pve的虚拟网卡vmbr0是桥接到mac为3c:ec:ef:90:ea:97的网卡即eno2上，需要将vmbr0更改桥接到eno1上。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano /etc/network/interfaces
</span></span></code></pre></div><p>原内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>auto lo
</span></span><span style=display:flex><span>iface lo inet loopback
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface eno2 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>auto vmbr0
</span></span><span style=display:flex><span>iface vmbr0 inet static
</span></span><span style=display:flex><span>        address 192.168.1.191/24
</span></span><span style=display:flex><span>        gateway 192.168.1.254
</span></span><span style=display:flex><span>        bridge-ports eno2
</span></span><span style=display:flex><span>        bridge-stp off
</span></span><span style=display:flex><span>        bridge-fd <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp101s0f0 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp101s0f1 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp23s0f0 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp23s0f1 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface eno2 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp182s0f0 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp182s0f1 inet manual
</span></span></code></pre></div><p>需要更改为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>auto lo
</span></span><span style=display:flex><span>iface lo inet loopback
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface eno1 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>auto vmbr0
</span></span><span style=display:flex><span>iface vmbr0 inet static
</span></span><span style=display:flex><span>        address 192.168.1.191/24
</span></span><span style=display:flex><span>        gateway 192.168.1.254
</span></span><span style=display:flex><span>        bridge-ports eno1
</span></span><span style=display:flex><span>        bridge-stp off
</span></span><span style=display:flex><span>        bridge-fd <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp101s0f0 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp101s0f1 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp23s0f0 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp23s0f1 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface eno2 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp182s0f0 inet manual
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>iface enp182s0f1 inet manual
</span></span></code></pre></div><p>重启机器</p><h3 id=4pve中虚拟机无法关闭解决方法>4.pve中虚拟机无法关闭，解决方法。</h3><p>删除虚拟机ID对应的配置文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> rm /var/lock/qemu-server/lock-102.conf    <span style=color:#75715e>#102是你的虚拟机编号</span>
</span></span></code></pre></div><p>然后关闭虚拟机</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>qm stop <span style=color:#ae81ff>102</span>
</span></span></code></pre></div><h3 id=5centos79常用工具一键安装>5.centos7.9常用工具一键安装</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum -y install wget gcc gcc-c++ pcre pcre-devel zlib zlib-devel ruby openssl openssl-devel patch lsof unzip zip lrzsz bash-completion net-tools nmap-ncat
</span></span></code></pre></div><h3 id=6proxmox-ve-72-iso-镜像重置-pve-root密码>6.Proxmox VE 7.2 iso 镜像重置 pve root密码</h3><ul><li><p>u盘引导进入pve安装界面，选择Advanced Options。</p></li><li><p>选择 Debug mode</p></li><li><p>进入后发现默认在/路径下，继续按CTRL D，进入root@proxmox:/</p></li><li><p>验证LVM并挂载</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#查看VG，输出应该是有VG PVE</span>
</span></span><span style=display:flex><span>vgs
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#查看LV，可以看到 data root </span>
</span></span><span style=display:flex><span>lvs
</span></span></code></pre></div><ul><li>激活VG</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vgchange -a y 
</span></span></code></pre></div><ul><li>挂载lvm</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount /dev/mapper/pve-root /mnt
</span></span></code></pre></div><ul><li>chroot</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chroot /mnt
</span></span></code></pre></div><ul><li>修改root密码，更改完成密码重启服务器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>passwd root
</span></span></code></pre></div><h3 id=7proxmox集群部分节点出现问号>7.Proxmox集群部分节点出现问号</h3><p>决定pve上状态的服务是pvestat daemon，也就是<code>pvestatd</code>，因此查看它的运行状况，果然有问题！</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@www:~# service pvestatd status
</span></span><span style=display:flex><span>● pvestatd.service - PVE Status Daemon
</span></span><span style=display:flex><span>     Loaded: loaded <span style=color:#f92672>(</span>/lib/systemd/system/pvestatd.service; enabled; vendor preset: enabled<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     Active: failed <span style=color:#f92672>(</span>Result: signal<span style=color:#f92672>)</span> since Wed 2022-11-16 09:23:04 CST; 10min ago
</span></span><span style=display:flex><span>    Process: <span style=color:#ae81ff>1146</span> ExecStart<span style=color:#f92672>=</span>/usr/bin/pvestatd start <span style=color:#f92672>(</span>code<span style=color:#f92672>=</span>killed, signal<span style=color:#f92672>=</span>KILL<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        CPU: 286ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nov <span style=color:#ae81ff>16</span> 09:23:03 www systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: Starting PVE Status Daemon...
</span></span><span style=display:flex><span>Nov <span style=color:#ae81ff>16</span> 09:23:04 www systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: pvestatd.service: Control process exited, code<span style=color:#f92672>=</span>killed, status<span style=color:#f92672>=</span>9/KILL
</span></span><span style=display:flex><span>Nov <span style=color:#ae81ff>16</span> 09:23:04 www systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: pvestatd.service: Failed with result <span style=color:#e6db74>&#39;signal&#39;</span>.
</span></span><span style=display:flex><span>Nov <span style=color:#ae81ff>16</span> 09:23:04 www systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: Failed to start PVE Status Daemon.
</span></span></code></pre></div><p>重启该服务状态恢复正常</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@www:~# service pvestatd restart 
</span></span><span style=display:flex><span>root@www:~# service pvestatd status
</span></span><span style=display:flex><span>● pvestatd.service - PVE Status Daemon
</span></span><span style=display:flex><span>     Loaded: loaded <span style=color:#f92672>(</span>/lib/systemd/system/pvestatd.service; enabled; vendor preset: enabled<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     Active: active <span style=color:#f92672>(</span>running<span style=color:#f92672>)</span> since Wed 2022-11-16 09:34:06 CST; 1s ago
</span></span><span style=display:flex><span>    Process: <span style=color:#ae81ff>1510</span> ExecStart<span style=color:#f92672>=</span>/usr/bin/pvestatd start <span style=color:#f92672>(</span>code<span style=color:#f92672>=</span>exited, status<span style=color:#f92672>=</span>0/SUCCESS<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   Main PID: <span style=color:#ae81ff>1511</span> <span style=color:#f92672>(</span>pvestatd<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      Tasks: <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>limit: 18701<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     Memory: 79.2M
</span></span><span style=display:flex><span>        CPU: 851ms
</span></span><span style=display:flex><span>     CGroup: /system.slice/pvestatd.service
</span></span><span style=display:flex><span>             └─1511 pvestatd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nov <span style=color:#ae81ff>16</span> 09:34:05 www systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: Starting PVE Status Daemon...
</span></span><span style=display:flex><span>Nov <span style=color:#ae81ff>16</span> 09:34:06 www pvestatd<span style=color:#f92672>[</span>1511<span style=color:#f92672>]</span>: starting server
</span></span><span style=display:flex><span>Nov <span style=color:#ae81ff>16</span> 09:34:06 www systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: Started PVE Status Daemon.
</span></span></code></pre></div><h3 id=8解决pve创建的虚拟机无法复制粘贴>8.解决pve创建的虚拟机无法复制粘贴</h3><p><strong>配置xterm.js</strong></p><p>PVE创建虚拟机后默认只有novnc方法连接虚拟机，无法复制粘贴，很不方便，因此可以打开xterm.js的方式弥补此缺陷。</p><p>关闭 VM，并且新增 serial port 给 VM 在PVE Host 中用 qm 命令建立 serial port，假设我的 VM ID 是 100</p><pre tabindex=0><code>qm set 100 -serial0 socket
</code></pre><p>重新开启 VM，用 dmesg 验证是否有 ttyS 出现。</p><pre tabindex=0><code>dmesg | grep ttyS
</code></pre><p>如果出现如下代表有了</p><pre tabindex=0><code>[    3.521757] 00:04: ttyS0 at I/O 0x3f8 (irq = 4, base_baud = 115200) is a 16550A
</code></pre><p>接下来配置VM的grub，进入VM的ssh</p><pre tabindex=0><code>cd /etc/default/
vi grub
</code></pre><p>修改grub中的GRUB_CMDLINE_LINUX值</p><pre tabindex=0><code>GRUB_CMDLINE_LINUX=&#34;quiet console=tty0 console=ttyS0,115200”
</code></pre><p>更新grub</p><p>debian based</p><pre tabindex=0><code>update-grub
</code></pre><p>redhat based</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>grub2-mkconfig --output<span style=color:#f92672>=</span>/boot/grub2/grub.cfg
</span></span></code></pre></div><p>在虚拟机添加</p><pre tabindex=0><code>/etc/init/ttyS0.conf
</code></pre><p>并添加如下</p><pre tabindex=0><code># ttyS0 - getty
#
# This service maintains a getty on ttyS0 from the point the system is
# started until it is shut down again.
start on stopped rc RUNLEVEL=[12345]
stop on runlevel [!12345]
respawn
exec /sbin/getty -L 115200 ttyS0 vt102
</code></pre><p>设置自启动</p><pre tabindex=0><code>systemctl enable serial-getty@ttyS0.service
systemctl start serial-getty@ttyS0.service
</code></pre><p>重启VM，测试xterm，已经可以用。</p><p>官方文档如下：https://pve.proxmox.com/wiki/Serial_Terminal</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-11-11</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://example.org/posts/pve%E4%BC%98%E5%8C%96/ data-title=pve优化><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://example.org/posts/pve%E4%BC%98%E5%8C%96/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://example.org/posts/pve%E4%BC%98%E5%8C%96/ data-title=pve优化><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://example.org/posts/pve%E4%BC%98%E5%8C%96/ data-title=pve优化><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=http://example.org/posts/pve%E4%BC%98%E5%8C%96/ data-title=pve优化><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/centos7.9%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0/ class=prev rel=prev title=centos7.9更换网卡名称><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>centos7.9更换网卡名称</a>
<a href=/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%94%B1%E4%BA%8Ekswapd0%E8%BF%9B%E7%A8%8B%E5%AF%BC%E8%87%B4%E7%B3%BB%E7%BB%9F%E5%BC%82%E5%B8%B8/ class=next rel=next title=记一次由于kswapd0进程导致cpu占满>记一次由于kswapd0进程导致cpu占满<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.115.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>