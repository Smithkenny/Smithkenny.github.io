<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>VSFTP不同用户拥有不同权限 - My New Hugo Site</title><meta name=Description content="This is my cool site"><meta property="og:title" content="VSFTP不同用户拥有不同权限"><meta property="og:description" content="VSFTP不同用户拥有不同权限 安装篇 操作系统环境 centos 7.9 mini 安装vsftp服务 yum install –y vsftpd ftp –安装 systemctl start vsftpd.service –启动 systemctl enable vsftpd.service –开机自启 vi /etc/selinux/conf SELINUX=enforce 改成 SELINUX=disabled getenforce - 查看是否为Disabled 实现篇 1.要实现的功能 admin_root：/home/download/下的所有文件夹及文件具有上传、下载、删除权限 admin_001：/home/download/admin_001/下的文件具有上传、下载、删除权限 download_root：/home/download/下的所有文件夹及文件具有下载权限 download_001：/home/download/admin_001/下的文件具有下载权限 2.首先创建一个本地系统用户abcde并指定其家目录，并建立相应的子目录 useradd -d /home/download abcde -s /sbin/nologin mkdir -p /home/download/admin_001 chown -R abcde: /home/download chmod 755 /home/download chmod 755 /home/download/* 3.创建用户数据文件：（一行账号一行密码，不要有空行，不要有空格） 所有密码此处示例设为123456。
vim /etc/vsftpd/userlist.txt admin_root 123456 admin_001 123456 download_root 123456 download_001 123456 然后生成数据文件
db_load：一般系统都有安装，db4，db4-devel，db4-utils ，如果没有的话可以安装： yum -y install db4* db_load -T -t hash -f /etc/vsftpd/userlist."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-15T16:10:12+00:00"><meta property="article:modified_time" content="2022-10-15T16:10:12+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="VSFTP不同用户拥有不同权限"><meta name=twitter:description content="VSFTP不同用户拥有不同权限 安装篇 操作系统环境 centos 7.9 mini 安装vsftp服务 yum install –y vsftpd ftp –安装 systemctl start vsftpd.service –启动 systemctl enable vsftpd.service –开机自启 vi /etc/selinux/conf SELINUX=enforce 改成 SELINUX=disabled getenforce - 查看是否为Disabled 实现篇 1.要实现的功能 admin_root：/home/download/下的所有文件夹及文件具有上传、下载、删除权限 admin_001：/home/download/admin_001/下的文件具有上传、下载、删除权限 download_root：/home/download/下的所有文件夹及文件具有下载权限 download_001：/home/download/admin_001/下的文件具有下载权限 2.首先创建一个本地系统用户abcde并指定其家目录，并建立相应的子目录 useradd -d /home/download abcde -s /sbin/nologin mkdir -p /home/download/admin_001 chown -R abcde: /home/download chmod 755 /home/download chmod 755 /home/download/* 3.创建用户数据文件：（一行账号一行密码，不要有空行，不要有空格） 所有密码此处示例设为123456。
vim /etc/vsftpd/userlist.txt admin_root 123456 admin_001 123456 download_root 123456 download_001 123456 然后生成数据文件
db_load：一般系统都有安装，db4，db4-devel，db4-utils ，如果没有的话可以安装： yum -y install db4* db_load -T -t hash -f /etc/vsftpd/userlist."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://example.org/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/><link rel=prev href=http://example.org/posts/linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/><link rel=next href=http://example.org/posts/%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%85%B7-inxi/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"VSFTP不同用户拥有不同权限","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/example.org\/posts\/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90\/"},"genre":"posts","wordcount":262,"url":"http:\/\/example.org\/posts\/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90\/","datePublished":"2022-10-15T16:10:12+00:00","dateModified":"2022-10-15T16:10:12+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Author"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu><div class=menu-inner><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">VSFTP不同用户拥有不同权限</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Author</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-10-15>2022-10-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;262 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;2 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#vsftp不同用户拥有不同权限>VSFTP不同用户拥有不同权限</a></li></ul></li><li><a href=#安装篇>安装篇</a><ul><li></li></ul></li><li><a href=#实现篇>实现篇</a><ul><li><a href=#1要实现的功能>1.要实现的功能</a></li><li><a href=#2首先创建一个本地系统用户abcde并指定其家目录并建立相应的子目录>2.首先创建一个本地系统用户<code>abcde</code>并指定其家目录，并建立相应的子目录</a></li><li><a href=#3创建用户数据文件一行账号一行密码不要有空行不要有空格>3.创建用户数据文件：（一行账号一行密码，不要有空行，不要有空格）</a></li><li><a href=#5创建本地系统用户abcde对应的虚拟账户>5、创建本地系统用户abcde对应的虚拟账户</a></li><li><a href=#6设置配置文件vsftpdconf>6、设置配置文件vsftpd.conf</a></li><li><a href=#7重新启动vsftpd>7、重新启动vsftpd</a></li><li><a href=#8测试>8.测试</a></li><li><a href=#9日常维护>9.日常维护</a></li><li><a href=#10加密连接>10.加密连接</a></li><li><a href=#vsftpd-425-security-bad-ip-connecting解决方法>vsftpd 425 Security: Bad IP connecting解决方法</a></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=vsftp不同用户拥有不同权限>VSFTP不同用户拥有不同权限</h3><h2 id=安装篇>安装篇</h2><h4 id=操作系统环境>操作系统环境</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>centos 7.9 mini
</span></span></code></pre></div><h4 id=安装vsftp服务>安装vsftp服务</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yum install –y vsftpd ftp –安装
</span></span><span style=display:flex><span>systemctl start vsftpd.service –启动
</span></span><span style=display:flex><span>systemctl enable vsftpd.service –开机自启
</span></span><span style=display:flex><span>vi /etc/selinux/conf
</span></span><span style=display:flex><span>SELINUX<span style=color:#f92672>=</span>enforce 改成 SELINUX<span style=color:#f92672>=</span>disabled
</span></span><span style=display:flex><span>getenforce - 查看是否为Disabled
</span></span></code></pre></div><h2 id=实现篇>实现篇</h2><h3 id=1要实现的功能>1.要实现的功能</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>admin_root：/home/download/下的所有文件夹及文件具有上传、下载、删除权限
</span></span><span style=display:flex><span>admin_001：/home/download/admin_001/下的文件具有上传、下载、删除权限
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>download_root：/home/download/下的所有文件夹及文件具有下载权限
</span></span><span style=display:flex><span>download_001：/home/download/admin_001/下的文件具有下载权限
</span></span></code></pre></div><h3 id=2首先创建一个本地系统用户abcde并指定其家目录并建立相应的子目录>2.首先创建一个本地系统用户<code>abcde</code>并指定其家目录，并建立相应的子目录</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>useradd -d /home/download abcde -s /sbin/nologin
</span></span><span style=display:flex><span>mkdir -p /home/download/admin_001
</span></span><span style=display:flex><span>chown -R abcde: /home/download
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>755</span> /home/download
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>755</span> /home/download/*
</span></span></code></pre></div><h3 id=3创建用户数据文件一行账号一行密码不要有空行不要有空格>3.创建用户数据文件：（一行账号一行密码，不要有空行，不要有空格）</h3><p><strong>所有密码此处示例设为123456。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vim /etc/vsftpd/userlist.txt
</span></span><span style=display:flex><span>admin_root
</span></span><span style=display:flex><span><span style=color:#ae81ff>123456</span>
</span></span><span style=display:flex><span>admin_001
</span></span><span style=display:flex><span><span style=color:#ae81ff>123456</span>
</span></span><span style=display:flex><span>download_root
</span></span><span style=display:flex><span><span style=color:#ae81ff>123456</span>
</span></span><span style=display:flex><span>download_001
</span></span><span style=display:flex><span><span style=color:#ae81ff>123456</span>
</span></span></code></pre></div><p><strong>然后生成数据文件</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>db_load：一般系统都有安装，db4，db4-devel，db4-utils ，如果没有的话可以安装：
</span></span><span style=display:flex><span>yum -y install db4*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>db_load -T -t hash -f /etc/vsftpd/userlist.txt /etc/vsftpd/userlist.db
</span></span></code></pre></div><h4 id=4修改pam配置>4、修改pam配置</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vim /etc/pam.d/vsftpd
</span></span></code></pre></div><p><strong>将原来的全部注释掉，加入</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>auth sufficient /lib64/security/pam_userdb.so db<span style=color:#f92672>=</span>/etc/vsftpd/userlist
</span></span><span style=display:flex><span>account sufficient /lib64/security/pam_userdb.so db<span style=color:#f92672>=</span>/etc/vsftpd/userlist
</span></span></code></pre></div><p><strong>注意：<code>db=/etc/vsftpd/userlist</code> 后面的<code>.db</code>必须去掉，默认会自动匹配<code>*.db</code>文件，</strong>
<strong>这里只需要给数据文件名，就行了。</strong>
<strong>64位机需要使用<code>lib64</code>（这里折腾了好久，有的是<code>lib</code>有的是<code>lib64</code>）;</strong></p><h3 id=5创建本地系统用户abcde对应的虚拟账户>5、创建本地系统用户abcde对应的虚拟账户</h3><p><strong>虚拟用户需要通过本地系统用户来实现各种操作,因此要放在系统用户的同名文件夹下。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /etc/vfstpd/abcde
</span></span><span style=display:flex><span>cd /etc/vfstpd/abcde
</span></span></code></pre></div><p><strong>每一个虚拟用户都要有一个同名的文件，文件里记载其权限以及可操作的目录；</strong>
<strong>本例如下执行，两个&#187;和&#171;之间不要有空格</strong></p><p><strong>创建有上传下载权限的用户</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt;&gt;admin_root<span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_world_readable_only=NO
</span></span></span><span style=display:flex><span><span style=color:#e6db74>write_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_mkdir_write_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_upload_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_other_write_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>local_root=/home/download
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt;&gt;admin_001<span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_world_readable_only=NO
</span></span></span><span style=display:flex><span><span style=color:#e6db74>write_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_mkdir_write_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_upload_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_other_write_enable=YES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>local_root=/home/download/admin_001
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p><strong>创建只有下载权限的用户</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt;&gt;download_root<span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_world_readable_only=NO
</span></span></span><span style=display:flex><span><span style=color:#e6db74>local_root=/home/download
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt;&gt;download_001<span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>anon_world_readable_only=NO
</span></span></span><span style=display:flex><span><span style=color:#e6db74>local_root=/home/download/admin_001
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=6设置配置文件vsftpdconf>6、设置配置文件vsftpd.conf</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vim /etc/vsftpd/vsftpd.conf
</span></span></code></pre></div><p><strong>修改内容如下：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>listen<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>connect_from_port_20<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>anonymous_enable<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>local_enable<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>write_enable<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>anon_upload_enable<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>anon_mkdir_write_enable<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>anon_other_write_enable<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>chroot_local_user<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>chroot_list_enable<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>chroot_list_file<span style=color:#f92672>=</span>/etc/vsftpd/chroot_list
</span></span><span style=display:flex><span>guest_enable<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>guest_username<span style=color:#f92672>=</span>abcde
</span></span><span style=display:flex><span>virtual_use_local_privs<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>allow_writeable_chroot<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>pam_service_name<span style=color:#f92672>=</span>vsftpd
</span></span><span style=display:flex><span>user_config_dir<span style=color:#f92672>=</span>/etc/vsftpd/abcde
</span></span><span style=display:flex><span>local_umask<span style=color:#f92672>=</span><span style=color:#ae81ff>022</span>
</span></span><span style=display:flex><span>xferlog_enable<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>xferlog_file<span style=color:#f92672>=</span>/var/log/vsftpd.log
</span></span><span style=display:flex><span>pasv_promiscuous<span style=color:#f92672>=</span>YES
</span></span></code></pre></div><p><strong>touch /etc/vsftp/chroot_list</strong>
<strong>里面啥也不写。</strong></p><h3 id=7重新启动vsftpd>7、重新启动vsftpd</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>service vsftpd restart
</span></span></code></pre></div><h3 id=8测试>8.测试</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>所有用户只能进入自己家目录不能进入上一级目录；
</span></span><span style=display:flex><span>admin_root对于/home/download下的所有文件夹具有上传、下载、删除权限；
</span></span><span style=display:flex><span>admin_001对于/home/download/下的同名文件夹具有上传、删除权限，无其他权限；
</span></span><span style=display:flex><span>download_root对于/home/download下的所有文件夹具有下载权限，不能上传或删除任何内容，不能对其他任何文件夹操作；
</span></span><span style=display:flex><span>download_001对于/home/download/下的admin_001文件夹分别具有下载权限，不能上传或删除任何内容，不能对其他任何文件夹操作。
</span></span></code></pre></div><h3 id=9日常维护>9.日常维护</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>（1）更新帐号，先修改userlist.txt，再执行db_load
</span></span><span style=display:flex><span>db_load -T -t hash -f /etc/vsftpd/userlist.txt /etc/vsftpd/userlist.db
</span></span><span style=display:flex><span>（2）更新/etc/vsftpd/abcde/下不同用户对应的权限
</span></span><span style=display:flex><span>（3）重启vsftpd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemctl start  vsftpd.service
</span></span></code></pre></div><h3 id=10加密连接>10.加密连接</h3><p><strong>生成证书</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openssl req -x509 -nodes -days <span style=color:#ae81ff>365</span> -newkey rsa:1024 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> -keyout /etc/vsftpd/vsftpd.pem <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> -out /etc/vsftpd/vsftpd.pem
</span></span></code></pre></div><p><strong>其中"-days 365"声明证书的有效期是一年。</strong></p><p><strong>接下来的过程需要你输入一些相关的国家，地区，位置，组织名称，common name等信息。</strong></p><p><strong>回答这些信息以后系统会将生成完的证书vsftpd.pem文件保存在/etc/vsftpd目录下。</strong></p><p><strong>修改<code>/etc/vsftpd/vsftpd.conf</code>文件,增加以下内容</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssl_enable<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>allow_anon_ssl<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>force_local_data_ssl<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>force_local_logins_ssl<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>ssl_tlsv1<span style=color:#f92672>=</span>YES
</span></span><span style=display:flex><span>ssl_sslv2<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>ssl_sslv3<span style=color:#f92672>=</span>NO
</span></span><span style=display:flex><span>rsa_cert_file<span style=color:#f92672>=</span>/etc/vsftpd/vsftpd.pem
</span></span></code></pre></div><p><strong>如果设置force_local_logins_ssl=YES，那么会强制用户登录时采用支持TLS/SSL认证的ftp客户端。如果设置为NO的话，则用户可以选择使用ssl加密或者不加密。</strong></p><p><strong>此时选择不加密登录会有失败提示</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Non-anonymous sessions must use encryption.
</span></span></code></pre></div><p><strong>重启服务</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>systemctl restart vsftpd
</span></span></code></pre></div><p><strong>修改为其他端口</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>listen_port<span style=color:#f92672>=</span><span style=color:#ae81ff>10021</span>
</span></span></code></pre></div><h3 id=vsftpd-425-security-bad-ip-connecting解决方法>vsftpd 425 Security: Bad IP connecting解决方法</h3><p><strong>问题分析:</strong>
FTP客户端软件连接<code>vsftpd</code>服务报此错误，大概原因是在连接中变换了IP地址。</p><p><strong>问题解决</strong></p><p><strong>服务端添加：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vi /etc/vsftpd/vsftpd.conf
</span></span><span style=display:flex><span>pasv_promiscuous<span style=color:#f92672>=</span>YES
</span></span></code></pre></div><p><strong>重启服务</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>systemctl restart vsftpd
</span></span></code></pre></div><p><strong>pasv_promiscuous选项参数说明</strong>
此选项激活时，将关闭PASV模式的安全检查。该检查确保数据连接和控制连接是来自同一个IP地址。小心打开此选项。此选项唯一合理的用法是存在于由安全隧道方案构成的组织中。默认值为NO。
合理的用法是：在一些安全隧道配置环境下，或者更好地支持FXP时(才启用它)。</p><p><strong>FTP模式与数据端口</strong></p><p>FTP 分为两类，PORT FTP和PASV FTP，PORT FTP是一般形式的FTP。这两种FTP在建立控制连接时操作是一样的，都是由客户端首先和FTP服务器的控制端口(默认值为21)建立控制链接，并通过此链接进行传输操作指令。它们的区别在于使用数据传输端口(ftp- data)的方式。PORT FTP由FTP服务器指定数据传输所使用的端口，默认值为20。PASV FTP由FTP客户端决定数据传输的端口。 PASV FTP这种做法，主要是考虑到存在防火墙的环境下，由客户端与服务器进行沟通(客户端向服务器发出数据传输请求中包含了数据传输端口)，决定两者之间的数据传输端口更为方便一些。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-10-15</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://example.org/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/ data-title=VSFTP不同用户拥有不同权限><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://example.org/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://example.org/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/ data-title=VSFTP不同用户拥有不同权限><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://example.org/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/ data-title=VSFTP不同用户拥有不同权限><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=http://example.org/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/ data-title=VSFTP不同用户拥有不同权限><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/ class=prev rel=prev title=linux小技巧汇总><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>linux小技巧汇总</a>
<a href=/posts/%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%85%B7-inxi/ class=next rel=next title=功能强大的硬件信息获取工具-inxi>功能强大的硬件信息获取工具-inxi<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.115.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>