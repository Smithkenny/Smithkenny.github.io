<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>shell脚本应用（长期更新） - My New Hugo Site</title><meta name=Description content="This is my cool site"><meta property="og:title" content="shell脚本应用（长期更新）"><meta property="og:description" content="批量免密登录 no_pass.sh:只需要运行脚本，输入目标端服务器用户名和密码即可。ip根据目标端网段修改。
#!/bin/bash read -p 'input user: ' USER echo &#34;$USER&#34; read -s -p 'input pass: ' PASS rm -f /root/.ssh/id_rsa (ssh-keygen -P &#34;&#34; -f /root/.ssh/id_rsa) &>/dev/null for i in {5..7} do IP_host=172.18.0.${i} ping -c 1 -w 1 ${IP_host} &>/dev/null if [ $? -eq 0 ];then (sshpass -p ${PASS} ssh-copy-id -o StrictHostKeyChecking=no ${IP_host}) &>/dev/null echo -e &#34;\e[1;32m ${IP_host} ok \e[0m&#34; fi done 计算内存使用占比 vi memory_info.sh && chmod +x memory_info.sh
#!/bin/bash MEM_TOTAL=`free -h |awk 'NR==2{print $2}'` MEM_USE=`free -h |awk 'NR==2{print $3}'` MEM_USED=`free | grep -i mem |awk '{print $3/$2*100&#34;%&#34;}'` MEM_FREE=`free -h |awk 'NR==2{print $4}'` MEM_FREED=`free | grep -i mem |awk '{print $4/$2*100&#34;%&#34;}'` MEM_BUFF_CACHE=`free -h |awk 'NR==2{print $6}'` MEM_BUFF_CACHED=`free | grep -i mem |awk '{print $6/$2*100 &#34;%&#34;}'` MEM_SHARE=`free -h |awk 'NR==2{print $5}'` MEM_SHARED=`free | grep -i mem |awk '{print $5/$2*100 &#34;%&#34;}'` MEM_ZONE=`head -3 /proc/meminfo | awk 'NR==1{t=$2}NR==2{f=$2;print(t-f)*100/t&#34;%&#34;}'` echo -e &#34;\t\e[1;32m内存总量: $MEM_TOTAL \e[0m&#34; echo -e &#34;\t\e[1;32m内存总量减剩余内存(所有已使用)占比: $MEM_ZONE \e[0m&#34; echo -e &#34;\t\e[1;32m已使用: $MEM_USE 占比: $MEM_USED \e[0m&#34; echo -e &#34;\t\e[1;32m剩 余: $MEM_FREE 占比: $MEM_FREED \e[0m&#34; echo -e &#34;\t\e[1;32m共 享: $MEM_SHARE 占比: $MEM_SHARED \e[0m&#34; echo -e &#34;\t\e[1;32m缓冲区: $MEM_BUFF_CACHE 占比: $MEM_BUFF_CACHED \e[0m&#34; 执行后的结果"><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/posts/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-18T13:51:17+00:00"><meta property="article:modified_time" content="2022-04-18T13:51:17+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="shell脚本应用（长期更新）"><meta name=twitter:description content="批量免密登录 no_pass.sh:只需要运行脚本，输入目标端服务器用户名和密码即可。ip根据目标端网段修改。
#!/bin/bash read -p 'input user: ' USER echo &#34;$USER&#34; read -s -p 'input pass: ' PASS rm -f /root/.ssh/id_rsa (ssh-keygen -P &#34;&#34; -f /root/.ssh/id_rsa) &>/dev/null for i in {5..7} do IP_host=172.18.0.${i} ping -c 1 -w 1 ${IP_host} &>/dev/null if [ $? -eq 0 ];then (sshpass -p ${PASS} ssh-copy-id -o StrictHostKeyChecking=no ${IP_host}) &>/dev/null echo -e &#34;\e[1;32m ${IP_host} ok \e[0m&#34; fi done 计算内存使用占比 vi memory_info.sh && chmod +x memory_info.sh
#!/bin/bash MEM_TOTAL=`free -h |awk 'NR==2{print $2}'` MEM_USE=`free -h |awk 'NR==2{print $3}'` MEM_USED=`free | grep -i mem |awk '{print $3/$2*100&#34;%&#34;}'` MEM_FREE=`free -h |awk 'NR==2{print $4}'` MEM_FREED=`free | grep -i mem |awk '{print $4/$2*100&#34;%&#34;}'` MEM_BUFF_CACHE=`free -h |awk 'NR==2{print $6}'` MEM_BUFF_CACHED=`free | grep -i mem |awk '{print $6/$2*100 &#34;%&#34;}'` MEM_SHARE=`free -h |awk 'NR==2{print $5}'` MEM_SHARED=`free | grep -i mem |awk '{print $5/$2*100 &#34;%&#34;}'` MEM_ZONE=`head -3 /proc/meminfo | awk 'NR==1{t=$2}NR==2{f=$2;print(t-f)*100/t&#34;%&#34;}'` echo -e &#34;\t\e[1;32m内存总量: $MEM_TOTAL \e[0m&#34; echo -e &#34;\t\e[1;32m内存总量减剩余内存(所有已使用)占比: $MEM_ZONE \e[0m&#34; echo -e &#34;\t\e[1;32m已使用: $MEM_USE 占比: $MEM_USED \e[0m&#34; echo -e &#34;\t\e[1;32m剩 余: $MEM_FREE 占比: $MEM_FREED \e[0m&#34; echo -e &#34;\t\e[1;32m共 享: $MEM_SHARE 占比: $MEM_SHARED \e[0m&#34; echo -e &#34;\t\e[1;32m缓冲区: $MEM_BUFF_CACHE 占比: $MEM_BUFF_CACHED \e[0m&#34; 执行后的结果"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://example.org/posts/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/><link rel=prev href=http://example.org/posts/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAopenvpn/><link rel=next href=http://example.org/posts/ansible%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"shell脚本应用（长期更新）","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/example.org\/posts\/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0\/"},"genre":"posts","wordcount":2601,"url":"http:\/\/example.org\/posts\/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0\/","datePublished":"2022-04-18T13:51:17+00:00","dateModified":"2022-04-18T13:51:17+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Author"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu><div class=menu-inner><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">shell脚本应用（长期更新）</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Author</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-04-18>2022-04-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2601 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;13 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#批量免密登录>批量免密登录</a></li><li><a href=#计算内存使用占比>计算内存使用占比</a></li><li><a href=#巡检报告>巡检报告</a><ul><li><a href=#从一个文件夹中的所有文件加tmp转移到另一个目录下再去掉tmp>从一个文件夹中的所有文件加.tmp，转移到另一个目录下再去掉.tmp。</a></li><li><a href=#同时设置定时任务定时执行>同时设置定时任务，定时执行。</a></li><li><a href=#定时重启进程配合crontab-使用>定时重启进程配合crontab 使用</a></li><li><a href=#使用awk将两个单词位置互换>使用awk将两个单词位置互换</a></li><li><a href=#取出文本中指定行指定位置的字段内容>取出文本中指定行指定位置的字段内容</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=批量免密登录>批量免密登录</h2><p><code>no_pass.sh</code>:只需要运行脚本，输入目标端服务器用户名和密码即可。ip根据目标端网段修改。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>read -p <span style=color:#e6db74>&#39;input user: &#39;</span> USER
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>read -s -p <span style=color:#e6db74>&#39;input pass: &#39;</span> PASS
</span></span><span style=display:flex><span>rm -f /root/.ssh/id_rsa
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>ssh-keygen -P <span style=color:#e6db74>&#34;&#34;</span> -f /root/.ssh/id_rsa<span style=color:#f92672>)</span> &amp;&gt;/dev/null
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#f92672>{</span>5..7<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    IP_host<span style=color:#f92672>=</span>172.18.0.<span style=color:#e6db74>${</span>i<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>    ping  -c <span style=color:#ae81ff>1</span> -w <span style=color:#ae81ff>1</span> <span style=color:#e6db74>${</span>IP_host<span style=color:#e6db74>}</span> &amp;&gt;/dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>(</span>sshpass -p <span style=color:#e6db74>${</span>PASS<span style=color:#e6db74>}</span> ssh-copy-id -o StrictHostKeyChecking<span style=color:#f92672>=</span>no <span style=color:#e6db74>${</span>IP_host<span style=color:#e6db74>}</span><span style=color:#f92672>)</span> &amp;&gt;/dev/null
</span></span><span style=display:flex><span>        echo -e <span style=color:#e6db74>&#34;\e[1;32m </span><span style=color:#e6db74>${</span>IP_host<span style=color:#e6db74>}</span><span style=color:#e6db74>    ok \e[0m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><h2 id=计算内存使用占比>计算内存使用占比</h2><p><code>vi memory_info.sh && chmod +x memory_info.sh</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>MEM_TOTAL<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free -h |awk <span style=color:#e6db74>&#39;NR==2{print $2}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MEM_USE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free -h |awk <span style=color:#e6db74>&#39;NR==2{print $3}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>MEM_USED<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free | grep -i mem |awk <span style=color:#e6db74>&#39;{print $3/$2*100&#34;%&#34;}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MEM_FREE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free -h |awk <span style=color:#e6db74>&#39;NR==2{print $4}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>MEM_FREED<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free | grep -i mem |awk <span style=color:#e6db74>&#39;{print $4/$2*100&#34;%&#34;}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MEM_BUFF_CACHE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free -h |awk <span style=color:#e6db74>&#39;NR==2{print $6}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>MEM_BUFF_CACHED<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free | grep -i mem |awk <span style=color:#e6db74>&#39;{print $6/$2*100 &#34;%&#34;}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MEM_SHARE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free -h |awk <span style=color:#e6db74>&#39;NR==2{print $5}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>MEM_SHARED<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>free | grep -i mem |awk <span style=color:#e6db74>&#39;{print $5/$2*100 &#34;%&#34;}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>MEM_ZONE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>head -3 /proc/meminfo | awk <span style=color:#e6db74>&#39;NR==1{t=$2}NR==2{f=$2;print(t-f)*100/t&#34;%&#34;}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\t\e[1;32m内存总量: </span>$MEM_TOTAL<span style=color:#e6db74> \e[0m&#34;</span> 
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\t\e[1;32m内存总量减剩余内存(所有已使用)占比: </span>$MEM_ZONE<span style=color:#e6db74> \e[0m&#34;</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\t\e[1;32m已使用: </span>$MEM_USE<span style=color:#e6db74>  占比: </span>$MEM_USED<span style=color:#e6db74> \e[0m&#34;</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\t\e[1;32m剩  余: </span>$MEM_FREE<span style=color:#e6db74>  占比: </span>$MEM_FREED<span style=color:#e6db74> \e[0m&#34;</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\t\e[1;32m共  享: </span>$MEM_SHARE<span style=color:#e6db74>  占比: </span>$MEM_SHARED<span style=color:#e6db74> \e[0m&#34;</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\t\e[1;32m缓冲区: </span>$MEM_BUFF_CACHE<span style=color:#e6db74>  占比: </span>$MEM_BUFF_CACHED<span style=color:#e6db74> \e[0m&#34;</span>
</span></span></code></pre></div><p>执行后的结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@ccb07fbb3515:~# ./memoryinfo.sh 
</span></span><span style=display:flex><span>	内存总量: 1.8Gi 
</span></span><span style=display:flex><span>	内存总量减剩余内存<span style=color:#f92672>(</span>所有已使用<span style=color:#f92672>)</span>占比: 93.9799% 
</span></span><span style=display:flex><span>	已使用: 695Mi  占比: 38.0057% 
</span></span><span style=display:flex><span>	剩  余: 110Mi  占比: 6.01987% 
</span></span><span style=display:flex><span>	共  享: 157Mi  占比: 8.59889% 
</span></span><span style=display:flex><span>	缓冲区: 1.0Gi  占比: 55.9744% 
</span></span></code></pre></div><h2 id=巡检报告>巡检报告</h2><p><code>system_check.sh</code>巡检结果在当前用户log文件夹下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># @Author: localhost</span>
</span></span><span style=display:flex><span><span style=color:#75715e># @Date:   2021-03-16 09:56:57</span>
</span></span><span style=display:flex><span><span style=color:#75715e># @Last Modified by:   localhost</span>
</span></span><span style=display:flex><span><span style=color:#75715e># @Last Modified time: 2021-03-16 11:06:31</span>
</span></span><span style=display:flex><span><span style=color:#75715e># @E-mail: localhost@163.com</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#主机信息每日巡检</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>IPADDR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ifconfig eth0|grep <span style=color:#e6db74>&#39;inet addr&#39;</span>|awk -F <span style=color:#e6db74>&#39;[ :]&#39;</span> <span style=color:#e6db74>&#39;{print $13}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#环境变量PATH没设好，在cron里执行时有很多命令会找不到</span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
</span></span><span style=display:flex><span>source /etc/profile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span> -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;请用root用户执行此脚本！&#34;</span> <span style=color:#f92672>&amp;&amp;</span> exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>centosVersion<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk <span style=color:#e6db74>&#39;{print $(NF-1)}&#39;</span> /etc/redhat-release<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>VERSION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2020-03-16&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#日志相关</span>
</span></span><span style=display:flex><span>PROGPATH<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo $0 | sed -e <span style=color:#e6db74>&#39;s,[\\/][^\\/][^\\/]*$,,&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -f $PROGPATH <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> PROGPATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;.&#34;</span>
</span></span><span style=display:flex><span>LOGPATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PROGPATH<span style=color:#e6db74>/log&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -e $LOGPATH <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> mkdir $LOGPATH
</span></span><span style=display:flex><span>RESULTFILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$LOGPATH<span style=color:#e6db74>/HostDailyCheck-</span>$IPADDR<span style=color:#e6db74>-`date +%Y%m%d`.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#定义报表的全局变量</span>
</span></span><span style=display:flex><span>report_DateTime<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#日期 ok</span>
</span></span><span style=display:flex><span>report_Hostname<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#主机名 ok</span>
</span></span><span style=display:flex><span>report_OSRelease<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#发行版本 ok</span>
</span></span><span style=display:flex><span>report_Kernel<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#内核 ok</span>
</span></span><span style=display:flex><span>report_Language<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#语言/编码 ok</span>
</span></span><span style=display:flex><span>report_LastReboot<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#最近启动时间 ok</span>
</span></span><span style=display:flex><span>report_Uptime<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#运行时间（天） ok</span>
</span></span><span style=display:flex><span>report_CPUs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#CPU数量 ok</span>
</span></span><span style=display:flex><span>report_CPUType<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#CPU类型 ok</span>
</span></span><span style=display:flex><span>report_Arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#CPU架构 ok</span>
</span></span><span style=display:flex><span>report_MemTotal<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#内存总容量(MB) ok</span>
</span></span><span style=display:flex><span>report_MemFree<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#内存剩余(MB) ok</span>
</span></span><span style=display:flex><span>report_MemUsedPercent<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#内存使用率% ok</span>
</span></span><span style=display:flex><span>report_DiskTotal<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#硬盘总容量(GB) ok</span>
</span></span><span style=display:flex><span>report_DiskFree<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#硬盘剩余(GB) ok</span>
</span></span><span style=display:flex><span>report_DiskUsedPercent<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#硬盘使用率% ok</span>
</span></span><span style=display:flex><span>report_InodeTotal<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#Inode总量 ok</span>
</span></span><span style=display:flex><span>report_InodeFree<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#Inode剩余 ok</span>
</span></span><span style=display:flex><span>report_InodeUsedPercent<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#Inode使用率 ok</span>
</span></span><span style=display:flex><span>report_IP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#IP地址 ok</span>
</span></span><span style=display:flex><span>report_MAC<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#MAC地址 ok</span>
</span></span><span style=display:flex><span>report_Gateway<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#默认网关 ok</span>
</span></span><span style=display:flex><span>report_DNS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#DNS ok</span>
</span></span><span style=display:flex><span>report_Listen<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#监听 ok</span>
</span></span><span style=display:flex><span>report_Selinux<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#Selinux ok</span>
</span></span><span style=display:flex><span>report_Firewall<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#防火墙 ok</span>
</span></span><span style=display:flex><span>report_USERs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#用户 ok</span>
</span></span><span style=display:flex><span>report_USEREmptyPassword<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#空密码用户 ok</span>
</span></span><span style=display:flex><span>report_USERTheSameUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#相同ID的用户 ok </span>
</span></span><span style=display:flex><span>report_PasswordExpiry<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#密码过期（天） ok</span>
</span></span><span style=display:flex><span>report_RootUser<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#root用户 ok</span>
</span></span><span style=display:flex><span>report_Sudoers<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#sudo授权 ok</span>
</span></span><span style=display:flex><span>report_SSHAuthorized<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#SSH信任主机 ok</span>
</span></span><span style=display:flex><span>report_SSHDProtocolVersion<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#SSH协议版本 ok</span>
</span></span><span style=display:flex><span>report_SSHDPermitRootLogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#允许root远程登录 ok</span>
</span></span><span style=display:flex><span>report_DefunctProsess<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#僵尸进程数量 ok</span>
</span></span><span style=display:flex><span>report_SelfInitiatedService<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#自启动服务数量 ok</span>
</span></span><span style=display:flex><span>report_SelfInitiatedProgram<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#自启动程序数量 ok</span>
</span></span><span style=display:flex><span>report_RuningService<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#运行中服务数 ok</span>
</span></span><span style=display:flex><span>report_Crontab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#计划任务数 ok</span>
</span></span><span style=display:flex><span>report_Syslog<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#日志服务 ok</span>
</span></span><span style=display:flex><span>report_SNMP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#SNMP OK</span>
</span></span><span style=display:flex><span>report_NTP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#NTP ok</span>
</span></span><span style=display:flex><span>report_JDK<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#75715e>#JDK版本 ok</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> version<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;系统巡检脚本：Version </span>$VERSION<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getCpuStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ CPU检查 #############################&#34;</span>
</span></span><span style=display:flex><span>Physical_CPUs<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;physical id&#34;</span> /proc/cpuinfo| sort | uniq | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>Virt_CPUs<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;processor&#34;</span> /proc/cpuinfo | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>CPU_Kernels<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;cores&#34;</span> /proc/cpuinfo|uniq| awk -F <span style=color:#e6db74>&#39;: &#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>CPU_Type<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;model name&#34;</span> /proc/cpuinfo | awk -F <span style=color:#e6db74>&#39;: &#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span> | sort | uniq<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>CPU_Arch<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -m<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;物理CPU个数:</span>$Physical_CPUs<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;逻辑CPU个数:</span>$Virt_CPUs<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;每CPU核心数:</span>$CPU_Kernels<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; CPU型号:</span>$CPU_Type<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; CPU架构:</span>$CPU_Arch<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_CPUs<span style=color:#f92672>=</span>$Virt_CPUs <span style=color:#75715e>#CPU数量</span>
</span></span><span style=display:flex><span>report_CPUType<span style=color:#f92672>=</span>$CPU_Type <span style=color:#75715e>#CPU类型</span>
</span></span><span style=display:flex><span>report_Arch<span style=color:#f92672>=</span>$CPU_Arch <span style=color:#75715e>#CPU架构</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getMemStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 内存检查 ############################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>free -mo
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>free -h
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>MemTotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep MemTotal /proc/meminfo| awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>MemFree<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep MemFree /proc/meminfo| awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>let MemUsed<span style=color:#f92672>=</span>MemTotal-MemFree
</span></span><span style=display:flex><span>MemPercent<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk <span style=color:#e6db74>&#34;BEGIN {if(</span>$MemTotal<span style=color:#e6db74>==0){printf 100}else{printf \&#34;%.2f\&#34;,</span>$MemUsed<span style=color:#e6db74>*100/</span>$MemTotal<span style=color:#e6db74>}}&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>report_MemTotal<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$((</span>MemTotal/1024<span style=color:#66d9ef>))</span><span style=color:#e6db74>&#34;&#34;MB&#34;</span> <span style=color:#75715e>#内存总容量(MB)</span>
</span></span><span style=display:flex><span>report_MemFree<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$((</span>MemFree/1024<span style=color:#66d9ef>))</span><span style=color:#e6db74>&#34;&#34;MB&#34;</span> <span style=color:#75715e>#内存剩余(MB)</span>
</span></span><span style=display:flex><span>report_MemUsedPercent<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>awk <span style=color:#e6db74>&#34;BEGIN {if(</span>$MemTotal<span style=color:#e6db74>==0){printf 100}else{printf \&#34;%.2f\&#34;,</span>$MemUsed<span style=color:#e6db74>*100/</span>$MemTotal<span style=color:#e6db74>}}&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;&#34;%&#34;</span> <span style=color:#75715e>#内存使用率%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getDiskStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 磁盘检查 ############################&#34;</span>
</span></span><span style=display:flex><span>df -hiP | sed <span style=color:#e6db74>&#39;s/Mounted on/Mounted/&#39;</span>&gt; /tmp/inode
</span></span><span style=display:flex><span>df -hTP | sed <span style=color:#e6db74>&#39;s/Mounted on/Mounted/&#39;</span>&gt; /tmp/disk 
</span></span><span style=display:flex><span>join /tmp/disk /tmp/inode | awk <span style=color:#e6db74>&#39;{print $1,$2,&#34;|&#34;,$3,$4,$5,$6,&#34;|&#34;,$8,$9,$10,$11,&#34;|&#34;,$12}&#39;</span>| column -t
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>diskdata<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -TP | sed <span style=color:#e6db74>&#39;1d&#39;</span> | awk <span style=color:#e6db74>&#39;$2!=&#34;tmpfs&#34;{print}&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>disktotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$diskdata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$3}END{print total}&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>diskused<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$diskdata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$4}END{print total}&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>diskfree<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>disktotal-diskused<span style=color:#66d9ef>))</span> <span style=color:#75715e>#KB</span>
</span></span><span style=display:flex><span>diskusedpercent<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $disktotal $diskused | awk <span style=color:#e6db74>&#39;{if($1==0){printf 100}else{printf &#34;%.2f&#34;,$2*100/$1}}&#39;</span><span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span>inodedata<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>df -iTP | sed <span style=color:#e6db74>&#39;1d&#39;</span> | awk <span style=color:#e6db74>&#39;$2!=&#34;tmpfs&#34;{print}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>inodetotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$inodedata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$3}END{print total}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>inodeused<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$inodedata<span style=color:#e6db74>&#34;</span> | awk <span style=color:#e6db74>&#39;{total+=$4}END{print total}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>inodefree<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>inodetotal-inodeused<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>inodeusedpercent<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $inodetotal $inodeused | awk <span style=color:#e6db74>&#39;{if($1==0){printf 100}else{printf &#34;%.2f&#34;,$2*100/$1}}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>report_DiskTotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>disktotal/1024/1024<span style=color:#66d9ef>))</span><span style=color:#e6db74>&#34;GB&#34;</span> <span style=color:#75715e>#硬盘总容量(GB)</span>
</span></span><span style=display:flex><span>report_DiskFree<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>diskfree/1024/1024<span style=color:#66d9ef>))</span><span style=color:#e6db74>&#34;GB&#34;</span> <span style=color:#75715e>#硬盘剩余(GB)</span>
</span></span><span style=display:flex><span>report_DiskUsedPercent<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$diskusedpercent<span style=color:#e6db74>&#34;&#34;%&#34;</span> <span style=color:#75715e>#硬盘使用率%</span>
</span></span><span style=display:flex><span>report_InodeTotal<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>inodetotal/1000<span style=color:#66d9ef>))</span><span style=color:#e6db74>&#34;K&#34;</span> <span style=color:#75715e>#Inode总量</span>
</span></span><span style=display:flex><span>report_InodeFree<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>inodefree/1000<span style=color:#66d9ef>))</span><span style=color:#e6db74>&#34;K&#34;</span> <span style=color:#75715e>#Inode剩余</span>
</span></span><span style=display:flex><span>report_InodeUsedPercent<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$inodeusedpercent<span style=color:#e6db74>&#34;&#34;%&#34;</span> <span style=color:#75715e>#Inode使用率%</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSystemStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 系统检查 ############################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e /etc/sysconfig/i18n <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>default_LANG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;LANG=&#34;</span> /etc/sysconfig/i18n | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | awk -F <span style=color:#e6db74>&#39;&#34;&#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>default_LANG<span style=color:#f92672>=</span>$LANG
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>export LANG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en_US.UTF-8&#34;</span>
</span></span><span style=display:flex><span>Release<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/redhat-release 2&gt;/dev/null<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>Kernel<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -r<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>OS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -o<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>Hostname<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uname -n<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>SELinux<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/usr/sbin/sestatus | grep <span style=color:#e6db74>&#34;SELinux status: &#34;</span> | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>LastReboot<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>who -b | awk <span style=color:#e6db74>&#39;{print $3,$4}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>uptime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>uptime | sed <span style=color:#e6db74>&#39;s/.*up \([^,]*\), .*/\1/&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; 系统：</span>$OS<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; 发行版本：</span>$Release<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; 内核：</span>$Kernel<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; 主机名：</span>$Hostname<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; SELinux：</span>$SELinux<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;语言/编码：</span>$default_LANG<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; 当前时间：</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#39;%F %T&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; 最后启动：</span>$LastReboot<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; 运行时间：</span>$uptime<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_DateTime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%F %T&#34;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#日期</span>
</span></span><span style=display:flex><span>report_Hostname<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$Hostname<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#主机名</span>
</span></span><span style=display:flex><span>report_OSRelease<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$Release<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#发行版本</span>
</span></span><span style=display:flex><span>report_Kernel<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$Kernel<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#内核</span>
</span></span><span style=display:flex><span>report_Language<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$default_LANG<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#语言/编码</span>
</span></span><span style=display:flex><span>report_LastReboot<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$LastReboot<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#最近启动时间</span>
</span></span><span style=display:flex><span>report_Uptime<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$uptime<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#运行时间（天）</span>
</span></span><span style=display:flex><span>report_Selinux<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$SELinux<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>export LANG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$default_LANG<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getServiceStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 服务检查 ############################&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &gt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>systemctl list-unit-files --type<span style=color:#f92672>=</span>service --state<span style=color:#f92672>=</span>enabled --no-pager | grep <span style=color:#e6db74>&#34;enabled&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>process<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>systemctl list-units --type<span style=color:#f92672>=</span>service --state<span style=color:#f92672>=</span>running --no-pager | grep <span style=color:#e6db74>&#34;.service&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_SelfInitiatedService<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span> | wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#自启动服务数量</span>
</span></span><span style=display:flex><span>report_RuningService<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$process<span style=color:#e6db74>&#34;</span> | wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#运行中服务数量</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/sbin/chkconfig | grep -E <span style=color:#e6db74>&#34;:on|:启用&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>process<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/sbin/service --status-all 2&gt;/dev/null | grep -E <span style=color:#e6db74>&#34;is running|正在运行&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_SelfInitiatedService<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span> | wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#自启动服务数量</span>
</span></span><span style=display:flex><span>report_RuningService<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$process<span style=color:#e6db74>&#34;</span> | wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#运行中服务数量</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;服务配置&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span> | column -t
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;正在运行的服务&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------------&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$process<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getAutoStartStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 自启动检查 ##########################&#34;</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;^#&#34;</span> /etc/rc.d/rc.local| sed <span style=color:#e6db74>&#39;/^$/d&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_SelfInitiatedProgram<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo $conf | wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#自启动程序数量</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getLoginStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 登录检查 ############################&#34;</span>
</span></span><span style=display:flex><span>last | head
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getNetworkStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 网络检查 ############################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>/sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v inet6
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ip a</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>ip link | grep BROADCAST | awk -F: <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span> ip add show $i | grep -E <span style=color:#e6db74>&#34;BROADCAST|global&#34;</span>| awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39; &#39;</span> ;echo <span style=color:#e6db74>&#34;&#34;</span> ;<span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>GATEWAY<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip route | grep default | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>DNS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep nameserver /etc/resolv.conf| grep -v <span style=color:#e6db74>&#34;#&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;网关：</span>$GATEWAY<span style=color:#e6db74> &#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34; DNS：</span>$DNS<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>IP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip -f inet addr | grep -v 127.0.0.1 | grep inet | awk <span style=color:#e6db74>&#39;{print $NF,$2}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>MAC<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip link | grep -v <span style=color:#e6db74>&#34;LOOPBACK\|loopback&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> | sed <span style=color:#e6db74>&#39;N;s/\n//&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>report_IP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$IP<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#IP地址</span>
</span></span><span style=display:flex><span>report_MAC<span style=color:#f92672>=</span>$MAC <span style=color:#75715e>#MAC地址</span>
</span></span><span style=display:flex><span>report_Gateway<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$GATEWAY<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#默认网关</span>
</span></span><span style=display:flex><span>report_DNS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$DNS<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#DNS</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getListenStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 监听检查 ############################&#34;</span>
</span></span><span style=display:flex><span>TCPListen<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ss -ntul | column -t<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$TCPListen<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_Listen<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$TCPListen<span style=color:#e6db74>&#34;</span>| sed <span style=color:#e6db74>&#39;1d&#39;</span> | awk <span style=color:#e6db74>&#39;/tcp/ {print $5}&#39;</span> | awk -F: <span style=color:#e6db74>&#39;{print $NF}&#39;</span> | sort | uniq | wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getCronStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 计划任务检查 ########################&#34;</span>
</span></span><span style=display:flex><span>Crontab<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> /etc/passwd| awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>crontab -l -u $user &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$user<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------&#34;</span>
</span></span><span style=display:flex><span>crontab -l -u $user
</span></span><span style=display:flex><span>let Crontab<span style=color:#f92672>=</span>Crontab+<span style=color:#66d9ef>$(</span>crontab -l -u $user | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#计划任务</span>
</span></span><span style=display:flex><span>find /etc/cron* -type f | xargs -i ls -l <span style=color:#f92672>{}</span> | column -t
</span></span><span style=display:flex><span>let Crontab<span style=color:#f92672>=</span>Crontab+<span style=color:#66d9ef>$(</span>find /etc/cron* -type f | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_Crontab<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$Crontab<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#计划任务数</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getHowLongAgo<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 计算一个时间戳离现在有多久了</span>
</span></span><span style=display:flex><span>datetime<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$*<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$datetime<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;错误的参数：getHowLongAgo() </span>$*<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>Timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s -d <span style=color:#e6db74>&#34;</span>$datetime<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#转化为时间戳</span>
</span></span><span style=display:flex><span>Now_Timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>Difference_Timestamp<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>$Now_Timestamp<span style=color:#f92672>-</span>$Timestamp<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>days<span style=color:#f92672>=</span>0;hours<span style=color:#f92672>=</span>0;minutes<span style=color:#f92672>=</span>0;
</span></span><span style=display:flex><span>sec_in_day<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>24</span><span style=color:#66d9ef>))</span>;
</span></span><span style=display:flex><span>sec_in_hour<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60</span><span style=color:#66d9ef>))</span>;
</span></span><span style=display:flex><span>sec_in_minute<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>((</span> <span style=color:#66d9ef>$((</span>$Difference_Timestamp<span style=color:#f92672>-</span>$sec_in_day<span style=color:#66d9ef>))</span> &gt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>let Difference_Timestamp<span style=color:#f92672>=</span>Difference_Timestamp-sec_in_day
</span></span><span style=display:flex><span>let days++
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>((</span> <span style=color:#66d9ef>$((</span>$Difference_Timestamp<span style=color:#f92672>-</span>$sec_in_hour<span style=color:#66d9ef>))</span> &gt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>let Difference_Timestamp<span style=color:#f92672>=</span>Difference_Timestamp-sec_in_hour
</span></span><span style=display:flex><span>let hours++
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$days<span style=color:#e6db74> 天 </span>$hours<span style=color:#e6db74> 小时前&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getUserLastLogin<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取用户最近一次登录的时间，含年份</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 很遗憾last命令不支持显示年份，只有&#34;last -t YYYYMMDDHHMMSS&#34;表示某个时间之间的登录，我</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 们只能用最笨的方法了，对比今天之前和今年元旦之前（或者去年之前和前年之前……）某个用户</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 登录次数，如果登录统计次数有变化，则说明最近一次登录是今年。</span>
</span></span><span style=display:flex><span>username<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>: <span style=color:#e6db74>${</span>username:=<span style=color:#e6db74>&#34;`whoami`&#34;</span><span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>thisYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>oldesYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last | tail -n1 | awk <span style=color:#e6db74>&#39;{print $NF}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span><span style=color:#f92672>((</span> $thisYear &gt;<span style=color:#f92672>=</span> $oldesYear<span style=color:#f92672>))</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>loginBeforeToday<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last $username | grep $username | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>loginBeforeNewYearsDayOfThisYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last $username -t $thisYear<span style=color:#e6db74>&#34;0101000000&#34;</span> | grep $username | wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $loginBeforeToday -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;从未登录过&#34;</span>
</span></span><span style=display:flex><span>break
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>lastDateTime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>last -i $username | head -n1 | awk <span style=color:#e6db74>&#39;{for(i=4;i&lt;(NF-2);i++)printf&#34;%s &#34;,$i}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34; </span>$thisYear<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#格式如: Sat Nov 2 20:33 2015</span>
</span></span><span style=display:flex><span>lastDateTime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#34;+%Y-%m-%d %H:%M:%S&#34;</span> -d <span style=color:#e6db74>&#34;</span>$lastDateTime<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$lastDateTime<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>break
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>thisYear<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>thisYear-1<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getUserStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 用户检查 ############################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/etc/passwd 最后修改时间</span>
</span></span><span style=display:flex><span>pwdfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /etc/passwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>Modify<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>stat /etc/passwd | grep Modify | tr <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#e6db74>&#39; &#39;</span> | awk <span style=color:#e6db74>&#39;{print $2,$3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/etc/passwd 最后修改时间：</span>$Modify<span style=color:#e6db74> (</span><span style=color:#66d9ef>$(</span>getHowLongAgo $Modify<span style=color:#66d9ef>)</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;特权用户&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------&#34;</span>
</span></span><span style=display:flex><span>RootUser<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>id -u $user<span style=color:#66d9ef>)</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$user<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>RootUser<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$RootUser<span style=color:#e6db74>,</span>$user<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;用户列表&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------&#34;</span>
</span></span><span style=display:flex><span>USERs<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;用户名 UID GID HOME SHELL 最后一次登录&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> username in <span style=color:#66d9ef>$(</span>grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> /etc/passwd| awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>userLastLogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getUserLastLogin $username<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep -w <span style=color:#e6db74>&#34;</span>$username<span style=color:#e6db74>&#34;</span> |grep -w <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span>| awk -F: -v lastlogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$userLastLogin<span style=color:#e6db74>&#34;</span> | tr <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#e6db74>&#39;_&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;{print $1,$3,$4,$6,$7,lastlogin}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>let USERs<span style=color:#f92672>=</span>USERs+<span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span>| wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> | column -t
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;空密码用户&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;----------&#34;</span>
</span></span><span style=display:flex><span>USEREmptyPassword<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> | cut -d: -f1<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk -F: <span style=color:#e6db74>&#39;$2==&#34;!!&#34;{print $1}&#39;</span> /etc/shadow | grep -w $user<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -z $r <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo $r
</span></span><span style=display:flex><span>USEREmptyPassword<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$USEREmptyPassword<span style=color:#e6db74>,&#34;</span>$r
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;相同ID的用户&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;------------&#34;</span>
</span></span><span style=display:flex><span>USERTheSameUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>UIDs<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cut -d: -f3 /etc/passwd | sort | uniq -c | awk <span style=color:#e6db74>&#39;$1&gt;1{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> uid in $UIDs;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;</span>$uid<span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>USERTheSameUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$uid<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>awk -F: <span style=color:#e6db74>&#39;ORS=&#34;&#34;;$3==&#39;</span><span style=color:#e6db74>&#34;</span>$uid<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#39;{print &#34;:&#34;,$1}&#39;</span> /etc/passwd<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$r<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>USERTheSameUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$USERTheSameUID<span style=color:#e6db74> </span>$r<span style=color:#e6db74>,&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_USERs<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$USERs<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#用户</span>
</span></span><span style=display:flex><span>report_USEREmptyPassword<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $USEREmptyPassword | sed <span style=color:#e6db74>&#39;s/^,//&#39;</span><span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span>report_USERTheSameUID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $USERTheSameUID | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span>report_RootUser<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $RootUser | sed <span style=color:#e6db74>&#39;s/^,//&#39;</span><span style=color:#66d9ef>)</span> <span style=color:#75715e>#特权用户</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getPasswordStatus <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 密码检查 ############################&#34;</span>
</span></span><span style=display:flex><span>pwdfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /etc/passwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;密码过期检查&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;------------&#34;</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> shell in <span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;/sbin/nologin&#34;</span> /etc/shells<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep <span style=color:#e6db74>&#34;</span>$shell<span style=color:#e6db74>&#34;</span> | cut -d: -f1<span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>get_expiry_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/usr/bin/chage -l $user | grep <span style=color:#e6db74>&#39;Password expires&#39;</span> | cut -d: -f2<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $get_expiry_date <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39; never&#39;</span> <span style=color:#f92672>||</span> $get_expiry_date <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;never&#39;</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;%-15s 永不过期\n&#34;</span> $user
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$result<span style=color:#e6db74>,</span>$user<span style=color:#e6db74>:never&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>password_expiry_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date -d <span style=color:#e6db74>&#34;</span>$get_expiry_date<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;+%s&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>current_date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#34;+%s&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>diff<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>$password_expiry_date<span style=color:#f92672>-</span>$current_date<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>let DAYS<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>$diff<span style=color:#f92672>/(</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>24</span><span style=color:#66d9ef>))</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;%-15s %s天后过期\n&#34;</span> $user $DAYS
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$result<span style=color:#e6db74>,</span>$user<span style=color:#e6db74>:</span>$DAYS<span style=color:#e6db74> days&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>report_PasswordExpiry<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | sed <span style=color:#e6db74>&#39;s/^,//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;密码策略检查&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;------------&#34;</span>
</span></span><span style=display:flex><span>grep -v <span style=color:#e6db74>&#34;#&#34;</span> /etc/login.defs | grep -E <span style=color:#e6db74>&#34;PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSudoersStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ Sudoers检查 #########################&#34;</span>
</span></span><span style=display:flex><span>conf<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>grep -v <span style=color:#e6db74>&#34;^#&#34;</span> /etc/sudoers| grep -v <span style=color:#e6db74>&#34;^Defaults&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$conf<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_Sudoers<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>echo $conf | wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getInstalledStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 软件检查 ############################&#34;</span>
</span></span><span style=display:flex><span>rpm -qa --last | head | column -t 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getProcessStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 进程检查 ############################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#66d9ef>$(</span>ps -ef | grep defunct | grep -v grep | wc -l<span style=color:#66d9ef>)</span> -ge <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;僵尸进程&#34;</span>;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------&#34;</span>
</span></span><span style=display:flex><span>ps -ef | head -n1
</span></span><span style=display:flex><span>ps -ef | grep defunct | grep -v grep
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;内存占用TOP10&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;-------------&#34;</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;PID %MEM RSS COMMAND
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#66d9ef>$(</span>ps aux | awk <span style=color:#e6db74>&#39;{print $2, $4, $6, $11}&#39;</span> | sort -k3rn | head -n <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>| column -t 
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;CPU占用TOP10&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;------------&#34;</span>
</span></span><span style=display:flex><span>top b -n1 | head -17 | tail -11
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_DefunctProsess<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>ps -ef | grep defunct | grep -v grep|wc -l<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getJDKStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ JDK检查 #############################&#34;</span>
</span></span><span style=display:flex><span>java -version 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>java -version 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;JAVA_HOME=\&#34;</span>$JAVA_HOME<span style=color:#e6db74>\&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_JDK<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>java -version 2&gt;&amp;<span style=color:#ae81ff>1</span> | grep version | awk <span style=color:#e6db74>&#39;{print $1,$3}&#39;</span> | tr -d <span style=color:#e6db74>&#39;&#34;&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSyslogStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ syslog检查 ##########################&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;服务状态：</span><span style=color:#66d9ef>$(</span>getState rsyslog<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/etc/rsyslog.conf&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;-----------------&#34;</span>
</span></span><span style=display:flex><span>cat /etc/rsyslog.conf 2&gt;/dev/null | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | grep -v <span style=color:#e6db74>&#34;^\\</span>$<span style=color:#e6db74>&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span> | column -t
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_Syslog<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getState rsyslog<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getFirewallStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 防火墙检查 ##########################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#防火墙状态，策略等</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>/etc/init.d/iptables status &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>status<span style=color:#f92672>=</span>$?
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;active&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>3</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inactive&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> $status -eq <span style=color:#ae81ff>4</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;permission denied&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>s<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getState iptables<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;iptables: </span>$s<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/etc/sysconfig/iptables&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;-----------------------&#34;</span>
</span></span><span style=display:flex><span>cat /etc/sysconfig/iptables 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_Firewall<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$s<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSNMPStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SNMP服务状态，配置等</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ SNMP检查 ############################&#34;</span>
</span></span><span style=display:flex><span>status<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getState snmpd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;服务状态：</span>$status<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e /etc/snmp/snmpd.conf <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/etc/snmp/snmpd.conf&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------------------&#34;</span>
</span></span><span style=display:flex><span>cat /etc/snmp/snmpd.conf 2&gt;/dev/null | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_SNMP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getState snmpd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getState<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $centosVersion &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e <span style=color:#e6db74>&#34;/etc/init.d/</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>`</span>/etc/init.d/$1 status 2&gt;/dev/null | grep -E <span style=color:#e6db74>&#34;is running|正在运行&#34;</span> | wc -l<span style=color:#e6db74>`</span> -ge <span style=color:#ae81ff>1</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;active&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inactive&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;unknown&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#CentOS 7+</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>systemctl is-active $1 2&gt;&amp;1<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$r<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getSSHStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#SSHD服务状态，配置,受信任主机等</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ SSH检查 #############################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#检查受信任主机</span>
</span></span><span style=display:flex><span>pwdfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /etc/passwd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;服务状态：</span><span style=color:#66d9ef>$(</span>getState sshd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>Protocol_Version<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/ssh/sshd_config | grep Protocol | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;SSH协议版本：</span>$Protocol_Version<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;信任主机&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------&#34;</span>
</span></span><span style=display:flex><span>authorized<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> user in <span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep /bin/bash | awk -F: <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>authorize_file<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$pwdfile<span style=color:#e6db74>&#34;</span> | grep -w $user | awk -F: <span style=color:#e6db74>&#39;{printf $6&#34;/.ssh/authorized_keys&#34;}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>authorized_host<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat $authorize_file 2&gt;/dev/null | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39;,&#39;</span> | sed <span style=color:#e6db74>&#39;s/,$//&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -z $authorized_host <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$user<span style=color:#e6db74> 授权 \&#34;</span>$authorized_host<span style=color:#e6db74>\&#34; 无密码访问&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>let authorized<span style=color:#f92672>=</span>authorized+<span style=color:#66d9ef>$(</span>cat $authorize_file 2&gt;/dev/null | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span>|wc -l<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;是否允许ROOT远程登录&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------------------&#34;</span>
</span></span><span style=display:flex><span>config<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/ssh/sshd_config | grep PermitRootLogin<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>firstChar<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>config:0:1<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $firstChar <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;#&#34;</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>PermitRootLogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yes&#34;</span> <span style=color:#75715e>#默认是允许ROOT远程登录的</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>PermitRootLogin<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $config | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;PermitRootLogin </span>$PermitRootLogin<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/etc/ssh/sshd_config&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;--------------------&#34;</span>
</span></span><span style=display:flex><span>cat /etc/ssh/sshd_config | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_SSHAuthorized<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$authorized<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#SSH信任主机</span>
</span></span><span style=display:flex><span>report_SSHDProtocolVersion<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$Protocol_Version<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#SSH协议版本</span>
</span></span><span style=display:flex><span>report_SSHDPermitRootLogin<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PermitRootLogin<span style=color:#e6db74>&#34;</span> <span style=color:#75715e>#允许root远程登录</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getNTPStatus<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#NTP服务状态，当前时间，配置等</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ NTP检查 #############################&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e /etc/ntp.conf <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;服务状态：</span><span style=color:#66d9ef>$(</span>getState ntpd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/etc/ntp.conf&#34;</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;-------------&#34;</span>
</span></span><span style=display:flex><span>cat /etc/ntp.conf 2&gt;/dev/null | grep -v <span style=color:#e6db74>&#34;^#&#34;</span> | sed <span style=color:#e6db74>&#39;/^$/d&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#报表信息</span>
</span></span><span style=display:flex><span>report_NTP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>getState ntpd<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> uploadHostDailyCheckReport<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>json<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;DateTime\&#34;:\&#34;</span>$report_DateTime<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Hostname\&#34;:\&#34;</span>$report_Hostname<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;OSRelease\&#34;:\&#34;</span>$report_OSRelease<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Kernel\&#34;:\&#34;</span>$report_Kernel<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Language\&#34;:\&#34;</span>$report_Language<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;LastReboot\&#34;:\&#34;</span>$report_LastReboot<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Uptime\&#34;:\&#34;</span>$report_Uptime<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;CPUs\&#34;:\&#34;</span>$report_CPUs<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;CPUType\&#34;:\&#34;</span>$report_CPUType<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Arch\&#34;:\&#34;</span>$report_Arch<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;MemTotal\&#34;:\&#34;</span>$report_MemTotal<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;MemFree\&#34;:\&#34;</span>$report_MemFree<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;MemUsedPercent\&#34;:\&#34;</span>$report_MemUsedPercent<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;DiskTotal\&#34;:\&#34;</span>$report_DiskTotal<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;DiskFree\&#34;:\&#34;</span>$report_DiskFree<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;DiskUsedPercent\&#34;:\&#34;</span>$report_DiskUsedPercent<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;InodeTotal\&#34;:\&#34;</span>$report_InodeTotal<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;InodeFree\&#34;:\&#34;</span>$report_InodeFree<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;InodeUsedPercent\&#34;:\&#34;</span>$report_InodeUsedPercent<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;IP\&#34;:\&#34;</span>$report_IP<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;MAC\&#34;:\&#34;</span>$report_MAC<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Gateway\&#34;:\&#34;</span>$report_Gateway<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;DNS\&#34;:\&#34;</span>$report_DNS<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Listen\&#34;:\&#34;</span>$report_Listen<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Selinux\&#34;:\&#34;</span>$report_Selinux<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Firewall\&#34;:\&#34;</span>$report_Firewall<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;USERs\&#34;:\&#34;</span>$report_USERs<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;USEREmptyPassword\&#34;:\&#34;</span>$report_USEREmptyPassword<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;USERTheSameUID\&#34;:\&#34;</span>$report_USERTheSameUID<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;PasswordExpiry\&#34;:\&#34;</span>$report_PasswordExpiry<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;RootUser\&#34;:\&#34;</span>$report_RootUser<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Sudoers\&#34;:\&#34;</span>$report_Sudoers<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;SSHAuthorized\&#34;:\&#34;</span>$report_SSHAuthorized<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;SSHDProtocolVersion\&#34;:\&#34;</span>$report_SSHDProtocolVersion<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;SSHDPermitRootLogin\&#34;:\&#34;</span>$report_SSHDPermitRootLogin<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;DefunctProsess\&#34;:\&#34;</span>$report_DefunctProsess<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;SelfInitiatedService\&#34;:\&#34;</span>$report_SelfInitiatedService<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;SelfInitiatedProgram\&#34;:\&#34;</span>$report_SelfInitiatedProgram<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;RuningService\&#34;:\&#34;</span>$report_RuningService<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Crontab\&#34;:\&#34;</span>$report_Crontab<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;Syslog\&#34;:\&#34;</span>$report_Syslog<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;SNMP\&#34;:\&#34;</span>$report_SNMP<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;NTP\&#34;:\&#34;</span>$report_NTP<span style=color:#e6db74>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>\&#34;JDK\&#34;:\&#34;</span>$report_JDK<span style=color:#e6db74>\&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#echo &#34;$json&#34; </span>
</span></span><span style=display:flex><span>curl -l -H <span style=color:#e6db74>&#34;Content-type: application/json&#34;</span> -X POST -d <span style=color:#e6db74>&#34;</span>$json<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$uploadHostDailyCheckReportApi<span style=color:#e6db74>&#34;</span> 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> getchage_file_24h<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;############################ 文件检查 #############################&#34;</span>
</span></span><span style=display:flex><span>    check2<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name <span style=color:#e6db74>&#39;*.sh&#39;</span> -mtime -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check21<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name <span style=color:#e6db74>&#39;*.asp&#39;</span> -mtime -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check22<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name <span style=color:#e6db74>&#39;*.php&#39;</span> -mtime -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check23<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name <span style=color:#e6db74>&#39;*.aspx&#39;</span> -mtime -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check24<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name <span style=color:#e6db74>&#39;*.jsp&#39;</span> -mtime -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check25<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name <span style=color:#e6db74>&#39;*.html&#39;</span> -mtime -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check26<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name <span style=color:#e6db74>&#39;*.htm&#39;</span> -mtime -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check9<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find / -name core -exec ls -l <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check10<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/crontab<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>check12<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ls -alt /usr/bin | head -10<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>############################查看所有被修改过的文件返回最近24小时内的############################
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check2}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check21}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check22}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check23}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check24}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check25}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check26}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${line}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>############################检查定时文件的完整性############################
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check10}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${line}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>############################查看系统命令是否被替换############################
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${check12}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>${line}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> check<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>version
</span></span><span style=display:flex><span>getSystemStatus
</span></span><span style=display:flex><span>getCpuStatus
</span></span><span style=display:flex><span>getMemStatus
</span></span><span style=display:flex><span>getDiskStatus
</span></span><span style=display:flex><span>getNetworkStatus
</span></span><span style=display:flex><span>getListenStatus
</span></span><span style=display:flex><span>getProcessStatus
</span></span><span style=display:flex><span>getServiceStatus
</span></span><span style=display:flex><span>getAutoStartStatus
</span></span><span style=display:flex><span>getLoginStatus
</span></span><span style=display:flex><span>getCronStatus
</span></span><span style=display:flex><span>getUserStatus
</span></span><span style=display:flex><span>getPasswordStatus
</span></span><span style=display:flex><span>getSudoersStatus
</span></span><span style=display:flex><span>getJDKStatus
</span></span><span style=display:flex><span>getFirewallStatus
</span></span><span style=display:flex><span>getSSHStatus
</span></span><span style=display:flex><span>getSyslogStatus
</span></span><span style=display:flex><span>getSNMPStatus
</span></span><span style=display:flex><span>getNTPStatus
</span></span><span style=display:flex><span>getInstalledStatus
</span></span><span style=display:flex><span>getchage_file_24h
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#执行检查并保存检查结果</span>
</span></span><span style=display:flex><span>check &gt; $RESULTFILE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;检查结果：</span>$RESULTFILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;`date &#34;</span>+%Y-%m-%d %H:%M:%S<span style=color:#e6db74>&#34;` 巡检报告&#34;</span>
</span></span><span style=display:flex><span>END
</span></span></code></pre></div><h3 id=从一个文件夹中的所有文件加tmp转移到另一个目录下再去掉tmp>从一个文件夹中的所有文件加.tmp，转移到另一个目录下再去掉.tmp。</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#! /bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>PRE_HOME<span style=color:#f92672>=</span>/iflytek/sl_export_pre
</span></span><span style=display:flex><span>EXP_HOME<span style=color:#f92672>=</span>/iflytek/sl_export
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> nameadd<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>cd $PRE_HOME
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> filename in <span style=color:#e6db74>`</span>ls *.*<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>	echo $filename | mv $filename $filename<span style=color:#e6db74>&#34;.tmp&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>sleep <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>mv *.tmp $EXP_HOME
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> namesub<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>cd $EXP_HOME
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> filename in <span style=color:#e6db74>`</span>ls *.tmp<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>	echo $filename | mv $filename <span style=color:#e6db74>`</span>sed <span style=color:#e6db74>&#39;s/.tmp//g&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nameadd
</span></span><span style=display:flex><span>sleep <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>namesub
</span></span></code></pre></div><h3 id=同时设置定时任务定时执行>同时设置定时任务，定时执行。</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ae81ff>15</span> 8,10,12,15,17,19 * * *
</span></span></code></pre></div><h3 id=定时重启进程配合crontab-使用>定时重启进程配合crontab 使用</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span>date +<span style=color:#e6db74>&#39;%Y-%m-%d %H:%M:%S&#39;</span>
</span></span><span style=display:flex><span>PID<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>ps -ef | grep <span style=color:#e6db74>&#39;/tmpdisk/siphole_back -c /etc/siphole/siphole_back_3.conf&#39;</span> | grep -v <span style=color:#e6db74>&#34;grep&#34;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>kill -9 $PID
</span></span><span style=display:flex><span>/tmpdisk/siphole_back -c /etc/siphole/siphole_back_3.conf
</span></span></code></pre></div><p>crontab</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ae81ff>59</span> <span style=color:#ae81ff>23</span> * * * /tmpdisk/restart_back3.sh &gt;&gt; /tmpdisk/restart_back.txt
</span></span></code></pre></div><p>是否执行成功会输出到日志<code>/tmpdisk/restart_back.txt</code></p><h3 id=使用awk将两个单词位置互换>使用awk将两个单词位置互换</h3><p>文本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># cat a.txt</span>
</span></span><span style=display:flex><span>tian po 
</span></span></code></pre></div><p>处理</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>awk <span style=color:#e6db74>&#39;{temp=$1;$1=$2;$2=temp;print $0}&#39;</span> a.txt
</span></span><span style=display:flex><span>po tian
</span></span></code></pre></div><h3 id=取出文本中指定行指定位置的字段内容>取出文本中指定行指定位置的字段内容</h3><p>文本如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># cat a.txt</span>
</span></span><span style=display:flex><span>root     <span style=color:#ae81ff>4041836</span> <span style=color:#ae81ff>4040563</span>  <span style=color:#ae81ff>0</span> 09:23 pts/0    00:00:00 journalctl _PID<span style=color:#f92672>=</span><span style=color:#ae81ff>2726353</span> -f
</span></span><span style=display:flex><span>root     <span style=color:#ae81ff>4041863</span> <span style=color:#ae81ff>4040563</span>  <span style=color:#ae81ff>0</span> 09:23 pts/0    00:00:00 journalctl _PID<span style=color:#f92672>=</span><span style=color:#ae81ff>3371956</span> -f
</span></span></code></pre></div><p>处理</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>awk <span style=color:#e6db74>&#39;NR==2 {print $2}&#39;</span> a.txt
</span></span><span style=display:flex><span><span style=color:#ae81ff>4041863</span>
</span></span></code></pre></div><p>分析</p><p>在 <code>awk</code> 命令中，<code>NR</code> 是一个内置变量，代表当前正在处理的行数。每次 <code>awk</code> 处理一行文本时，<code>NR</code> 的值都会增加 1。您可以使用 <code>NR</code> 来判断处理的是文件的第几行，并根据需要对特定行执行操作。如果当前行的行号（即 <code>NR</code> 的值）等于 2，则会打印指定的消息。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-04-18</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://example.org/posts/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/ data-title=shell脚本应用（长期更新）><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://example.org/posts/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://example.org/posts/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/ data-title=shell脚本应用（长期更新）><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://example.org/posts/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/ data-title=shell脚本应用（长期更新）><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=http://example.org/posts/shell%E8%84%9A%E6%9C%AC%E5%BA%94%E7%94%A8%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/ data-title=shell脚本应用（长期更新）><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAopenvpn/ class=prev rel=prev title=使用docker搭建openvpn><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>使用docker搭建openvpn</a>
<a href=/posts/ansible%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/ class=next rel=next title=ansible基础教程>ansible基础教程<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.115.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>