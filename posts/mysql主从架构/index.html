<!doctype html><html lang=zh-CN><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content="Mysql主从架构 - https://t.haipengv.com/posts/mysql%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84/"><meta name=author content="Smith - https://t.haipengv.com/"><meta name=msvalidate.01 content="B46311949B856F2A7015F366FB3CE878"><title>Mysql主从架构</title><base target=_blank><link rel=icon type=image/png href=/favicon.ico><link rel=stylesheet href=https://t.haipengv.com/style.min.9a0cea23154ac1941e15c25aa2d31b77285a217d2606ec05b55236428cf1c3e6.css><script>const DARK=!1</script><script type=text/javascript src=/main.js defer></script></head><body class=active-animate><div class=cool-before></div><div id=header><div class=container-header><div class=right><h1 class=title>Mysql主从架构</h1><div id=toc>📜</div></div></div></div><div id=content><div class="container-main container-page"><div class=rel><div class=curtag-desc><a href=https://t.haipengv.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/><img src=/imgs/icons/tag.svg width=16> 相关文章：数据库 <sup>9</sup></a></div><div class=curtag-post><div class=curtag-post-item><a href=https://t.haipengv.com/posts/clickhouse%E6%90%AD%E5%BB%BA%E5%8F%8A%E4%BD%BF%E7%94%A8/>Clickhouse搭建及使用</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/greenplum-db7%E5%AE%B9%E5%99%A8%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85/>Greenplum Db7容器方式安装</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/greenplum-db7%E5%8D%95%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85%E8%AF%B4%E6%98%8E/>GreenplumDb7单节点安装说明</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/greenplumdb7%E6%95%B0%E6%8D%AE%E5%85%A5%E5%BA%93%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96/>Greenplumdb7数据入库速度优化</a></div><div class="curtag-post-item curtag-post-item--active"><a href=https://t.haipengv.com/posts/mysql%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84/>Mysql主从架构</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/mysql%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/>Mysql常用命令总结</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/mysql%E7%9A%84user%E8%A1%A8%E8%AF%A6%E8%A7%A3/>Mysql的user表详解</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/oracle%E7%89%88%E6%9C%AC%E5%8F%B7%E6%9F%A5%E7%9C%8B/>Oracle版本号查看</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/windows%E5%B9%B3%E5%8F%B0%E5%AE%89%E8%A3%85oracle/>Windows平台安装oracle</a></div></div></div><div class=desc><span><svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667l-324.522666 324.48c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334L685.098667 499.2 524.885333 338.986667zM585.258667 278.656l160.170666 160.213333 102.144-102.144a19.712 19.712.0 000-27.861333l-132.48-132.437333a19.456 19.456.0 00-27.605333.0L585.258667 278.613333zM701.312 85.333333c27.946667.0 54.741333 11.136 74.282667 30.848L907.904 248.490667a105.045333 105.045333.0 010 148.565333L424.874667 879.957333C395.050667 914.304 352.768 935.424 304.426667 938.752H85.333333v-42.666667l.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666a104.789333 104.789333.0 0174.24-30.933334z" p-id="7410" fill="#adb5bd"/></svg>2025-03-16&nbsp;&nbsp;&nbsp;<svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859.0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775.0-360.398 149.372-360.398 356.147S305.225 870.23 512 870.23c206.775.0 357.467-151.455 357.467-358.23.0-23.859 23.634-50.706 53.413-50.706 29.78.0 49.92 26.847 49.92 50.706.0 254.493-206.307 460.8-460.8 460.8s-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4.0 226.684 33.296 312.264 117.369.358.351.358-24.052.0-73.209z" p-id="23839" fill="#adb5bd"/></svg>
2025-03-16&nbsp;&nbsp;&nbsp;</span>
<span><svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028c-70.774903.0-128.089859 57.325793-128.089859 128.03206v446.793671c0 70.7171050000001 57.314956 128.154884 128.089859 128.154884h133.353183a63.940169 63.940169.0 0155.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169.0 0155.212517-31.551041h133.54103c70.576219.0 127.732228-57.289669 127.732227-127.800865V192.391272c0-70.536482-57.181295-127.728615-127.786414-127.728615zM895.884854 639.842407A63.85347 63.85347.0 01832.092795 703.703103h-133.54103a127.753903 127.753903.0 00-110.349172 63.09847l-76.222461 129.856342a.274545.274545.0 010-.050574h-.032512s-.021675.061411-.032512.061412l-76.1466-129.85273a127.804477 127.804477.0 00-110.385297-63.11292H192.030028A64.207489 64.207489.0 01127.880338 639.488388V192.694717a64.102729 64.102729.0 0164.14969-64.091891h640.00858a63.799284 63.799284.0 0163.846246 63.788446v447.451135z" fill="#adb5bd" p-id="33867"/><path d="M608.154093 288.092004a31.970084 31.970084.0 00-31.970084 31.970085v160.078006L441.53396 300.861976a31.970084 31.970084.0 00-57.531702 19.200113v255.760676a31.970084 31.970084.0 0063.940169.0V415.863969l134.650048 179.274507a31.970084 31.970084.0 0057.531703-19.200113V320.062089a31.970084 31.970084.0 00-31.970085-31.970085z" fill="#adb5bd" p-id="33868"/></svg>2639 字</span>&nbsp;
<span><svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667zm0 810.666666C307.2 885.333333 138.666667 716.8 138.666667 512S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"/><path d="M695.466667 567.466667 544 497.066667V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666L669.866667 627.2c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8.0 23.466667-6.4 29.866666-19.2 6.4-14.933333.0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"/></svg>6 分钟</span><div class=container-ctgtag><div class=taxonomy><div class=tag><a href=/tags/%E6%95%B0%E6%8D%AE%E5%BA%93>数据库</a></div></div></div></div><div class=toc><div class=container-page-operation><div class=page-operation><div><a href=/><img src=/imgs/icons/home-2.svg alt></a></div><div><a href=/nav><img src=/imgs/icons/iov-navigate-1.svg alt></a></div><div><a href=/wiki><img src=/imgs/icons/wiki.svg alt></a></div><div><a href=/tags><img src=/imgs/icons/treetags.svg alt></a></div><div id=light-dark><a><img src=/imgs/icons/moon2.svg alt></a></div><div><a href=#><img src=/imgs/icons/up2.svg alt></a></div></div></div><nav id=TableOfContents><ul><li><ul><li><a href=#实验环境>实验环境</a></li><li><a href=#安装mysql57>安装mysql5.7</a></li><li><a href=#配置mysql-master主服务器>配置MySQL master主服务器</a></li><li><a href=#配置从服务器>配置从服务器</a></li><li><a href=#验证主从复制结果>验证主从复制结果</a></li><li><a href=#拓展server-id的用途>拓展server-id的用途</a></li><li><a href=#当主库和备库server-id重复时>当主库和备库<code>server-id</code>重复时</a></li><li><a href=#当两个备库server-id重复时>当两个备库<code>server-id</code>重复时</a></li><li><a href=#生成server-id的规则>生成<code>server-id</code>的规则</a></li></ul></li><li><a href=#server-uuid配置><code>server-uuid</code>配置</a><ul><li><a href=#参考资料>参考资料</a></li></ul></li></ul></nav></div><div class=content><h3 id=实验环境>实验环境</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># uname -r </span>
</span></span><span style=display:flex><span>3.10.0-1062.el7.x86_64
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># cat /etc/redhat-release </span>
</span></span><span style=display:flex><span>CentOS Linux release 7.7.1908 <span style=color:#000;font-weight:700>(</span>Core<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># </span>
</span></span></code></pre></td></tr></table></div></div><p>master 10.4.7.11</p><p>slave1 10.4.7.12</p><p>slave2 10.4.7.21</p><h3 id=安装mysql57>安装mysql5.7</h3><h4 id=查询并删除旧的mysql没有可以忽略>查询并删除旧的MySQL(没有可以忽略)</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># rpm  -qa |grep mysql</span>
</span></span><span style=display:flex><span>php-mysql-5.4.16-48.el7.x86_64
</span></span><span style=display:flex><span>mysql57-community-release-el7-9.noarch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># rpm  -e php-mysql-5.4.16-48.el7.x86_64</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=下载mysql源>下载MySQL源</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># wget https://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=repo的安装>repo的安装</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># rpm -ivh mysql57-community-release-el7-9.noarch.rpm </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>warning: mysql57-community-release-el7-9.noarch.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY
</span></span><span style=display:flex><span>Preparing...                          <span style=color:#998;font-style:italic>################################# [100%]</span>
</span></span><span style=display:flex><span>Updating / installing...
</span></span><span style=display:flex><span>   1:mysql57-community-release-el7-9  <span style=color:#998;font-style:italic>################################# [100%]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=开始安装mysql>开始安装MySQL</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum -y install mysql-community-server
</span></span></code></pre></td></tr></table></div></div><h4 id=启动mysql并查看状态>启动mysql并查看状态</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>systemctl start  mysqld.service
</span></span><span style=display:flex><span>systemctl status  mysqld.service
</span></span></code></pre></td></tr></table></div></div><p>● mysqld.service - MySQL Server
Loaded: <strong>loaded</strong> (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)
Active: active (running) since Mon 2022-01-03 18:12:46 CST; 15s ago
Docs: man:mysqld(8)
<a href=http://dev.mysql.com/doc/refman/en/using-systemd.html>http://dev.mysql.com/doc/refman/en/using-systemd.html</a>
Process: 3241 ExecStart=/usr/sbin/mysqld &ndash;daemonize &ndash;pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)
Process: 3187 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)
Main PID: 3244 (mysqld)
CGroup: /system.slice/mysqld.service
└─3244 /usr/sbin/mysqld &ndash;daemonize &ndash;pid-file=/var/run/m&mldr;</p><p>Jan 03 18:12:41 hdss7-11.host.com systemd[1]: Starting MySQL Server&mldr;
Jan 03 18:12:46 hdss7-11.host.com systemd[1]: Started MySQL Server.
Hint: Some lines were ellipsized, use -l to show in full.</p><h4 id=查看版本>查看版本</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql -V
</span></span></code></pre></td></tr></table></div></div><p>mysql Ver 14.14 Distrib 5.7.36, for Linux (x86_64) using EditLine wrapper</p><h4 id=查找系统默认密码>查找系统默认密码</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#0086b3>cd</span> /var/log
</span></span><span style=display:flex><span>grep -e <span style=color:#d14>&#34;password&#34;</span> mysqld.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>A temporary password is generated <span style=color:#000;font-weight:700>for</span> root@localhost: kaNNUw-2y,Gc
</span></span></code></pre></td></tr></table></div></div><h4 id=设置新密码密码修改为ithaipeng123>设置新密码，密码修改为IThaipeng123.</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql -uroot -p 
</span></span><span style=display:flex><span>输入密码kaNNUw-2y,Gc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql&gt; alter user <span style=color:#d14>&#39;root&#39;</span>@<span style=color:#d14>&#39;localhost&#39;</span> identified by <span style=color:#d14>&#39;IThaipeng123.&#39;</span>;
</span></span><span style=display:flex><span>Query OK, <span style=color:#099>0</span> rows affected <span style=color:#000;font-weight:700>(</span>0.01 sec<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>如果有以下报错说明密码强度不够，需要加特殊字符。</strong></p><p>mysql> alter user &lsquo;root&rsquo;@&rsquo;localhost&rsquo; identified by &lsquo;IThaipeng123&rsquo;;
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</p><p><strong>注意：三台服务器安装方法相同，这里只给出一台的说明。</strong></p><p>三台MySQL搭建好之后，需要把时间同步开启，防火墙关闭</p><h4 id=ntp配置>NTP配置</h4><p>NTP服务端：10.4.7.11</p><p>NTP客户端：10.4.7.12 10.4.7.21</p><p><strong>安装ntp服务（三台都需安装）</strong></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum install -y ntp
</span></span></code></pre></td></tr></table></div></div><p>查看ntp安装包</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># rpm -qa |grep ntp</span>
</span></span><span style=display:flex><span>ntp-4.2.6p5-29.el7.centos.2.x86_64
</span></span><span style=display:flex><span>ntpdate-4.2.6p5-29.el7.centos.2.x86_64
</span></span></code></pre></td></tr></table></div></div><p>7.11上修改NTP配置文件</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>vim /etc/ntp.conf
</span></span><span style=display:flex><span>把配置文件下面四行注释掉：
</span></span><span style=display:flex><span>server 0.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 1.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 2.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 3.centos.pool.ntp.org iburst
</span></span><span style=display:flex><span>然后在下面添加这几行：
</span></span><span style=display:flex><span>server 0.cn.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 1.cn.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 2.cn.pool.ntp.org iburst
</span></span><span style=display:flex><span>server 3.cn.pool.ntp.org iburst
</span></span></code></pre></td></tr></table></div></div><p>启动ntp服务，并开机自启</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>systemctl start ntpd
</span></span><span style=display:flex><span>systemctl <span style=color:#0086b3>enable</span> ntpd
</span></span></code></pre></td></tr></table></div></div><p>查看ntp是否同步</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ntpq -p</span>
</span></span><span style=display:flex><span>     remote           refid      st t when poll reach   delay   offset  <span style=color:teal>jitter</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>==============================================================================</span>
</span></span><span style=display:flex><span> ntp5.flashdance 194.58.202.20    <span style=color:#099>2</span> u    <span style=color:#099>1</span>   <span style=color:#099>64</span>    <span style=color:#099>1</span>  318.796   49.178   1.689
</span></span><span style=display:flex><span> time.cloudflare 10.4.3.52        <span style=color:#099>3</span> u    <span style=color:#099>2</span>   <span style=color:#099>64</span>    <span style=color:#099>1</span>  183.991   28.217   4.578
</span></span><span style=display:flex><span> ntp6.flashdance 194.58.202.148   <span style=color:#099>2</span> u    <span style=color:#099>1</span>   <span style=color:#099>64</span>    <span style=color:#099>1</span>  331.954   46.528   5.128
</span></span><span style=display:flex><span> 139.199.214.202 100.122.36.196   <span style=color:#099>2</span> u    <span style=color:#099>2</span>   <span style=color:#099>64</span>    <span style=color:#099>1</span>   72.218   10.343   0.000
</span></span></code></pre></td></tr></table></div></div><p>防火墙开启ntp默认端口udp123(可选，如果没开启防火墙则不用操作此步)</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># firewall-cmd --permanent --zone=public --add-port=123/udp</span>
</span></span><span style=display:flex><span>success
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># firewall-cmd --reload</span>
</span></span><span style=display:flex><span>success
</span></span></code></pre></td></tr></table></div></div><p>NTP 客户端配置</p><p>7.12 7.21 上修改ntp配置文件</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>vim /etc/ntp.conf
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#配置允许NTP Server时间服务器主动修改本机的时间</span>
</span></span><span style=display:flex><span>restrict 10.4.7.11 nomodify notrap noquery
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#注释掉其他时间服务器</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#server 0.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#server 1.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#server 2.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#server 3.centos.pool.ntp.org iburst</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#配置时间服务器为本地搭建的NTP Server服务器</span>
</span></span><span style=display:flex><span>server 10.4.7.11
</span></span></code></pre></td></tr></table></div></div><h4 id=同步主服务器712-721-上操作>同步主服务器(7.12 7.21 上操作）</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-21 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ntpdate -u 10.4.7.11</span>
</span></span><span style=display:flex><span> <span style=color:#099>3</span> Jan 10:53:42 ntpdate<span style=color:#000;font-weight:700>[</span>6675<span style=color:#000;font-weight:700>]</span>: adjust <span style=color:#0086b3>time</span> server 10.4.7.11 offset 0.015245 sec
</span></span></code></pre></td></tr></table></div></div><h4 id=查看ntp同步状态>查看NTP同步状态</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-21 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ntpq -p</span>
</span></span><span style=display:flex><span>     remote           refid      st t when poll reach   delay   offset  <span style=color:teal>jitter</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>==============================================================================</span>
</span></span><span style=display:flex><span> 10.4.7.11       139.199.214.202  <span style=color:#099>3</span> u    <span style=color:#099>1</span>   <span style=color:#099>64</span>    <span style=color:#099>7</span>    0.327   -6.267  15.285
</span></span></code></pre></td></tr></table></div></div><h3 id=配置mysql-master主服务器>配置MySQL master主服务器</h3><h4 id=在etcmycnf-中修改或者增加以下内容>在/etc/my.cnf 中修改或者增加以下内容</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-11 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># tail -n 3 /etc/my.cnf</span>
</span></span><span style=display:flex><span>server-id <span style=color:#000;font-weight:700>=</span> <span style=color:#099>11</span>
</span></span><span style=display:flex><span>log-bin<span style=color:#000;font-weight:700>=</span>master-bin
</span></span><span style=display:flex><span>log-slave-updates<span style=color:#000;font-weight:700>=</span><span style=color:#0086b3>true</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=重启mysql服务>重启mysql服务</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>systemctl  restart mysqld
</span></span></code></pre></td></tr></table></div></div><h4 id=登录mysql程序给服务器授权>登录MySQL程序，给服务器授权</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql -uroot -p
</span></span><span style=display:flex><span>输入密码
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql&gt;grant replication slave on *.* to <span style=color:#d14>&#39;myslave&#39;</span>@<span style=color:#d14>&#39;10.4.7.%&#39;</span> identified by <span style=color:#d14>&#39;Haipengv123456?&#39;</span>;
</span></span><span style=display:flex><span>Query OK, <span style=color:#099>0</span> rows affected, <span style=color:#099>1</span> warning <span style=color:#000;font-weight:700>(</span>0.00 sec<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>mysql&gt; flush privileges;
</span></span><span style=display:flex><span>Query OK, <span style=color:#099>0</span> rows affected <span style=color:#000;font-weight:700>(</span>0.00 sec<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql&gt; show master status;
</span></span><span style=display:flex><span>+-------------------+----------+--------------+------------------+-------------------+
</span></span><span style=display:flex><span>| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
</span></span><span style=display:flex><span>+-------------------+----------+--------------+------------------+-------------------+
</span></span><span style=display:flex><span>| master-bin.000001 |      <span style=color:#099>599</span> |              |                  |                   |
</span></span><span style=display:flex><span>+-------------------+----------+--------------+------------------+-------------------+
</span></span><span style=display:flex><span><span style=color:#099>1</span> row in <span style=color:#0086b3>set</span> <span style=color:#000;font-weight:700>(</span>0.00 sec<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><p>file列显示的日志名，position 列显示偏移量。</p><h3 id=配置从服务器>配置从服务器</h3><p>7-12 server-id = 22</p><p>7-21 server-id = 23</p><h4 id=在etcmycnf-中修改或者增加以下内容-1>在/etc/my.cnf 中修改或者增加以下内容：</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@hdss7-12 ~<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># tail -n 3 /etc/my.cnf</span>
</span></span><span style=display:flex><span>server-id <span style=color:#000;font-weight:700>=</span> <span style=color:#099>22</span>   <span style=color:#998;font-style:italic>## 这里的ID不能与主服务器相同，也不能和其他从服务器相同</span>
</span></span><span style=display:flex><span>relay-log<span style=color:#000;font-weight:700>=</span>relay-log-bin  <span style=color:#998;font-style:italic>## 从主服务器上同步日志到本地</span>
</span></span><span style=display:flex><span>relay-log-index<span style=color:#000;font-weight:700>=</span>slave-relay-bin.index  <span style=color:#998;font-style:italic>## 定义relay-log的位置和名称</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=重启从服务器的mysql>重启从服务器的MySQL</h4><p>登录mysql</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic># mysql -uroot -p</span>
</span></span><span style=display:flex><span>Enter password:
</span></span></code></pre></td></tr></table></div></div><p>配置同步</p><p>根据主服务器的结果来更改下面的master_log_file 和master_log_post 的参数</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql&gt; change master to <span style=color:teal>master_host</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;10.4.7.11&#39;</span>,master_user<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;myslave&#39;</span>,master_password<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;Haipengv123456?&#39;</span>,master_log_file<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;master-bin.000001&#39;</span>,master_log_pos<span style=color:#000;font-weight:700>=</span>599;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Query OK, <span style=color:#099>0</span> rows affected, <span style=color:#099>2</span> warnings <span style=color:#000;font-weight:700>(</span>0.02 sec<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=启动同步>启动同步</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql&gt; start slave;
</span></span><span style=display:flex><span>Query OK, <span style=color:#099>0</span> rows affected <span style=color:#000;font-weight:700>(</span>0.35 sec<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql&gt; 
</span></span></code></pre></td></tr></table></div></div><h4 id=查看slave确保两个值都为yes>查看slave确保两个值都为yes</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql&gt; show slave status <span style=color:#d14>\G</span>
</span></span><span style=display:flex><span>*************************** 1. row ***************************
</span></span><span style=display:flex><span>               Slave_IO_State: Waiting <span style=color:#000;font-weight:700>for</span> master to send event
</span></span><span style=display:flex><span>                  Master_Host: 10.4.7.11
</span></span><span style=display:flex><span>                  Master_User: myslave
</span></span><span style=display:flex><span>                  Master_Port: <span style=color:#099>3306</span>
</span></span><span style=display:flex><span>                Connect_Retry: <span style=color:#099>60</span>
</span></span><span style=display:flex><span>              Master_Log_File: master-bin.000001
</span></span><span style=display:flex><span>          Read_Master_Log_Pos: <span style=color:#099>599</span>
</span></span><span style=display:flex><span>               Relay_Log_File: relay-log-bin.000002
</span></span><span style=display:flex><span>                Relay_Log_Pos: <span style=color:#099>321</span>
</span></span><span style=display:flex><span>        Relay_Master_Log_File: master-bin.000001
</span></span><span style=display:flex><span>             Slave_IO_Running: Yes
</span></span><span style=display:flex><span>            Slave_SQL_Running: Yes
</span></span></code></pre></td></tr></table></div></div><h3 id=验证主从复制结果>验证主从复制结果</h3><h4 id=在主服务器上创建数据库>在主服务器上创建数据库</h4><p>10.4.7.11 主服务器</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql&gt; create database db_test;
</span></span><span style=display:flex><span>Query OK, <span style=color:#099>1</span> row affected <span style=color:#000;font-weight:700>(</span>0.00 sec<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查看主从服务器的数据库是否同步>查看主从服务器的数据库是否同步</h4><p>主服务器：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql&gt; show databases;
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| Database           |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| information_schema |
</span></span><span style=display:flex><span>| db_test            |
</span></span><span style=display:flex><span>| mysql              |
</span></span><span style=display:flex><span>| performance_schema |
</span></span><span style=display:flex><span>| sys                |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span><span style=color:#099>5</span> rows in <span style=color:#0086b3>set</span> <span style=color:#000;font-weight:700>(</span>0.00 sec<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><p>slave1</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql&gt; show databases;
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| Database           |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| information_schema |
</span></span><span style=display:flex><span>| db_test            |
</span></span><span style=display:flex><span>| mysql              |
</span></span><span style=display:flex><span>| performance_schema |
</span></span><span style=display:flex><span>| sys                |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span><span style=color:#099>5</span> rows in <span style=color:#0086b3>set</span> <span style=color:#000;font-weight:700>(</span>0.00 sec<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><p>slave2</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>mysql&gt; show databases;
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| Database           |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| information_schema |
</span></span><span style=display:flex><span>| db_test            |
</span></span><span style=display:flex><span>| mysql              |
</span></span><span style=display:flex><span>| performance_schema |
</span></span><span style=display:flex><span>| sys                |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span><span style=color:#099>5</span> rows in <span style=color:#0086b3>set</span> <span style=color:#000;font-weight:700>(</span>0.00 sec<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=拓展server-id的用途>拓展server-id的用途</h3><p><code>server-id</code>用于标识数据库实例，防止在链式主从、多主多从拓扑中导致<code>SQL</code>语句的无限循环：</p><ol><li>标记<code>binlog event</code>的源实例</li><li>过滤主库<code>binlog</code>，当发现<code>server-id</code>相同时，跳过该<code>event</code>执行，避免无限循环执行。</li><li>如果设置了<code>replicate-same-server-id=1</code>，则执行所有<code>event</code>，但有可能导致无限循环执行<code>SQL</code>语句。</li></ol><p>我们用两个例子来说明<code>server-id</code>为什么不要重复：</p><h3 id=当主库和备库server-id重复时>当主库和备库<code>server-id</code>重复时</h3><p>由于默认情况<code>replicate-same-server-id=0</code>，因此备库会跳过所有主库同步的数据，导致主从数据的不一致。</p><h3 id=当两个备库server-id重复时>当两个备库<code>server-id</code>重复时</h3><p>会导致从库跟主库的连接时断时连，产生大量异常。根据<code>MySQL</code>的设计，主库和从库通过事件机制进行连接和同步，当新的连接到来时，如果发现<code>server-id</code>相同，主库会断开之前的连接并重新注册新连接。当<code>A</code>库连接上主库时，此时<code>B</code>库连接到来，会断开<code>A</code>库连接，<code>A</code>库再进行重连，周而复始导致大量异常信息。</p><h3 id=生成server-id的规则>生成<code>server-id</code>的规则</h3><p>既然<code>server-id</code>不能相同，而当我们有<code>10</code>个实例时，怎么保证每个都不同呢？有几种常用的方法：</p><ol><li>随机数</li><li>时间戳</li><li><code>IP</code>地址+端口</li><li>在管理中心集中分配，生成自增<code>ID</code></li></ol><p>上面的这些方法都可以，但是注意不要超过了最大值<code>2^32-1</code>，同时值最好<code>>2</code>。我采用的方法是<code>IP</code>地址后两位+本机<code>MySQL</code>实例序号，但如果是通过<code>docker</code>来进行管理多实例时，这个怎么生成大家可以想下有没有什么优美的解决方案。</p><h2 id=server-uuid配置><code>server-uuid</code>配置</h2><p><code>MySQL</code>服务会自动创建并生成<code>server-uuid</code>配置：</p><ol><li>读取<code>${data_dir}/auto.cnf</code>文件中的<code>UUID</code></li><li>如果不存在，自动创建文件和生成新的<code>UUID</code>并读取</li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>shell&gt; cat ~/mysql/data/auto.cnf
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>auto<span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>server-uuid<span style=color:#000;font-weight:700>=</span>fd5d03bc-cfde-11e9-ae59-48d539355108
</span></span></code></pre></td></tr></table></div></div><p>这个<code>auto.cnf</code>配置风格类似于<code>my.cnf</code>，但这个文件只包含一个<code>auto</code>配置块和一行<code>server-uuid</code>配置。它是自动创建的，因此不要修改它的内容。</p><p>在主从拓扑中，主从可以知道互相的<code>UUID</code>，在主机上使用<code>show slave hosts</code>，在从机上使用<code>show slave status</code>查看<code>Master_UUID</code>字段。</p><p><code>server-uuid</code>参数并不能取代<code>server-id</code>，他们有不同的作用。当主从同步时如果主从实例的<code>server-uuid</code>相同会报错退出，不过我们可以通过设置<code>replicate-same-server-id=1</code>来避免报错（不推荐）。</p><h3 id=参考资料>参考资料</h3><p><a href=https://segmentfault.com/a/1190000020315036>参考</a></p></div></div></div><div id=footer><div class=container-footer><div class=beian><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="></a><a href target=_blank><span class=some>icp...<span></a></div><div class=info><a href=https://github.com/loveminimal/hugo-theme-virgo>🕊️</a> 2021 - <span id=info-date></span></div></div></div><div class=cool-after></div></body></html>