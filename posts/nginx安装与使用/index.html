<!doctype html><html lang=zh-CN><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content="Nginx安装与使用 - https://t.haipengv.com/posts/nginx%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"><meta name=author content="Smith - https://t.haipengv.com/"><meta name=msvalidate.01 content="B46311949B856F2A7015F366FB3CE878"><title>Nginx安装与使用</title><base target=_blank><link rel=icon type=image/png href=/favicon.ico><link rel=stylesheet href=https://t.haipengv.com/style.min.9a0cea23154ac1941e15c25aa2d31b77285a217d2606ec05b55236428cf1c3e6.css><script>const DARK=!1</script><script type=text/javascript src=/main.js defer></script></head><body class=active-animate><div class=cool-before></div><div id=header><div class=container-header><div class=right><h1 class=title>Nginx安装与使用</h1><div id=toc>📜</div></div></div></div><div id=content><div class="container-main container-page"><div class=rel><div class=curtag-desc><a href=https://t.haipengv.com/tags/web/><img src=/imgs/icons/tag.svg width=16> 相关文章：Web <sup>6</sup></a></div><div class=curtag-post><div class=curtag-post-item><a href=https://t.haipengv.com/posts/caddy%E5%BC%80%E6%BA%90web%E6%9C%8D%E5%8A%A1%E5%99%A8/>Caddy开源web服务器</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/django/>Django</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/flask%E5%85%A5%E9%97%A8/>Flask入门</a></div><div class="curtag-post-item curtag-post-item--active"><a href=https://t.haipengv.com/posts/nginx%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/>Nginx安装与使用</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/seatunnel%E5%8F%8Aseatunnel-web%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/>SeaTunnel及SeaTunnelWeb部署指南</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/>前端框架</a></div></div></div><div class=desc><span><svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667l-324.522666 324.48c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334L685.098667 499.2 524.885333 338.986667zM585.258667 278.656l160.170666 160.213333 102.144-102.144a19.712 19.712.0 000-27.861333l-132.48-132.437333a19.456 19.456.0 00-27.605333.0L585.258667 278.613333zM701.312 85.333333c27.946667.0 54.741333 11.136 74.282667 30.848L907.904 248.490667a105.045333 105.045333.0 010 148.565333L424.874667 879.957333C395.050667 914.304 352.768 935.424 304.426667 938.752H85.333333v-42.666667l.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666a104.789333 104.789333.0 0174.24-30.933334z" p-id="7410" fill="#adb5bd"/></svg>2025-03-16&nbsp;&nbsp;&nbsp;<svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859.0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775.0-360.398 149.372-360.398 356.147S305.225 870.23 512 870.23c206.775.0 357.467-151.455 357.467-358.23.0-23.859 23.634-50.706 53.413-50.706 29.78.0 49.92 26.847 49.92 50.706.0 254.493-206.307 460.8-460.8 460.8s-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4.0 226.684 33.296 312.264 117.369.358.351.358-24.052.0-73.209z" p-id="23839" fill="#adb5bd"/></svg>
2025-03-16&nbsp;&nbsp;&nbsp;</span>
<span><svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028c-70.774903.0-128.089859 57.325793-128.089859 128.03206v446.793671c0 70.7171050000001 57.314956 128.154884 128.089859 128.154884h133.353183a63.940169 63.940169.0 0155.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169.0 0155.212517-31.551041h133.54103c70.576219.0 127.732228-57.289669 127.732227-127.800865V192.391272c0-70.536482-57.181295-127.728615-127.786414-127.728615zM895.884854 639.842407A63.85347 63.85347.0 01832.092795 703.703103h-133.54103a127.753903 127.753903.0 00-110.349172 63.09847l-76.222461 129.856342a.274545.274545.0 010-.050574h-.032512s-.021675.061411-.032512.061412l-76.1466-129.85273a127.804477 127.804477.0 00-110.385297-63.11292H192.030028A64.207489 64.207489.0 01127.880338 639.488388V192.694717a64.102729 64.102729.0 0164.14969-64.091891h640.00858a63.799284 63.799284.0 0163.846246 63.788446v447.451135z" fill="#adb5bd" p-id="33867"/><path d="M608.154093 288.092004a31.970084 31.970084.0 00-31.970084 31.970085v160.078006L441.53396 300.861976a31.970084 31.970084.0 00-57.531702 19.200113v255.760676a31.970084 31.970084.0 0063.940169.0V415.863969l134.650048 179.274507a31.970084 31.970084.0 0057.531703-19.200113V320.062089a31.970084 31.970084.0 00-31.970085-31.970085z" fill="#adb5bd" p-id="33868"/></svg>8858 字</span>&nbsp;
<span><svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667zm0 810.666666C307.2 885.333333 138.666667 716.8 138.666667 512S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"/><path d="M695.466667 567.466667 544 497.066667V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666L669.866667 627.2c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8.0 23.466667-6.4 29.866666-19.2 6.4-14.933333.0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"/></svg>18 分钟</span><div class=container-ctgtag><div class=taxonomy><div class=tag><a href=/tags/web>Web</a></div></div></div></div><div class=toc><div class=container-page-operation><div class=page-operation><div><a href=/><img src=/imgs/icons/home-2.svg alt></a></div><div><a href=/nav><img src=/imgs/icons/iov-navigate-1.svg alt></a></div><div><a href=/wiki><img src=/imgs/icons/wiki.svg alt></a></div><div><a href=/tags><img src=/imgs/icons/treetags.svg alt></a></div><div id=light-dark><a><img src=/imgs/icons/moon2.svg alt></a></div><div><a href=#><img src=/imgs/icons/up2.svg alt></a></div></div></div><nav id=TableOfContents><ul><li><a href=#nginx-1161-安装使用说明>nginx 1.16.1 安装使用说明</a><ul><li><a href=#config-编译参数>config 编译参数</a></li></ul></li><li><a href=#nginx-的进程模型>nginx 的进程模型</a><ul><li><a href=#nginx事件处理异步非阻塞>nginx事件处理。异步非阻塞。</a></li></ul></li><li><a href=#配置文件详解>配置文件详解：</a></li><li><a href=#常见pid报错>常见pid报错</a><ul><li><a href=#nginxpid打开失败>nginx.pid打开失败：</a></li></ul></li><li><a href=#日志切割手动>日志切割：(手动)</a></li><li><a href=#日志切割定时>日志切割：(定时)</a></li><li><a href=#虚拟主机-使用nginx为静态资源提供服务>虚拟主机-使用nginx为静态资源提供服务</a></li><li><a href=#gzip压缩提升请求效率>gzip压缩提升请求效率</a></li><li><a href=#location匹配规则>location匹配规则</a></li><li><a href=#dns解析域名>DNS解析域名</a></li><li><a href=#用switchhosts-模拟本地域名解析访问>用switchhosts 模拟本地域名解析访问</a></li><li><a href=#跨域访问>跨域访问</a></li><li><a href=#nginx-防盗链技术支持>nginx 防盗链技术支持</a></li><li><a href=#nginx-模块化体系>nginx 模块化体系</a></li><li><a href=#负载均衡>负载均衡</a><ul><li><a href=#四层负载均衡>四层负载均衡</a></li><li><a href=#七层负载均衡>七层负载均衡</a></li><li><a href=#dns-地域负载均衡>DNS 地域负载均衡</a></li></ul></li><li><a href=#使用nginx搭建三台tomcat集群>使用Nginx搭建三台tomcat集群</a></li><li><a href=#负载均衡之轮询>负载均衡之轮询</a></li><li><a href=#负载均衡之权重-加权轮询>负载均衡之权重-加权轮询</a></li><li><a href=#upstream-指令参数>upstream 指令参数</a></li><li><a href=#使用keepalive提高吞吐量>使用keepalive提高吞吐量</a></li><li><a href=#负载均衡之ip_hash>负载均衡之ip_hash</a><ul><li><a href=#负载均衡之url_hash>负载均衡之<strong>url_hash</strong></a></li></ul></li><li><a href=#nginx控制浏览器缓存>nginx控制浏览器缓存</a></li><li><a href=#上游服务静态内容缓存>上游服务静态内容缓存</a></li><li><a href=#使用nginx-配置https域名证书>使用nginx 配置https域名证书</a></li><li><a href=#配置ssl>配置ssl</a></li><li><a href=#动静分离>动静分离</a></li><li><a href=#nginx高可用ha-keepalived-双机主备>nginx高可用HA keepalived 双机主备</a></li><li><a href=#安装keepalived>安装keepalived</a><ul><li><a href=#核心配置文件>核心配置文件：</a></li><li><a href=#keepalived配置nginx自动启动>keepalived配置Nginx自动启动</a></li></ul></li></ul></nav></div><div class=content><h2 id=nginx-1161-安装使用说明>nginx 1.16.1 安装使用说明</h2><p>1.创建目录</p><p>mkdir -p /var/temp/nginx</p><p>下载：</p><p><a href=https://nginx.org/en/download.html>https://nginx.org/en/download.html</a></p><p>解压</p><p>tar -zxvf nginx-1.16.1.tar.gz</p><p>安装编译依赖包：</p><p>yum install -y gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</p><p>2.进入nginx-1.16.1</p><p>编译参数</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>./configure <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--prefix<span style=color:#000;font-weight:700>=</span>/usr/local/nginx <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--pid-path<span style=color:#000;font-weight:700>=</span>/var/run/nginx/nginx.pid <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--lock-path<span style=color:#000;font-weight:700>=</span>/var/lock/nginx.lock <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--error-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/error.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/access.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--with-http_gzip_static_module <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-client-body-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/client <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-proxy-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/proxy <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-fastcgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/fastcgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-uwsgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/uwsgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-scgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/scgi
</span></span></code></pre></td></tr></table></div></div><p><a href=https://nginx.org/en/download.html>https://nginx.org/en/download.html</a></p><h3 id=config-编译参数>config 编译参数</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>nginx1.16编译安装configure参数：
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@363ee3055cf0 nginx-1.16.1<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ./configure --help</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --help                             print this message 打印帮助信息
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --prefix<span style=color:#000;font-weight:700>=</span>PATH                      <span style=color:#0086b3>set</span> installation prefix 设置安装目录
</span></span><span style=display:flex><span>  --sbin-path<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> nginx binary pathname 设置sbin路径
</span></span><span style=display:flex><span>  --modules-path<span style=color:#000;font-weight:700>=</span>PATH                <span style=color:#0086b3>set</span> modules path 设置模块路径
</span></span><span style=display:flex><span>  --conf-path<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> nginx.conf pathname 设置配置文件路径
</span></span><span style=display:flex><span>  --error-log-path<span style=color:#000;font-weight:700>=</span>PATH              <span style=color:#0086b3>set</span> error log pathname 设置错误日志的路径
</span></span><span style=display:flex><span>  --pid-path<span style=color:#000;font-weight:700>=</span>PATH                    <span style=color:#0086b3>set</span> nginx.pid pathname 设置pid路径
</span></span><span style=display:flex><span>  --lock-path<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> nginx.lock pathname 设置锁路径
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --user<span style=color:#000;font-weight:700>=</span>USER                        <span style=color:#0086b3>set</span> non-privileged user <span style=color:#000;font-weight:700>for</span> 设置用户
</span></span><span style=display:flex><span>                                     worker processes
</span></span><span style=display:flex><span>  --group<span style=color:#000;font-weight:700>=</span>GROUP                      <span style=color:#0086b3>set</span> non-privileged group <span style=color:#000;font-weight:700>for</span> 设置组
</span></span><span style=display:flex><span>                                     worker processes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --build<span style=color:#000;font-weight:700>=</span>NAME                       <span style=color:#0086b3>set</span> build name 设置构建名
</span></span><span style=display:flex><span>  --builddir<span style=color:#000;font-weight:700>=</span>DIR                     <span style=color:#0086b3>set</span> build directory 设置构建文件夹
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-select_module               <span style=color:#0086b3>enable</span> <span style=color:#000;font-weight:700>select</span> module 开启select模块
</span></span><span style=display:flex><span>  --without-select_module            disable <span style=color:#000;font-weight:700>select</span> module关闭
</span></span><span style=display:flex><span>  --with-poll_module                 <span style=color:#0086b3>enable</span> poll module
</span></span><span style=display:flex><span>  --without-poll_module              disable poll module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-threads                     <span style=color:#0086b3>enable</span> thread pool support
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-file-aio                    <span style=color:#0086b3>enable</span> file AIO support
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-http_ssl_module             <span style=color:#0086b3>enable</span> ngx_http_ssl_module
</span></span><span style=display:flex><span>  --with-http_v2_module              <span style=color:#0086b3>enable</span> ngx_http_v2_module
</span></span><span style=display:flex><span>  --with-http_realip_module          <span style=color:#0086b3>enable</span> ngx_http_realip_module
</span></span><span style=display:flex><span>  --with-http_addition_module        <span style=color:#0086b3>enable</span> ngx_http_addition_module
</span></span><span style=display:flex><span>  --with-http_xslt_module            <span style=color:#0086b3>enable</span> ngx_http_xslt_module
</span></span><span style=display:flex><span>  --with-http_xslt_module<span style=color:#000;font-weight:700>=</span>dynamic    <span style=color:#0086b3>enable</span> dynamic ngx_http_xslt_module
</span></span><span style=display:flex><span>  --with-http_image_filter_module    <span style=color:#0086b3>enable</span> ngx_http_image_filter_module
</span></span><span style=display:flex><span>  --with-http_image_filter_module<span style=color:#000;font-weight:700>=</span>dynamic
</span></span><span style=display:flex><span>                                     <span style=color:#0086b3>enable</span> dynamic ngx_http_image_filter_module
</span></span><span style=display:flex><span>  --with-http_geoip_module           <span style=color:#0086b3>enable</span> ngx_http_geoip_module
</span></span><span style=display:flex><span>  --with-http_geoip_module<span style=color:#000;font-weight:700>=</span>dynamic   <span style=color:#0086b3>enable</span> dynamic ngx_http_geoip_module
</span></span><span style=display:flex><span>  --with-http_sub_module             <span style=color:#0086b3>enable</span> ngx_http_sub_module
</span></span><span style=display:flex><span>  --with-http_dav_module             <span style=color:#0086b3>enable</span> ngx_http_dav_module
</span></span><span style=display:flex><span>  --with-http_flv_module             <span style=color:#0086b3>enable</span> ngx_http_flv_module
</span></span><span style=display:flex><span>  --with-http_mp4_module             <span style=color:#0086b3>enable</span> ngx_http_mp4_module
</span></span><span style=display:flex><span>  --with-http_gunzip_module          <span style=color:#0086b3>enable</span> ngx_http_gunzip_module
</span></span><span style=display:flex><span>  --with-http_gzip_static_module     <span style=color:#0086b3>enable</span> ngx_http_gzip_static_module
</span></span><span style=display:flex><span>  --with-http_auth_request_module    <span style=color:#0086b3>enable</span> ngx_http_auth_request_module
</span></span><span style=display:flex><span>  --with-http_random_index_module    <span style=color:#0086b3>enable</span> ngx_http_random_index_module
</span></span><span style=display:flex><span>  --with-http_secure_link_module     <span style=color:#0086b3>enable</span> ngx_http_secure_link_module
</span></span><span style=display:flex><span>  --with-http_degradation_module     <span style=color:#0086b3>enable</span> ngx_http_degradation_module
</span></span><span style=display:flex><span>  --with-http_slice_module           <span style=color:#0086b3>enable</span> ngx_http_slice_module
</span></span><span style=display:flex><span>  --with-http_stub_status_module     <span style=color:#0086b3>enable</span> ngx_http_stub_status_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --without-http_charset_module      disable ngx_http_charset_module
</span></span><span style=display:flex><span>  --without-http_gzip_module         disable ngx_http_gzip_module
</span></span><span style=display:flex><span>  --without-http_ssi_module          disable ngx_http_ssi_module
</span></span><span style=display:flex><span>  --without-http_userid_module       disable ngx_http_userid_module
</span></span><span style=display:flex><span>  --without-http_access_module       disable ngx_http_access_module
</span></span><span style=display:flex><span>  --without-http_auth_basic_module   disable ngx_http_auth_basic_module
</span></span><span style=display:flex><span>  --without-http_mirror_module       disable ngx_http_mirror_module
</span></span><span style=display:flex><span>  --without-http_autoindex_module    disable ngx_http_autoindex_module
</span></span><span style=display:flex><span>  --without-http_geo_module          disable ngx_http_geo_module
</span></span><span style=display:flex><span>  --without-http_map_module          disable ngx_http_map_module
</span></span><span style=display:flex><span>  --without-http_split_clients_module disable ngx_http_split_clients_module
</span></span><span style=display:flex><span>  --without-http_referer_module      disable ngx_http_referer_module
</span></span><span style=display:flex><span>  --without-http_rewrite_module      disable ngx_http_rewrite_module
</span></span><span style=display:flex><span>  --without-http_proxy_module        disable ngx_http_proxy_module
</span></span><span style=display:flex><span>  --without-http_fastcgi_module      disable ngx_http_fastcgi_module
</span></span><span style=display:flex><span>  --without-http_uwsgi_module        disable ngx_http_uwsgi_module
</span></span><span style=display:flex><span>  --without-http_scgi_module         disable ngx_http_scgi_module
</span></span><span style=display:flex><span>  --without-http_grpc_module         disable ngx_http_grpc_module
</span></span><span style=display:flex><span>  --without-http_memcached_module    disable ngx_http_memcached_module
</span></span><span style=display:flex><span>  --without-http_limit_conn_module   disable ngx_http_limit_conn_module
</span></span><span style=display:flex><span>  --without-http_limit_req_module    disable ngx_http_limit_req_module
</span></span><span style=display:flex><span>  --without-http_empty_gif_module    disable ngx_http_empty_gif_module
</span></span><span style=display:flex><span>  --without-http_browser_module      disable ngx_http_browser_module
</span></span><span style=display:flex><span>  --without-http_upstream_hash_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_hash_module
</span></span><span style=display:flex><span>  --without-http_upstream_ip_hash_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_ip_hash_module
</span></span><span style=display:flex><span>  --without-http_upstream_least_conn_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_least_conn_module
</span></span><span style=display:flex><span>  --without-http_upstream_random_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_random_module
</span></span><span style=display:flex><span>  --without-http_upstream_keepalive_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_keepalive_module
</span></span><span style=display:flex><span>  --without-http_upstream_zone_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_zone_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-http_perl_module            <span style=color:#0086b3>enable</span> ngx_http_perl_module
</span></span><span style=display:flex><span>  --with-http_perl_module<span style=color:#000;font-weight:700>=</span>dynamic    <span style=color:#0086b3>enable</span> dynamic ngx_http_perl_module
</span></span><span style=display:flex><span>  --with-perl_modules_path<span style=color:#000;font-weight:700>=</span>PATH      <span style=color:#0086b3>set</span> Perl modules path
</span></span><span style=display:flex><span>  --with-perl<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> perl binary pathname
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --http-log-path<span style=color:#000;font-weight:700>=</span>PATH               <span style=color:#0086b3>set</span> http access log pathname
</span></span><span style=display:flex><span>  --http-client-body-temp-path<span style=color:#000;font-weight:700>=</span>PATH  <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http client request body temporary files
</span></span><span style=display:flex><span>  --http-proxy-temp-path<span style=color:#000;font-weight:700>=</span>PATH        <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http proxy temporary files
</span></span><span style=display:flex><span>  --http-fastcgi-temp-path<span style=color:#000;font-weight:700>=</span>PATH      <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http fastcgi temporary files
</span></span><span style=display:flex><span>  --http-uwsgi-temp-path<span style=color:#000;font-weight:700>=</span>PATH        <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http uwsgi temporary files
</span></span><span style=display:flex><span>  --http-scgi-temp-path<span style=color:#000;font-weight:700>=</span>PATH         <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http scgi temporary files
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --without-http                     disable HTTP server
</span></span><span style=display:flex><span>  --without-http-cache               disable HTTP cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-mail                        <span style=color:#0086b3>enable</span> POP3/IMAP4/SMTP proxy module
</span></span><span style=display:flex><span>  --with-mail<span style=color:#000;font-weight:700>=</span>dynamic                <span style=color:#0086b3>enable</span> dynamic POP3/IMAP4/SMTP proxy module
</span></span><span style=display:flex><span>  --with-mail_ssl_module             <span style=color:#0086b3>enable</span> ngx_mail_ssl_module
</span></span><span style=display:flex><span>  --without-mail_pop3_module         disable ngx_mail_pop3_module
</span></span><span style=display:flex><span>  --without-mail_imap_module         disable ngx_mail_imap_module
</span></span><span style=display:flex><span>  --without-mail_smtp_module         disable ngx_mail_smtp_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-stream                      <span style=color:#0086b3>enable</span> TCP/UDP proxy module
</span></span><span style=display:flex><span>  --with-stream<span style=color:#000;font-weight:700>=</span>dynamic              <span style=color:#0086b3>enable</span> dynamic TCP/UDP proxy module
</span></span><span style=display:flex><span>  --with-stream_ssl_module           <span style=color:#0086b3>enable</span> ngx_stream_ssl_module
</span></span><span style=display:flex><span>  --with-stream_realip_module        <span style=color:#0086b3>enable</span> ngx_stream_realip_module
</span></span><span style=display:flex><span>  --with-stream_geoip_module         <span style=color:#0086b3>enable</span> ngx_stream_geoip_module
</span></span><span style=display:flex><span>  --with-stream_geoip_module<span style=color:#000;font-weight:700>=</span>dynamic <span style=color:#0086b3>enable</span> dynamic ngx_stream_geoip_module
</span></span><span style=display:flex><span>  --with-stream_ssl_preread_module   <span style=color:#0086b3>enable</span> ngx_stream_ssl_preread_module
</span></span><span style=display:flex><span>  --without-stream_limit_conn_module disable ngx_stream_limit_conn_module
</span></span><span style=display:flex><span>  --without-stream_access_module     disable ngx_stream_access_module
</span></span><span style=display:flex><span>  --without-stream_geo_module        disable ngx_stream_geo_module
</span></span><span style=display:flex><span>  --without-stream_map_module        disable ngx_stream_map_module
</span></span><span style=display:flex><span>  --without-stream_split_clients_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_split_clients_module
</span></span><span style=display:flex><span>  --without-stream_return_module     disable ngx_stream_return_module
</span></span><span style=display:flex><span>  --without-stream_upstream_hash_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_hash_module
</span></span><span style=display:flex><span>  --without-stream_upstream_least_conn_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_least_conn_module
</span></span><span style=display:flex><span>  --without-stream_upstream_random_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_random_module
</span></span><span style=display:flex><span>  --without-stream_upstream_zone_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_zone_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-google_perftools_module     <span style=color:#0086b3>enable</span> ngx_google_perftools_module
</span></span><span style=display:flex><span>  --with-cpp_test_module             <span style=color:#0086b3>enable</span> ngx_cpp_test_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --add-module<span style=color:#000;font-weight:700>=</span>PATH                  <span style=color:#0086b3>enable</span> external module
</span></span><span style=display:flex><span>  --add-dynamic-module<span style=color:#000;font-weight:700>=</span>PATH          <span style=color:#0086b3>enable</span> dynamic external module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-compat                      dynamic modules compatibility
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-cc<span style=color:#000;font-weight:700>=</span>PATH                     <span style=color:#0086b3>set</span> C compiler pathname
</span></span><span style=display:flex><span>  --with-cpp<span style=color:#000;font-weight:700>=</span>PATH                    <span style=color:#0086b3>set</span> C preprocessor pathname
</span></span><span style=display:flex><span>  --with-cc-opt<span style=color:#000;font-weight:700>=</span>OPTIONS              <span style=color:#0086b3>set</span> additional C compiler options
</span></span><span style=display:flex><span>  --with-ld-opt<span style=color:#000;font-weight:700>=</span>OPTIONS              <span style=color:#0086b3>set</span> additional linker options
</span></span><span style=display:flex><span>  --with-cpu-opt<span style=color:#000;font-weight:700>=</span>CPU                 build <span style=color:#000;font-weight:700>for</span> the specified CPU, valid values:
</span></span><span style=display:flex><span>                                     pentium, pentiumpro, pentium3, pentium4,
</span></span><span style=display:flex><span>                                     athlon, opteron, sparc32, sparc64, ppc64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --without-pcre                     disable PCRE library usage
</span></span><span style=display:flex><span>  --with-pcre                        force PCRE library usage
</span></span><span style=display:flex><span>  --with-pcre<span style=color:#000;font-weight:700>=</span>DIR                    <span style=color:#0086b3>set</span> path to PCRE library sources
</span></span><span style=display:flex><span>  --with-pcre-opt<span style=color:#000;font-weight:700>=</span>OPTIONS            <span style=color:#0086b3>set</span> additional build options <span style=color:#000;font-weight:700>for</span> PCRE
</span></span><span style=display:flex><span>  --with-pcre-jit                    build PCRE with JIT compilation support
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-zlib<span style=color:#000;font-weight:700>=</span>DIR                    <span style=color:#0086b3>set</span> path to zlib library sources
</span></span><span style=display:flex><span>  --with-zlib-opt<span style=color:#000;font-weight:700>=</span>OPTIONS            <span style=color:#0086b3>set</span> additional build options <span style=color:#000;font-weight:700>for</span> zlib
</span></span><span style=display:flex><span>  --with-zlib-asm<span style=color:#000;font-weight:700>=</span>CPU                use zlib assembler sources optimized
</span></span><span style=display:flex><span>                                     <span style=color:#000;font-weight:700>for</span> the specified CPU, valid values:
</span></span><span style=display:flex><span>                                     pentium, pentiumpro
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-libatomic                   force libatomic_ops library usage
</span></span><span style=display:flex><span>  --with-libatomic<span style=color:#000;font-weight:700>=</span>DIR               <span style=color:#0086b3>set</span> path to libatomic_ops library sources
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-openssl<span style=color:#000;font-weight:700>=</span>DIR                 <span style=color:#0086b3>set</span> path to OpenSSL library sources
</span></span><span style=display:flex><span>  --with-openssl-opt<span style=color:#000;font-weight:700>=</span>OPTIONS         <span style=color:#0086b3>set</span> additional build options <span style=color:#000;font-weight:700>for</span> OpenSSL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-debug                       <span style=color:#0086b3>enable</span> debug logging
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic>#编译</span>
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#安装</span>
</span></span><span style=display:flex><span>make install 
</span></span></code></pre></td></tr></table></div></div><p>whereis nginx</p><p>在/usr/local/nginx/sbin/内</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>./nginx 启动
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> ./nginx -s stop 强制停止
</span></span><span style=display:flex><span> ./nginx -s quit 优雅停止
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./nginx -s reload 重新加载
</span></span><span style=display:flex><span>./nginx -t 配置检测
</span></span><span style=display:flex><span>./nginx -v 版本信息
</span></span><span style=display:flex><span>./nginx -V 详细信息
</span></span><span style=display:flex><span>./nginx -h 帮助
</span></span><span style=display:flex><span>./nginx -c 指定配置文件
</span></span></code></pre></td></tr></table></div></div><p>注意：</p><p>1.云服务器需要默认开启nginx 80</p><p>2.虚拟机安装，需要关闭防火墙</p><p>3.本机win或mac需要关闭防火墙</p><p>nginx.conf</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>80</span>; 						<span style=color:#a61717;background-color:#e3d2d2>#</span>监听端口
</span></span><span style=display:flex><span>        server_name  localhost;					<span style=color:#a61717;background-color:#e3d2d2>#</span>域名
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {							<span style=color:#a61717;background-color:#e3d2d2>#</span> <span style=color:#000;font-weight:700>/</span> 从根开始匹配<span style=color:#a61717;background-color:#e3d2d2>。</span>html文件夹内的index index.html index.htm
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  index.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        error_page   <span style=color:#099>500</span> <span style=color:#099>502</span> <span style=color:#099>503</span> <span style=color:#099>504</span>  <span style=color:#000;font-weight:700>/</span><span style=color:#099>50</span>x.html;   <span style=color:#a61717;background-color:#e3d2d2>#</span>匹配不到自动转到错误页<span style=color:#a61717;background-color:#e3d2d2>。</span>html<span style=color:#000;font-weight:700>/</span><span style=color:#099>50</span>x.html 
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>=</span> <span style=color:#a61717;background-color:#e3d2d2>/50x.html {</span>
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>更改 80 端口后需重新加载。</p><p>cd /usr/local/nginx/sbin</p><p>./nginx -s reload</p><p>访问：ip+监听端口</p><h2 id=nginx-的进程模型>nginx 的进程模型</h2><p>master 主进程</p><p>worker 工作进程</p><p>worker_processes 2; # 默认为1,配置为n-1 .n为cpu数量。</p><h3 id=nginx事件处理异步非阻塞>nginx事件处理。异步非阻塞。</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>events {
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> 默认使用epoll
</span></span><span style=display:flex><span>    use epoll;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> 每个worker 允许连接的客户端最大连接数
</span></span><span style=display:flex><span>    worker_connections  <span style=color:#099>10240</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=配置文件详解>配置文件详解：</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>89</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>/usr/local/nginx/html/imooc.html</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:navy>html</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>title</span>&gt;Welcome to immoc!&lt;/<span style=color:navy>title</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>style</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:navy>body</span> {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>width</span>: <span style=color:#099>35</span><span style=color:#458;font-weight:700>em</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>margin</span>: <span style=color:#099>0</span> <span style=color:#000;font-weight:700>auto</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>font-family</span>: Tahoma, Verdana, Arial, <span style=color:#000;font-weight:700>sans-serif</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>style</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>body</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>h1</span>&gt;Welcome imooc!&lt;/<span style=color:navy>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>html</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>或者：</p><p>nginx.conf中添加</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>  include       imooc.conf;
</span></span></code></pre></td></tr></table></div></div><p>创建imooc.conf文件。</p><p>/usr/local/nginx/conf/imooc.conf</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>   server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>89</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>每次更改后都要重启服务。</p><h2 id=常见pid报错>常见pid报错</h2><h3 id=nginxpid打开失败>nginx.pid打开失败：</h3><p>1.nginx: [error] invalid PID number "" in &ldquo;/usr/local/nginx/logs/nginx.pid&rdquo;</p><p>解决方法：</p><p>使用nginx -c的参数指定nginx.conf文件的位置
然后再重新启动，解决问题，可以通过ps -ef|grep nginx 看到服务已经启动成功。</p><p>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</p><p>2.nginx: [error] open() &ldquo;/var/run/nginx/nginx.pid&rdquo; failed (2: No such file or directory)</p><p>提示信息说明在 <strong>/var/run/nginx/</strong> 目录下找不到 <strong>nginx.pid</strong> 文件，解决方式有两种</p><p>第一种方式：创建默认目录 <strong>/var/run/nginx/</strong> ；</p><p>第二种方式：修改 <strong>nginx.conf</strong> 文件，指定 <strong>pid文件</strong> 所在目录。</p><h2 id=日志切割手动>日志切割：(手动)</h2><p>cat_my_log.sh</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span><span style=color:teal>LOG_PATH</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;/var/log/nginx/&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>RECORD_TIME</span><span style=color:#000;font-weight:700>=</span><span style=color:#000;font-weight:700>$(</span>date -d <span style=color:#d14>&#34;yesterday&#34;</span> +%Y-%m-%d+%H:%M<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:teal>PID</span><span style=color:#000;font-weight:700>=</span>/var/run/nginx/nginx.pid
</span></span><span style=display:flex><span>mv <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/access.log <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/access.<span style=color:#d14>${</span><span style=color:teal>RECORD_TIME</span><span style=color:#d14>}</span>.log
</span></span><span style=display:flex><span>mv <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/error.log <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/error.<span style=color:#d14>${</span><span style=color:teal>RECORD_TIME</span><span style=color:#d14>}</span>.log
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#向nginx主进程发送信号，用于重新打开日志文件</span>
</span></span><span style=display:flex><span><span style=color:#0086b3>kill</span> -USR1 <span style=color:#d14>`</span>cat <span style=color:teal>$PID</span><span style=color:#d14>`</span>
</span></span></code></pre></td></tr></table></div></div><p>chmod +x cat_my_log.sh</p><h2 id=日志切割定时>日志切割：(定时)</h2><p>1.安装定时任务</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum install crontabs
</span></span></code></pre></td></tr></table></div></div><p>2.crontab -e 编辑并添加一行新的任务</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>*/1 * * * * /usr/local/nginx/sbin/cut_my_log.sh
</span></span></code></pre></td></tr></table></div></div><p>3.重启定时任务</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>service crond restart 
</span></span></code></pre></td></tr></table></div></div><p>4.常用定时任务</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>service crond start 
</span></span><span style=display:flex><span>service crond stop 
</span></span><span style=display:flex><span>service crond reload <span style=color:#998;font-style:italic>#重新加载</span>
</span></span><span style=display:flex><span>service crond restart  <span style=color:#998;font-style:italic>#重启服务</span>
</span></span><span style=display:flex><span>crontab -l <span style=color:#998;font-style:italic>#查看任务列表</span>
</span></span><span style=display:flex><span>crontab -e <span style=color:#998;font-style:italic># 编辑任务</span>
</span></span></code></pre></td></tr></table></div></div><p>每分钟执行</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>*/1 * * * *
</span></span></code></pre></td></tr></table></div></div><p>每日凌晨（每天晚上23：59）执行：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#099>59</span> <span style=color:#099>23</span> * * *
</span></span></code></pre></td></tr></table></div></div><p>每日凌晨1点执行：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#099>0</span> <span style=color:#099>1</span> * * *
</span></span></code></pre></td></tr></table></div></div><p>每天为数据库定时备份：<a href=https://www.cnblogs.com/leechenxiang/p/7110382.html>参考</a></p><h2 id=虚拟主机-使用nginx为静态资源提供服务>虚拟主机-使用nginx为静态资源提供服务</h2><p>静态资源可以是mp4、png、jpg等等。</p><p>/usr/local/nginx/conf/imooc.conf中创建静态资源路径。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>90</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>foodie<span style=color:#000;font-weight:700>-</span>shop;
</span></span><span style=display:flex><span>            index  index.html;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span><span style=color:#000;font-weight:700>static</span> {
</span></span><span style=display:flex><span>	    alias <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>imooc;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span>imooc {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>请求/home/imooc下的资源。</p><p>两种写法：</p><p>一、正常请求：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span>imooc {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>直接请求：</p><p>http://10.4.7.129:90/imooc/456.jpg</p><p>二、给路径起别名：</p><p>将/home/imooc创建别名 为/static</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span><span style=color:#000;font-weight:700>static</span> {
</span></span><span style=display:flex><span>	    alias <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>imooc;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>请求时用别名请求</p><p>http://10.4.7.129:90/static/456.jpg</p><p>将imooc.conf文件内容应用到nginx.conf中</p><p>编辑/usr/local/nginx/conf/nginx.conf</p><p>单独添加一行：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>    include       imooc.conf;
</span></span></code></pre></td></tr></table></div></div><p>检测配置是否正确：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/usr/local/nginx/sbin/nginx -t 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
</span></span><span style=display:flex><span>nginx: configuration file /usr/local/nginx/conf/nginx.conf <span style=color:#0086b3>test</span> is successful
</span></span></code></pre></td></tr></table></div></div><p>重启nginx</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/usr/local/nginx/sbin/nginx -s reload 
</span></span></code></pre></td></tr></table></div></div><p>测试结果：</p><p>http://10.4.7.129:90/imooc/456.jpg</p><p>http://10.4.7.129:90/static/456.jpg</p><h2 id=gzip压缩提升请求效率>gzip压缩提升请求效率</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic>#开启gzip压缩功能，目的：提高传输效率，节约带宽</span>
</span></span><span style=display:flex><span>gzip  on;
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#限制最小压缩，小于1字节的文件不会压缩</span>
</span></span><span style=display:flex><span>gzip_min_length 1;
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#的定义压缩的级别（压缩比，文件越大，压缩越多，但是cpu使用会越多） </span>
</span></span><span style=display:flex><span>gzip_comp_level 3;
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#定义压缩文件类型</span>
</span></span><span style=display:flex><span>gzip_types text/plain application/javascript application/x-javascript test/css application/xml text/javascript application/x-httpd/php image/jpeg image/gif image/png application/json;
</span></span></code></pre></td></tr></table></div></div><h2 id=location匹配规则>location匹配规则</h2><p>空格：默认匹配，普通匹配</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>91</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location  <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>= ：精确匹配</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>91</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>精确匹配
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>=</span> <span style=color:#a61717;background-color:#e3d2d2>/ {</span>
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>正则表达式。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/home/imooc/img
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 img<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>808</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root  <span style=color:#099>25125</span> Jun <span style=color:#099>30</span> 19:40 456.jpg
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root  <span style=color:#099>25125</span> Dec <span style=color:#099>19</span> 00:12 456.JPG
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root <span style=color:#099>383222</span> Dec <span style=color:#099>13</span> 19:25 AutoPlayOptIn.gif
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root <span style=color:#099>383222</span> Dec <span style=color:#099>19</span> 00:17 AutoPlayOptIn.GIF
</span></span></code></pre></td></tr></table></div></div><p>~* ：匹配正则表达式，*代表不区分大小写</p><p>http://10.4.7.129:92/imooc/img/456.JGP (可以访问)不论是否定义了.JPG这种类型都能访问。</p><p>~ ：匹配正则表达式，区分大小写</p><p>http://10.4.7.129:92/imooc/img/456.JGP (不能访问)因为没有定义.JPG这种类型能访问。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>92</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>正则表达式<span style=color:#a61717;background-color:#e3d2d2>。</span><span style=color:#000;font-weight:700>*</span>代表不区分大小写
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>~*</span> <span style=color:#a61717;background-color:#e3d2d2>\</span>.(GIF<span style=color:#000;font-weight:700>|</span>png<span style=color:#000;font-weight:700>|</span>bmp<span style=color:#000;font-weight:700>|</span>jpg<span style=color:#000;font-weight:700>|</span>jpeg) {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>92</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>正则表达式<span style=color:#a61717;background-color:#e3d2d2>。</span><span style=color:#000;font-weight:700>*</span>代表不区分大小写
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>~</span> <span style=color:#a61717;background-color:#e3d2d2>\</span>.(GIF<span style=color:#000;font-weight:700>|</span>png<span style=color:#000;font-weight:700>|</span>bmp<span style=color:#000;font-weight:700>|</span>jpg<span style=color:#000;font-weight:700>|</span>jpeg) {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>^~ 以某个字符路径开头请求</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>93</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#000;font-weight:700>^~</span> 以某个字符路径开头请求
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>^~</span> <span style=color:#009926>/imooc/img</span> {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=dns解析域名>DNS解析域名</h2><p>user-> client(<a href=https://www.imooc.com>www.imooc.com</a>) -> nginx(代理服务器192.168.1.88 小区大门) &mdash;> tomcat1 （目标服务器 内网） ##号楼##室</p><p>​ &mdash;> tomcat2 （目标服务器 内网）##号楼##室</p><h2 id=用switchhosts-模拟本地域名解析访问>用switchhosts 模拟本地域名解析访问</h2><p><a href=https://cloud.tencent.com/developer/article/1408956>https://cloud.tencent.com/developer/article/1408956</a></p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Foldj%2FSwitchHosts%2Freleases%2Fdownload%2Fv3.3.12%2FSwitchHosts-win32-ia32_v3.3.12.5349.zip">https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Foldj%2FSwitchHosts%2Freleases%2Fdownload%2Fv3.3.12%2FSwitchHosts-win32-ia32_v3.3.12.5349.zip</a></p><p>自定义hosts 一键切换。不用更改本机hosts</p><p>定义nginx-dev-imooc 的hosts</p><p>添加映射：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>10.4.7.129 www.imooc.com
</span></span></code></pre></td></tr></table></div></div><p>访问：</p><p><a href=https://www.imooc.com>www.imooc.com</a> 显示10.4.7.129 默认界面</p><h2 id=跨域访问>跨域访问</h2><p><img src=/postimages/nginx%E8%B7%A8%E5%9F%9F.webp alt=nginx跨域></p><p><img src=/postimages/nginx%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AEsuccess.webp alt=nginx跨域访问success></p><p><img src=/postimages/cors%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB.webp alt=cors跨域资源共享></p><p>当出现403跨域错误的时候 <code>No 'Access-Control-Allow-Origin' header is present on the requested resource</code>，需要给Nginx服务器配置响应的header参数：</p><p>只需要在Nginx的配置文件中配置以下参数：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>location <span style=color:#000;font-weight:700>/</span> { 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>允许跨域请求的域<span style=color:#a61717;background-color:#e3d2d2>，</span><span style=color:#000;font-weight:700>*</span>代表所有
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Origin&#39;</span> <span style=color:#000;font-weight:700>*</span>;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>允许请求的方法<span style=color:#a61717;background-color:#e3d2d2>，</span>比如GET, POST, DELETE<span style=color:#a61717;background-color:#e3d2d2>，</span>PUT
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Methods&#39;</span> <span style=color:#000;font-weight:700>*</span>;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>允许带上cookie请求
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Credentails&#39;</span> <span style=color:#d14>&#39;true&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>允许请求的HEADER
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Headers&#39;</span> <span style=color:#000;font-weight:700>*</span>;
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> ($request_method <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;OPTIONS&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#099>204</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>} 
</span></span></code></pre></td></tr></table></div></div><h2 id=nginx-防盗链技术支持>nginx 防盗链技术支持</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>对源站点验证
</span></span><span style=display:flex><span>valid_referers <span style=color:#000;font-weight:700>*</span>.imooc.com;
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>非法引入会进入下方判断
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> ($invalid_referer) {
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>return</span> <span style=color:#099>404</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=nginx-模块化体系>nginx 模块化体系</h2><p><img src=/postimages/nginx%E6%A8%A1%E5%9D%97%E5%8C%96%E4%BD%93%E7%B3%BB.webp alt=nginx模块化体系></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 nginx-1.16.1<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>756</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>6</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 auto       <span style=color:#998;font-style:italic>#一些判断操作系统支持，编译等相关的文件</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>296463</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> CHANGES    <span style=color:#998;font-style:italic>#版本的更改日志</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>452171</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> CHANGES.ru <span style=color:#998;font-style:italic>#俄版版本的更改日志</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>    <span style=color:#099>168</span> Dec <span style=color:#099>17</span> 04:04 conf      <span style=color:#998;font-style:italic>#配置文件夹</span>
</span></span><span style=display:flex><span>-rwxr-xr-x. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>2502</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> configure <span style=color:#998;font-style:italic>#编译配置程序</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>4</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>72</span> Dec <span style=color:#099>17</span> 04:04 contrib   <span style=color:#998;font-style:italic>#提供了语法高亮支持脚本，让vim打开时，语法高亮。需要拷贝contrib														中到 本地vim目录(如果根目录没有该目录，先mkdir ~/.vim)</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>40</span> Dec <span style=color:#099>17</span> 04:04 html      <span style=color:#998;font-style:italic>#默认页面</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>1397</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> LICENSE   <span style=color:#998;font-style:italic>#许可证书</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>355</span> Dec <span style=color:#099>17</span> 04:19 Makefile  <span style=color:#998;font-style:italic>#编译后的文件</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>21</span> Dec <span style=color:#099>17</span> 04:04 man       <span style=color:#998;font-style:italic>#使用手册</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>3</span> root root    <span style=color:#099>174</span> Dec <span style=color:#099>17</span> 04:20 objs      <span style=color:#998;font-style:italic>#第三方插件</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>49</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> README
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>9</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>91</span> Dec <span style=color:#099>17</span> 04:04 src      <span style=color:#998;font-style:italic>#源码</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#0086b3>cd</span> conf
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 conf<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>40</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>1077</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> fastcgi.conf
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>1007</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> fastcgi_params
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>2837</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> koi-utf
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>2223</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> koi-win
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>5231</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> mime.types
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>2656</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> nginx.conf <span style=color:#998;font-style:italic># 核心配置文件</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>  <span style=color:#099>636</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> scgi_params
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>  <span style=color:#099>664</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> uwsgi_params
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>3610</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> win-utf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 html<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>8</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>494</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> 50x.html
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>612</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> index.html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 objs<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>3888</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root   <span style=color:#099>17763</span> Dec <span style=color:#099>17</span> 04:19 autoconf.err
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root   <span style=color:#099>40485</span> Dec <span style=color:#099>17</span> 04:19 Makefile
</span></span><span style=display:flex><span>-rwxr-xr-x. <span style=color:#099>1</span> root root <span style=color:#099>3857136</span> Dec <span style=color:#099>17</span> 04:20 nginx
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>5327</span> Dec <span style=color:#099>17</span> 04:20 nginx.8
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>7363</span> Dec <span style=color:#099>17</span> 04:19 ngx_auto_config.h
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root     <span style=color:#099>657</span> Dec <span style=color:#099>17</span> 04:19 ngx_auto_headers.h
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>5975</span> Dec <span style=color:#099>17</span> 04:19 ngx_modules.c
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root   <span style=color:#099>32552</span> Dec <span style=color:#099>17</span> 04:20 ngx_modules.o
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>9</span> root root      <span style=color:#099>91</span> Dec <span style=color:#099>17</span> 04:19 src
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 src<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>20</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 core   <span style=color:#998;font-style:italic>#核心源码</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>3</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 event  <span style=color:#998;font-style:italic>#事件</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>4</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 http
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 mail
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>74</span> Dec <span style=color:#099>17</span> 04:04 misc   <span style=color:#998;font-style:italic>#辅助代码</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>3</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>18</span> Dec <span style=color:#099>17</span> 04:04 os     <span style=color:#998;font-style:italic>#系统</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> stream 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 http<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ls</span>
</span></span><span style=display:flex><span>modules                        ngx_http_file_cache.c              ngx_http_request.h               ngx_http_upstream_round_robin.h
</span></span><span style=display:flex><span>ngx_http.c                     ngx_http.h                         ngx_http_script.c                ngx_http_variables.c
</span></span><span style=display:flex><span>ngx_http_cache.h               ngx_http_header_filter_module.c    ngx_http_script.h                ngx_http_variables.h
</span></span><span style=display:flex><span>ngx_http_config.h              ngx_http_parse.c                   ngx_http_special_response.c      ngx_http_write_filter_module.c
</span></span><span style=display:flex><span>ngx_http_copy_filter_module.c  ngx_http_postpone_filter_module.c  ngx_http_upstream.c              v2
</span></span><span style=display:flex><span>ngx_http_core_module.c         ngx_http_request_body.c            ngx_http_upstream.h
</span></span><span style=display:flex><span>ngx_http_core_module.h         ngx_http_request.c                 ngx_http_upstream_round_robin.c
</span></span></code></pre></td></tr></table></div></div><h2 id=负载均衡>负载均衡</h2><h3 id=四层负载均衡>四层负载均衡</h3><p>主要是为了将请求分流到不同服务器</p><p>F5 硬负载均衡 基于硬件、商业化</p><p>LVS 四层负载均衡</p><p>Haproxy 四层负载均衡</p><p>Nginx 四层负载均衡</p><h3 id=七层负载均衡>七层负载均衡</h3><p>基于应用层HTTP协议进行负载均衡</p><p>Nginx 七层负载均衡</p><p>Haproxy 七层负载均衡</p><p>apache 七层负载均衡</p><p>四层主要是tcp、udp转发请求，而不是处理请求
七层会处理请求，可以过滤、压缩、缓存等</p><h3 id=dns-地域负载均衡>DNS 地域负载均衡</h3><p><img src=/postimages/DNS%E5%9C%B0%E5%9F%9F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.webp alt=DNS地域负载均衡></p><p>可以根据请求者地域，分配到最近的服务器
减少网络传输的损耗</p><h2 id=使用nginx搭建三台tomcat集群>使用Nginx搭建三台tomcat集群</h2><p>tomcat1 :10.4.7.11</p><p>tomcat2 :10.4.7.12</p><p>tomcat3 :10.4.7.21</p><p>tomcat安装：10.4.7.{11,12,21}都要安装</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum install tomcat -y
</span></span><span style=display:flex><span>yum install tomcat-webapps tomcat-admin-webapps tomcat-docs-webapp tomcat-javadoc
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#关闭防火墙</span>
</span></span><span style=display:flex><span>systemctl stop firewalld
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#启动tomcat</span>
</span></span><span style=display:flex><span>systemctl restart tomcat
</span></span></code></pre></td></tr></table></div></div><p>10.4.7.129 (nginx服务器)上配置tomcat集群</p><p>vim imooc.conf</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>        server_name  www.tomcats.com;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            proxy_pass http<span style=color:#000;font-weight:700>:</span><span style=color:#998;font-style:italic>//tomcats;
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>重启nginx</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/usr/local/nginx/sbin/nginx -s reload 
</span></span></code></pre></td></tr></table></div></div><p>windwos配置hosts规则：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>10.4.7.129 www.tomcats.com
</span></span></code></pre></td></tr></table></div></div><p>测试访问。</p><p><a href=https://www.tomcats.com>www.tomcats.com</a></p><p>请求会平均分配给后面三台tomcat.</p><p>参考：http://tengine.taobao.org/book/chapter_05.html</p><h2 id=负载均衡之轮询>负载均衡之轮询</h2><p>默认nginx使用的是轮询。交替出现。出现次数均等。</p><p>修改每台tomcat默认页面</p><p>/usr/share/tomcat/webapps/ROOT/index.jsp</p><p>第37行。home改成对应IP最后一位。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span> 37 &lt;<span style=color:navy>span</span> <span style=color:teal>id</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;nav-home&#34;</span>&gt;&lt;<span style=color:navy>a</span> <span style=color:teal>href</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;${tomcatUrl}&#34;</span>&gt;12&lt;/<span style=color:navy>a</span>&gt;&lt;/<span style=color:navy>span</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>重启tomcat</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>systemctl restart tomcat 
</span></span></code></pre></td></tr></table></div></div><p>![nginx 轮询](/postimages/nginx 轮询.webp)</p><p>11 12 21 会交替出现。</p><h2 id=负载均衡之权重-加权轮询>负载均衡之权重-加权轮询</h2><p>weight 值越大，出现的次数越多（后端服务器被访问的次数就越多）。</p><p>配置在upstream 模块内。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>3</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>11:12:21 = 1:2:3</p><p>21出现几率最大。</p><h2 id=upstream-指令参数>upstream 指令参数</h2><p>max_conns :限制<code>*number*</code>到代理服务器的最大同时活动连接数.默认值为零，表示没有限制。如果启用了<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive>idle keepalive</a>连接、多个<a href=https://nginx.org/en/docs/ngx_core_module.html#worker_processes>worker</a>和<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone>共享内存</a>，则代理服务器的 active 和 idle 连接总数可能会超过该<code>max_conns</code>值。允许最大连接数。</p><p>限制每台server的连接数，用于保护避免过载起到限流作用。</p><p>测试参考配置如下：</p><p>#worker 进程设置1个，便于测试观察成功的连接数。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>worker_processes <span style=color:#099>1</span> 
</span></span><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> max_conns<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> max_conns<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> max_conns<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>slow_start:当节点恢复，不立即加入,而是等待 slow_start 后加入服务对列.(仅商业版支持)</p><p>测试参考配置如下：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>6</span> slow_start<span style=color:#000;font-weight:700>=</span><span style=color:#099>60</span>s;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>注意：</p><p>该参数不能使用在hash 和random load balancing中</p><p>如果在upstream中只有一台server，则该参数失效。</p><p>down :将服务器标记为永久不可用。</p><p>测试参考配置如下：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> down;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>backup:将服务器标记为备份服务器,只有在其他的服务器都宕机以后，自己才会加入到集群中，被用户访问到。</p><p>该参数不能与 <a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#hash>hash</a>、<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ip_hash>ip_hash</a>和<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#random>随机</a> 负载平衡方法一起使用。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> backup;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>max_fails:失败几次，则标记server已宕机，剔出上游服务。</p><p>fail_timeout:表示失败的重试时间。</p><p>假设目前设置如下：</p><p>max_fails=2 fail_timeout=15s</p><p>则表示在15秒内请求某一server失败达到2次后，则认为该server已经挂了或者宕机了，随后再过15s，这15s内不会有新的请求到达刚刚挂掉的节点上，而是会请求到正常运作的server，15秒后会在有新请求尝试连接挂掉的server，如果还是失败，重复上一过程，直到恢复。</p><h2 id=使用keepalive提高吞吐量>使用keepalive提高吞吐量</h2><p><a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive>https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive</a></p><p>测试配置：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        keepalive <span style=color:#099>32</span>; <span style=color:#a61717;background-color:#e3d2d2>#</span>配置长连接的数量<span style=color:#a61717;background-color:#e3d2d2>，</span>保持连接可以提高吞吐量
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>        server_name  www.tomcats.com;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            proxy_pass http<span style=color:#000;font-weight:700>:</span><span style=color:#998;font-style:italic>//tomcats;
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>            proxy_http_version <span style=color:#099>1.1</span>; <span style=color:#a61717;background-color:#e3d2d2>#</span>代表上面长连接的版本号<span style=color:#a61717;background-color:#e3d2d2>，（</span>默认1.<span style=color:#099>0</span><span style=color:#a61717;background-color:#e3d2d2>，</span>但1.<span style=color:#099>0</span>不是长链接<span style=color:#a61717;background-color:#e3d2d2>）</span>
</span></span><span style=display:flex><span>            proxy_set_header Connection <span style=color:#d14>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=负载均衡之ip_hash>负载均衡之ip_hash</h2><p>hash算法</p><p>hash(ip) % node_counts = index</p><p>算出用户访问的服务器具体是哪一台</p><p>保证用户访问的服务器是同一台，保持会话一致</p><p>测试配置：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>		ip_hash;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>10.4.7.110
10.4.7.120 &mdash;> hash(10 4 7)
10.4.7.210</p><p>分段进行计算，同一片区域，会访问到一个里</p><h3 id=负载均衡之url_hash>负载均衡之<strong>url_hash</strong></h3><p><img src=/postimages/url_hash.webp alt=url_hash></p><p>通过配置hash $request_uri
开启url_hash</p><h2 id=nginx控制浏览器缓存>nginx控制浏览器缓存</h2><p><img src=/postimages/nginx%E7%BC%93%E5%AD%98.webp alt=nginx缓存></p><p>1、设置静态内容的过期时间(expires time;)</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>location  <span style=color:#000;font-weight:700>/</span><span style=color:#000;font-weight:700>static</span> {
</span></span><span style=display:flex><span>    alias  <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>naga;
</span></span><span style=display:flex><span>    expires  <span style=color:#099>10</span>s;   
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>2、固定时间 expires @[time]</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>expires  @22h30s;   代表晚上10:30pm失效，浏览器会自动计算时间差
</span></span></code></pre></td></tr></table></div></div><p>3、 expires -[time]</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span> expires  -1h;  距离现在的1小时之前就失效了，相当于不用缓存
</span></span></code></pre></td></tr></table></div></div><p>4、expires eposh; 不使用缓存</p><p>5、expires off; 默认值，其实就是不管，由浏览器自己使用自己的默认缓存</p><p>6、expires max; 缓存不会过期，除非修改过。</p><h2 id=上游服务静态内容缓存>上游服务静态内容缓存</h2><p>keys_zone 是内存缓存 max_size 是硬盘缓存</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream xxx {  ...  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span> proxy_cache_path  设置缓存保存的地址<span style=color:#a61717;background-color:#e3d2d2>，</span>目录会自动创建
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   keys_zone 设置共享内存<span style=color:#a61717;background-color:#e3d2d2>，</span>以及占用的空间大小 <span style=color:#a61717;background-color:#e3d2d2>##</span> 内存缓存 <span style=color:#a61717;background-color:#e3d2d2>##</span>  (mycache是共享内存名<span style=color:#a61717;background-color:#e3d2d2>，</span>下面)
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   max_size 设置缓存大小
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   inactive 超过此时间<span style=color:#a61717;background-color:#e3d2d2>，</span>缓存自动清理
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   use_temp_path<span style=color:#000;font-weight:700>=</span>off  关闭临时目录
</span></span><span style=display:flex><span>proxy_cache_path  <span style=color:#000;font-weight:700>/</span>usr<span style=color:#000;font-weight:700>/</span>local<span style=color:#000;font-weight:700>/</span>nginx<span style=color:#000;font-weight:700>/</span>upstream_cache  keys_zone<span style=color:#000;font-weight:700>=</span>mycache<span style=color:#000;font-weight:700>:</span><span style=color:#099>50</span>m  max_size<span style=color:#000;font-weight:700>=</span><span style=color:#099>30</span>g  inactive<span style=color:#000;font-weight:700>=</span><span style=color:#099>8</span>h  use_temp_path<span style=color:#000;font-weight:700>=</span>off;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>  listen  <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>  server_name  www.naga.cn;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a61717;background-color:#e3d2d2>#</span>开启并且使用缓存
</span></span><span style=display:flex><span>  proxy_cache  mycache;
</span></span><span style=display:flex><span>  <span style=color:#a61717;background-color:#e3d2d2>#</span>针对200和304状态码的缓存设置过期时间
</span></span><span style=display:flex><span>  proxy_cache_valid   <span style=color:#099>200</span>  <span style=color:#099>304</span>  <span style=color:#099>8</span>h;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=使用nginx-配置https域名证书>使用nginx 配置https域名证书</h2><ol><li><p>安装ssl模块</p><p>要在nginx中配置https,及必须安装ssl模块，也就是‘http_ssl_module’.</p><p>进入到nginx解压目录：nginx-1.16.1</p><p>新增ssl模块（原来的模块需要保留）&ndash;with-http_ssl_module</p></li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>./configure <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--prefix<span style=color:#000;font-weight:700>=</span>/usr/local/nginx <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--pid-path<span style=color:#000;font-weight:700>=</span>/var/run/nginx/nginx.pid <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--lock-path<span style=color:#000;font-weight:700>=</span>/var/lock/nginx.lock <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--error-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/error.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/access.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--with-http_gzip_static_module <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-client-body-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/client <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-proxy-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/proxy <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-fastcgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/fastcgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-uwsgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/uwsgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-scgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/scgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--with-http_ssl_module
</span></span></code></pre></td></tr></table></div></div><p>编译和安装：</p><p>make</p><p>make install</p><h2 id=配置ssl>配置ssl</h2><p>1、云上申请证书，审核完成后将证书下载下来，nginx包含两个文件，一个crt证书文件，一个key密钥文件</p><p>2、将文件上传到云服务器，可以放在conf下</p><p>3、修改nginx.conf (事先在nginx里面加入ssl模块 &ndash;with-http_ssl_module, 安装后通过 ./nginx -V 查看 )</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen  <span style=color:#099>443</span>;
</span></span><span style=display:flex><span>    server_name  localhost;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> 开启ssl 
</span></span><span style=display:flex><span>    ssl on; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> 配置ssl证书   因为放在conf下的<span style=color:#a61717;background-color:#e3d2d2>，</span>和nginx.conf同一路径<span style=color:#a61717;background-color:#e3d2d2>，</span>就这样写就行
</span></span><span style=display:flex><span>    ssl_certificate <span style=color:#099>1_</span>www.imoocdsp.com_bundle.crt; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> 配置证书秘钥 
</span></span><span style=display:flex><span>    ssl_certificate_key <span style=color:#099>2_</span>www.imoocdsp.com.key; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> ssl会话cache 
</span></span><span style=display:flex><span>    ssl_session_cache shared<span style=color:#000;font-weight:700>:</span>SSL<span style=color:#000;font-weight:700>:</span><span style=color:#099>1</span>m; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> ssl会话超时时间 
</span></span><span style=display:flex><span>    ssl_session_timeout <span style=color:#099>5</span>m; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> 配置加密套件<span style=color:#a61717;background-color:#e3d2d2>，</span>写法遵循 openssl 标准 
</span></span><span style=display:flex><span>    ssl_protocols TLSv1 TLSv1.<span style=color:#099>1</span> TLSv1.<span style=color:#099>2</span>; 
</span></span><span style=display:flex><span>    ssl_ciphers ECDHE<span style=color:#000;font-weight:700>-</span>RSA<span style=color:#000;font-weight:700>-</span>AES128<span style=color:#000;font-weight:700>-</span>GCM<span style=color:#000;font-weight:700>-</span>SHA256<span style=color:#000;font-weight:700>:</span>HIGH<span style=color:#000;font-weight:700>:!</span>aNULL<span style=color:#000;font-weight:700>:!</span>MD5<span style=color:#000;font-weight:700>:!</span>RC4<span style=color:#000;font-weight:700>:!</span>DHE; 
</span></span><span style=display:flex><span>    ssl_prefer_server_ciphers on;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>###</span> 将http的请求转发到https
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>    server_name localhost;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> 排除法
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> ($http_name <span style=color:#000;font-weight:700>~*</span> <span style=color:#d14>&#34;^online$&#34;</span> ) {
</span></span><span style=display:flex><span>        rewrite <span style=color:#000;font-weight:700>^</span><span style=color:#009926>/(.*)$ https:/</span><span style=color:#000;font-weight:700>/</span>localhost<span style=color:#000;font-weight:700>/</span>online<span style=color:#000;font-weight:700>/</span> permanent;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    rewrite <span style=color:#000;font-weight:700>^</span> https<span style=color:#000;font-weight:700>:</span><span style=color:#998;font-style:italic>//$host$1 permanent;
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=动静分离>动静分离</h2><p>1.分布式</p><p>2.前后端解耦</p><p>3.静态归nginx</p><p>4.接口服务化</p><p>静态数据：css/js/html/images/audios/videos/&mldr;</p><p>动态数据：得到的响应可能会和上次不同。</p><p>动静分离的问题</p><p>跨域：</p><p>springboot</p><p>nginx</p><p>jsonp</p><p>分布式会话： 分布式缓存中间件Redis</p><h2 id=nginx高可用ha-keepalived-双机主备>nginx高可用HA keepalived 双机主备</h2><p>keepalived 使用的是虚拟路由冗余协议 VRRP ，这个协议的特点如下：</p><p>1、解决内网单机故障的路由协议，</p><p>2、用于构建过个路由MASTER BACKUP，将几台提供相同服务的路由器组成一个路由器组。一个路由就是nginx</p><p>3、虚拟IP-VIP（Virtual IP Address）</p><p>过程：用户不直接访问nginx，访问虚拟IP，这个虚拟IP是绑定了nginx的master节点，会根据这个关系解析出来结果。 master主节点挂了，心跳检测到后会让虚拟IP找到备用机，多个备用机会根据权重选择。</p><p>此外，主备节点的硬件配置应一样。</p><h2 id=安装keepalived>安装keepalived</h2><p>解压后进入文件夹进行配置，类似nginx，但是需要用 &ndash;sysconf=/etc指定配置文件地址</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum -y install libnl libnl-devel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./configure --prefix<span style=color:#000;font-weight:700>=</span>/usr/local/keepalived  --sysconf<span style=color:#000;font-weight:700>=</span>/etc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make <span style=color:#000;font-weight:700>&amp;&amp;</span> make install
</span></span></code></pre></td></tr></table></div></div><p>prefix：keepalived安装的位置</p><p>sysconf：keepalived核心配置文件所在位置，固定位置，改成其他位置则keepalived启动不了。会报错。</p><p>libnl libnl-devel 是libnl/libnl-3依赖包。</p><h3 id=核心配置文件>核心配置文件：</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span>Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span> 全局配置
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   <span style=color:#a61717;background-color:#e3d2d2>#</span> 节点故障<span style=color:#a61717;background-color:#e3d2d2>，</span>切换了节点之后会通知管理员<span style=color:#a61717;background-color:#e3d2d2>，</span>下面还要配置邮箱的协议等<span style=color:#a61717;background-color:#e3d2d2>，</span>可以不要
</span></span><span style=display:flex><span>   notification_email {
</span></span><span style=display:flex><span>     <span style=color:#099>123456</span><span style=color:#a61717;background-color:#e3d2d2>@</span>qq.com
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   notification_email_from Alexandre.Cassen<span style=color:#a61717;background-color:#e3d2d2>@</span>firewall.loc
</span></span><span style=display:flex><span>   smtp_server <span style=color:#099>192.168</span>.<span style=color:#099>200.1</span>
</span></span><span style=display:flex><span>   smtp_connect_timeout <span style=color:#099>30</span>
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>   <span style=color:#a61717;background-color:#e3d2d2>#</span> 路由ID<span style=color:#a61717;background-color:#e3d2d2>：</span>当前安装keepalived节点主机的标识符<span style=color:#a61717;background-color:#e3d2d2>，</span>全局唯一
</span></span><span style=display:flex><span>   router_id naga_170
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>   vrrp_skip_check_adv_addr
</span></span><span style=display:flex><span>   vrrp_strict
</span></span><span style=display:flex><span>   vrrp_garp_interval <span style=color:#099>0</span>
</span></span><span style=display:flex><span>   vrrp_gna_interval <span style=color:#099>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>基于VRRP协议的对象<span style=color:#a61717;background-color:#e3d2d2>，</span>计算机节点
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER            <span style=color:#a61717;background-color:#e3d2d2>#</span> 表示当前为nginx的master主节点
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> eth0          <span style=color:#a61717;background-color:#e3d2d2>#</span> 当前实例绑定的网卡<span style=color:#a61717;background-color:#e3d2d2>，</span> 用 ip addr查看
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>     <span style=color:#a61717;background-color:#e3d2d2>#</span>虚拟路由ID<span style=color:#a61717;background-color:#e3d2d2>，</span>主备节点需要一致
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>            <span style=color:#a61717;background-color:#e3d2d2>#</span>权重<span style=color:#a61717;background-color:#e3d2d2>，</span>备机优先级越高就成为新的master
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>            <span style=color:#a61717;background-color:#e3d2d2>#</span> 主备心跳检查<span style=color:#a61717;background-color:#e3d2d2>，</span>时间间隔1s
</span></span><span style=display:flex><span>    authentication {        <span style=color:#a61717;background-color:#e3d2d2>#</span> 认证授权<span style=color:#a61717;background-color:#e3d2d2>，</span>防止非法节点<span style=color:#a61717;background-color:#e3d2d2>。</span>每个节点一样就可以
</span></span><span style=display:flex><span>        auth_type PASS      
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {     <span style=color:#a61717;background-color:#e3d2d2>#</span> 虚拟IP<span style=color:#a61717;background-color:#e3d2d2>，</span>用一个就可以了
</span></span><span style=display:flex><span>        <span style=color:#099>192.168</span>.<span style=color:#099>17.17</span>
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>192.168</span>.<span style=color:#099>200.17</span>
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>192.168</span>.<span style=color:#099>200.18</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>下面的都可以不要
</span></span><span style=display:flex><span>virtual_server <span style=color:#099>192.168</span>.<span style=color:#099>200.100</span> <span style=color:#099>443</span> {
</span></span><span style=display:flex><span>    delay_loop <span style=color:#099>6</span>
</span></span><span style=display:flex><span>    lb_algo rr
</span></span><span style=display:flex><span>    lb_kind NAT
</span></span><span style=display:flex><span>    persistence_timeout <span style=color:#099>50</span>
</span></span><span style=display:flex><span>    protocol TCP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>201.100</span> <span style=color:#099>443</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        SSL_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>
</span></span><span style=display:flex><span>              digest ff20ad2481f97b1754ef3e12ecd3a9cc
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>mrtg<span style=color:#000;font-weight:700>/</span>
</span></span><span style=display:flex><span>              digest <span style=color:#099>9</span>b3a0c85a887a256d6939da88aabd8cd
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>virtual_server <span style=color:#099>10.10</span>.<span style=color:#099>10.2</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>    delay_loop <span style=color:#099>6</span>
</span></span><span style=display:flex><span>    lb_algo rr
</span></span><span style=display:flex><span>    lb_kind NAT
</span></span><span style=display:flex><span>    persistence_timeout <span style=color:#099>50</span>
</span></span><span style=display:flex><span>    protocol TCP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    sorry_server <span style=color:#099>192.168</span>.<span style=color:#099>200.200</span> <span style=color:#099>1358</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.2</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl3<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.3</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334c
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334c
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>virtual_server <span style=color:#099>10.10</span>.<span style=color:#099>10.3</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>    delay_loop <span style=color:#099>3</span>
</span></span><span style=display:flex><span>    lb_algo rr
</span></span><span style=display:flex><span>    lb_kind NAT
</span></span><span style=display:flex><span>    persistence_timeout <span style=color:#099>50</span>
</span></span><span style=display:flex><span>    protocol TCP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.4</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl3<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.5</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl3<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>示例：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>####</span> 第一台 <span style=color:#a61717;background-color:#e3d2d2>####</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>全局变量<span style=color:#000;font-weight:700>-</span>路由id<span style=color:#a61717;background-color:#e3d2d2>，</span>标识主机id
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_140
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>计算机节点
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER	<span style=color:#a61717;background-color:#e3d2d2>#</span>标示当前机器为主节点<span style=color:#a61717;background-color:#e3d2d2>，</span>从节点BACKUP
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33	<span style=color:#a61717;background-color:#e3d2d2>#</span>当前网卡
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>保持主备机一致
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>权重<span style=color:#a61717;background-color:#e3d2d2>，</span>最高的当选下一任主机
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>检查时间间隔1s
</span></span><span style=display:flex><span>    authentication {	<span style=color:#a61717;background-color:#e3d2d2>#</span>认证授权<span style=color:#a61717;background-color:#e3d2d2>，</span>防止非法节点进入
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {	<span style=color:#a61717;background-color:#e3d2d2>#</span>虚拟ip
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>####</span> 第二台 <span style=color:#a61717;background-color:#e3d2d2>####</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>全局变量<span style=color:#000;font-weight:700>-</span>路由id<span style=color:#a61717;background-color:#e3d2d2>，</span>标识主机id
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_141
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>计算机节点
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state BACKUP	<span style=color:#a61717;background-color:#e3d2d2>#</span>标示当前机器为从节点
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33	<span style=color:#a61717;background-color:#e3d2d2>#</span>当前网卡
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>保持主备机一致
</span></span><span style=display:flex><span>    priority <span style=color:#099>80</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>权重<span style=color:#a61717;background-color:#e3d2d2>，</span>最高的当选下一任主机
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>检查时间间隔1s
</span></span><span style=display:flex><span>    authentication {	<span style=color:#a61717;background-color:#e3d2d2>#</span>认证授权<span style=color:#a61717;background-color:#e3d2d2>，</span>防止非法节点进入
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {	<span style=color:#a61717;background-color:#e3d2d2>#</span>虚拟ip<span style=color:#a61717;background-color:#e3d2d2>，</span>保持和主节点一致
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>测试：</p><p>两台机器nginx 和keeplived进程都在。两台一主一备的目的是，主服务器keeplived挂了，vip切到备服务器上，业务不中断。默认vip是在主上生效的。主备的keepalived进程都在，vip会在主上生效。vip切到备服务器上时.主服务器上的keepalived恢复了。vip会再次切回到主服务器上。</p><h3 id=keepalived配置nginx自动启动>keepalived配置Nginx自动启动</h3><p>这时如果nginx挂了，keepalived没有挂，还是会无法访问。</p><p>1.脚本（主从都配置）</p><p>cd /etc/keepalived
vim check_nginx_alive.sh</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span><span style=color:teal>A</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>`</span>ps -C nginx --no-header | wc -l<span style=color:#d14>`</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># 进程数是0的话，就尝试重启nginx</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>[</span> <span style=color:teal>$A</span> -eq <span style=color:#099>0</span> <span style=color:#000;font-weight:700>]</span>; <span style=color:#000;font-weight:700>then</span>
</span></span><span style=display:flex><span>    /usr/local/nginx/sbin/nginx
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic># 等一会儿再次检查ngxin，如果nginx没有启动成功，则停止当前机器的keepalived，使用备用机器</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#099>3</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#d14>`</span>ps -C nginx --no-header | wc -l<span style=color:#d14>`</span> -eq <span style=color:#099>0</span> <span style=color:#000;font-weight:700>]</span>; <span style=color:#000;font-weight:700>then</span>
</span></span><span style=display:flex><span>        killall keepalived  
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>fi</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>fi</span>      
</span></span></code></pre></td></tr></table></div></div><p>执行这个脚本后，会检测nginx，挂掉会重启nginx。</p><p>我们将它配置到keepalived配置文件里。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_140
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_script check_nginx_alive {
</span></span><span style=display:flex><span>        script <span style=color:#d14>&#34;/etc/keepalived/check_nginx_alive.sh&#34;</span>
</span></span><span style=display:flex><span>        interval <span style=color:#099>2</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>每隔两秒钟运行脚本检测
</span></span><span style=display:flex><span>        weight <span style=color:#099>10</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>脚本运行成功<span style=color:#a61717;background-color:#e3d2d2>，</span>升级权重<span style=color:#000;font-weight:700>+</span><span style=color:#099>10</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>在此执行上面的定时器
</span></span><span style=display:flex><span>    track_script{
</span></span><span style=display:flex><span>        check_nginx_alive
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=双机主备缺点>双机主备缺点</h4><p>这样我们就能保证高可用的架构了，但是双机主备会有资源浪费的问题，主机永远不挂机，备机白干活儿。</p><h4 id=keepalived-双主热备>Keepalived 双主热备</h4><p><img src=/postimages/nginx%E5%8F%8C%E4%B8%BB1.webp alt=nginx双主1></p><p><img src=/postimages/nginx%E5%8F%8C%E4%B8%BB2.webp alt=nginx双主2></p><p>双机使用两个虚拟IP，互为主备。</p><p>使用DNS轮询两个虚拟IP进行访问，这样两台服务器都可以使用了。解析域名的时候，给域名解析两个云服务器的ip地址，再均衡权重即可。</p><p>配置（原主节点）：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_140
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_script check_nginx_alive {
</span></span><span style=display:flex><span>        script <span style=color:#d14>&#34;/etc/keepalived/check_nginx_alive.sh&#34;</span>
</span></span><span style=display:flex><span>        interval <span style=color:#099>2</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>每隔两秒钟运行脚本检测
</span></span><span style=display:flex><span>        weight <span style=color:#099>10</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>脚本运行成功<span style=color:#a61717;background-color:#e3d2d2>，</span>升级权重<span style=color:#000;font-weight:700>+</span><span style=color:#099>10</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>211</span>主节点
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    track_script{
</span></span><span style=display:flex><span>        check_nginx_alive
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>212</span>从节点
</span></span><span style=display:flex><span>vrrp_instance VI_2 {        <span style=color:#a61717;background-color:#e3d2d2>#</span>名字要改
</span></span><span style=display:flex><span>    state BACKUP
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>52</span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>换了一组实例<span style=color:#a61717;background-color:#e3d2d2>，</span>改
</span></span><span style=display:flex><span>    priority <span style=color:#099>80</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS      
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    track_script {
</span></span><span style=display:flex><span>        check_nginx_alive 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.212</span>           <span style=color:#a61717;background-color:#e3d2d2>#</span>VIP更改  虚拟ip  virtual IP
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    track_script{
</span></span><span style=display:flex><span>    	check_nginx_alive
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>配置（原从节点）：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_141
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_script check_nginx_alive {
</span></span><span style=display:flex><span>        script <span style=color:#d14>&#34;/etc/keepalived/check_nginx_alive.sh&#34;</span>
</span></span><span style=display:flex><span>        interval <span style=color:#099>2</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>每隔两秒钟运行脚本检测
</span></span><span style=display:flex><span>        weight <span style=color:#099>10</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>脚本运行成功<span style=color:#a61717;background-color:#e3d2d2>，</span>升级权重<span style=color:#000;font-weight:700>+</span><span style=color:#099>10</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>211</span>从节点
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state BACKUP
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>
</span></span><span style=display:flex><span>    priority <span style=color:#099>80</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>        track_script {
</span></span><span style=display:flex><span>        check_nginx_alive 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>212</span>主节点
</span></span><span style=display:flex><span>vrrp_instance VI_2 {           <span style=color:#a61717;background-color:#e3d2d2>#</span>第二组实例
</span></span><span style=display:flex><span>    state MASTER            
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33          
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>52</span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>第二组router_id
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>            
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>            
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS      
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {     
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.212</span>           <span style=color:#a61717;background-color:#e3d2d2>#</span>改为第二个虚拟ip
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>        track_script {
</span></span><span style=display:flex><span>        check_nginx_alive 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=footer><div class=container-footer><div class=beian><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="></a><a href target=_blank><span class=some>icp...<span></a></div><div class=info><a href=https://github.com/loveminimal/hugo-theme-virgo>🕊️</a> 2021 - <span id=info-date></span></div></div></div><div class=cool-after></div></body></html>