<!doctype html><html lang=zh-CN><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content="Nginxå®‰è£…ä¸ä½¿ç”¨ - https://t.haipengv.com/posts/nginx%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"><meta name=author content="Smith - https://t.haipengv.com/"><meta name=msvalidate.01 content="B46311949B856F2A7015F366FB3CE878"><title>Nginxå®‰è£…ä¸ä½¿ç”¨</title><base target=_blank><link rel=icon type=image/png href=/favicon.ico><link rel=stylesheet href=https://t.haipengv.com/style.min.9a0cea23154ac1941e15c25aa2d31b77285a217d2606ec05b55236428cf1c3e6.css><script>const DARK=!1</script><script type=text/javascript src=/main.js defer></script></head><body class=active-animate><div class=cool-before></div><div id=header><div class=container-header><div class=right><h1 class=title>Nginxå®‰è£…ä¸ä½¿ç”¨</h1><div id=toc>ğŸ“œ</div></div></div></div><div id=content><div class="container-main container-page"><div class=rel><div class=curtag-desc><a href=https://t.haipengv.com/tags/web/><img src=/imgs/icons/tag.svg width=16> ç›¸å…³æ–‡ç« ï¼šWeb <sup>6</sup></a></div><div class=curtag-post><div class=curtag-post-item><a href=https://t.haipengv.com/posts/caddy%E5%BC%80%E6%BA%90web%E6%9C%8D%E5%8A%A1%E5%99%A8/>Caddyå¼€æºwebæœåŠ¡å™¨</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/django/>Django</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/flask%E5%85%A5%E9%97%A8/>Flaskå…¥é—¨</a></div><div class="curtag-post-item curtag-post-item--active"><a href=https://t.haipengv.com/posts/nginx%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/>Nginxå®‰è£…ä¸ä½¿ç”¨</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/seatunnel%E5%8F%8Aseatunnel-web%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/>SeaTunnelåŠSeaTunnelWebéƒ¨ç½²æŒ‡å—</a></div><div class=curtag-post-item><a href=https://t.haipengv.com/posts/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/>å‰ç«¯æ¡†æ¶</a></div></div></div><div class=desc><span><svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667l-324.522666 324.48c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334L685.098667 499.2 524.885333 338.986667zM585.258667 278.656l160.170666 160.213333 102.144-102.144a19.712 19.712.0 000-27.861333l-132.48-132.437333a19.456 19.456.0 00-27.605333.0L585.258667 278.613333zM701.312 85.333333c27.946667.0 54.741333 11.136 74.282667 30.848L907.904 248.490667a105.045333 105.045333.0 010 148.565333L424.874667 879.957333C395.050667 914.304 352.768 935.424 304.426667 938.752H85.333333v-42.666667l.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666a104.789333 104.789333.0 0174.24-30.933334z" p-id="7410" fill="#adb5bd"/></svg>2025-03-16&nbsp;&nbsp;&nbsp;<svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859.0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775.0-360.398 149.372-360.398 356.147S305.225 870.23 512 870.23c206.775.0 357.467-151.455 357.467-358.23.0-23.859 23.634-50.706 53.413-50.706 29.78.0 49.92 26.847 49.92 50.706.0 254.493-206.307 460.8-460.8 460.8s-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4.0 226.684 33.296 312.264 117.369.358.351.358-24.052.0-73.209z" p-id="23839" fill="#adb5bd"/></svg>
2025-03-16&nbsp;&nbsp;&nbsp;</span>
<span><svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028c-70.774903.0-128.089859 57.325793-128.089859 128.03206v446.793671c0 70.7171050000001 57.314956 128.154884 128.089859 128.154884h133.353183a63.940169 63.940169.0 0155.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169.0 0155.212517-31.551041h133.54103c70.576219.0 127.732228-57.289669 127.732227-127.800865V192.391272c0-70.536482-57.181295-127.728615-127.786414-127.728615zM895.884854 639.842407A63.85347 63.85347.0 01832.092795 703.703103h-133.54103a127.753903 127.753903.0 00-110.349172 63.09847l-76.222461 129.856342a.274545.274545.0 010-.050574h-.032512s-.021675.061411-.032512.061412l-76.1466-129.85273a127.804477 127.804477.0 00-110.385297-63.11292H192.030028A64.207489 64.207489.0 01127.880338 639.488388V192.694717a64.102729 64.102729.0 0164.14969-64.091891h640.00858a63.799284 63.799284.0 0163.846246 63.788446v447.451135z" fill="#adb5bd" p-id="33867"/><path d="M608.154093 288.092004a31.970084 31.970084.0 00-31.970084 31.970085v160.078006L441.53396 300.861976a31.970084 31.970084.0 00-57.531702 19.200113v255.760676a31.970084 31.970084.0 0063.940169.0V415.863969l134.650048 179.274507a31.970084 31.970084.0 0057.531703-19.200113V320.062089a31.970084 31.970084.0 00-31.970085-31.970085z" fill="#adb5bd" p-id="33868"/></svg>8858 å­—</span>&nbsp;
<span><svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667zm0 810.666666C307.2 885.333333 138.666667 716.8 138.666667 512S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"/><path d="M695.466667 567.466667 544 497.066667V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666L669.866667 627.2c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8.0 23.466667-6.4 29.866666-19.2 6.4-14.933333.0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"/></svg>18 åˆ†é’Ÿ</span><div class=container-ctgtag><div class=taxonomy><div class=tag><a href=/tags/web>Web</a></div></div></div></div><div class=toc><div class=container-page-operation><div class=page-operation><div><a href=/><img src=/imgs/icons/home-2.svg alt></a></div><div><a href=/nav><img src=/imgs/icons/iov-navigate-1.svg alt></a></div><div><a href=/wiki><img src=/imgs/icons/wiki.svg alt></a></div><div><a href=/tags><img src=/imgs/icons/treetags.svg alt></a></div><div id=light-dark><a><img src=/imgs/icons/moon2.svg alt></a></div><div><a href=#><img src=/imgs/icons/up2.svg alt></a></div></div></div><nav id=TableOfContents><ul><li><a href=#nginx-1161-å®‰è£…ä½¿ç”¨è¯´æ˜>nginx 1.16.1 å®‰è£…ä½¿ç”¨è¯´æ˜</a><ul><li><a href=#config-ç¼–è¯‘å‚æ•°>config ç¼–è¯‘å‚æ•°</a></li></ul></li><li><a href=#nginx-çš„è¿›ç¨‹æ¨¡å‹>nginx çš„è¿›ç¨‹æ¨¡å‹</a><ul><li><a href=#nginxäº‹ä»¶å¤„ç†å¼‚æ­¥éé˜»å¡>nginxäº‹ä»¶å¤„ç†ã€‚å¼‚æ­¥éé˜»å¡ã€‚</a></li></ul></li><li><a href=#é…ç½®æ–‡ä»¶è¯¦è§£>é…ç½®æ–‡ä»¶è¯¦è§£ï¼š</a></li><li><a href=#å¸¸è§pidæŠ¥é”™>å¸¸è§pidæŠ¥é”™</a><ul><li><a href=#nginxpidæ‰“å¼€å¤±è´¥>nginx.pidæ‰“å¼€å¤±è´¥ï¼š</a></li></ul></li><li><a href=#æ—¥å¿—åˆ‡å‰²æ‰‹åŠ¨>æ—¥å¿—åˆ‡å‰²ï¼š(æ‰‹åŠ¨)</a></li><li><a href=#æ—¥å¿—åˆ‡å‰²å®šæ—¶>æ—¥å¿—åˆ‡å‰²ï¼š(å®šæ—¶)</a></li><li><a href=#è™šæ‹Ÿä¸»æœº-ä½¿ç”¨nginxä¸ºé™æ€èµ„æºæä¾›æœåŠ¡>è™šæ‹Ÿä¸»æœº-ä½¿ç”¨nginxä¸ºé™æ€èµ„æºæä¾›æœåŠ¡</a></li><li><a href=#gzipå‹ç¼©æå‡è¯·æ±‚æ•ˆç‡>gzipå‹ç¼©æå‡è¯·æ±‚æ•ˆç‡</a></li><li><a href=#locationåŒ¹é…è§„åˆ™>locationåŒ¹é…è§„åˆ™</a></li><li><a href=#dnsè§£æåŸŸå>DNSè§£æåŸŸå</a></li><li><a href=#ç”¨switchhosts-æ¨¡æ‹Ÿæœ¬åœ°åŸŸåè§£æè®¿é—®>ç”¨switchhosts æ¨¡æ‹Ÿæœ¬åœ°åŸŸåè§£æè®¿é—®</a></li><li><a href=#è·¨åŸŸè®¿é—®>è·¨åŸŸè®¿é—®</a></li><li><a href=#nginx-é˜²ç›—é“¾æŠ€æœ¯æ”¯æŒ>nginx é˜²ç›—é“¾æŠ€æœ¯æ”¯æŒ</a></li><li><a href=#nginx-æ¨¡å—åŒ–ä½“ç³»>nginx æ¨¡å—åŒ–ä½“ç³»</a></li><li><a href=#è´Ÿè½½å‡è¡¡>è´Ÿè½½å‡è¡¡</a><ul><li><a href=#å››å±‚è´Ÿè½½å‡è¡¡>å››å±‚è´Ÿè½½å‡è¡¡</a></li><li><a href=#ä¸ƒå±‚è´Ÿè½½å‡è¡¡>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</a></li><li><a href=#dns-åœ°åŸŸè´Ÿè½½å‡è¡¡>DNS åœ°åŸŸè´Ÿè½½å‡è¡¡</a></li></ul></li><li><a href=#ä½¿ç”¨nginxæ­å»ºä¸‰å°tomcaté›†ç¾¤>ä½¿ç”¨Nginxæ­å»ºä¸‰å°tomcaté›†ç¾¤</a></li><li><a href=#è´Ÿè½½å‡è¡¡ä¹‹è½®è¯¢>è´Ÿè½½å‡è¡¡ä¹‹è½®è¯¢</a></li><li><a href=#è´Ÿè½½å‡è¡¡ä¹‹æƒé‡-åŠ æƒè½®è¯¢>è´Ÿè½½å‡è¡¡ä¹‹æƒé‡-åŠ æƒè½®è¯¢</a></li><li><a href=#upstream-æŒ‡ä»¤å‚æ•°>upstream æŒ‡ä»¤å‚æ•°</a></li><li><a href=#ä½¿ç”¨keepaliveæé«˜ååé‡>ä½¿ç”¨keepaliveæé«˜ååé‡</a></li><li><a href=#è´Ÿè½½å‡è¡¡ä¹‹ip_hash>è´Ÿè½½å‡è¡¡ä¹‹ip_hash</a><ul><li><a href=#è´Ÿè½½å‡è¡¡ä¹‹url_hash>è´Ÿè½½å‡è¡¡ä¹‹<strong>url_hash</strong></a></li></ul></li><li><a href=#nginxæ§åˆ¶æµè§ˆå™¨ç¼“å­˜>nginxæ§åˆ¶æµè§ˆå™¨ç¼“å­˜</a></li><li><a href=#ä¸Šæ¸¸æœåŠ¡é™æ€å†…å®¹ç¼“å­˜>ä¸Šæ¸¸æœåŠ¡é™æ€å†…å®¹ç¼“å­˜</a></li><li><a href=#ä½¿ç”¨nginx-é…ç½®httpsåŸŸåè¯ä¹¦>ä½¿ç”¨nginx é…ç½®httpsåŸŸåè¯ä¹¦</a></li><li><a href=#é…ç½®ssl>é…ç½®ssl</a></li><li><a href=#åŠ¨é™åˆ†ç¦»>åŠ¨é™åˆ†ç¦»</a></li><li><a href=#nginxé«˜å¯ç”¨ha-keepalived-åŒæœºä¸»å¤‡>nginxé«˜å¯ç”¨HA keepalived åŒæœºä¸»å¤‡</a></li><li><a href=#å®‰è£…keepalived>å®‰è£…keepalived</a><ul><li><a href=#æ ¸å¿ƒé…ç½®æ–‡ä»¶>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</a></li><li><a href=#keepalivedé…ç½®nginxè‡ªåŠ¨å¯åŠ¨>keepalivedé…ç½®Nginxè‡ªåŠ¨å¯åŠ¨</a></li></ul></li></ul></nav></div><div class=content><h2 id=nginx-1161-å®‰è£…ä½¿ç”¨è¯´æ˜>nginx 1.16.1 å®‰è£…ä½¿ç”¨è¯´æ˜</h2><p>1.åˆ›å»ºç›®å½•</p><p>mkdir -p /var/temp/nginx</p><p>ä¸‹è½½ï¼š</p><p><a href=https://nginx.org/en/download.html>https://nginx.org/en/download.html</a></p><p>è§£å‹</p><p>tar -zxvf nginx-1.16.1.tar.gz</p><p>å®‰è£…ç¼–è¯‘ä¾èµ–åŒ…ï¼š</p><p>yum install -y gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</p><p>2.è¿›å…¥nginx-1.16.1</p><p>ç¼–è¯‘å‚æ•°</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>./configure <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--prefix<span style=color:#000;font-weight:700>=</span>/usr/local/nginx <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--pid-path<span style=color:#000;font-weight:700>=</span>/var/run/nginx/nginx.pid <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--lock-path<span style=color:#000;font-weight:700>=</span>/var/lock/nginx.lock <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--error-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/error.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/access.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--with-http_gzip_static_module <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-client-body-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/client <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-proxy-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/proxy <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-fastcgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/fastcgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-uwsgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/uwsgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-scgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/scgi
</span></span></code></pre></td></tr></table></div></div><p><a href=https://nginx.org/en/download.html>https://nginx.org/en/download.html</a></p><h3 id=config-ç¼–è¯‘å‚æ•°>config ç¼–è¯‘å‚æ•°</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>nginx1.16ç¼–è¯‘å®‰è£…configureå‚æ•°ï¼š
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@363ee3055cf0 nginx-1.16.1<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ./configure --help</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --help                             print this message æ‰“å°å¸®åŠ©ä¿¡æ¯
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --prefix<span style=color:#000;font-weight:700>=</span>PATH                      <span style=color:#0086b3>set</span> installation prefix è®¾ç½®å®‰è£…ç›®å½•
</span></span><span style=display:flex><span>  --sbin-path<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> nginx binary pathname è®¾ç½®sbinè·¯å¾„
</span></span><span style=display:flex><span>  --modules-path<span style=color:#000;font-weight:700>=</span>PATH                <span style=color:#0086b3>set</span> modules path è®¾ç½®æ¨¡å—è·¯å¾„
</span></span><span style=display:flex><span>  --conf-path<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> nginx.conf pathname è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„
</span></span><span style=display:flex><span>  --error-log-path<span style=color:#000;font-weight:700>=</span>PATH              <span style=color:#0086b3>set</span> error log pathname è®¾ç½®é”™è¯¯æ—¥å¿—çš„è·¯å¾„
</span></span><span style=display:flex><span>  --pid-path<span style=color:#000;font-weight:700>=</span>PATH                    <span style=color:#0086b3>set</span> nginx.pid pathname è®¾ç½®pidè·¯å¾„
</span></span><span style=display:flex><span>  --lock-path<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> nginx.lock pathname è®¾ç½®é”è·¯å¾„
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --user<span style=color:#000;font-weight:700>=</span>USER                        <span style=color:#0086b3>set</span> non-privileged user <span style=color:#000;font-weight:700>for</span> è®¾ç½®ç”¨æˆ·
</span></span><span style=display:flex><span>                                     worker processes
</span></span><span style=display:flex><span>  --group<span style=color:#000;font-weight:700>=</span>GROUP                      <span style=color:#0086b3>set</span> non-privileged group <span style=color:#000;font-weight:700>for</span> è®¾ç½®ç»„
</span></span><span style=display:flex><span>                                     worker processes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --build<span style=color:#000;font-weight:700>=</span>NAME                       <span style=color:#0086b3>set</span> build name è®¾ç½®æ„å»ºå
</span></span><span style=display:flex><span>  --builddir<span style=color:#000;font-weight:700>=</span>DIR                     <span style=color:#0086b3>set</span> build directory è®¾ç½®æ„å»ºæ–‡ä»¶å¤¹
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-select_module               <span style=color:#0086b3>enable</span> <span style=color:#000;font-weight:700>select</span> module å¼€å¯selectæ¨¡å—
</span></span><span style=display:flex><span>  --without-select_module            disable <span style=color:#000;font-weight:700>select</span> moduleå…³é—­
</span></span><span style=display:flex><span>  --with-poll_module                 <span style=color:#0086b3>enable</span> poll module
</span></span><span style=display:flex><span>  --without-poll_module              disable poll module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-threads                     <span style=color:#0086b3>enable</span> thread pool support
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-file-aio                    <span style=color:#0086b3>enable</span> file AIO support
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-http_ssl_module             <span style=color:#0086b3>enable</span> ngx_http_ssl_module
</span></span><span style=display:flex><span>  --with-http_v2_module              <span style=color:#0086b3>enable</span> ngx_http_v2_module
</span></span><span style=display:flex><span>  --with-http_realip_module          <span style=color:#0086b3>enable</span> ngx_http_realip_module
</span></span><span style=display:flex><span>  --with-http_addition_module        <span style=color:#0086b3>enable</span> ngx_http_addition_module
</span></span><span style=display:flex><span>  --with-http_xslt_module            <span style=color:#0086b3>enable</span> ngx_http_xslt_module
</span></span><span style=display:flex><span>  --with-http_xslt_module<span style=color:#000;font-weight:700>=</span>dynamic    <span style=color:#0086b3>enable</span> dynamic ngx_http_xslt_module
</span></span><span style=display:flex><span>  --with-http_image_filter_module    <span style=color:#0086b3>enable</span> ngx_http_image_filter_module
</span></span><span style=display:flex><span>  --with-http_image_filter_module<span style=color:#000;font-weight:700>=</span>dynamic
</span></span><span style=display:flex><span>                                     <span style=color:#0086b3>enable</span> dynamic ngx_http_image_filter_module
</span></span><span style=display:flex><span>  --with-http_geoip_module           <span style=color:#0086b3>enable</span> ngx_http_geoip_module
</span></span><span style=display:flex><span>  --with-http_geoip_module<span style=color:#000;font-weight:700>=</span>dynamic   <span style=color:#0086b3>enable</span> dynamic ngx_http_geoip_module
</span></span><span style=display:flex><span>  --with-http_sub_module             <span style=color:#0086b3>enable</span> ngx_http_sub_module
</span></span><span style=display:flex><span>  --with-http_dav_module             <span style=color:#0086b3>enable</span> ngx_http_dav_module
</span></span><span style=display:flex><span>  --with-http_flv_module             <span style=color:#0086b3>enable</span> ngx_http_flv_module
</span></span><span style=display:flex><span>  --with-http_mp4_module             <span style=color:#0086b3>enable</span> ngx_http_mp4_module
</span></span><span style=display:flex><span>  --with-http_gunzip_module          <span style=color:#0086b3>enable</span> ngx_http_gunzip_module
</span></span><span style=display:flex><span>  --with-http_gzip_static_module     <span style=color:#0086b3>enable</span> ngx_http_gzip_static_module
</span></span><span style=display:flex><span>  --with-http_auth_request_module    <span style=color:#0086b3>enable</span> ngx_http_auth_request_module
</span></span><span style=display:flex><span>  --with-http_random_index_module    <span style=color:#0086b3>enable</span> ngx_http_random_index_module
</span></span><span style=display:flex><span>  --with-http_secure_link_module     <span style=color:#0086b3>enable</span> ngx_http_secure_link_module
</span></span><span style=display:flex><span>  --with-http_degradation_module     <span style=color:#0086b3>enable</span> ngx_http_degradation_module
</span></span><span style=display:flex><span>  --with-http_slice_module           <span style=color:#0086b3>enable</span> ngx_http_slice_module
</span></span><span style=display:flex><span>  --with-http_stub_status_module     <span style=color:#0086b3>enable</span> ngx_http_stub_status_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --without-http_charset_module      disable ngx_http_charset_module
</span></span><span style=display:flex><span>  --without-http_gzip_module         disable ngx_http_gzip_module
</span></span><span style=display:flex><span>  --without-http_ssi_module          disable ngx_http_ssi_module
</span></span><span style=display:flex><span>  --without-http_userid_module       disable ngx_http_userid_module
</span></span><span style=display:flex><span>  --without-http_access_module       disable ngx_http_access_module
</span></span><span style=display:flex><span>  --without-http_auth_basic_module   disable ngx_http_auth_basic_module
</span></span><span style=display:flex><span>  --without-http_mirror_module       disable ngx_http_mirror_module
</span></span><span style=display:flex><span>  --without-http_autoindex_module    disable ngx_http_autoindex_module
</span></span><span style=display:flex><span>  --without-http_geo_module          disable ngx_http_geo_module
</span></span><span style=display:flex><span>  --without-http_map_module          disable ngx_http_map_module
</span></span><span style=display:flex><span>  --without-http_split_clients_module disable ngx_http_split_clients_module
</span></span><span style=display:flex><span>  --without-http_referer_module      disable ngx_http_referer_module
</span></span><span style=display:flex><span>  --without-http_rewrite_module      disable ngx_http_rewrite_module
</span></span><span style=display:flex><span>  --without-http_proxy_module        disable ngx_http_proxy_module
</span></span><span style=display:flex><span>  --without-http_fastcgi_module      disable ngx_http_fastcgi_module
</span></span><span style=display:flex><span>  --without-http_uwsgi_module        disable ngx_http_uwsgi_module
</span></span><span style=display:flex><span>  --without-http_scgi_module         disable ngx_http_scgi_module
</span></span><span style=display:flex><span>  --without-http_grpc_module         disable ngx_http_grpc_module
</span></span><span style=display:flex><span>  --without-http_memcached_module    disable ngx_http_memcached_module
</span></span><span style=display:flex><span>  --without-http_limit_conn_module   disable ngx_http_limit_conn_module
</span></span><span style=display:flex><span>  --without-http_limit_req_module    disable ngx_http_limit_req_module
</span></span><span style=display:flex><span>  --without-http_empty_gif_module    disable ngx_http_empty_gif_module
</span></span><span style=display:flex><span>  --without-http_browser_module      disable ngx_http_browser_module
</span></span><span style=display:flex><span>  --without-http_upstream_hash_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_hash_module
</span></span><span style=display:flex><span>  --without-http_upstream_ip_hash_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_ip_hash_module
</span></span><span style=display:flex><span>  --without-http_upstream_least_conn_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_least_conn_module
</span></span><span style=display:flex><span>  --without-http_upstream_random_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_random_module
</span></span><span style=display:flex><span>  --without-http_upstream_keepalive_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_keepalive_module
</span></span><span style=display:flex><span>  --without-http_upstream_zone_module
</span></span><span style=display:flex><span>                                     disable ngx_http_upstream_zone_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-http_perl_module            <span style=color:#0086b3>enable</span> ngx_http_perl_module
</span></span><span style=display:flex><span>  --with-http_perl_module<span style=color:#000;font-weight:700>=</span>dynamic    <span style=color:#0086b3>enable</span> dynamic ngx_http_perl_module
</span></span><span style=display:flex><span>  --with-perl_modules_path<span style=color:#000;font-weight:700>=</span>PATH      <span style=color:#0086b3>set</span> Perl modules path
</span></span><span style=display:flex><span>  --with-perl<span style=color:#000;font-weight:700>=</span>PATH                   <span style=color:#0086b3>set</span> perl binary pathname
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --http-log-path<span style=color:#000;font-weight:700>=</span>PATH               <span style=color:#0086b3>set</span> http access log pathname
</span></span><span style=display:flex><span>  --http-client-body-temp-path<span style=color:#000;font-weight:700>=</span>PATH  <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http client request body temporary files
</span></span><span style=display:flex><span>  --http-proxy-temp-path<span style=color:#000;font-weight:700>=</span>PATH        <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http proxy temporary files
</span></span><span style=display:flex><span>  --http-fastcgi-temp-path<span style=color:#000;font-weight:700>=</span>PATH      <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http fastcgi temporary files
</span></span><span style=display:flex><span>  --http-uwsgi-temp-path<span style=color:#000;font-weight:700>=</span>PATH        <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http uwsgi temporary files
</span></span><span style=display:flex><span>  --http-scgi-temp-path<span style=color:#000;font-weight:700>=</span>PATH         <span style=color:#0086b3>set</span> path to store
</span></span><span style=display:flex><span>                                     http scgi temporary files
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --without-http                     disable HTTP server
</span></span><span style=display:flex><span>  --without-http-cache               disable HTTP cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-mail                        <span style=color:#0086b3>enable</span> POP3/IMAP4/SMTP proxy module
</span></span><span style=display:flex><span>  --with-mail<span style=color:#000;font-weight:700>=</span>dynamic                <span style=color:#0086b3>enable</span> dynamic POP3/IMAP4/SMTP proxy module
</span></span><span style=display:flex><span>  --with-mail_ssl_module             <span style=color:#0086b3>enable</span> ngx_mail_ssl_module
</span></span><span style=display:flex><span>  --without-mail_pop3_module         disable ngx_mail_pop3_module
</span></span><span style=display:flex><span>  --without-mail_imap_module         disable ngx_mail_imap_module
</span></span><span style=display:flex><span>  --without-mail_smtp_module         disable ngx_mail_smtp_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-stream                      <span style=color:#0086b3>enable</span> TCP/UDP proxy module
</span></span><span style=display:flex><span>  --with-stream<span style=color:#000;font-weight:700>=</span>dynamic              <span style=color:#0086b3>enable</span> dynamic TCP/UDP proxy module
</span></span><span style=display:flex><span>  --with-stream_ssl_module           <span style=color:#0086b3>enable</span> ngx_stream_ssl_module
</span></span><span style=display:flex><span>  --with-stream_realip_module        <span style=color:#0086b3>enable</span> ngx_stream_realip_module
</span></span><span style=display:flex><span>  --with-stream_geoip_module         <span style=color:#0086b3>enable</span> ngx_stream_geoip_module
</span></span><span style=display:flex><span>  --with-stream_geoip_module<span style=color:#000;font-weight:700>=</span>dynamic <span style=color:#0086b3>enable</span> dynamic ngx_stream_geoip_module
</span></span><span style=display:flex><span>  --with-stream_ssl_preread_module   <span style=color:#0086b3>enable</span> ngx_stream_ssl_preread_module
</span></span><span style=display:flex><span>  --without-stream_limit_conn_module disable ngx_stream_limit_conn_module
</span></span><span style=display:flex><span>  --without-stream_access_module     disable ngx_stream_access_module
</span></span><span style=display:flex><span>  --without-stream_geo_module        disable ngx_stream_geo_module
</span></span><span style=display:flex><span>  --without-stream_map_module        disable ngx_stream_map_module
</span></span><span style=display:flex><span>  --without-stream_split_clients_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_split_clients_module
</span></span><span style=display:flex><span>  --without-stream_return_module     disable ngx_stream_return_module
</span></span><span style=display:flex><span>  --without-stream_upstream_hash_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_hash_module
</span></span><span style=display:flex><span>  --without-stream_upstream_least_conn_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_least_conn_module
</span></span><span style=display:flex><span>  --without-stream_upstream_random_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_random_module
</span></span><span style=display:flex><span>  --without-stream_upstream_zone_module
</span></span><span style=display:flex><span>                                     disable ngx_stream_upstream_zone_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-google_perftools_module     <span style=color:#0086b3>enable</span> ngx_google_perftools_module
</span></span><span style=display:flex><span>  --with-cpp_test_module             <span style=color:#0086b3>enable</span> ngx_cpp_test_module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --add-module<span style=color:#000;font-weight:700>=</span>PATH                  <span style=color:#0086b3>enable</span> external module
</span></span><span style=display:flex><span>  --add-dynamic-module<span style=color:#000;font-weight:700>=</span>PATH          <span style=color:#0086b3>enable</span> dynamic external module
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-compat                      dynamic modules compatibility
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-cc<span style=color:#000;font-weight:700>=</span>PATH                     <span style=color:#0086b3>set</span> C compiler pathname
</span></span><span style=display:flex><span>  --with-cpp<span style=color:#000;font-weight:700>=</span>PATH                    <span style=color:#0086b3>set</span> C preprocessor pathname
</span></span><span style=display:flex><span>  --with-cc-opt<span style=color:#000;font-weight:700>=</span>OPTIONS              <span style=color:#0086b3>set</span> additional C compiler options
</span></span><span style=display:flex><span>  --with-ld-opt<span style=color:#000;font-weight:700>=</span>OPTIONS              <span style=color:#0086b3>set</span> additional linker options
</span></span><span style=display:flex><span>  --with-cpu-opt<span style=color:#000;font-weight:700>=</span>CPU                 build <span style=color:#000;font-weight:700>for</span> the specified CPU, valid values:
</span></span><span style=display:flex><span>                                     pentium, pentiumpro, pentium3, pentium4,
</span></span><span style=display:flex><span>                                     athlon, opteron, sparc32, sparc64, ppc64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --without-pcre                     disable PCRE library usage
</span></span><span style=display:flex><span>  --with-pcre                        force PCRE library usage
</span></span><span style=display:flex><span>  --with-pcre<span style=color:#000;font-weight:700>=</span>DIR                    <span style=color:#0086b3>set</span> path to PCRE library sources
</span></span><span style=display:flex><span>  --with-pcre-opt<span style=color:#000;font-weight:700>=</span>OPTIONS            <span style=color:#0086b3>set</span> additional build options <span style=color:#000;font-weight:700>for</span> PCRE
</span></span><span style=display:flex><span>  --with-pcre-jit                    build PCRE with JIT compilation support
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-zlib<span style=color:#000;font-weight:700>=</span>DIR                    <span style=color:#0086b3>set</span> path to zlib library sources
</span></span><span style=display:flex><span>  --with-zlib-opt<span style=color:#000;font-weight:700>=</span>OPTIONS            <span style=color:#0086b3>set</span> additional build options <span style=color:#000;font-weight:700>for</span> zlib
</span></span><span style=display:flex><span>  --with-zlib-asm<span style=color:#000;font-weight:700>=</span>CPU                use zlib assembler sources optimized
</span></span><span style=display:flex><span>                                     <span style=color:#000;font-weight:700>for</span> the specified CPU, valid values:
</span></span><span style=display:flex><span>                                     pentium, pentiumpro
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-libatomic                   force libatomic_ops library usage
</span></span><span style=display:flex><span>  --with-libatomic<span style=color:#000;font-weight:700>=</span>DIR               <span style=color:#0086b3>set</span> path to libatomic_ops library sources
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-openssl<span style=color:#000;font-weight:700>=</span>DIR                 <span style=color:#0086b3>set</span> path to OpenSSL library sources
</span></span><span style=display:flex><span>  --with-openssl-opt<span style=color:#000;font-weight:700>=</span>OPTIONS         <span style=color:#0086b3>set</span> additional build options <span style=color:#000;font-weight:700>for</span> OpenSSL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --with-debug                       <span style=color:#0086b3>enable</span> debug logging
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic>#ç¼–è¯‘</span>
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#å®‰è£…</span>
</span></span><span style=display:flex><span>make install 
</span></span></code></pre></td></tr></table></div></div><p>whereis nginx</p><p>åœ¨/usr/local/nginx/sbin/å†…</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>./nginx å¯åŠ¨
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> ./nginx -s stop å¼ºåˆ¶åœæ­¢
</span></span><span style=display:flex><span> ./nginx -s quit ä¼˜é›…åœæ­¢
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./nginx -s reload é‡æ–°åŠ è½½
</span></span><span style=display:flex><span>./nginx -t é…ç½®æ£€æµ‹
</span></span><span style=display:flex><span>./nginx -v ç‰ˆæœ¬ä¿¡æ¯
</span></span><span style=display:flex><span>./nginx -V è¯¦ç»†ä¿¡æ¯
</span></span><span style=display:flex><span>./nginx -h å¸®åŠ©
</span></span><span style=display:flex><span>./nginx -c æŒ‡å®šé…ç½®æ–‡ä»¶
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„ï¼š</p><p>1.äº‘æœåŠ¡å™¨éœ€è¦é»˜è®¤å¼€å¯nginx 80</p><p>2.è™šæ‹Ÿæœºå®‰è£…ï¼Œéœ€è¦å…³é—­é˜²ç«å¢™</p><p>3.æœ¬æœºwinæˆ–macéœ€è¦å…³é—­é˜²ç«å¢™</p><p>nginx.conf</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>80</span>; 						<span style=color:#a61717;background-color:#e3d2d2>#</span>ç›‘å¬ç«¯å£
</span></span><span style=display:flex><span>        server_name  localhost;					<span style=color:#a61717;background-color:#e3d2d2>#</span>åŸŸå
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {							<span style=color:#a61717;background-color:#e3d2d2>#</span> <span style=color:#000;font-weight:700>/</span> ä»æ ¹å¼€å§‹åŒ¹é…<span style=color:#a61717;background-color:#e3d2d2>ã€‚</span>htmlæ–‡ä»¶å¤¹å†…çš„index index.html index.htm
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  index.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        error_page   <span style=color:#099>500</span> <span style=color:#099>502</span> <span style=color:#099>503</span> <span style=color:#099>504</span>  <span style=color:#000;font-weight:700>/</span><span style=color:#099>50</span>x.html;   <span style=color:#a61717;background-color:#e3d2d2>#</span>åŒ¹é…ä¸åˆ°è‡ªåŠ¨è½¬åˆ°é”™è¯¯é¡µ<span style=color:#a61717;background-color:#e3d2d2>ã€‚</span>html<span style=color:#000;font-weight:700>/</span><span style=color:#099>50</span>x.html 
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>=</span> <span style=color:#a61717;background-color:#e3d2d2>/50x.html {</span>
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>æ›´æ”¹ 80 ç«¯å£åéœ€é‡æ–°åŠ è½½ã€‚</p><p>cd /usr/local/nginx/sbin</p><p>./nginx -s reload</p><p>è®¿é—®ï¼šip+ç›‘å¬ç«¯å£</p><h2 id=nginx-çš„è¿›ç¨‹æ¨¡å‹>nginx çš„è¿›ç¨‹æ¨¡å‹</h2><p>master ä¸»è¿›ç¨‹</p><p>worker å·¥ä½œè¿›ç¨‹</p><p>worker_processes 2; # é»˜è®¤ä¸º1,é…ç½®ä¸ºn-1 .nä¸ºcpuæ•°é‡ã€‚</p><h3 id=nginxäº‹ä»¶å¤„ç†å¼‚æ­¥éé˜»å¡>nginxäº‹ä»¶å¤„ç†ã€‚å¼‚æ­¥éé˜»å¡ã€‚</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>events {
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> é»˜è®¤ä½¿ç”¨epoll
</span></span><span style=display:flex><span>    use epoll;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> æ¯ä¸ªworker å…è®¸è¿æ¥çš„å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•°
</span></span><span style=display:flex><span>    worker_connections  <span style=color:#099>10240</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=é…ç½®æ–‡ä»¶è¯¦è§£>é…ç½®æ–‡ä»¶è¯¦è§£ï¼š</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>89</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>/usr/local/nginx/html/imooc.html</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:navy>html</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>title</span>&gt;Welcome to immoc!&lt;/<span style=color:navy>title</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>style</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:navy>body</span> {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>width</span>: <span style=color:#099>35</span><span style=color:#458;font-weight:700>em</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>margin</span>: <span style=color:#099>0</span> <span style=color:#000;font-weight:700>auto</span>;
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>font-family</span>: Tahoma, Verdana, Arial, <span style=color:#000;font-weight:700>sans-serif</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>style</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>body</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:navy>h1</span>&gt;Welcome imooc!&lt;/<span style=color:navy>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:navy>html</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>æˆ–è€…ï¼š</p><p>nginx.confä¸­æ·»åŠ </p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>  include       imooc.conf;
</span></span></code></pre></td></tr></table></div></div><p>åˆ›å»ºimooc.confæ–‡ä»¶ã€‚</p><p>/usr/local/nginx/conf/imooc.conf</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>   server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>89</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>æ¯æ¬¡æ›´æ”¹åéƒ½è¦é‡å¯æœåŠ¡ã€‚</p><h2 id=å¸¸è§pidæŠ¥é”™>å¸¸è§pidæŠ¥é”™</h2><h3 id=nginxpidæ‰“å¼€å¤±è´¥>nginx.pidæ‰“å¼€å¤±è´¥ï¼š</h3><p>1.nginx: [error] invalid PID number "" in &ldquo;/usr/local/nginx/logs/nginx.pid&rdquo;</p><p>è§£å†³æ–¹æ³•ï¼š</p><p>ä½¿ç”¨nginx -cçš„å‚æ•°æŒ‡å®šnginx.confæ–‡ä»¶çš„ä½ç½®
ç„¶åå†é‡æ–°å¯åŠ¨ï¼Œè§£å†³é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ps -ef|grep nginx çœ‹åˆ°æœåŠ¡å·²ç»å¯åŠ¨æˆåŠŸã€‚</p><p>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</p><p>2.nginx: [error] open() &ldquo;/var/run/nginx/nginx.pid&rdquo; failed (2: No such file or directory)</p><p>æç¤ºä¿¡æ¯è¯´æ˜åœ¨ <strong>/var/run/nginx/</strong> ç›®å½•ä¸‹æ‰¾ä¸åˆ° <strong>nginx.pid</strong> æ–‡ä»¶ï¼Œè§£å†³æ–¹å¼æœ‰ä¸¤ç§</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼šåˆ›å»ºé»˜è®¤ç›®å½• <strong>/var/run/nginx/</strong> ï¼›</p><p>ç¬¬äºŒç§æ–¹å¼ï¼šä¿®æ”¹ <strong>nginx.conf</strong> æ–‡ä»¶ï¼ŒæŒ‡å®š <strong>pidæ–‡ä»¶</strong> æ‰€åœ¨ç›®å½•ã€‚</p><h2 id=æ—¥å¿—åˆ‡å‰²æ‰‹åŠ¨>æ—¥å¿—åˆ‡å‰²ï¼š(æ‰‹åŠ¨)</h2><p>cat_my_log.sh</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span><span style=color:teal>LOG_PATH</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;/var/log/nginx/&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>RECORD_TIME</span><span style=color:#000;font-weight:700>=</span><span style=color:#000;font-weight:700>$(</span>date -d <span style=color:#d14>&#34;yesterday&#34;</span> +%Y-%m-%d+%H:%M<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:teal>PID</span><span style=color:#000;font-weight:700>=</span>/var/run/nginx/nginx.pid
</span></span><span style=display:flex><span>mv <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/access.log <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/access.<span style=color:#d14>${</span><span style=color:teal>RECORD_TIME</span><span style=color:#d14>}</span>.log
</span></span><span style=display:flex><span>mv <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/error.log <span style=color:#d14>${</span><span style=color:teal>LOG_PATH</span><span style=color:#d14>}</span>/error.<span style=color:#d14>${</span><span style=color:teal>RECORD_TIME</span><span style=color:#d14>}</span>.log
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#å‘nginxä¸»è¿›ç¨‹å‘é€ä¿¡å·ï¼Œç”¨äºé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#0086b3>kill</span> -USR1 <span style=color:#d14>`</span>cat <span style=color:teal>$PID</span><span style=color:#d14>`</span>
</span></span></code></pre></td></tr></table></div></div><p>chmod +x cat_my_log.sh</p><h2 id=æ—¥å¿—åˆ‡å‰²å®šæ—¶>æ—¥å¿—åˆ‡å‰²ï¼š(å®šæ—¶)</h2><p>1.å®‰è£…å®šæ—¶ä»»åŠ¡</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum install crontabs
</span></span></code></pre></td></tr></table></div></div><p>2.crontab -e ç¼–è¾‘å¹¶æ·»åŠ ä¸€è¡Œæ–°çš„ä»»åŠ¡</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>*/1 * * * * /usr/local/nginx/sbin/cut_my_log.sh
</span></span></code></pre></td></tr></table></div></div><p>3.é‡å¯å®šæ—¶ä»»åŠ¡</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>service crond restart 
</span></span></code></pre></td></tr></table></div></div><p>4.å¸¸ç”¨å®šæ—¶ä»»åŠ¡</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>service crond start 
</span></span><span style=display:flex><span>service crond stop 
</span></span><span style=display:flex><span>service crond reload <span style=color:#998;font-style:italic>#é‡æ–°åŠ è½½</span>
</span></span><span style=display:flex><span>service crond restart  <span style=color:#998;font-style:italic>#é‡å¯æœåŠ¡</span>
</span></span><span style=display:flex><span>crontab -l <span style=color:#998;font-style:italic>#æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨</span>
</span></span><span style=display:flex><span>crontab -e <span style=color:#998;font-style:italic># ç¼–è¾‘ä»»åŠ¡</span>
</span></span></code></pre></td></tr></table></div></div><p>æ¯åˆ†é’Ÿæ‰§è¡Œ</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>*/1 * * * *
</span></span></code></pre></td></tr></table></div></div><p>æ¯æ—¥å‡Œæ™¨ï¼ˆæ¯å¤©æ™šä¸Š23ï¼š59ï¼‰æ‰§è¡Œï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#099>59</span> <span style=color:#099>23</span> * * *
</span></span></code></pre></td></tr></table></div></div><p>æ¯æ—¥å‡Œæ™¨1ç‚¹æ‰§è¡Œï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#099>0</span> <span style=color:#099>1</span> * * *
</span></span></code></pre></td></tr></table></div></div><p>æ¯å¤©ä¸ºæ•°æ®åº“å®šæ—¶å¤‡ä»½ï¼š<a href=https://www.cnblogs.com/leechenxiang/p/7110382.html>å‚è€ƒ</a></p><h2 id=è™šæ‹Ÿä¸»æœº-ä½¿ç”¨nginxä¸ºé™æ€èµ„æºæä¾›æœåŠ¡>è™šæ‹Ÿä¸»æœº-ä½¿ç”¨nginxä¸ºé™æ€èµ„æºæä¾›æœåŠ¡</h2><p>é™æ€èµ„æºå¯ä»¥æ˜¯mp4ã€pngã€jpgç­‰ç­‰ã€‚</p><p>/usr/local/nginx/conf/imooc.confä¸­åˆ›å»ºé™æ€èµ„æºè·¯å¾„ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>90</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>foodie<span style=color:#000;font-weight:700>-</span>shop;
</span></span><span style=display:flex><span>            index  index.html;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span><span style=color:#000;font-weight:700>static</span> {
</span></span><span style=display:flex><span>	    alias <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>imooc;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span>imooc {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>è¯·æ±‚/home/imoocä¸‹çš„èµ„æºã€‚</p><p>ä¸¤ç§å†™æ³•ï¼š</p><p>ä¸€ã€æ­£å¸¸è¯·æ±‚ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span>imooc {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>ç›´æ¥è¯·æ±‚ï¼š</p><p>http://10.4.7.129:90/imooc/456.jpg</p><p>äºŒã€ç»™è·¯å¾„èµ·åˆ«åï¼š</p><p>å°†/home/imoocåˆ›å»ºåˆ«å ä¸º/static</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span><span style=color:#000;font-weight:700>static</span> {
</span></span><span style=display:flex><span>	    alias <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>imooc;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>è¯·æ±‚æ—¶ç”¨åˆ«åè¯·æ±‚</p><p>http://10.4.7.129:90/static/456.jpg</p><p>å°†imooc.confæ–‡ä»¶å†…å®¹åº”ç”¨åˆ°nginx.confä¸­</p><p>ç¼–è¾‘/usr/local/nginx/conf/nginx.conf</p><p>å•ç‹¬æ·»åŠ ä¸€è¡Œï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>    include       imooc.conf;
</span></span></code></pre></td></tr></table></div></div><p>æ£€æµ‹é…ç½®æ˜¯å¦æ­£ç¡®ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/usr/local/nginx/sbin/nginx -t 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
</span></span><span style=display:flex><span>nginx: configuration file /usr/local/nginx/conf/nginx.conf <span style=color:#0086b3>test</span> is successful
</span></span></code></pre></td></tr></table></div></div><p>é‡å¯nginx</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/usr/local/nginx/sbin/nginx -s reload 
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•ç»“æœï¼š</p><p>http://10.4.7.129:90/imooc/456.jpg</p><p>http://10.4.7.129:90/static/456.jpg</p><h2 id=gzipå‹ç¼©æå‡è¯·æ±‚æ•ˆç‡>gzipå‹ç¼©æå‡è¯·æ±‚æ•ˆç‡</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#998;font-style:italic>#å¼€å¯gzipå‹ç¼©åŠŸèƒ½ï¼Œç›®çš„ï¼šæé«˜ä¼ è¾“æ•ˆç‡ï¼ŒèŠ‚çº¦å¸¦å®½</span>
</span></span><span style=display:flex><span>gzip  on;
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#é™åˆ¶æœ€å°å‹ç¼©ï¼Œå°äº1å­—èŠ‚çš„æ–‡ä»¶ä¸ä¼šå‹ç¼©</span>
</span></span><span style=display:flex><span>gzip_min_length 1;
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#çš„å®šä¹‰å‹ç¼©çš„çº§åˆ«ï¼ˆå‹ç¼©æ¯”ï¼Œæ–‡ä»¶è¶Šå¤§ï¼Œå‹ç¼©è¶Šå¤šï¼Œä½†æ˜¯cpuä½¿ç”¨ä¼šè¶Šå¤šï¼‰ </span>
</span></span><span style=display:flex><span>gzip_comp_level 3;
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#å®šä¹‰å‹ç¼©æ–‡ä»¶ç±»å‹</span>
</span></span><span style=display:flex><span>gzip_types text/plain application/javascript application/x-javascript test/css application/xml text/javascript application/x-httpd/php image/jpeg image/gif image/png application/json;
</span></span></code></pre></td></tr></table></div></div><h2 id=locationåŒ¹é…è§„åˆ™>locationåŒ¹é…è§„åˆ™</h2><p>ç©ºæ ¼ï¼šé»˜è®¤åŒ¹é…ï¼Œæ™®é€šåŒ¹é…</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>91</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        location  <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>= ï¼šç²¾ç¡®åŒ¹é…</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>91</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>ç²¾ç¡®åŒ¹é…
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>=</span> <span style=color:#a61717;background-color:#e3d2d2>/ {</span>
</span></span><span style=display:flex><span>            root   html;
</span></span><span style=display:flex><span>            index  imooc.html index.htm;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/home/imooc/img
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 img<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>808</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root  <span style=color:#099>25125</span> Jun <span style=color:#099>30</span> 19:40 456.jpg
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root  <span style=color:#099>25125</span> Dec <span style=color:#099>19</span> 00:12 456.JPG
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root <span style=color:#099>383222</span> Dec <span style=color:#099>13</span> 19:25 AutoPlayOptIn.gif
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root <span style=color:#099>383222</span> Dec <span style=color:#099>19</span> 00:17 AutoPlayOptIn.GIF
</span></span></code></pre></td></tr></table></div></div><p>~* ï¼šåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œ*ä»£è¡¨ä¸åŒºåˆ†å¤§å°å†™</p><p>http://10.4.7.129:92/imooc/img/456.JGP (å¯ä»¥è®¿é—®)ä¸è®ºæ˜¯å¦å®šä¹‰äº†.JPGè¿™ç§ç±»å‹éƒ½èƒ½è®¿é—®ã€‚</p><p>~ ï¼šåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒºåˆ†å¤§å°å†™</p><p>http://10.4.7.129:92/imooc/img/456.JGP (ä¸èƒ½è®¿é—®)å› ä¸ºæ²¡æœ‰å®šä¹‰.JPGè¿™ç§ç±»å‹èƒ½è®¿é—®ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>92</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>æ­£åˆ™è¡¨è¾¾å¼<span style=color:#a61717;background-color:#e3d2d2>ã€‚</span><span style=color:#000;font-weight:700>*</span>ä»£è¡¨ä¸åŒºåˆ†å¤§å°å†™
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>~*</span> <span style=color:#a61717;background-color:#e3d2d2>\</span>.(GIF<span style=color:#000;font-weight:700>|</span>png<span style=color:#000;font-weight:700>|</span>bmp<span style=color:#000;font-weight:700>|</span>jpg<span style=color:#000;font-weight:700>|</span>jpeg) {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>92</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>æ­£åˆ™è¡¨è¾¾å¼<span style=color:#a61717;background-color:#e3d2d2>ã€‚</span><span style=color:#000;font-weight:700>*</span>ä»£è¡¨ä¸åŒºåˆ†å¤§å°å†™
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>~</span> <span style=color:#a61717;background-color:#e3d2d2>\</span>.(GIF<span style=color:#000;font-weight:700>|</span>png<span style=color:#000;font-weight:700>|</span>bmp<span style=color:#000;font-weight:700>|</span>jpg<span style=color:#000;font-weight:700>|</span>jpeg) {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>^~ ä»¥æŸä¸ªå­—ç¬¦è·¯å¾„å¼€å¤´è¯·æ±‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>93</span>;
</span></span><span style=display:flex><span>        server_name  localhost;
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#000;font-weight:700>^~</span> ä»¥æŸä¸ªå­—ç¬¦è·¯å¾„å¼€å¤´è¯·æ±‚
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>^~</span> <span style=color:#009926>/imooc/img</span> {
</span></span><span style=display:flex><span>            root   <span style=color:#000;font-weight:700>/</span>home;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=dnsè§£æåŸŸå>DNSè§£æåŸŸå</h2><p>user-> client(<a href=https://www.imooc.com>www.imooc.com</a>) -> nginx(ä»£ç†æœåŠ¡å™¨192.168.1.88 å°åŒºå¤§é—¨) &mdash;> tomcat1 ï¼ˆç›®æ ‡æœåŠ¡å™¨ å†…ç½‘ï¼‰ ##å·æ¥¼##å®¤</p><p>â€‹ &mdash;> tomcat2 ï¼ˆç›®æ ‡æœåŠ¡å™¨ å†…ç½‘ï¼‰##å·æ¥¼##å®¤</p><h2 id=ç”¨switchhosts-æ¨¡æ‹Ÿæœ¬åœ°åŸŸåè§£æè®¿é—®>ç”¨switchhosts æ¨¡æ‹Ÿæœ¬åœ°åŸŸåè§£æè®¿é—®</h2><p><a href=https://cloud.tencent.com/developer/article/1408956>https://cloud.tencent.com/developer/article/1408956</a></p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Foldj%2FSwitchHosts%2Freleases%2Fdownload%2Fv3.3.12%2FSwitchHosts-win32-ia32_v3.3.12.5349.zip">https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Foldj%2FSwitchHosts%2Freleases%2Fdownload%2Fv3.3.12%2FSwitchHosts-win32-ia32_v3.3.12.5349.zip</a></p><p>è‡ªå®šä¹‰hosts ä¸€é”®åˆ‡æ¢ã€‚ä¸ç”¨æ›´æ”¹æœ¬æœºhosts</p><p>å®šä¹‰nginx-dev-imooc çš„hosts</p><p>æ·»åŠ æ˜ å°„ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>10.4.7.129 www.imooc.com
</span></span></code></pre></td></tr></table></div></div><p>è®¿é—®ï¼š</p><p><a href=https://www.imooc.com>www.imooc.com</a> æ˜¾ç¤º10.4.7.129 é»˜è®¤ç•Œé¢</p><h2 id=è·¨åŸŸè®¿é—®>è·¨åŸŸè®¿é—®</h2><p><img src=/postimages/nginx%E8%B7%A8%E5%9F%9F.webp alt=nginxè·¨åŸŸ></p><p><img src=/postimages/nginx%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AEsuccess.webp alt=nginxè·¨åŸŸè®¿é—®success></p><p><img src=/postimages/cors%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB.webp alt=corsè·¨åŸŸèµ„æºå…±äº«></p><p>å½“å‡ºç°403è·¨åŸŸé”™è¯¯çš„æ—¶å€™ <code>No 'Access-Control-Allow-Origin' header is present on the requested resource</code>ï¼Œéœ€è¦ç»™NginxæœåŠ¡å™¨é…ç½®å“åº”çš„headerå‚æ•°ï¼š</p><p>åªéœ€è¦åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹å‚æ•°ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>location <span style=color:#000;font-weight:700>/</span> { 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span><span style=color:#000;font-weight:700>*</span>ä»£è¡¨æ‰€æœ‰
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Origin&#39;</span> <span style=color:#000;font-weight:700>*</span>;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>å…è®¸è¯·æ±‚çš„æ–¹æ³•<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>æ¯”å¦‚GET, POST, DELETE<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>PUT
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Methods&#39;</span> <span style=color:#000;font-weight:700>*</span>;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Credentails&#39;</span> <span style=color:#d14>&#39;true&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>å…è®¸è¯·æ±‚çš„HEADER
</span></span><span style=display:flex><span>    add_header <span style=color:#d14>&#39;Access-Control-Allow-Headers&#39;</span> <span style=color:#000;font-weight:700>*</span>;
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> ($request_method <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;OPTIONS&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#099>204</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>} 
</span></span></code></pre></td></tr></table></div></div><h2 id=nginx-é˜²ç›—é“¾æŠ€æœ¯æ”¯æŒ>nginx é˜²ç›—é“¾æŠ€æœ¯æ”¯æŒ</h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>å¯¹æºç«™ç‚¹éªŒè¯
</span></span><span style=display:flex><span>valid_referers <span style=color:#000;font-weight:700>*</span>.imooc.com;
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>éæ³•å¼•å…¥ä¼šè¿›å…¥ä¸‹æ–¹åˆ¤æ–­
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> ($invalid_referer) {
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>return</span> <span style=color:#099>404</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=nginx-æ¨¡å—åŒ–ä½“ç³»>nginx æ¨¡å—åŒ–ä½“ç³»</h2><p><img src=/postimages/nginx%E6%A8%A1%E5%9D%97%E5%8C%96%E4%BD%93%E7%B3%BB.webp alt=nginxæ¨¡å—åŒ–ä½“ç³»></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 nginx-1.16.1<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>756</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>6</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 auto       <span style=color:#998;font-style:italic>#ä¸€äº›åˆ¤æ–­æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œç¼–è¯‘ç­‰ç›¸å…³çš„æ–‡ä»¶</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>296463</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> CHANGES    <span style=color:#998;font-style:italic>#ç‰ˆæœ¬çš„æ›´æ”¹æ—¥å¿—</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>452171</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> CHANGES.ru <span style=color:#998;font-style:italic>#ä¿„ç‰ˆç‰ˆæœ¬çš„æ›´æ”¹æ—¥å¿—</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>    <span style=color:#099>168</span> Dec <span style=color:#099>17</span> 04:04 conf      <span style=color:#998;font-style:italic>#é…ç½®æ–‡ä»¶å¤¹</span>
</span></span><span style=display:flex><span>-rwxr-xr-x. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>2502</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> configure <span style=color:#998;font-style:italic>#ç¼–è¯‘é…ç½®ç¨‹åº</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>4</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>72</span> Dec <span style=color:#099>17</span> 04:04 contrib   <span style=color:#998;font-style:italic>#æä¾›äº†è¯­æ³•é«˜äº®æ”¯æŒè„šæœ¬ï¼Œè®©vimæ‰“å¼€æ—¶ï¼Œè¯­æ³•é«˜äº®ã€‚éœ€è¦æ‹·è´contrib														ä¸­åˆ° æœ¬åœ°vimç›®å½•(å¦‚æœæ ¹ç›®å½•æ²¡æœ‰è¯¥ç›®å½•ï¼Œå…ˆmkdir ~/.vim)</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>40</span> Dec <span style=color:#099>17</span> 04:04 html      <span style=color:#998;font-style:italic>#é»˜è®¤é¡µé¢</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>1397</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> LICENSE   <span style=color:#998;font-style:italic>#è®¸å¯è¯ä¹¦</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>355</span> Dec <span style=color:#099>17</span> 04:19 Makefile  <span style=color:#998;font-style:italic>#ç¼–è¯‘åçš„æ–‡ä»¶</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>21</span> Dec <span style=color:#099>17</span> 04:04 man       <span style=color:#998;font-style:italic>#ä½¿ç”¨æ‰‹å†Œ</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>3</span> root root    <span style=color:#099>174</span> Dec <span style=color:#099>17</span> 04:20 objs      <span style=color:#998;font-style:italic>#ç¬¬ä¸‰æ–¹æ’ä»¶</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>49</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> README
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>9</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>     <span style=color:#099>91</span> Dec <span style=color:#099>17</span> 04:04 src      <span style=color:#998;font-style:italic>#æºç </span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#0086b3>cd</span> conf
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 conf<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>40</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>1077</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> fastcgi.conf
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>1007</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> fastcgi_params
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>2837</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> koi-utf
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>2223</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> koi-win
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>5231</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> mime.types
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>2656</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> nginx.conf <span style=color:#998;font-style:italic># æ ¸å¿ƒé…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>  <span style=color:#099>636</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> scgi_params
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>  <span style=color:#099>664</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> uwsgi_params
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>3610</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> win-utf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 html<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>8</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>494</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> 50x.html
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>612</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> index.html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 objs<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>3888</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root   <span style=color:#099>17763</span> Dec <span style=color:#099>17</span> 04:19 autoconf.err
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root   <span style=color:#099>40485</span> Dec <span style=color:#099>17</span> 04:19 Makefile
</span></span><span style=display:flex><span>-rwxr-xr-x. <span style=color:#099>1</span> root root <span style=color:#099>3857136</span> Dec <span style=color:#099>17</span> 04:20 nginx
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>5327</span> Dec <span style=color:#099>17</span> 04:20 nginx.8
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>7363</span> Dec <span style=color:#099>17</span> 04:19 ngx_auto_config.h
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root     <span style=color:#099>657</span> Dec <span style=color:#099>17</span> 04:19 ngx_auto_headers.h
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root    <span style=color:#099>5975</span> Dec <span style=color:#099>17</span> 04:19 ngx_modules.c
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#099>1</span> root root   <span style=color:#099>32552</span> Dec <span style=color:#099>17</span> 04:20 ngx_modules.o
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>9</span> root root      <span style=color:#099>91</span> Dec <span style=color:#099>17</span> 04:19 src
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 src<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ll</span>
</span></span><span style=display:flex><span>total <span style=color:#099>20</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 core   <span style=color:#998;font-style:italic>#æ ¸å¿ƒæºç </span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>3</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 event  <span style=color:#998;font-style:italic>#äº‹ä»¶</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>4</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 http
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Dec <span style=color:#099>17</span> 04:04 mail
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>74</span> Dec <span style=color:#099>17</span> 04:04 misc   <span style=color:#998;font-style:italic>#è¾…åŠ©ä»£ç </span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>3</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span>   <span style=color:#099>18</span> Dec <span style=color:#099>17</span> 04:04 os     <span style=color:#998;font-style:italic>#ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#099>2</span> <span style=color:#099>1001</span> <span style=color:#099>1001</span> <span style=color:#099>4096</span> Aug <span style=color:#099>13</span>  <span style=color:#099>2019</span> stream 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>root@centos7 http<span style=color:#000;font-weight:700>]</span><span style=color:#998;font-style:italic># ls</span>
</span></span><span style=display:flex><span>modules                        ngx_http_file_cache.c              ngx_http_request.h               ngx_http_upstream_round_robin.h
</span></span><span style=display:flex><span>ngx_http.c                     ngx_http.h                         ngx_http_script.c                ngx_http_variables.c
</span></span><span style=display:flex><span>ngx_http_cache.h               ngx_http_header_filter_module.c    ngx_http_script.h                ngx_http_variables.h
</span></span><span style=display:flex><span>ngx_http_config.h              ngx_http_parse.c                   ngx_http_special_response.c      ngx_http_write_filter_module.c
</span></span><span style=display:flex><span>ngx_http_copy_filter_module.c  ngx_http_postpone_filter_module.c  ngx_http_upstream.c              v2
</span></span><span style=display:flex><span>ngx_http_core_module.c         ngx_http_request_body.c            ngx_http_upstream.h
</span></span><span style=display:flex><span>ngx_http_core_module.h         ngx_http_request.c                 ngx_http_upstream_round_robin.c
</span></span></code></pre></td></tr></table></div></div><h2 id=è´Ÿè½½å‡è¡¡>è´Ÿè½½å‡è¡¡</h2><h3 id=å››å±‚è´Ÿè½½å‡è¡¡>å››å±‚è´Ÿè½½å‡è¡¡</h3><p>ä¸»è¦æ˜¯ä¸ºäº†å°†è¯·æ±‚åˆ†æµåˆ°ä¸åŒæœåŠ¡å™¨</p><p>F5 ç¡¬è´Ÿè½½å‡è¡¡ åŸºäºç¡¬ä»¶ã€å•†ä¸šåŒ–</p><p>LVS å››å±‚è´Ÿè½½å‡è¡¡</p><p>Haproxy å››å±‚è´Ÿè½½å‡è¡¡</p><p>Nginx å››å±‚è´Ÿè½½å‡è¡¡</p><h3 id=ä¸ƒå±‚è´Ÿè½½å‡è¡¡>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</h3><p>åŸºäºåº”ç”¨å±‚HTTPåè®®è¿›è¡Œè´Ÿè½½å‡è¡¡</p><p>Nginx ä¸ƒå±‚è´Ÿè½½å‡è¡¡</p><p>Haproxy ä¸ƒå±‚è´Ÿè½½å‡è¡¡</p><p>apache ä¸ƒå±‚è´Ÿè½½å‡è¡¡</p><p>å››å±‚ä¸»è¦æ˜¯tcpã€udpè½¬å‘è¯·æ±‚ï¼Œè€Œä¸æ˜¯å¤„ç†è¯·æ±‚
ä¸ƒå±‚ä¼šå¤„ç†è¯·æ±‚ï¼Œå¯ä»¥è¿‡æ»¤ã€å‹ç¼©ã€ç¼“å­˜ç­‰</p><h3 id=dns-åœ°åŸŸè´Ÿè½½å‡è¡¡>DNS åœ°åŸŸè´Ÿè½½å‡è¡¡</h3><p><img src=/postimages/DNS%E5%9C%B0%E5%9F%9F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.webp alt=DNSåœ°åŸŸè´Ÿè½½å‡è¡¡></p><p>å¯ä»¥æ ¹æ®è¯·æ±‚è€…åœ°åŸŸï¼Œåˆ†é…åˆ°æœ€è¿‘çš„æœåŠ¡å™¨
å‡å°‘ç½‘ç»œä¼ è¾“çš„æŸè€—</p><h2 id=ä½¿ç”¨nginxæ­å»ºä¸‰å°tomcaté›†ç¾¤>ä½¿ç”¨Nginxæ­å»ºä¸‰å°tomcaté›†ç¾¤</h2><p>tomcat1 :10.4.7.11</p><p>tomcat2 :10.4.7.12</p><p>tomcat3 :10.4.7.21</p><p>tomcatå®‰è£…ï¼š10.4.7.{11,12,21}éƒ½è¦å®‰è£…</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum install tomcat -y
</span></span><span style=display:flex><span>yum install tomcat-webapps tomcat-admin-webapps tomcat-docs-webapp tomcat-javadoc
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#å…³é—­é˜²ç«å¢™</span>
</span></span><span style=display:flex><span>systemctl stop firewalld
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#å¯åŠ¨tomcat</span>
</span></span><span style=display:flex><span>systemctl restart tomcat
</span></span></code></pre></td></tr></table></div></div><p>10.4.7.129 (nginxæœåŠ¡å™¨)ä¸Šé…ç½®tomcaté›†ç¾¤</p><p>vim imooc.conf</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>        server_name  www.tomcats.com;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            proxy_pass http<span style=color:#000;font-weight:700>:</span><span style=color:#998;font-style:italic>//tomcats;
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>é‡å¯nginx</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>/usr/local/nginx/sbin/nginx -s reload 
</span></span></code></pre></td></tr></table></div></div><p>windwosé…ç½®hostsè§„åˆ™ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>10.4.7.129 www.tomcats.com
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•è®¿é—®ã€‚</p><p><a href=https://www.tomcats.com>www.tomcats.com</a></p><p>è¯·æ±‚ä¼šå¹³å‡åˆ†é…ç»™åé¢ä¸‰å°tomcat.</p><p>å‚è€ƒï¼šhttp://tengine.taobao.org/book/chapter_05.html</p><h2 id=è´Ÿè½½å‡è¡¡ä¹‹è½®è¯¢>è´Ÿè½½å‡è¡¡ä¹‹è½®è¯¢</h2><p>é»˜è®¤nginxä½¿ç”¨çš„æ˜¯è½®è¯¢ã€‚äº¤æ›¿å‡ºç°ã€‚å‡ºç°æ¬¡æ•°å‡ç­‰ã€‚</p><p>ä¿®æ”¹æ¯å°tomcaté»˜è®¤é¡µé¢</p><p>/usr/share/tomcat/webapps/ROOT/index.jsp</p><p>ç¬¬37è¡Œã€‚homeæ”¹æˆå¯¹åº”IPæœ€åä¸€ä½ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span> 37 &lt;<span style=color:navy>span</span> <span style=color:teal>id</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;nav-home&#34;</span>&gt;&lt;<span style=color:navy>a</span> <span style=color:teal>href</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;${tomcatUrl}&#34;</span>&gt;12&lt;/<span style=color:navy>a</span>&gt;&lt;/<span style=color:navy>span</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>é‡å¯tomcat</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>systemctl restart tomcat 
</span></span></code></pre></td></tr></table></div></div><p>![nginx è½®è¯¢](/postimages/nginx è½®è¯¢.webp)</p><p>11 12 21 ä¼šäº¤æ›¿å‡ºç°ã€‚</p><h2 id=è´Ÿè½½å‡è¡¡ä¹‹æƒé‡-åŠ æƒè½®è¯¢>è´Ÿè½½å‡è¡¡ä¹‹æƒé‡-åŠ æƒè½®è¯¢</h2><p>weight å€¼è¶Šå¤§ï¼Œå‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼ˆåç«¯æœåŠ¡å™¨è¢«è®¿é—®çš„æ¬¡æ•°å°±è¶Šå¤šï¼‰ã€‚</p><p>é…ç½®åœ¨upstream æ¨¡å—å†…ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>3</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>11:12:21 = 1:2:3</p><p>21å‡ºç°å‡ ç‡æœ€å¤§ã€‚</p><h2 id=upstream-æŒ‡ä»¤å‚æ•°>upstream æŒ‡ä»¤å‚æ•°</h2><p>max_conns :é™åˆ¶<code>*number*</code>åˆ°ä»£ç†æœåŠ¡å™¨çš„æœ€å¤§åŒæ—¶æ´»åŠ¨è¿æ¥æ•°.é»˜è®¤å€¼ä¸ºé›¶ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ã€‚å¦‚æœå¯ç”¨äº†<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive>idle keepalive</a>è¿æ¥ã€å¤šä¸ª<a href=https://nginx.org/en/docs/ngx_core_module.html#worker_processes>worker</a>å’Œ<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone>å…±äº«å†…å­˜</a>ï¼Œåˆ™ä»£ç†æœåŠ¡å™¨çš„ active å’Œ idle è¿æ¥æ€»æ•°å¯èƒ½ä¼šè¶…è¿‡è¯¥<code>max_conns</code>å€¼ã€‚å…è®¸æœ€å¤§è¿æ¥æ•°ã€‚</p><p>é™åˆ¶æ¯å°serverçš„è¿æ¥æ•°ï¼Œç”¨äºä¿æŠ¤é¿å…è¿‡è½½èµ·åˆ°é™æµä½œç”¨ã€‚</p><p>æµ‹è¯•å‚è€ƒé…ç½®å¦‚ä¸‹ï¼š</p><p>#worker è¿›ç¨‹è®¾ç½®1ä¸ªï¼Œä¾¿äºæµ‹è¯•è§‚å¯ŸæˆåŠŸçš„è¿æ¥æ•°ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>worker_processes <span style=color:#099>1</span> 
</span></span><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> max_conns<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> max_conns<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> max_conns<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>slow_start:å½“èŠ‚ç‚¹æ¢å¤ï¼Œä¸ç«‹å³åŠ å…¥,è€Œæ˜¯ç­‰å¾… slow_start ååŠ å…¥æœåŠ¡å¯¹åˆ—.(ä»…å•†ä¸šç‰ˆæ”¯æŒ)</p><p>æµ‹è¯•å‚è€ƒé…ç½®å¦‚ä¸‹ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>6</span> slow_start<span style=color:#000;font-weight:700>=</span><span style=color:#099>60</span>s;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„ï¼š</p><p>è¯¥å‚æ•°ä¸èƒ½ä½¿ç”¨åœ¨hash å’Œrandom load balancingä¸­</p><p>å¦‚æœåœ¨upstreamä¸­åªæœ‰ä¸€å°serverï¼Œåˆ™è¯¥å‚æ•°å¤±æ•ˆã€‚</p><p>down :å°†æœåŠ¡å™¨æ ‡è®°ä¸ºæ°¸ä¹…ä¸å¯ç”¨ã€‚</p><p>æµ‹è¯•å‚è€ƒé…ç½®å¦‚ä¸‹ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> down;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>2</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>backup:å°†æœåŠ¡å™¨æ ‡è®°ä¸ºå¤‡ä»½æœåŠ¡å™¨,åªæœ‰åœ¨å…¶ä»–çš„æœåŠ¡å™¨éƒ½å®•æœºä»¥åï¼Œè‡ªå·±æ‰ä¼šåŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œè¢«ç”¨æˆ·è®¿é—®åˆ°ã€‚</p><p>è¯¥å‚æ•°ä¸èƒ½ä¸ <a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#hash>hash</a>ã€<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ip_hash>ip_hash</a>å’Œ<a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#random>éšæœº</a> è´Ÿè½½å¹³è¡¡æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> backup;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>max_fails:å¤±è´¥å‡ æ¬¡ï¼Œåˆ™æ ‡è®°serverå·²å®•æœºï¼Œå‰”å‡ºä¸Šæ¸¸æœåŠ¡ã€‚</p><p>fail_timeout:è¡¨ç¤ºå¤±è´¥çš„é‡è¯•æ—¶é—´ã€‚</p><p>å‡è®¾ç›®å‰è®¾ç½®å¦‚ä¸‹ï¼š</p><p>max_fails=2 fail_timeout=15s</p><p>åˆ™è¡¨ç¤ºåœ¨15ç§’å†…è¯·æ±‚æŸä¸€serverå¤±è´¥è¾¾åˆ°2æ¬¡åï¼Œåˆ™è®¤ä¸ºè¯¥serverå·²ç»æŒ‚äº†æˆ–è€…å®•æœºäº†ï¼Œéšåå†è¿‡15sï¼Œè¿™15så†…ä¸ä¼šæœ‰æ–°çš„è¯·æ±‚åˆ°è¾¾åˆšåˆšæŒ‚æ‰çš„èŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯ä¼šè¯·æ±‚åˆ°æ­£å¸¸è¿ä½œçš„serverï¼Œ15ç§’åä¼šåœ¨æœ‰æ–°è¯·æ±‚å°è¯•è¿æ¥æŒ‚æ‰çš„serverï¼Œå¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œé‡å¤ä¸Šä¸€è¿‡ç¨‹ï¼Œç›´åˆ°æ¢å¤ã€‚</p><h2 id=ä½¿ç”¨keepaliveæé«˜ååé‡>ä½¿ç”¨keepaliveæé«˜ååé‡</h2><p><a href=https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive>https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive</a></p><p>æµ‹è¯•é…ç½®ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span> weight<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span>;
</span></span><span style=display:flex><span>        keepalive <span style=color:#099>32</span>; <span style=color:#a61717;background-color:#e3d2d2>#</span>é…ç½®é•¿è¿æ¥çš„æ•°é‡<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä¿æŒè¿æ¥å¯ä»¥æé«˜ååé‡
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server {
</span></span><span style=display:flex><span>        listen       <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>        server_name  www.tomcats.com;
</span></span><span style=display:flex><span>        location <span style=color:#000;font-weight:700>/</span> {
</span></span><span style=display:flex><span>            proxy_pass http<span style=color:#000;font-weight:700>:</span><span style=color:#998;font-style:italic>//tomcats;
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>            proxy_http_version <span style=color:#099>1.1</span>; <span style=color:#a61717;background-color:#e3d2d2>#</span>ä»£è¡¨ä¸Šé¢é•¿è¿æ¥çš„ç‰ˆæœ¬å·<span style=color:#a61717;background-color:#e3d2d2>ï¼Œï¼ˆ</span>é»˜è®¤1.<span style=color:#099>0</span><span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä½†1.<span style=color:#099>0</span>ä¸æ˜¯é•¿é“¾æ¥<span style=color:#a61717;background-color:#e3d2d2>ï¼‰</span>
</span></span><span style=display:flex><span>            proxy_set_header Connection <span style=color:#d14>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=è´Ÿè½½å‡è¡¡ä¹‹ip_hash>è´Ÿè½½å‡è¡¡ä¹‹ip_hash</h2><p>hashç®—æ³•</p><p>hash(ip) % node_counts = index</p><p>ç®—å‡ºç”¨æˆ·è®¿é—®çš„æœåŠ¡å™¨å…·ä½“æ˜¯å“ªä¸€å°</p><p>ä¿è¯ç”¨æˆ·è®¿é—®çš„æœåŠ¡å™¨æ˜¯åŒä¸€å°ï¼Œä¿æŒä¼šè¯ä¸€è‡´</p><p>æµ‹è¯•é…ç½®ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream tomcats {
</span></span><span style=display:flex><span>		ip_hash;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.12</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        server <span style=color:#099>10.4</span>.<span style=color:#099>7.21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>8080</span>;
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><p>10.4.7.110
10.4.7.120 &mdash;> hash(10 4 7)
10.4.7.210</p><p>åˆ†æ®µè¿›è¡Œè®¡ç®—ï¼ŒåŒä¸€ç‰‡åŒºåŸŸï¼Œä¼šè®¿é—®åˆ°ä¸€ä¸ªé‡Œ</p><h3 id=è´Ÿè½½å‡è¡¡ä¹‹url_hash>è´Ÿè½½å‡è¡¡ä¹‹<strong>url_hash</strong></h3><p><img src=/postimages/url_hash.webp alt=url_hash></p><p>é€šè¿‡é…ç½®hash $request_uri
å¼€å¯url_hash</p><h2 id=nginxæ§åˆ¶æµè§ˆå™¨ç¼“å­˜>nginxæ§åˆ¶æµè§ˆå™¨ç¼“å­˜</h2><p><img src=/postimages/nginx%E7%BC%93%E5%AD%98.webp alt=nginxç¼“å­˜></p><p>1ã€è®¾ç½®é™æ€å†…å®¹çš„è¿‡æœŸæ—¶é—´(expires time;)</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>location  <span style=color:#000;font-weight:700>/</span><span style=color:#000;font-weight:700>static</span> {
</span></span><span style=display:flex><span>    alias  <span style=color:#000;font-weight:700>/</span>home<span style=color:#000;font-weight:700>/</span>naga;
</span></span><span style=display:flex><span>    expires  <span style=color:#099>10</span>s;   
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>2ã€å›ºå®šæ—¶é—´ expires @[time]</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>expires  @22h30s;   ä»£è¡¨æ™šä¸Š10:30pmå¤±æ•ˆï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¡ç®—æ—¶é—´å·®
</span></span></code></pre></td></tr></table></div></div><p>3ã€ expires -[time]</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span> expires  -1h;  è·ç¦»ç°åœ¨çš„1å°æ—¶ä¹‹å‰å°±å¤±æ•ˆäº†ï¼Œç›¸å½“äºä¸ç”¨ç¼“å­˜
</span></span></code></pre></td></tr></table></div></div><p>4ã€expires eposh; ä¸ä½¿ç”¨ç¼“å­˜</p><p>5ã€expires off; é»˜è®¤å€¼ï¼Œå…¶å®å°±æ˜¯ä¸ç®¡ï¼Œç”±æµè§ˆå™¨è‡ªå·±ä½¿ç”¨è‡ªå·±çš„é»˜è®¤ç¼“å­˜</p><p>6ã€expires max; ç¼“å­˜ä¸ä¼šè¿‡æœŸï¼Œé™¤éä¿®æ”¹è¿‡ã€‚</p><h2 id=ä¸Šæ¸¸æœåŠ¡é™æ€å†…å®¹ç¼“å­˜>ä¸Šæ¸¸æœåŠ¡é™æ€å†…å®¹ç¼“å­˜</h2><p>keys_zone æ˜¯å†…å­˜ç¼“å­˜ max_size æ˜¯ç¡¬ç›˜ç¼“å­˜</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>upstream xxx {  ...  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span> proxy_cache_path  è®¾ç½®ç¼“å­˜ä¿å­˜çš„åœ°å€<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»º
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   keys_zone è®¾ç½®å…±äº«å†…å­˜<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä»¥åŠå ç”¨çš„ç©ºé—´å¤§å° <span style=color:#a61717;background-color:#e3d2d2>##</span> å†…å­˜ç¼“å­˜ <span style=color:#a61717;background-color:#e3d2d2>##</span>  (mycacheæ˜¯å…±äº«å†…å­˜å<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä¸‹é¢)
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   max_size è®¾ç½®ç¼“å­˜å¤§å°
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   inactive è¶…è¿‡æ­¤æ—¶é—´<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ç¼“å­˜è‡ªåŠ¨æ¸…ç†
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>   use_temp_path<span style=color:#000;font-weight:700>=</span>off  å…³é—­ä¸´æ—¶ç›®å½•
</span></span><span style=display:flex><span>proxy_cache_path  <span style=color:#000;font-weight:700>/</span>usr<span style=color:#000;font-weight:700>/</span>local<span style=color:#000;font-weight:700>/</span>nginx<span style=color:#000;font-weight:700>/</span>upstream_cache  keys_zone<span style=color:#000;font-weight:700>=</span>mycache<span style=color:#000;font-weight:700>:</span><span style=color:#099>50</span>m  max_size<span style=color:#000;font-weight:700>=</span><span style=color:#099>30</span>g  inactive<span style=color:#000;font-weight:700>=</span><span style=color:#099>8</span>h  use_temp_path<span style=color:#000;font-weight:700>=</span>off;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>  listen  <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>  server_name  www.naga.cn;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a61717;background-color:#e3d2d2>#</span>å¼€å¯å¹¶ä¸”ä½¿ç”¨ç¼“å­˜
</span></span><span style=display:flex><span>  proxy_cache  mycache;
</span></span><span style=display:flex><span>  <span style=color:#a61717;background-color:#e3d2d2>#</span>é’ˆå¯¹200å’Œ304çŠ¶æ€ç çš„ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´
</span></span><span style=display:flex><span>  proxy_cache_valid   <span style=color:#099>200</span>  <span style=color:#099>304</span>  <span style=color:#099>8</span>h;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=ä½¿ç”¨nginx-é…ç½®httpsåŸŸåè¯ä¹¦>ä½¿ç”¨nginx é…ç½®httpsåŸŸåè¯ä¹¦</h2><ol><li><p>å®‰è£…sslæ¨¡å—</p><p>è¦åœ¨nginxä¸­é…ç½®https,åŠå¿…é¡»å®‰è£…sslæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯â€˜http_ssl_moduleâ€™.</p><p>è¿›å…¥åˆ°nginxè§£å‹ç›®å½•ï¼šnginx-1.16.1</p><p>æ–°å¢sslæ¨¡å—ï¼ˆåŸæ¥çš„æ¨¡å—éœ€è¦ä¿ç•™ï¼‰&ndash;with-http_ssl_module</p></li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>./configure <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--prefix<span style=color:#000;font-weight:700>=</span>/usr/local/nginx <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--pid-path<span style=color:#000;font-weight:700>=</span>/var/run/nginx/nginx.pid <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--lock-path<span style=color:#000;font-weight:700>=</span>/var/lock/nginx.lock <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--error-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/error.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-log-path<span style=color:#000;font-weight:700>=</span>/var/log/nginx/access.log <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--with-http_gzip_static_module <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-client-body-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/client <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-proxy-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/proxy <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-fastcgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/fastcgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-uwsgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/uwsgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--http-scgi-temp-path<span style=color:#000;font-weight:700>=</span>/var/temp/nginx/scgi <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>--with-http_ssl_module
</span></span></code></pre></td></tr></table></div></div><p>ç¼–è¯‘å’Œå®‰è£…ï¼š</p><p>make</p><p>make install</p><h2 id=é…ç½®ssl>é…ç½®ssl</h2><p>1ã€äº‘ä¸Šç”³è¯·è¯ä¹¦ï¼Œå®¡æ ¸å®Œæˆåå°†è¯ä¹¦ä¸‹è½½ä¸‹æ¥ï¼ŒnginxåŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªcrtè¯ä¹¦æ–‡ä»¶ï¼Œä¸€ä¸ªkeyå¯†é’¥æ–‡ä»¶</p><p>2ã€å°†æ–‡ä»¶ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ï¼Œå¯ä»¥æ”¾åœ¨confä¸‹</p><p>3ã€ä¿®æ”¹nginx.conf (äº‹å…ˆåœ¨nginxé‡Œé¢åŠ å…¥sslæ¨¡å— &ndash;with-http_ssl_module, å®‰è£…åé€šè¿‡ ./nginx -V æŸ¥çœ‹ )</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen  <span style=color:#099>443</span>;
</span></span><span style=display:flex><span>    server_name  localhost;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> å¼€å¯ssl 
</span></span><span style=display:flex><span>    ssl on; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> é…ç½®sslè¯ä¹¦   å› ä¸ºæ”¾åœ¨confä¸‹çš„<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å’Œnginx.confåŒä¸€è·¯å¾„<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å°±è¿™æ ·å†™å°±è¡Œ
</span></span><span style=display:flex><span>    ssl_certificate <span style=color:#099>1_</span>www.imoocdsp.com_bundle.crt; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> é…ç½®è¯ä¹¦ç§˜é’¥ 
</span></span><span style=display:flex><span>    ssl_certificate_key <span style=color:#099>2_</span>www.imoocdsp.com.key; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> sslä¼šè¯cache 
</span></span><span style=display:flex><span>    ssl_session_cache shared<span style=color:#000;font-weight:700>:</span>SSL<span style=color:#000;font-weight:700>:</span><span style=color:#099>1</span>m; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> sslä¼šè¯è¶…æ—¶æ—¶é—´ 
</span></span><span style=display:flex><span>    ssl_session_timeout <span style=color:#099>5</span>m; 
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> é…ç½®åŠ å¯†å¥—ä»¶<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å†™æ³•éµå¾ª openssl æ ‡å‡† 
</span></span><span style=display:flex><span>    ssl_protocols TLSv1 TLSv1.<span style=color:#099>1</span> TLSv1.<span style=color:#099>2</span>; 
</span></span><span style=display:flex><span>    ssl_ciphers ECDHE<span style=color:#000;font-weight:700>-</span>RSA<span style=color:#000;font-weight:700>-</span>AES128<span style=color:#000;font-weight:700>-</span>GCM<span style=color:#000;font-weight:700>-</span>SHA256<span style=color:#000;font-weight:700>:</span>HIGH<span style=color:#000;font-weight:700>:!</span>aNULL<span style=color:#000;font-weight:700>:!</span>MD5<span style=color:#000;font-weight:700>:!</span>RC4<span style=color:#000;font-weight:700>:!</span>DHE; 
</span></span><span style=display:flex><span>    ssl_prefer_server_ciphers on;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>###</span> å°†httpçš„è¯·æ±‚è½¬å‘åˆ°https
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen <span style=color:#099>80</span>;
</span></span><span style=display:flex><span>    server_name localhost;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span> æ’é™¤æ³•
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> ($http_name <span style=color:#000;font-weight:700>~*</span> <span style=color:#d14>&#34;^online$&#34;</span> ) {
</span></span><span style=display:flex><span>        rewrite <span style=color:#000;font-weight:700>^</span><span style=color:#009926>/(.*)$ https:/</span><span style=color:#000;font-weight:700>/</span>localhost<span style=color:#000;font-weight:700>/</span>online<span style=color:#000;font-weight:700>/</span> permanent;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    rewrite <span style=color:#000;font-weight:700>^</span> https<span style=color:#000;font-weight:700>:</span><span style=color:#998;font-style:italic>//$host$1 permanent;
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=åŠ¨é™åˆ†ç¦»>åŠ¨é™åˆ†ç¦»</h2><p>1.åˆ†å¸ƒå¼</p><p>2.å‰åç«¯è§£è€¦</p><p>3.é™æ€å½’nginx</p><p>4.æ¥å£æœåŠ¡åŒ–</p><p>é™æ€æ•°æ®ï¼šcss/js/html/images/audios/videos/&mldr;</p><p>åŠ¨æ€æ•°æ®ï¼šå¾—åˆ°çš„å“åº”å¯èƒ½ä¼šå’Œä¸Šæ¬¡ä¸åŒã€‚</p><p>åŠ¨é™åˆ†ç¦»çš„é—®é¢˜</p><p>è·¨åŸŸï¼š</p><p>springboot</p><p>nginx</p><p>jsonp</p><p>åˆ†å¸ƒå¼ä¼šè¯ï¼š åˆ†å¸ƒå¼ç¼“å­˜ä¸­é—´ä»¶Redis</p><h2 id=nginxé«˜å¯ç”¨ha-keepalived-åŒæœºä¸»å¤‡>nginxé«˜å¯ç”¨HA keepalived åŒæœºä¸»å¤‡</h2><p>keepalived ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿè·¯ç”±å†—ä½™åè®® VRRP ï¼Œè¿™ä¸ªåè®®çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><p>1ã€è§£å†³å†…ç½‘å•æœºæ•…éšœçš„è·¯ç”±åè®®ï¼Œ</p><p>2ã€ç”¨äºæ„å»ºè¿‡ä¸ªè·¯ç”±MASTER BACKUPï¼Œå°†å‡ å°æä¾›ç›¸åŒæœåŠ¡çš„è·¯ç”±å™¨ç»„æˆä¸€ä¸ªè·¯ç”±å™¨ç»„ã€‚ä¸€ä¸ªè·¯ç”±å°±æ˜¯nginx</p><p>3ã€è™šæ‹ŸIP-VIPï¼ˆVirtual IP Addressï¼‰</p><p>è¿‡ç¨‹ï¼šç”¨æˆ·ä¸ç›´æ¥è®¿é—®nginxï¼Œè®¿é—®è™šæ‹ŸIPï¼Œè¿™ä¸ªè™šæ‹ŸIPæ˜¯ç»‘å®šäº†nginxçš„masterèŠ‚ç‚¹ï¼Œä¼šæ ¹æ®è¿™ä¸ªå…³ç³»è§£æå‡ºæ¥ç»“æœã€‚ masterä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå¿ƒè·³æ£€æµ‹åˆ°åä¼šè®©è™šæ‹ŸIPæ‰¾åˆ°å¤‡ç”¨æœºï¼Œå¤šä¸ªå¤‡ç”¨æœºä¼šæ ¹æ®æƒé‡é€‰æ‹©ã€‚</p><p>æ­¤å¤–ï¼Œä¸»å¤‡èŠ‚ç‚¹çš„ç¡¬ä»¶é…ç½®åº”ä¸€æ ·ã€‚</p><h2 id=å®‰è£…keepalived>å®‰è£…keepalived</h2><p>è§£å‹åè¿›å…¥æ–‡ä»¶å¤¹è¿›è¡Œé…ç½®ï¼Œç±»ä¼¼nginxï¼Œä½†æ˜¯éœ€è¦ç”¨ &ndash;sysconf=/etcæŒ‡å®šé…ç½®æ–‡ä»¶åœ°å€</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>yum -y install libnl libnl-devel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./configure --prefix<span style=color:#000;font-weight:700>=</span>/usr/local/keepalived  --sysconf<span style=color:#000;font-weight:700>=</span>/etc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make <span style=color:#000;font-weight:700>&amp;&amp;</span> make install
</span></span></code></pre></td></tr></table></div></div><p>prefixï¼škeepalivedå®‰è£…çš„ä½ç½®</p><p>sysconfï¼škeepalivedæ ¸å¿ƒé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼Œå›ºå®šä½ç½®ï¼Œæ”¹æˆå…¶ä»–ä½ç½®åˆ™keepalivedå¯åŠ¨ä¸äº†ã€‚ä¼šæŠ¥é”™ã€‚</p><p>libnl libnl-devel æ˜¯libnl/libnl-3ä¾èµ–åŒ…ã€‚</p><h3 id=æ ¸å¿ƒé…ç½®æ–‡ä»¶>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span>Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span> å…¨å±€é…ç½®
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   <span style=color:#a61717;background-color:#e3d2d2>#</span> èŠ‚ç‚¹æ•…éšœ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>åˆ‡æ¢äº†èŠ‚ç‚¹ä¹‹åä¼šé€šçŸ¥ç®¡ç†å‘˜<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä¸‹é¢è¿˜è¦é…ç½®é‚®ç®±çš„åè®®ç­‰<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å¯ä»¥ä¸è¦
</span></span><span style=display:flex><span>   notification_email {
</span></span><span style=display:flex><span>     <span style=color:#099>123456</span><span style=color:#a61717;background-color:#e3d2d2>@</span>qq.com
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   notification_email_from Alexandre.Cassen<span style=color:#a61717;background-color:#e3d2d2>@</span>firewall.loc
</span></span><span style=display:flex><span>   smtp_server <span style=color:#099>192.168</span>.<span style=color:#099>200.1</span>
</span></span><span style=display:flex><span>   smtp_connect_timeout <span style=color:#099>30</span>
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>   <span style=color:#a61717;background-color:#e3d2d2>#</span> è·¯ç”±ID<span style=color:#a61717;background-color:#e3d2d2>ï¼š</span>å½“å‰å®‰è£…keepalivedèŠ‚ç‚¹ä¸»æœºçš„æ ‡è¯†ç¬¦<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å…¨å±€å”¯ä¸€
</span></span><span style=display:flex><span>   router_id naga_170
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>   vrrp_skip_check_adv_addr
</span></span><span style=display:flex><span>   vrrp_strict
</span></span><span style=display:flex><span>   vrrp_garp_interval <span style=color:#099>0</span>
</span></span><span style=display:flex><span>   vrrp_gna_interval <span style=color:#099>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>åŸºäºVRRPåè®®çš„å¯¹è±¡<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>è®¡ç®—æœºèŠ‚ç‚¹
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER            <span style=color:#a61717;background-color:#e3d2d2>#</span> è¡¨ç¤ºå½“å‰ä¸ºnginxçš„masterä¸»èŠ‚ç‚¹
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> eth0          <span style=color:#a61717;background-color:#e3d2d2>#</span> å½“å‰å®ä¾‹ç»‘å®šçš„ç½‘å¡<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span> ç”¨ ip addræŸ¥çœ‹
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>     <span style=color:#a61717;background-color:#e3d2d2>#</span>è™šæ‹Ÿè·¯ç”±ID<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä¸»å¤‡èŠ‚ç‚¹éœ€è¦ä¸€è‡´
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>            <span style=color:#a61717;background-color:#e3d2d2>#</span>æƒé‡<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å¤‡æœºä¼˜å…ˆçº§è¶Šé«˜å°±æˆä¸ºæ–°çš„master
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>            <span style=color:#a61717;background-color:#e3d2d2>#</span> ä¸»å¤‡å¿ƒè·³æ£€æŸ¥<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>æ—¶é—´é—´éš”1s
</span></span><span style=display:flex><span>    authentication {        <span style=color:#a61717;background-color:#e3d2d2>#</span> è®¤è¯æˆæƒ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>é˜²æ­¢éæ³•èŠ‚ç‚¹<span style=color:#a61717;background-color:#e3d2d2>ã€‚</span>æ¯ä¸ªèŠ‚ç‚¹ä¸€æ ·å°±å¯ä»¥
</span></span><span style=display:flex><span>        auth_type PASS      
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {     <span style=color:#a61717;background-color:#e3d2d2>#</span> è™šæ‹ŸIP<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ç”¨ä¸€ä¸ªå°±å¯ä»¥äº†
</span></span><span style=display:flex><span>        <span style=color:#099>192.168</span>.<span style=color:#099>17.17</span>
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>192.168</span>.<span style=color:#099>200.17</span>
</span></span><span style=display:flex><span>        <span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>192.168</span>.<span style=color:#099>200.18</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>ä¸‹é¢çš„éƒ½å¯ä»¥ä¸è¦
</span></span><span style=display:flex><span>virtual_server <span style=color:#099>192.168</span>.<span style=color:#099>200.100</span> <span style=color:#099>443</span> {
</span></span><span style=display:flex><span>    delay_loop <span style=color:#099>6</span>
</span></span><span style=display:flex><span>    lb_algo rr
</span></span><span style=display:flex><span>    lb_kind NAT
</span></span><span style=display:flex><span>    persistence_timeout <span style=color:#099>50</span>
</span></span><span style=display:flex><span>    protocol TCP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>201.100</span> <span style=color:#099>443</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        SSL_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>
</span></span><span style=display:flex><span>              digest ff20ad2481f97b1754ef3e12ecd3a9cc
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>mrtg<span style=color:#000;font-weight:700>/</span>
</span></span><span style=display:flex><span>              digest <span style=color:#099>9</span>b3a0c85a887a256d6939da88aabd8cd
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>virtual_server <span style=color:#099>10.10</span>.<span style=color:#099>10.2</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>    delay_loop <span style=color:#099>6</span>
</span></span><span style=display:flex><span>    lb_algo rr
</span></span><span style=display:flex><span>    lb_kind NAT
</span></span><span style=display:flex><span>    persistence_timeout <span style=color:#099>50</span>
</span></span><span style=display:flex><span>    protocol TCP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    sorry_server <span style=color:#099>192.168</span>.<span style=color:#099>200.200</span> <span style=color:#099>1358</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.2</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl3<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.3</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334c
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334c
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>virtual_server <span style=color:#099>10.10</span>.<span style=color:#099>10.3</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>    delay_loop <span style=color:#099>3</span>
</span></span><span style=display:flex><span>    lb_algo rr
</span></span><span style=display:flex><span>    lb_kind NAT
</span></span><span style=display:flex><span>    persistence_timeout <span style=color:#099>50</span>
</span></span><span style=display:flex><span>    protocol TCP
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.4</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl3<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    real_server <span style=color:#099>192.168</span>.<span style=color:#099>200.5</span> <span style=color:#099>1358</span> {
</span></span><span style=display:flex><span>        weight <span style=color:#099>1</span>
</span></span><span style=display:flex><span>        HTTP_GET {
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl2<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            url {
</span></span><span style=display:flex><span>              path <span style=color:#000;font-weight:700>/</span>testurl3<span style=color:#000;font-weight:700>/</span>test.jsp
</span></span><span style=display:flex><span>              digest <span style=color:#099>640205</span>b7b0fc66c1ea91c463fac6334d
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            connect_timeout <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>            delay_before_retry <span style=color:#099>3</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>ç¤ºä¾‹ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>####</span> ç¬¬ä¸€å° <span style=color:#a61717;background-color:#e3d2d2>####</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>å…¨å±€å˜é‡<span style=color:#000;font-weight:700>-</span>è·¯ç”±id<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>æ ‡è¯†ä¸»æœºid
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_140
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>è®¡ç®—æœºèŠ‚ç‚¹
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER	<span style=color:#a61717;background-color:#e3d2d2>#</span>æ ‡ç¤ºå½“å‰æœºå™¨ä¸ºä¸»èŠ‚ç‚¹<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä»èŠ‚ç‚¹BACKUP
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33	<span style=color:#a61717;background-color:#e3d2d2>#</span>å½“å‰ç½‘å¡
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>ä¿æŒä¸»å¤‡æœºä¸€è‡´
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>æƒé‡<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>æœ€é«˜çš„å½“é€‰ä¸‹ä¸€ä»»ä¸»æœº
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>æ£€æŸ¥æ—¶é—´é—´éš”1s
</span></span><span style=display:flex><span>    authentication {	<span style=color:#a61717;background-color:#e3d2d2>#</span>è®¤è¯æˆæƒ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>é˜²æ­¢éæ³•èŠ‚ç‚¹è¿›å…¥
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {	<span style=color:#a61717;background-color:#e3d2d2>#</span>è™šæ‹Ÿip
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>####</span> ç¬¬äºŒå° <span style=color:#a61717;background-color:#e3d2d2>####</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>å…¨å±€å˜é‡<span style=color:#000;font-weight:700>-</span>è·¯ç”±id<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>æ ‡è¯†ä¸»æœºid
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_141
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span>è®¡ç®—æœºèŠ‚ç‚¹
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state BACKUP	<span style=color:#a61717;background-color:#e3d2d2>#</span>æ ‡ç¤ºå½“å‰æœºå™¨ä¸ºä»èŠ‚ç‚¹
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33	<span style=color:#a61717;background-color:#e3d2d2>#</span>å½“å‰ç½‘å¡
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>ä¿æŒä¸»å¤‡æœºä¸€è‡´
</span></span><span style=display:flex><span>    priority <span style=color:#099>80</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>æƒé‡<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>æœ€é«˜çš„å½“é€‰ä¸‹ä¸€ä»»ä¸»æœº
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>	<span style=color:#a61717;background-color:#e3d2d2>#</span>æ£€æŸ¥æ—¶é—´é—´éš”1s
</span></span><span style=display:flex><span>    authentication {	<span style=color:#a61717;background-color:#e3d2d2>#</span>è®¤è¯æˆæƒ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>é˜²æ­¢éæ³•èŠ‚ç‚¹è¿›å…¥
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {	<span style=color:#a61717;background-color:#e3d2d2>#</span>è™šæ‹Ÿip<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>ä¿æŒå’Œä¸»èŠ‚ç‚¹ä¸€è‡´
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•ï¼š</p><p>ä¸¤å°æœºå™¨nginx å’Œkeeplivedè¿›ç¨‹éƒ½åœ¨ã€‚ä¸¤å°ä¸€ä¸»ä¸€å¤‡çš„ç›®çš„æ˜¯ï¼Œä¸»æœåŠ¡å™¨keeplivedæŒ‚äº†ï¼Œvipåˆ‡åˆ°å¤‡æœåŠ¡å™¨ä¸Šï¼Œä¸šåŠ¡ä¸ä¸­æ–­ã€‚é»˜è®¤vipæ˜¯åœ¨ä¸»ä¸Šç”Ÿæ•ˆçš„ã€‚ä¸»å¤‡çš„keepalivedè¿›ç¨‹éƒ½åœ¨ï¼Œvipä¼šåœ¨ä¸»ä¸Šç”Ÿæ•ˆã€‚vipåˆ‡åˆ°å¤‡æœåŠ¡å™¨ä¸Šæ—¶.ä¸»æœåŠ¡å™¨ä¸Šçš„keepalivedæ¢å¤äº†ã€‚vipä¼šå†æ¬¡åˆ‡å›åˆ°ä¸»æœåŠ¡å™¨ä¸Šã€‚</p><h3 id=keepalivedé…ç½®nginxè‡ªåŠ¨å¯åŠ¨>keepalivedé…ç½®Nginxè‡ªåŠ¨å¯åŠ¨</h3><p>è¿™æ—¶å¦‚æœnginxæŒ‚äº†ï¼Œkeepalivedæ²¡æœ‰æŒ‚ï¼Œè¿˜æ˜¯ä¼šæ— æ³•è®¿é—®ã€‚</p><p>1.è„šæœ¬ï¼ˆä¸»ä»éƒ½é…ç½®ï¼‰</p><p>cd /etc/keepalived
vim check_nginx_alive.sh</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span><span style=color:teal>A</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>`</span>ps -C nginx --no-header | wc -l<span style=color:#d14>`</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># è¿›ç¨‹æ•°æ˜¯0çš„è¯ï¼Œå°±å°è¯•é‡å¯nginx</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>[</span> <span style=color:teal>$A</span> -eq <span style=color:#099>0</span> <span style=color:#000;font-weight:700>]</span>; <span style=color:#000;font-weight:700>then</span>
</span></span><span style=display:flex><span>    /usr/local/nginx/sbin/nginx
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic># ç­‰ä¸€ä¼šå„¿å†æ¬¡æ£€æŸ¥ngxinï¼Œå¦‚æœnginxæ²¡æœ‰å¯åŠ¨æˆåŠŸï¼Œåˆ™åœæ­¢å½“å‰æœºå™¨çš„keepalivedï¼Œä½¿ç”¨å¤‡ç”¨æœºå™¨</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#099>3</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#d14>`</span>ps -C nginx --no-header | wc -l<span style=color:#d14>`</span> -eq <span style=color:#099>0</span> <span style=color:#000;font-weight:700>]</span>; <span style=color:#000;font-weight:700>then</span>
</span></span><span style=display:flex><span>        killall keepalived  
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>fi</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>fi</span>      
</span></span></code></pre></td></tr></table></div></div><p>æ‰§è¡Œè¿™ä¸ªè„šæœ¬åï¼Œä¼šæ£€æµ‹nginxï¼ŒæŒ‚æ‰ä¼šé‡å¯nginxã€‚</p><p>æˆ‘ä»¬å°†å®ƒé…ç½®åˆ°keepalivedé…ç½®æ–‡ä»¶é‡Œã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_140
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_script check_nginx_alive {
</span></span><span style=display:flex><span>        script <span style=color:#d14>&#34;/etc/keepalived/check_nginx_alive.sh&#34;</span>
</span></span><span style=display:flex><span>        interval <span style=color:#099>2</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>æ¯éš”ä¸¤ç§’é’Ÿè¿è¡Œè„šæœ¬æ£€æµ‹
</span></span><span style=display:flex><span>        weight <span style=color:#099>10</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>è„šæœ¬è¿è¡ŒæˆåŠŸ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å‡çº§æƒé‡<span style=color:#000;font-weight:700>+</span><span style=color:#099>10</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a61717;background-color:#e3d2d2>#</span>åœ¨æ­¤æ‰§è¡Œä¸Šé¢çš„å®šæ—¶å™¨
</span></span><span style=display:flex><span>    track_script{
</span></span><span style=display:flex><span>        check_nginx_alive
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=åŒæœºä¸»å¤‡ç¼ºç‚¹>åŒæœºä¸»å¤‡ç¼ºç‚¹</h4><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½ä¿è¯é«˜å¯ç”¨çš„æ¶æ„äº†ï¼Œä½†æ˜¯åŒæœºä¸»å¤‡ä¼šæœ‰èµ„æºæµªè´¹çš„é—®é¢˜ï¼Œä¸»æœºæ°¸è¿œä¸æŒ‚æœºï¼Œå¤‡æœºç™½å¹²æ´»å„¿ã€‚</p><h4 id=keepalived-åŒä¸»çƒ­å¤‡>Keepalived åŒä¸»çƒ­å¤‡</h4><p><img src=/postimages/nginx%E5%8F%8C%E4%B8%BB1.webp alt=nginxåŒä¸»1></p><p><img src=/postimages/nginx%E5%8F%8C%E4%B8%BB2.webp alt=nginxåŒä¸»2></p><p>åŒæœºä½¿ç”¨ä¸¤ä¸ªè™šæ‹ŸIPï¼Œäº’ä¸ºä¸»å¤‡ã€‚</p><p>ä½¿ç”¨DNSè½®è¯¢ä¸¤ä¸ªè™šæ‹ŸIPè¿›è¡Œè®¿é—®ï¼Œè¿™æ ·ä¸¤å°æœåŠ¡å™¨éƒ½å¯ä»¥ä½¿ç”¨äº†ã€‚è§£æåŸŸåçš„æ—¶å€™ï¼Œç»™åŸŸåè§£æä¸¤ä¸ªäº‘æœåŠ¡å™¨çš„ipåœ°å€ï¼Œå†å‡è¡¡æƒé‡å³å¯ã€‚</p><p>é…ç½®ï¼ˆåŸä¸»èŠ‚ç‚¹ï¼‰ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_140
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_script check_nginx_alive {
</span></span><span style=display:flex><span>        script <span style=color:#d14>&#34;/etc/keepalived/check_nginx_alive.sh&#34;</span>
</span></span><span style=display:flex><span>        interval <span style=color:#099>2</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>æ¯éš”ä¸¤ç§’é’Ÿè¿è¡Œè„šæœ¬æ£€æµ‹
</span></span><span style=display:flex><span>        weight <span style=color:#099>10</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>è„šæœ¬è¿è¡ŒæˆåŠŸ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å‡çº§æƒé‡<span style=color:#000;font-weight:700>+</span><span style=color:#099>10</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>211</span>ä¸»èŠ‚ç‚¹
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state MASTER
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    track_script{
</span></span><span style=display:flex><span>        check_nginx_alive
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>212</span>ä»èŠ‚ç‚¹
</span></span><span style=display:flex><span>vrrp_instance VI_2 {        <span style=color:#a61717;background-color:#e3d2d2>#</span>åå­—è¦æ”¹
</span></span><span style=display:flex><span>    state BACKUP
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>52</span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>æ¢äº†ä¸€ç»„å®ä¾‹<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>æ”¹
</span></span><span style=display:flex><span>    priority <span style=color:#099>80</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS      
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    track_script {
</span></span><span style=display:flex><span>        check_nginx_alive 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.212</span>           <span style=color:#a61717;background-color:#e3d2d2>#</span>VIPæ›´æ”¹  è™šæ‹Ÿip  virtual IP
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    track_script{
</span></span><span style=display:flex><span>    	check_nginx_alive
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>é…ç½®ï¼ˆåŸä»èŠ‚ç‚¹ï¼‰ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#000;font-weight:700>!</span> Configuration File <span style=color:#000;font-weight:700>for</span> keepalived
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>global_defs {
</span></span><span style=display:flex><span>   router_id keep_141
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>vrrp_script check_nginx_alive {
</span></span><span style=display:flex><span>        script <span style=color:#d14>&#34;/etc/keepalived/check_nginx_alive.sh&#34;</span>
</span></span><span style=display:flex><span>        interval <span style=color:#099>2</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>æ¯éš”ä¸¤ç§’é’Ÿè¿è¡Œè„šæœ¬æ£€æµ‹
</span></span><span style=display:flex><span>        weight <span style=color:#099>10</span> <span style=color:#a61717;background-color:#e3d2d2>#</span>è„šæœ¬è¿è¡ŒæˆåŠŸ<span style=color:#a61717;background-color:#e3d2d2>ï¼Œ</span>å‡çº§æƒé‡<span style=color:#000;font-weight:700>+</span><span style=color:#099>10</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>211</span>ä»èŠ‚ç‚¹
</span></span><span style=display:flex><span>vrrp_instance VI_1 {
</span></span><span style=display:flex><span>    state BACKUP
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>51</span>
</span></span><span style=display:flex><span>    priority <span style=color:#099>80</span>
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.211</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>        track_script {
</span></span><span style=display:flex><span>        check_nginx_alive 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>#</span><span style=color:#099>212</span>ä¸»èŠ‚ç‚¹
</span></span><span style=display:flex><span>vrrp_instance VI_2 {           <span style=color:#a61717;background-color:#e3d2d2>#</span>ç¬¬äºŒç»„å®ä¾‹
</span></span><span style=display:flex><span>    state MASTER            
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>interface</span> ens33          
</span></span><span style=display:flex><span>    virtual_router_id <span style=color:#099>52</span>        <span style=color:#a61717;background-color:#e3d2d2>#</span>ç¬¬äºŒç»„router_id
</span></span><span style=display:flex><span>    priority <span style=color:#099>100</span>            
</span></span><span style=display:flex><span>    advert_int <span style=color:#099>1</span>            
</span></span><span style=display:flex><span>    authentication {
</span></span><span style=display:flex><span>        auth_type PASS      
</span></span><span style=display:flex><span>        auth_pass <span style=color:#099>1111</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    virtual_ipaddress {     
</span></span><span style=display:flex><span>        <span style=color:#099>10.4</span>.<span style=color:#099>7.212</span>           <span style=color:#a61717;background-color:#e3d2d2>#</span>æ”¹ä¸ºç¬¬äºŒä¸ªè™šæ‹Ÿip
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>        track_script {
</span></span><span style=display:flex><span>        check_nginx_alive 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=footer><div class=container-footer><div class=beian><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="></a><a href target=_blank><span class=some>icp...<span></a></div><div class=info><a href=https://github.com/loveminimal/hugo-theme-virgo>ğŸ•Šï¸</a> 2021 - <span id=info-date></span></div></div></div><div class=cool-after></div></body></html>