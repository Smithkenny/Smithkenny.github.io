<!doctype html><html lang=zh-CN><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta name=description content="模拟ssh执行远程命令 - https://www.haipengv.com/posts/%E6%A8%A1%E6%8B%9Fssh%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4/"><meta name=author content="Smith - https://www.haipengv.com/"><meta name=msvalidate.01 content="B46311949B856F2A7015F366FB3CE878"><title>模拟ssh执行远程命令</title><base target=_self><link rel=icon type=image/png href=/favicon.ico><link rel=stylesheet href=https://www.haipengv.com/style.min.9a0cea23154ac1941e15c25aa2d31b77285a217d2606ec05b55236428cf1c3e6.css><script>const DARK=!1</script><script type=text/javascript src=/main.js defer></script></head><body class=active-animate><div class=cool-before></div><div id=header><div class=container-header><div class=right><h1 class=title>模拟ssh执行远程命令</h1><div id=toc>📜</div></div></div></div><div id=content><div class="container-main container-page"><div class=rel><div class=curtag-desc><a href=https://www.haipengv.com/tags/linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/><img src=/imgs/icons/tag.svg width=16> 相关文章：Linux基础知识 <sup>42</sup></a></div><div class=curtag-post><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/>CentOS7 升级内核</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7.9%E5%AE%89%E8%A3%85jq/>Centos7.9安装jq</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7.9%E5%AE%89%E8%A3%85mysql8.0/>Centos7.9安装Mysql8.0</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7.9%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0/>Centos7.9更换网卡名称</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7%E4%BD%BF%E7%94%A8systemd%E7%AE%A1%E7%90%86%E7%A8%8B%E5%BA%8F/>Centos7使用systemd管理程序</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7-%E5%B8%B8%E8%A7%84%E5%91%BD%E4%BB%A4/>CentOS7常规命令</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos7%E7%BD%91%E5%8D%A1%E6%94%B9%E5%9B%9Eeth0%E6%98%BE%E7%A4%BA/>Centos7网卡改回eth0显示</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos8%E9%85%8D%E7%BD%AEyum%E6%BA%90/>CentOS8配置yum源</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/centos%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/>Centos搭建内网邮件服务器</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/crontab%E8%B8%A9%E5%9D%91%E8%AE%B0/>Crontab踩坑记</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/git%E5%85%A5%E9%97%A8/>Git入门</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/http%E5%92%8Chttps%E5%90%84%E7%A7%8D%E6%96%B9%E6%B3%95%E6%B5%8B%E8%AF%95/>Http和Https各种方法测试</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/iptables%E5%B8%B8%E7%94%A8%E6%80%BB%E7%BB%93/>Iptables常用总结</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux-oom%E4%BB%8B%E7%BB%8D/>Linux OOM介绍</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%B8%8B%E6%B7%B7%E6%9D%82%E6%A8%A1%E5%BC%8F%E5%88%A4%E6%96%AD/>Linux下混杂模式判断</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%B8%AD%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/>Linux中环境变量</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%B8%AD%E7%9A%84%E9%9A%94%E7%A6%BB/>Linux中的隔离</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2%E5%91%BD%E4%BB%A4/>Linux信息查询命令</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E5%9E%83%E5%9C%BE%E6%A1%B6/>Linux垃圾桶</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/>Linux小技巧汇总</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E6%97%A5%E5%BF%97%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%87%E5%89%B2/>Linux日志大文件切割</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E6%9F%A5%E7%9C%8B%E7%A8%8B%E5%BA%8F%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4/>Linux查看程序进程启动时间</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E6%A0%B9%E5%88%86%E5%8C%BA%E6%BB%A1%E4%BA%86%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95/>Linux根分区满了处理方法</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/linux%E7%A1%AC%E7%9B%98%E6%89%A9%E5%AE%B9%E5%92%8C%E7%BC%A9%E5%AE%B9/>Linux硬盘扩容和缩容</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/pam%E6%A8%A1%E5%9D%97%E9%99%90%E5%88%B6%E7%99%BB%E5%BD%95/>Pam模块限制登录</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/redhat6.3yum%E6%BA%90%E5%A4%B1%E6%95%88%E8%A7%A3%E5%86%B3/>Redhat6.3yum源失效解决</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/rsyslog%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/>Rsyslog日志服务器搭建</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/ssh%E7%9B%B8%E5%85%B3%E8%AF%B4%E6%98%8E/>SSH相关说明</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/ubuntu%E4%BD%BF%E7%94%A8%E4%B8%8A%E7%AF%87/>Ubuntu使用上篇</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/ubuntu%E4%BD%BF%E7%94%A8%E4%B8%8B%E7%AF%87/>Ubuntu使用下篇</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/vsftpd%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/>Vsftpd相关配置</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/>Vsftp不同用户拥有不同权限</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E4%BD%BF%E7%94%A8logrotate%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2/>使用logrotate进行日志切割</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E4%BD%BF%E7%94%A8sed%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E7%BD%91%E5%9D%80/>使用sed批量修改网址</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E4%BD%BF%E7%94%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%99%BB%E5%BD%95linux%E6%9C%8D%E5%8A%A1%E5%99%A8/>使用浏览器登录linux服务器</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%86%85%E7%BD%91%E9%9A%A7%E9%81%93ssh%E6%90%AD%E5%BB%BA%E6%96%B9%E6%B3%95/>内网隧道ssh搭建方法</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%85%B7-inxi/>功能强大的硬件信息获取工具-Inxi</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%8E%8B%E7%BC%A9%E4%B8%8E%E8%A7%A3%E5%8E%8B/>压缩与解压</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E5%A6%82%E4%BD%95%E7%AD%9B%E9%80%89%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E6%AE%B5%E5%86%85%E7%9A%84%E6%97%A5%E5%BF%97/>如何筛选指定时间段内的日志</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E6%90%AD%E5%BB%BArss%E8%AE%A2%E9%98%85%E5%99%A8/>搭建rss订阅器</a></div><div class=curtag-post-item><a href=https://www.haipengv.com/posts/%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%97%B6%E9%97%B4/>查看系统安装时间</a></div><div class="curtag-post-item curtag-post-item--active"><a href=https://www.haipengv.com/posts/%E6%A8%A1%E6%8B%9Fssh%E6%89%A7%E8%A1%8C%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4/>模拟ssh执行远程命令</a></div></div></div><div class=desc><span><svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667l-324.522666 324.48c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334L685.098667 499.2 524.885333 338.986667zM585.258667 278.656l160.170666 160.213333 102.144-102.144a19.712 19.712.0 000-27.861333l-132.48-132.437333a19.456 19.456.0 00-27.605333.0L585.258667 278.613333zM701.312 85.333333c27.946667.0 54.741333 11.136 74.282667 30.848L907.904 248.490667a105.045333 105.045333.0 010 148.565333L424.874667 879.957333C395.050667 914.304 352.768 935.424 304.426667 938.752H85.333333v-42.666667l.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666a104.789333 104.789333.0 0174.24-30.933334z" p-id="7410" fill="#adb5bd"/></svg>2025-03-16&nbsp;&nbsp;&nbsp;<svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859.0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775.0-360.398 149.372-360.398 356.147S305.225 870.23 512 870.23c206.775.0 357.467-151.455 357.467-358.23.0-23.859 23.634-50.706 53.413-50.706 29.78.0 49.92 26.847 49.92 50.706.0 254.493-206.307 460.8-460.8 460.8s-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4.0 226.684 33.296 312.264 117.369.358.351.358-24.052.0-73.209z" p-id="23839" fill="#adb5bd"/></svg>
2025-03-16&nbsp;&nbsp;&nbsp;</span>
<span><svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028c-70.774903.0-128.089859 57.325793-128.089859 128.03206v446.793671c0 70.7171050000001 57.314956 128.154884 128.089859 128.154884h133.353183a63.940169 63.940169.0 0155.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169.0 0155.212517-31.551041h133.54103c70.576219.0 127.732228-57.289669 127.732227-127.800865V192.391272c0-70.536482-57.181295-127.728615-127.786414-127.728615zM895.884854 639.842407A63.85347 63.85347.0 01832.092795 703.703103h-133.54103a127.753903 127.753903.0 00-110.349172 63.09847l-76.222461 129.856342a.274545.274545.0 010-.050574h-.032512s-.021675.061411-.032512.061412l-76.1466-129.85273a127.804477 127.804477.0 00-110.385297-63.11292H192.030028A64.207489 64.207489.0 01127.880338 639.488388V192.694717a64.102729 64.102729.0 0164.14969-64.091891h640.00858a63.799284 63.799284.0 0163.846246 63.788446v447.451135z" fill="#adb5bd" p-id="33867"/><path d="M608.154093 288.092004a31.970084 31.970084.0 00-31.970084 31.970085v160.078006L441.53396 300.861976a31.970084 31.970084.0 00-57.531702 19.200113v255.760676a31.970084 31.970084.0 0063.940169.0V415.863969l134.650048 179.274507a31.970084 31.970084.0 0057.531703-19.200113V320.062089a31.970084 31.970084.0 00-31.970085-31.970085z" fill="#adb5bd" p-id="33868"/></svg>2328 字</span>&nbsp;
<span><svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667zm0 810.666666C307.2 885.333333 138.666667 716.8 138.666667 512S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"/><path d="M695.466667 567.466667 544 497.066667V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666L669.866667 627.2c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8.0 23.466667-6.4 29.866666-19.2 6.4-14.933333.0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"/></svg>5 分钟</span><div class=container-ctgtag><div class=taxonomy><div class=tag><a href=/tags/linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86>Linux基础知识</a></div></div></div></div><div class=toc><div class=container-page-operation><div class=page-operation><div><a href=/><img src=/imgs/icons/home-2.svg alt></a></div><div><a href=/nav><img src=/imgs/icons/iov-navigate-1.svg alt></a></div><div><a href=/wiki><img src=/imgs/icons/wiki.svg alt></a></div><div><a href=/tags><img src=/imgs/icons/treetags.svg alt></a></div><div id=light-dark><a><img src=/imgs/icons/moon2.svg alt></a></div><div><a href=#><img src=/imgs/icons/up2.svg alt></a></div></div></div><nav id=TableOfContents><ul><li><a href=#模拟ssh执行远程命令>模拟ssh执行远程命令</a><ul><li><a href=#服务端>服务端</a></li><li><a href=#客户端>客户端</a></li></ul></li><li><a href=#粘包现象>粘包现象</a><ul><li><a href=#什么是粘包>什么是粘包？</a></li><li><a href=#tcp与udp><code>TCP</code>与<code>UDP</code></a></li><li><a href=#两种情况下会发生粘包>两种情况下会发生粘包</a></li><li><a href=#拆包的发生情况><strong>拆包的发生情况</strong></a></li></ul></li></ul></nav></div><div class=content><h2 id=模拟ssh执行远程命令>模拟ssh执行远程命令</h2><h3 id=服务端>服务端</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>socket</span> <span style=color:#000;font-weight:700>import</span> <span style=color:#000;font-weight:700>*</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>subprocess</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server <span style=color:#000;font-weight:700>=</span> socket(AF_INET, SOCK_STREAM)
</span></span><span style=display:flex><span>server<span style=color:#000;font-weight:700>.</span>bind((<span style=color:#d14>&#39;127.0.0.1&#39;</span>, <span style=color:#099>8090</span>))
</span></span><span style=display:flex><span>server<span style=color:#000;font-weight:700>.</span>listen(<span style=color:#099>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>while</span> <span style=color:#000;font-weight:700>True</span>:
</span></span><span style=display:flex><span>    conn, client_addr <span style=color:#000;font-weight:700>=</span> server<span style=color:#000;font-weight:700>.</span>accept()
</span></span><span style=display:flex><span>    <span style=color:#0086b3>print</span>(client_addr)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>while</span> <span style=color:#000;font-weight:700>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>try</span>:
</span></span><span style=display:flex><span>            cmd <span style=color:#000;font-weight:700>=</span> conn<span style=color:#000;font-weight:700>.</span>recv(<span style=color:#099>1024</span>)
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span> cmd:<span style=color:#000;font-weight:700>break</span>
</span></span><span style=display:flex><span>            obj <span style=color:#000;font-weight:700>=</span> subprocess<span style=color:#000;font-weight:700>.</span>Popen(cmd<span style=color:#000;font-weight:700>.</span>decode(<span style=color:#d14>&#39;utf-8&#39;</span>), shell<span style=color:#000;font-weight:700>=</span><span style=color:#000;font-weight:700>True</span>,
</span></span><span style=display:flex><span>                                   stdout<span style=color:#000;font-weight:700>=</span>subprocess<span style=color:#000;font-weight:700>.</span>PIPE,
</span></span><span style=display:flex><span>                                   stderr<span style=color:#000;font-weight:700>=</span>subprocess<span style=color:#000;font-weight:700>.</span>PIPE
</span></span><span style=display:flex><span>                                   )
</span></span><span style=display:flex><span>            stdout <span style=color:#000;font-weight:700>=</span> obj<span style=color:#000;font-weight:700>.</span>stdout<span style=color:#000;font-weight:700>.</span>read()
</span></span><span style=display:flex><span>            stderr <span style=color:#000;font-weight:700>=</span> obj<span style=color:#000;font-weight:700>.</span>stderr<span style=color:#000;font-weight:700>.</span>read()
</span></span><span style=display:flex><span>            cmd_res <span style=color:#000;font-weight:700>=</span> stdout<span style=color:#000;font-weight:700>+</span>stderr
</span></span><span style=display:flex><span>            <span style=color:#0086b3>print</span>(<span style=color:#0086b3>len</span>(cmd_res))
</span></span><span style=display:flex><span>            conn<span style=color:#000;font-weight:700>.</span>send(cmd_res)
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>except</span> <span style=color:#900;font-weight:700>ConnectionResetError</span>:
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    conn<span style=color:#000;font-weight:700>.</span>close()
</span></span><span style=display:flex><span>server<span style=color:#000;font-weight:700>.</span>close()
</span></span></code></pre></td></tr></table></div></div><h3 id=客户端>客户端</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>socket</span> <span style=color:#000;font-weight:700>import</span> <span style=color:#000;font-weight:700>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client <span style=color:#000;font-weight:700>=</span> socket(AF_INET, SOCK_STREAM)
</span></span><span style=display:flex><span>client<span style=color:#000;font-weight:700>.</span>connect((<span style=color:#d14>&#39;127.0.0.1&#39;</span>, <span style=color:#099>8090</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>while</span> <span style=color:#000;font-weight:700>True</span>:
</span></span><span style=display:flex><span>    cmd <span style=color:#000;font-weight:700>=</span> <span style=color:#0086b3>input</span>(<span style=color:#d14>&#39;&gt;&gt;: &#39;</span>)<span style=color:#000;font-weight:700>.</span>strip()
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span> cmd:<span style=color:#000;font-weight:700>continue</span>
</span></span><span style=display:flex><span>    client<span style=color:#000;font-weight:700>.</span>send(cmd<span style=color:#000;font-weight:700>.</span>encode(<span style=color:#d14>&#39;utf-8&#39;</span>))
</span></span><span style=display:flex><span>    data <span style=color:#000;font-weight:700>=</span> client<span style=color:#000;font-weight:700>.</span>recv(<span style=color:#099>1024</span>)
</span></span><span style=display:flex><span>    <span style=color:#0086b3>print</span>(data<span style=color:#000;font-weight:700>.</span>decode(<span style=color:#d14>&#39;gbk&#39;</span>)) <span style=color:#998;font-style:italic>#环境时windows收包后要转成gbk格式。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client<span style=color:#000;font-weight:700>.</span>close()
</span></span></code></pre></td></tr></table></div></div><h2 id=粘包现象>粘包现象</h2><h3 id=什么是粘包>什么是粘包？</h3><p>须知：只有TCP有粘包现象，UDP永远不会粘包。</p><p>首先需要掌握一个socket收发消息的原理</p><p><img src=/postimages/image-20220412220522130.webp alt=image-20220412220522130></p><p>发送端可以是一K一K地发送数据，而接收端的应用程序可以两K两K地提走数据，当然也有可能一次提走3K或6K数据，或者一次只提走几个字节的数据，也就是说，应用程序所看到的数据是一个整体，或说是一个流（stream），一条消息有多少字节对应用程序是不可见的，因此<code>TCP协议</code>是面向流的协议，这也是容易出现粘包问题的原因。而<code>UDP</code>是面向消息的协议，每个<code>UDP段</code>都是一条消息，应用程序必须以消息为单位提取数据，不能一次提取任意字节的数据，这一点和<code>TCP</code>是很不同的。</p><p>怎样定义消息呢？可以认为对方一次性<code>write/send</code>的数据为一个消息，需要明白的是当对方<code>send</code>一条信息的时候，无论底层怎样分段分片，<code>TCP协议层</code>会把构成整条消息的数据段排序完成后才呈现在内核缓冲区。</p><p>例如基于<code>TCP</code>的套接字客户端往服务端上传文件，发送时文件内容是按照一段一段的字节流发送的，在接收方看了，根本不知道该文件的字节流从何处开始，在何处结束。</p><p>所谓粘包问题主要还是因为接收方不知道消息之间的界限，不知道一次性提取多少字节的数据所造成的。</p><p>此外，发送方引起的粘包是由<code>TCP协议</code>本身造成的，<code>TCP</code>为提高传输效率，发送方往往要收集到足够多的数据后才发送一个<code>TCP</code>段。若连续几次需要<code>send</code>的数据都很少，通常<code>TCP</code>会根据优化算法把这些数据合成一个<code>TCP段</code>后一次发送出去，这样接收方就收到了粘包数据。</p><h3 id=tcp与udp><code>TCP</code>与<code>UDP</code></h3><ol><li><code>TCP</code>（transport control protocol，传输控制协议）是面向连接的，面向流的，提供高可靠性服务。收发两端（客户端和服务器端）都要有一一成对的socket，因此，发送端为了将多个发往接收端的包，更有效的发到对方，使用了优化方法（<code>Nagle算法</code>），将多次间隔较小且数据量小的数据，合并成一个大的数据块，然后进行封包。这样，接收端，就难于分辨出来了，必须提供科学的拆包机制。 即面向流的通信是无消息保护边界的。</li><li><code>UDP</code>（user datagram protocol，用户数据报协议）是无连接的，面向消息的，提供高效率服务。不会使用块的合并优化算法，, 由于<code>UDP</code>支持的是一对多的模式，所以接收端的<code>skbuff</code>(套接字缓冲区）采用了链式结构来记录每一个到达的<code>UDP包</code>，在每个<code>UDP包</code>中就有了消息头（消息来源地址，端口等信息），这样，对于接收端来说，就容易进行区分处理了。 <strong>即面向消息的通信是有消息保护边界的。</strong></li><li><strong><code>tcp</code>是基于数据流的，于是收发的消息不能为空，这就需要在客户端和服务端都添加空消息的处理机制，防止程序卡住，而<code>udp</code>是基于数据报的，即便是你输入的是空内容（直接回车），那也不是空消息，<code>udp协议</code>会帮你封装上消息头。</strong></li></ol><p><code>udp</code>的<code>recvfrom</code>是阻塞的，一个<code>recvfrom(x)</code>必须对唯一一个<code>sendinto(y)</code>,收完了<code>x</code>个字节的数据就算完成,若是<code>y>x</code>数据就丢失，这意味着<code>udp</code>根本不会粘包，但是会丢数据，不可靠。</p><p><code>TCP</code>的协议数据不会丢，没有收完包，下次接收，会继续上次继续接收，己端总是在收到<code>ack</code>时才会清除缓冲区内容。数据是可靠的，但是会粘包。</p><h3 id=两种情况下会发生粘包>两种情况下会发生粘包</h3><p>发送端需要等缓冲区满才发送出去，造成粘包（发送数据时间间隔很短，数据了很小，会合到一起，产生粘包）</p><p>运行上面的服务端和客户端代码看TCP粘包现象。</p><p>结果：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic>#服务端</span>
</span></span><span style=display:flex><span>(<span style=color:#d14>&#39;127.0.0.1&#39;</span>, <span style=color:#099>3221</span>)
</span></span><span style=display:flex><span><span style=color:#099>21944</span> <span style=color:#998;font-style:italic>#一共21944个字节数据，只收了1024个字节数据。剩下的就会粘包。</span>
</span></span><span style=display:flex><span><span style=color:#099>393</span>
</span></span><span style=display:flex><span><span style=color:#099>393</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#客户端 执行tasklist 相当于打印windows的任务管理器,然后再执行dir查看有哪些文件。</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;</span>: tasklist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>映像名称                       PID 会话名              会话<span style=color:#998;font-style:italic>#       内存使用 </span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>=========================</span> <span style=color:#000;font-weight:700>========</span> <span style=color:#000;font-weight:700>================</span> <span style=color:#000;font-weight:700>===========</span> <span style=color:#000;font-weight:700>============</span>
</span></span><span style=display:flex><span>System Idle Process              <span style=color:#099>0</span> Services                   <span style=color:#099>0</span>          <span style=color:#099>8</span> K
</span></span><span style=display:flex><span>System                           <span style=color:#099>4</span> Services                   <span style=color:#099>0</span>        <span style=color:#099>144</span> K
</span></span><span style=display:flex><span>Secure System                   <span style=color:#099>88</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>73</span>,<span style=color:#099>304</span> K
</span></span><span style=display:flex><span>Registry                       <span style=color:#099>156</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>93</span>,<span style=color:#099>616</span> K
</span></span><span style=display:flex><span>smss<span style=color:#000;font-weight:700>.</span>exe                       <span style=color:#099>528</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>1</span>,<span style=color:#099>256</span> K
</span></span><span style=display:flex><span>csrss<span style=color:#000;font-weight:700>.</span>exe                      <span style=color:#099>880</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>5</span>,<span style=color:#099>200</span> K
</span></span><span style=display:flex><span>wininit<span style=color:#000;font-weight:700>.</span>exe                    <span style=color:#099>980</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>6</span>,<span style=color:#099>700</span> K
</span></span><span style=display:flex><span>csrss<span style=color:#000;font-weight:700>.</span>exe                      <span style=color:#099>988</span> Console                    <span style=color:#099>1</span>      <span style=color:#099>7</span>,<span style=color:#099>392</span> K
</span></span><span style=display:flex><span>services<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>784</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>12</span>,<span style=color:#099>104</span> K
</span></span><span style=display:flex><span>LsaIso<span style=color:#000;font-weight:700>.</span>exe                     <span style=color:#099>816</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>3</span>,<span style=color:#099>352</span> K
</span></span><span style=display:flex><span>lsass<span style=color:#000;font-weight:700>.</span>exe                      <span style=color:#099>808</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>24</span>,<span style=color:#099>360</span> K
</span></span><span style=display:flex><span>winlogon
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&gt;&gt;</span>: <span style=color:#0086b3>dir</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span>exe                  <span style=color:#099>1064</span> Console                    <span style=color:#099>1</span>     <span style=color:#099>13</span>,<span style=color:#099>052</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1192</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>35</span>,<span style=color:#099>916</span> K
</span></span><span style=display:flex><span>fontdrvhost<span style=color:#000;font-weight:700>.</span>exe               <span style=color:#099>1228</span> Console                    <span style=color:#099>1</span>     <span style=color:#099>14</span>,<span style=color:#099>864</span> K
</span></span><span style=display:flex><span>fontdrvhost<span style=color:#000;font-weight:700>.</span>exe               <span style=color:#099>1236</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>4</span>,<span style=color:#099>444</span> K
</span></span><span style=display:flex><span>WUDFHost<span style=color:#000;font-weight:700>.</span>exe                  <span style=color:#099>1244</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>18</span>,<span style=color:#099>332</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1360</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>18</span>,<span style=color:#099>016</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1408</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>9</span>,<span style=color:#099>484</span> K
</span></span><span style=display:flex><span>dwm<span style=color:#000;font-weight:700>.</span>exe                       <span style=color:#099>1512</span> Console                    <span style=color:#099>1</span>    <span style=color:#099>154</span>,<span style=color:#099>792</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1644</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>9</span>,<span style=color:#099>572</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1656</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>13</span>,<span style=color:#099>208</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1664</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>14</span>,<span style=color:#099>728</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1680</span> Services                   <span style=color:#099>0</span>     <span style=color:#099>11</span>,<span style=color:#099>348</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe                   <span style=color:#099>1708</span> Services                   <span style=color:#099>0</span>      <span style=color:#099>5</span>,<span style=color:#099>540</span> K
</span></span><span style=display:flex><span>svchost<span style=color:#000;font-weight:700>.</span>exe       
</span></span></code></pre></td></tr></table></div></div><p>发现<code>dir</code>显示的不是当前目录下的内容，仿佛是上一次执行<code>tasklist</code>后内容没显示全。</p><p>接收方不及时接收缓冲区的包，造成多个包接收（客户端发送了一段数据，服务端只收了一小部分，服务端下次再收的时候还是从缓冲区拿上次遗留的数据，产生粘包） 。</p><h3 id=拆包的发生情况><strong>拆包的发生情况</strong></h3><p>当发送端缓冲区的长度大于网卡的<code>MTU</code>时，<code>TCP</code>会将这次发送的数据拆成几个数据包发送出去。</p><p><strong>补充问题一：为何TCP是可靠传输，UDP是不可靠传输</strong></p><p><code>TCP</code>在数据传输时，发送端先把数据发送到自己的缓存中，然后协议控制将缓存中的数据发往对端，对端返回一个<code>ack=1</code>，发送端则清理缓存中的数据，对端返回<code>ack=0</code>，则重新发送数据，所以<code>TCP</code>是可靠的。</p><p>而<code>udp</code>发送数据，对端是不会返回确认信息的，因此不可靠。</p><p><strong>补充问题二：send(字节流)和recv(1024)及sendall</strong></p><p><code>recv</code>里指定的1024意思是从缓存里一次拿出1024个字节的数据</p><p><code>send</code>的字节流是先放入己端缓存，然后由协议控制将缓存内容发往对端，如果待发送的字节流大小大于缓存剩余空间，那么数据丢失，用<code>sendall</code>就会循环调用<code>send</code>，数据不会丢失。</p></div></div></div><div id=footer><div class=container-footer><div class=beian><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="></a><a href target=_blank><span class=some>icp...<span></a></div><div class=info><a href=https://github.com/loveminimal/hugo-theme-virgo>🕊️</a> 2021 - <span id=info-date></span></div></div></div><div class=cool-after></div></body></html>