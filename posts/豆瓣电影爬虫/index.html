<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>豆瓣电影数据分析 - My New Hugo Site</title><meta name=Description content="This is my cool site"><meta property="og:title" content="豆瓣电影数据分析"><meta property="og:description" content="爬虫分析步骤 准备工作 获取数据 解析内容 保存数据 url分析 页面包括250条电影数据，分10页，每页25条。每页的url的不同之处：最后的数值= （页数-1）*25
# 第一页第一条 https://movie.douban.com/top250?start=0 服务器通过headers鉴定客户端信息。
保存到excel表格中，代码如下 注意：如果ip被限制可以带cookie请求，这样服务器会认为是同一个客户端发出的请求。
或者使用代理IP来访问。
代理IP网站 from bs4 import BeautifulSoup # 网页解析，获取数据 import re # 正则表达式，进行文字匹配 import urllib.request, urllib.error # 指定url，获取网页数据 from urllib.error import URLError import xlwt # 进行execl操作 import sqlite3 # 进行sqlite 数据库操作 from fake_useragent import UserAgent # 引入动态随机UserAgent from urllib.request import build_opener, ProxyHandler # 反反爬，使用代理IP，防止被服务器封掉。 def main(): baseurl = &#34;https://movie.douban.com/top250?start=&#34; # 1.爬取网页 datalist = getData(baseurl) savepath = &#34;.\\豆瓣电影top250.xls&#34; # 3."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.haipengv.com/posts/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-17T22:02:12+00:00"><meta property="article:modified_time" content="2022-07-17T22:02:12+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="豆瓣电影数据分析"><meta name=twitter:description content="爬虫分析步骤 准备工作 获取数据 解析内容 保存数据 url分析 页面包括250条电影数据，分10页，每页25条。每页的url的不同之处：最后的数值= （页数-1）*25
# 第一页第一条 https://movie.douban.com/top250?start=0 服务器通过headers鉴定客户端信息。
保存到excel表格中，代码如下 注意：如果ip被限制可以带cookie请求，这样服务器会认为是同一个客户端发出的请求。
或者使用代理IP来访问。
代理IP网站 from bs4 import BeautifulSoup # 网页解析，获取数据 import re # 正则表达式，进行文字匹配 import urllib.request, urllib.error # 指定url，获取网页数据 from urllib.error import URLError import xlwt # 进行execl操作 import sqlite3 # 进行sqlite 数据库操作 from fake_useragent import UserAgent # 引入动态随机UserAgent from urllib.request import build_opener, ProxyHandler # 反反爬，使用代理IP，防止被服务器封掉。 def main(): baseurl = &#34;https://movie.douban.com/top250?start=&#34; # 1.爬取网页 datalist = getData(baseurl) savepath = &#34;.\\豆瓣电影top250.xls&#34; # 3."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.haipengv.com/posts/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB/><link rel=prev href=https://blog.haipengv.com/posts/python%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8A%9E%E5%85%AC/><link rel=next href=https://blog.haipengv.com/posts/urllib%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"豆瓣电影数据分析","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.haipengv.com\/posts\/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB\/"},"genre":"posts","wordcount":780,"url":"https:\/\/blog.haipengv.com\/posts\/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB\/","datePublished":"2022-07-17T22:02:12+00:00","dateModified":"2022-07-17T22:02:12+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Author"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu><div class=menu-inner><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="My New Hugo Site">My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">豆瓣电影数据分析</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Author</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-07-17>2022-07-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;780 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#爬虫分析步骤>爬虫分析步骤</a><ul><li></li><li><a href=#url分析>url分析</a></li><li><a href=#保存到excel表格中代码如下>保存到excel表格中，代码如下</a></li><li><a href=#保存到数据库中代码如下>保存到数据库中，代码如下</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=爬虫分析步骤>爬虫分析步骤</h2><h4 id=准备工作>准备工作</h4><h4 id=获取数据>获取数据</h4><h4 id=解析内容>解析内容</h4><h4 id=保存数据>保存数据</h4><h3 id=url分析>url分析</h3><p>页面包括250条电影数据，分10页，每页25条。每页的url的不同之处：最后的数值= （页数-1）*25</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 第一页第一条</span>
</span></span><span style=display:flex><span>https:<span style=color:#f92672>//</span>movie<span style=color:#f92672>.</span>douban<span style=color:#f92672>.</span>com<span style=color:#f92672>/</span>top250<span style=color:#960050;background-color:#1e0010>?</span>start<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>服务器通过headers鉴定客户端信息。</p><h3 id=保存到excel表格中代码如下>保存到excel表格中，代码如下</h3><p>注意：如果<code>ip</code>被限制可以带<code>cookie</code>请求，这样服务器会认为是同一个客户端发出的请求。</p><p>或者使用代理IP来访问。</p><p>代理IP<a href=https://free.kuaidaili.com/free/ target=_blank rel="noopener noreffer">网站</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> bs4 <span style=color:#f92672>import</span> BeautifulSoup <span style=color:#75715e># 网页解析，获取数据</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re <span style=color:#75715e># 正则表达式，进行文字匹配</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> urllib.request<span style=color:#f92672>,</span> urllib.error <span style=color:#75715e># 指定url，获取网页数据</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> urllib.error <span style=color:#f92672>import</span> URLError
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> xlwt <span style=color:#75715e># 进行execl操作</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sqlite3 <span style=color:#75715e># 进行sqlite 数据库操作</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> fake_useragent <span style=color:#f92672>import</span> UserAgent <span style=color:#75715e># 引入动态随机UserAgent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> urllib.request <span style=color:#f92672>import</span> build_opener, ProxyHandler <span style=color:#75715e># 反反爬，使用代理IP，防止被服务器封掉。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    baseurl <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://movie.douban.com/top250?start=&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 1.爬取网页</span>
</span></span><span style=display:flex><span>    datalist <span style=color:#f92672>=</span> getData(baseurl)
</span></span><span style=display:flex><span>    savepath <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;.</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>豆瓣电影top250.xls&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 3.保存数据</span>
</span></span><span style=display:flex><span>    saveData(datalist,savepath)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># askURL(&#34;https://movie.douban.com/top250?start=0&#34;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 影片详情的规则</span>
</span></span><span style=display:flex><span>findLink <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;a href=&#34;(.*?)&#34;&gt;&#39;</span>)     <span style=color:#75715e># 创建正则表达式对象，表示规则（字符串的模式）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 影片图片</span>
</span></span><span style=display:flex><span>findImgSrc <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;img.*src=&#34;(.*?)&#34;&#39;</span>,re<span style=color:#f92672>.</span>S)  <span style=color:#75715e># re.S 让换行符包含在字符中      </span>
</span></span><span style=display:flex><span><span style=color:#75715e># 影片片名</span>
</span></span><span style=display:flex><span>findTitle <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span class=&#34;title&#34;&gt;(.*)&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 影片评分</span>
</span></span><span style=display:flex><span>findRating <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span class=&#34;rating_num&#34; property=&#34;v:average&#34;&gt;(.*)&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 找到评价人数</span>
</span></span><span style=display:flex><span>findJudge <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span&gt;(\d*)人评价&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 找到概况</span>
</span></span><span style=display:flex><span>findInq <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span class=&#34;inq&#34;&gt;(.*)&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 找到影片的相关内容</span>
</span></span><span style=display:flex><span>findBd <span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;p class=&#34;&#34;&gt;(.*?)&lt;/p&gt;&#39;</span>,re<span style=color:#f92672>.</span>S)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 爬取网页</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getData</span>(baseurl):
</span></span><span style=display:flex><span>    datalist <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>10</span>):       <span style=color:#75715e># 调用获取页面信息的函数,10次,正好10页内容250条。</span>
</span></span><span style=display:flex><span>        url <span style=color:#f92672>=</span> baseurl <span style=color:#f92672>+</span> str(i<span style=color:#f92672>*</span><span style=color:#ae81ff>25</span>)
</span></span><span style=display:flex><span>        askURL(url)
</span></span><span style=display:flex><span>        html <span style=color:#f92672>=</span> askURL(url)      <span style=color:#75715e># 保存获取到的网页源码</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 2.逐一解析数据</span>
</span></span><span style=display:flex><span>        soup <span style=color:#f92672>=</span> BeautifulSoup(html,<span style=color:#e6db74>&#34;html.parser&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> soup<span style=color:#f92672>.</span>find_all(<span style=color:#e6db74>&#34;div&#34;</span>,class_<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item&#34;</span>):    <span style=color:#75715e>#查找符合要求的字符串形成列表。</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(item) # 测试查看电影item全部信息</span>
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> []   <span style=color:#75715e>#保存一部电影的所有信息</span>
</span></span><span style=display:flex><span>            item <span style=color:#f92672>=</span> str(item)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 影片详情的链接</span>
</span></span><span style=display:flex><span>            link <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findLink,item)[<span style=color:#ae81ff>0</span>]     <span style=color:#75715e>#re库用来通过正则表达式查找指定的字符串</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(link)</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(link)                   <span style=color:#75715e># 添加链接</span>
</span></span><span style=display:flex><span>            imgSrc<span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findImgSrc,item)[<span style=color:#ae81ff>0</span>]  <span style=color:#75715e>#添加图片</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(imgSrc)
</span></span><span style=display:flex><span>            titles <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findTitle,item)        <span style=color:#75715e># 片名可能只有一个中文名，没有外国名</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (len(titles) <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>                ctitle <span style=color:#f92672>=</span> titles[<span style=color:#ae81ff>0</span>]          <span style=color:#75715e># 添加中文名</span>
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(ctitle)
</span></span><span style=display:flex><span>                otitle <span style=color:#f92672>=</span> titles[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;/&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>)      <span style=color:#75715e># 去掉无关的符号</span>
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(otitle)                 <span style=color:#75715e># 添加外国名</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(titles[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39; &#39;</span>)        <span style=color:#75715e># 外国名字留空</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            rating <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findRating,item)[<span style=color:#ae81ff>0</span>]     <span style=color:#75715e># 添加评分</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(rating)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            judgeNim <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findJudge,item)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(judgeNim)           <span style=color:#75715e># 添加评价人数</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            inq <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findInq,item)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> len(inq) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                inq <span style=color:#f92672>=</span> inq[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;。&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>)       <span style=color:#75715e># 去掉句号</span>
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(inq)                <span style=color:#75715e># 添加概述</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34; &#34;</span>)        <span style=color:#75715e># 留空</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            bd <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findBd,item)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            bd <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>&#39;&lt;br(\s+)?/&gt;(\s+)?&#39;</span>,<span style=color:#e6db74>&#34; &#34;</span>,bd)     <span style=color:#75715e># 去掉&lt;br/&gt;</span>
</span></span><span style=display:flex><span>            bd <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>&#39;/&#39;</span>,<span style=color:#e6db74>&#34; &#34;</span>,bd)     <span style=color:#75715e># 替换/</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(bd<span style=color:#f92672>.</span>strip())     <span style=color:#75715e># 去掉前后的空格</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            datalist<span style=color:#f92672>.</span>append(data)       <span style=color:#75715e># 把处理好的一部分电影信息放入datalist</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># print(datalist)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> datalist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 得到一个指定的URL的网页内容</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>askURL</span>(url):
</span></span><span style=display:flex><span>    head <span style=color:#f92672>=</span> {        <span style=color:#75715e># 模拟浏览器头部信息，向豆瓣服务器发送消息</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;User-Agent&#34;</span>: UserAgent()<span style=color:#f92672>.</span>random
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    request <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>Request(url,headers<span style=color:#f92672>=</span>head)
</span></span><span style=display:flex><span>    handler <span style=color:#f92672>=</span> ProxyHandler({<span style=color:#e6db74>&#34;http&#34;</span>:<span style=color:#e6db74>&#34;58.20.184.187:9091&#34;</span>}) <span style=color:#75715e># 使用代理IP请求资源</span>
</span></span><span style=display:flex><span>    opener <span style=color:#f92672>=</span> build_opener(handler)
</span></span><span style=display:flex><span>    <span style=color:#75715e># 用户代理表示告诉豆瓣服务器，我们是什么类型的机器、浏览器(本质上是告诉浏览器，我们可以接收什么水平的文件内容)</span>
</span></span><span style=display:flex><span>    html <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> opener<span style=color:#f92672>.</span>open(request)
</span></span><span style=display:flex><span>        html <span style=color:#f92672>=</span> resp<span style=color:#f92672>.</span>read()<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#34;utf-8&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># print(html)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> URLError <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(e,<span style=color:#e6db74>&#34;code&#34;</span>):
</span></span><span style=display:flex><span>            print(e<span style=color:#f92672>.</span>code)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(e,<span style=color:#e6db74>&#34;reason&#34;</span>):
</span></span><span style=display:flex><span>            print(e<span style=color:#f92672>.</span>reason)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span><span style=color:#75715e># 3.保存数据</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>saveData</span>(datalist,savepath):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;save....&#34;</span>)
</span></span><span style=display:flex><span>    book <span style=color:#f92672>=</span> xlwt<span style=color:#f92672>.</span>Workbook(encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#75715e># 创建workbook对象</span>
</span></span><span style=display:flex><span>    sheet <span style=color:#f92672>=</span> book<span style=color:#f92672>.</span>add_sheet(<span style=color:#e6db74>&#39;豆瓣电影Top250&#39;</span>,cell_overwrite_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)    <span style=color:#75715e># 创建工作表</span>
</span></span><span style=display:flex><span>    col <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#34;电影详情链接&#34;</span>,<span style=color:#e6db74>&#34;图片链接&#34;</span>,<span style=color:#e6db74>&#34;影片中文名&#34;</span>,<span style=color:#e6db74>&#34;影片外国名&#34;</span>,<span style=color:#e6db74>&#34;评分&#34;</span>,<span style=color:#e6db74>&#34;评价数&#34;</span>,<span style=color:#e6db74>&#34;概况&#34;</span>,<span style=color:#e6db74>&#34;相关信息&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>8</span>):
</span></span><span style=display:flex><span>        sheet<span style=color:#f92672>.</span>write(<span style=color:#ae81ff>0</span>,i,col[i])     <span style=color:#75715e># 列名</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>250</span>):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;第</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>条&#34;</span> <span style=color:#f92672>%</span>i)
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> datalist[i]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>8</span>):
</span></span><span style=display:flex><span>            sheet<span style=color:#f92672>.</span>write(i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>,j,data[j])      <span style=color:#75715e># 数据</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    book<span style=color:#f92672>.</span>save(savepath)    <span style=color:#75715e># 保存数据表</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>: <span style=color:#75715e># 当程序执行时。程序入口，控制函数调用顺序。</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 调用函数</span>
</span></span><span style=display:flex><span>    main()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;爬取完毕！&#34;</span>)
</span></span></code></pre></div><h3 id=保存到数据库中代码如下>保存到数据库中，代码如下</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> bs4 <span style=color:#f92672>import</span> BeautifulSoup <span style=color:#75715e># 网页解析，获取数据</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re <span style=color:#75715e># 正则表达式，进行文字匹配</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> urllib.request<span style=color:#f92672>,</span> urllib.error <span style=color:#75715e># 指定url，获取网页数据</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> urllib.error <span style=color:#f92672>import</span> URLError
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> xlwt <span style=color:#75715e># 进行execl操作</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sqlite3 <span style=color:#75715e># 进行sqlite 数据库操作</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> fake_useragent <span style=color:#f92672>import</span> UserAgent <span style=color:#75715e># 引入动态随机UserAgent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> urllib.request <span style=color:#f92672>import</span> build_opener, ProxyHandler <span style=color:#75715e># 反反爬，使用代理IP，防止被服务器封掉。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    baseurl <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://movie.douban.com/top250?start=&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 1.爬取网页</span>
</span></span><span style=display:flex><span>    datalist <span style=color:#f92672>=</span> getData(baseurl)
</span></span><span style=display:flex><span>    dbpath <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;movie.db&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 3.保存数据</span>
</span></span><span style=display:flex><span>    saveData2DB(datalist, dbpath)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># askURL(&#34;https://movie.douban.com/top250?start=0&#34;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 影片详情的规则</span>
</span></span><span style=display:flex><span>findLink <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;a href=&#34;(.*?)&#34;&gt;&#39;</span>)     <span style=color:#75715e># 创建正则表达式对象，表示规则（字符串的模式）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 影片图片</span>
</span></span><span style=display:flex><span>findImgSrc <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;img.*src=&#34;(.*?)&#34;&#39;</span>,re<span style=color:#f92672>.</span>S)  <span style=color:#75715e># re.S 让换行符包含在字符中      </span>
</span></span><span style=display:flex><span><span style=color:#75715e># 影片片名</span>
</span></span><span style=display:flex><span>findTitle <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span class=&#34;title&#34;&gt;(.*)&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 影片评分</span>
</span></span><span style=display:flex><span>findRating <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span class=&#34;rating_num&#34; property=&#34;v:average&#34;&gt;(.*)&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 找到评价人数</span>
</span></span><span style=display:flex><span>findJudge <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span&gt;(\d*)人评价&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 找到概况</span>
</span></span><span style=display:flex><span>findInq <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;span class=&#34;inq&#34;&gt;(.*)&lt;/span&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># 找到影片的相关内容</span>
</span></span><span style=display:flex><span>findBd <span style=color:#f92672>=</span>re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;&lt;p class=&#34;&#34;&gt;(.*?)&lt;/p&gt;&#39;</span>,re<span style=color:#f92672>.</span>S)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 爬取网页</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getData</span>(baseurl):
</span></span><span style=display:flex><span>    datalist <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>10</span>):       <span style=color:#75715e># 调用获取页面信息的函数,10次,正好10页内容250条。</span>
</span></span><span style=display:flex><span>        url <span style=color:#f92672>=</span> baseurl <span style=color:#f92672>+</span> str(i<span style=color:#f92672>*</span><span style=color:#ae81ff>25</span>)
</span></span><span style=display:flex><span>        askURL(url)
</span></span><span style=display:flex><span>        html <span style=color:#f92672>=</span> askURL(url)      <span style=color:#75715e># 保存获取到的网页源码</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 2.逐一解析数据</span>
</span></span><span style=display:flex><span>        soup <span style=color:#f92672>=</span> BeautifulSoup(html,<span style=color:#e6db74>&#34;html.parser&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> soup<span style=color:#f92672>.</span>find_all(<span style=color:#e6db74>&#34;div&#34;</span>,class_<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;item&#34;</span>):    <span style=color:#75715e>#查找符合要求的字符串形成列表。</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(item) # 测试查看电影item全部信息</span>
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> []   <span style=color:#75715e>#保存一部电影的所有信息</span>
</span></span><span style=display:flex><span>            item <span style=color:#f92672>=</span> str(item)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 影片详情的链接</span>
</span></span><span style=display:flex><span>            link <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findLink,item)[<span style=color:#ae81ff>0</span>]     <span style=color:#75715e>#re库用来通过正则表达式查找指定的字符串</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># print(link)</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(link)                   <span style=color:#75715e># 添加链接</span>
</span></span><span style=display:flex><span>            imgSrc<span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findImgSrc,item)[<span style=color:#ae81ff>0</span>]  <span style=color:#75715e>#添加图片</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(imgSrc)
</span></span><span style=display:flex><span>            titles <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findTitle,item)        <span style=color:#75715e># 片名可能只有一个中文名，没有外国名</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (len(titles) <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>                ctitle <span style=color:#f92672>=</span> titles[<span style=color:#ae81ff>0</span>]          <span style=color:#75715e># 添加中文名</span>
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(ctitle)
</span></span><span style=display:flex><span>                otitle <span style=color:#f92672>=</span> titles[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;/&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>)      <span style=color:#75715e># 去掉无关的符号</span>
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(otitle)                 <span style=color:#75715e># 添加外国名</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(titles[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39; &#39;</span>)        <span style=color:#75715e># 外国名字留空</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            rating <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findRating,item)[<span style=color:#ae81ff>0</span>]     <span style=color:#75715e># 添加评分</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(rating)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            judgeNim <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findJudge,item)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(judgeNim)           <span style=color:#75715e># 添加评价人数</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            inq <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findInq,item)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> len(inq) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                inq <span style=color:#f92672>=</span> inq[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;。&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>)       <span style=color:#75715e># 去掉句号</span>
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(inq)                <span style=color:#75715e># 添加概述</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                data<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34; &#34;</span>)        <span style=color:#75715e># 留空</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            bd <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(findBd,item)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            bd <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>&#39;&lt;br(\s+)?/&gt;(\s+)?&#39;</span>,<span style=color:#e6db74>&#34; &#34;</span>,bd)     <span style=color:#75715e># 去掉&lt;br/&gt;</span>
</span></span><span style=display:flex><span>            bd <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(<span style=color:#e6db74>&#39;/&#39;</span>,<span style=color:#e6db74>&#34; &#34;</span>,bd)     <span style=color:#75715e># 替换/</span>
</span></span><span style=display:flex><span>            data<span style=color:#f92672>.</span>append(bd<span style=color:#f92672>.</span>strip())     <span style=color:#75715e># 去掉前后的空格</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            datalist<span style=color:#f92672>.</span>append(data)       <span style=color:#75715e># 把处理好的一部分电影信息放入datalist</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># print(datalist)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> datalist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 得到一个指定的URL的网页内容</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>askURL</span>(url):
</span></span><span style=display:flex><span>    head <span style=color:#f92672>=</span> {        <span style=color:#75715e># 模拟浏览器头部信息，向豆瓣服务器发送消息</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;User-Agent&#34;</span>: UserAgent()<span style=color:#f92672>.</span>random
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    request <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>Request(url,headers<span style=color:#f92672>=</span>head)
</span></span><span style=display:flex><span>    handler <span style=color:#f92672>=</span> ProxyHandler({<span style=color:#e6db74>&#34;http&#34;</span>:<span style=color:#e6db74>&#34;58.20.184.187:9091&#34;</span>}) <span style=color:#75715e># 使用代理IP请求资源</span>
</span></span><span style=display:flex><span>    opener <span style=color:#f92672>=</span> build_opener(handler)
</span></span><span style=display:flex><span>    <span style=color:#75715e># 用户代理表示告诉豆瓣服务器，我们是什么类型的机器、浏览器(本质上是告诉浏览器，我们可以接收什么水平的文件内容)</span>
</span></span><span style=display:flex><span>    html <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        resp <span style=color:#f92672>=</span> opener<span style=color:#f92672>.</span>open(request)
</span></span><span style=display:flex><span>        html <span style=color:#f92672>=</span> resp<span style=color:#f92672>.</span>read()<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#34;utf-8&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># print(html)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> URLError <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(e,<span style=color:#e6db74>&#34;code&#34;</span>):
</span></span><span style=display:flex><span>            print(e<span style=color:#f92672>.</span>code)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(e,<span style=color:#e6db74>&#34;reason&#34;</span>):
</span></span><span style=display:flex><span>            print(e<span style=color:#f92672>.</span>reason)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span><span style=color:#75715e># 3.保存数据</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>saveData2DB</span>(datalist,dbpath):
</span></span><span style=display:flex><span>    init_db(dbpath)
</span></span><span style=display:flex><span>    conn <span style=color:#f92672>=</span> sqlite3<span style=color:#f92672>.</span>connect(dbpath)
</span></span><span style=display:flex><span>    cur <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> data <span style=color:#f92672>in</span> datalist:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> index <span style=color:#f92672>in</span> range(len(data)):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> index <span style=color:#f92672>==</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>or</span> index <span style=color:#f92672>==</span> <span style=color:#ae81ff>5</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            data[index] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#34;&#39;</span><span style=color:#f92672>+</span>data[index]<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;&#34;&#39;</span>
</span></span><span style=display:flex><span>        sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                insert into movie250(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                info_link,pic_link,cname,ename,score,rated,instroduction,info
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                )
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                values(</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>)&#39;&#39;&#39;</span><span style=color:#f92672>%</span><span style=color:#e6db74>&#34;,&#34;</span><span style=color:#f92672>.</span>join(data)
</span></span><span style=display:flex><span>        <span style=color:#75715e># print(sql) # 打印插入语句（测试用）</span>
</span></span><span style=display:flex><span>        cur<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span>        conn<span style=color:#f92672>.</span>commit()
</span></span><span style=display:flex><span>    cur<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>    conn<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>init_db</span>(dbpath):
</span></span><span style=display:flex><span>    sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        create table movie250
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        (
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        id integer primary key autoincrement,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        info_link text,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        pic_link text,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        cname varchar ,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ename varchar ,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        score numeric ,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        rated numeric ,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        instroduction text ,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        info text
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        )
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>     <span style=color:#75715e># 创建数据表</span>
</span></span><span style=display:flex><span>    conn <span style=color:#f92672>=</span> sqlite3<span style=color:#f92672>.</span>connect(dbpath)
</span></span><span style=display:flex><span>    cursor <span style=color:#f92672>=</span> conn<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>    cursor<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span>    conn<span style=color:#f92672>.</span>commit()
</span></span><span style=display:flex><span>    conn<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:  <span style=color:#75715e># 当程序执行时。程序入口，控制函数调用顺序。</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 调用函数</span>
</span></span><span style=display:flex><span>    main()
</span></span><span style=display:flex><span>    <span style=color:#75715e># init_db(&#34;movietest.db&#34;) # 测试用，生成测试库。</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;爬取完毕！&#34;</span>)
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-07-17</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://blog.haipengv.com/posts/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB/ data-title=豆瓣电影数据分析><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://blog.haipengv.com/posts/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://blog.haipengv.com/posts/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB/ data-title=豆瓣电影数据分析><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://blog.haipengv.com/posts/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB/ data-title=豆瓣电影数据分析><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://blog.haipengv.com/posts/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1%E7%88%AC%E8%99%AB/ data-title=豆瓣电影数据分析><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/python%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8A%9E%E5%85%AC/ class=prev rel=prev title=python自动化办公之文件读写><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>python自动化办公之文件读写</a>
<a href=/posts/urllib%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/ class=next rel=next title=urllib库的基本使用>urllib库的基本使用<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.115.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>