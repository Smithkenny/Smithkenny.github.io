<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>ceph - Peng</title><script async src=http://umami.haipengv.com/script.js data-website-id=2300daa7-4536-434f-bd3b-504e48a633ab></script><meta name=Description content="One World,One Dream!"><meta property="og:title" content="ceph"><meta property="og:description" content="基于k8s的ceph集群搭建 环境 master-139 mon,osd 既做管理节点又做子节点 node1-140 mon,osd 做子节点 node2-141 mon,osd 做子节点 ceph 版本 13.2.10 mimic (stable) 系统配置 系统配置工作， 三台节点依次执行 1、修改"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.haipengv.com/ceph/"><meta property="og:image" content="https://blog.haipengv.com/logo.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-16T10:10:00+00:00"><meta property="article:modified_time" content="2023-07-22T12:59:34+08:00"><meta property="og:site_name" content="我的网站"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.haipengv.com/logo.webp"><meta name=twitter:title content="ceph"><meta name=twitter:description content="基于k8s的ceph集群搭建 环境 master-139 mon,osd 既做管理节点又做子节点 node1-140 mon,osd 做子节点 node2-141 mon,osd 做子节点 ceph 版本 13.2.10 mimic (stable) 系统配置 系统配置工作， 三台节点依次执行 1、修改"><meta name=application-name content="我的网站"><meta name=apple-mobile-web-app-title content="我的网站"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.haipengv.com/ceph/><link rel=prev href=https://blog.haipengv.com/%E5%AE%89%E8%A3%85%E4%BB%BB%E6%84%8F%E7%89%88%E6%9C%ACpython/><link rel=next href=https://blog.haipengv.com/python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%80%BB%E7%BB%93/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ceph","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.haipengv.com\/ceph\/"},"genre":"posts","keywords":"ceph集群","wordcount":4792,"url":"https:\/\/blog.haipengv.com\/ceph\/","datePublished":"2022-05-16T10:10:00+00:00","dateModified":"2023-07-22T12:59:34+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Peng"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friends/><i class='fas fa-fw fa-fan fa-spin'></i> 友链 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friends/ title><i class='fas fa-fw fa-fan fa-spin'></i>友链</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ceph</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Peng</a>
</span>&nbsp;<span class=post-category>收录于 <a href=/categories/linux/><i class="far fa-folder fa-fw" aria-hidden=true></i>linux</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-05-16>2022-05-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 4792 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 10 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#基于k8s的ceph集群搭建>基于k8s的ceph集群搭建</a></li><li><a href=#环境>环境</a></li></ul></li><li><a href=#系统配置>系统配置</a><ul><li><ul><li><a href=#1修改主机名称>1、修改主机名称</a></li><li><a href=#2编辑hosts文件>2、编辑hosts文件</a></li><li><a href=#3修改yum源>3.修改yum源</a></li><li><a href=#4安装ceph与ceph-deploy组件>4、安装ceph与ceph-deploy组件</a></li><li><a href=#5安装ntp时间同步工具>5.安装NTP时间同步工具</a></li></ul></li><li><a href=#免密码ssh登陆>免密码SSH登陆</a><ul><li><a href=#6开放端口-非生产环境-可以直接禁用防火墙>6.开放端口， 非生产环境， 可以直接禁用防火墙：</a></li><li><a href=#7selinux设置>7.SELINUX设置</a></li><li><a href=#8生成密钥>8.生成密钥</a></li><li><a href=#9分发密钥至各机器节点>9.分发密钥至各机器节点</a></li></ul></li></ul></li><li><a href=#集群搭建配置><strong>集群搭建配置</strong></a><ul><li><ul><li><a href=#1采用root身份进行安装在管理节点创建集群配置目录>1.采用root身份进行安装，在管理节点创建集群配置目录</a></li><li><a href=#2创建集群-包含三台机器节点>2.创建集群， 包含三台机器节点：</a></li><li><a href=#3如果接下来集群的安装配置出现问题-可以执行以下命令清除-再重新安装可选>3.如果接下来集群的安装配置出现问题， 可以执行以下命令清除， 再重新安装(可选)</a></li><li><a href=#4将三台节点的mon信息也删除可选>4.将三台节点的mon信息也删除（可选）</a></li><li><a href=#5修改配置文件-有些配置后面需用到>5.修改配置文件， 有些配置后面需用到</a></li><li><a href=#6执行安装>6.执行安装</a></li><li><a href=#7初始monitor信息>7.初始monitor信息</a></li><li><a href=#8同步管理信息>8.同步管理信息</a></li><li><a href=#9安装mgr管理守护进程-大于12x版本需安装-我们装的是最新版需执行>9.安装mgr(管理守护进程)， 大于12.x版本需安装， 我们装的是最新版，需执行：</a></li><li><a href=#10查看当前ceph版本>10.查看当前ceph版本</a></li></ul></li><li><a href=#安装osd对象存储设备>安装OSD(对象存储设备)</a><ul><li><a href=#1执行创建osd命令>1.执行创建OSD命令</a></li><li><a href=#2验证节点>2.验证节点：</a></li><li><a href=#3如果出现错误各节点上执行确保时间一致>3.如果出现错误，各节点上执行,确保时间一致。</a></li></ul></li></ul></li><li><a href=#安装管理后台可选><strong>安装管理后台</strong>（可选）</a><ul><li><ul><li><a href=#1开启dashboard模块>1.开启dashboard模块</a></li><li><a href=#2生成签名>2.生成签名</a></li><li><a href=#3创建目录>3.创建目录</a></li><li><a href=#4生成密钥对>4.生成密钥对</a></li><li><a href=#5启动dashboard>5.启动dashboard</a></li><li><a href=#6设置ip与port>6.设置IP与PORT</a></li><li><a href=#7关闭https>7.关闭HTTPS</a></li><li><a href=#8查看服务信息>8.查看服务信息</a></li><li><a href=#9设置管理用户与密码>9.设置管理用户与密码</a></li><li><a href=#10访问>10.访问</a></li></ul></li></ul></li><li><a href=#创建cephfs>创建Cephfs</a><ul><li><ul><li><a href=#1创建两个存储池-执行两条命令>1.创建两个存储池, 执行两条命令</a></li><li><a href=#2创建fs-名称为cephfs>2.创建fs, 名称为cephfs</a></li><li><a href=#3状态查看-以下信息代表正常>3.状态查看， 以下信息代表正常</a></li></ul></li><li><a href=#采用fuse挂载>采用fuse挂载</a><ul><li><a href=#1创建挂载目录>1.创建挂载目录</a></li><li><a href=#2挂载cephfs>2.挂载cephfs</a></li><li><a href=#3查看磁盘挂载信息>3.查看磁盘挂载信息</a></li></ul></li></ul></li><li><a href=#ceph常用命令>ceph常用命令</a><ul><li><ul><li><a href=#ceph>ceph</a></li><li><a href=#ceph认证>ceph认证</a></li><li><a href=#创建管理用户>创建管理用户</a></li><li><a href=#集群相关>集群相关</a></li><li><a href=#mon命令>mon命令</a></li><li><a href=#mds命令>mds命令</a></li><li><a href=#osd命令>osd命令</a></li><li><a href=#pg命令>pg命令</a></li><li><a href=#rados和rbd命令>rados和rbd命令</a></li><li><a href=#crush映射>CRUSH映射</a></li><li><a href=#块设备的一些命令>块设备的一些命令</a></li><li><a href=#快照和克隆相关命令>快照和克隆相关命令</a></li><li><a href=#快照克隆相关例子>快照克隆相关例子</a></li></ul></li></ul></li><li><a href=#日志文件汇总>日志文件汇总</a><ul><li><a href=#参考文档>参考文档</a></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=基于k8s的ceph集群搭建>基于k8s的ceph集群搭建</h3><h3 id=环境>环境</h3><ul><li>master-139 mon,osd 既做管理节点又做子节点</li><li>node1-140 mon,osd 做子节点</li><li>node2-141 mon,osd 做子节点</li><li>ceph 版本 13.2.10 mimic (stable)</li></ul><h2 id=系统配置>系统配置</h2><p>系统配置工作， 三台节点依次执行</p><h4 id=1修改主机名称>1、修改主机名称</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@master-139 ~<span class=o>]</span><span class=c1># vi /etc/hostname</span>
</span></span><span class=line><span class=cl>master-139
</span></span></code></pre></td></tr></table></div></div><h4 id=2编辑hosts文件>2、编辑hosts文件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>10.4.7.139   master-139
</span></span><span class=line><span class=cl>10.4.7.140   node1-140
</span></span><span class=line><span class=cl>10.4.7.141	 node2-141
</span></span></code></pre></td></tr></table></div></div><p>注意， 这里面的主机名称要和节点名称保持一致， 否则安装的时候会出现问题</p><h4 id=3修改yum源>3.修改yum源</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF &gt; /etc/yum.repos.d/ceph.repo 
</span></span></span><span class=line><span class=cl><span class=s>[ceph] 
</span></span></span><span class=line><span class=cl><span class=s>name=Ceph packages for $basearch
</span></span></span><span class=line><span class=cl><span class=s>baseurl=https://mirrors.tuna.tsinghua.edu.cn/ceph/rpm-mimic/el7/x86_64/ 
</span></span></span><span class=line><span class=cl><span class=s>enabled=1 
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=1 
</span></span></span><span class=line><span class=cl><span class=s>type=rpm-md 
</span></span></span><span class=line><span class=cl><span class=s>gpgkey=https://download.ceph.com/keys/release.asc
</span></span></span><span class=line><span class=cl><span class=s> 
</span></span></span><span class=line><span class=cl><span class=s>[ceph-noarch] 
</span></span></span><span class=line><span class=cl><span class=s>name=Ceph noarch packages 
</span></span></span><span class=line><span class=cl><span class=s># 官方源 
</span></span></span><span class=line><span class=cl><span class=s>#baseurl=http://download.ceph.com/rpm-mimic/el7/noarch 
</span></span></span><span class=line><span class=cl><span class=s># 清华源 
</span></span></span><span class=line><span class=cl><span class=s>baseurl=https://mirrors.tuna.tsinghua.edu.cn/ceph/rpm-mimic/el7/noarch/ 
</span></span></span><span class=line><span class=cl><span class=s>enabled=1 
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=1 
</span></span></span><span class=line><span class=cl><span class=s>type=rpm-md 
</span></span></span><span class=line><span class=cl><span class=s>gpgkey=https://download.ceph.com/keys/release.asc
</span></span></span><span class=line><span class=cl><span class=s> 
</span></span></span><span class=line><span class=cl><span class=s>[ceph-source] 
</span></span></span><span class=line><span class=cl><span class=s>name=Ceph source packages
</span></span></span><span class=line><span class=cl><span class=s>baseurl=https://mirrors.tuna.tsinghua.edu.cn/ceph/rpm-mimic/el7/SRPMS/ 
</span></span></span><span class=line><span class=cl><span class=s>enabled=1 
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=1 
</span></span></span><span class=line><span class=cl><span class=s>type=rpm-md 
</span></span></span><span class=line><span class=cl><span class=s>gpgkey=https://download.ceph.com/keys/release.asc
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=4安装ceph与ceph-deploy组件>4、安装ceph与ceph-deploy组件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>yum clean all &amp;&amp; yum makecache 
</span></span><span class=line><span class=cl>yum -y install python-setuptools epel-release
</span></span><span class=line><span class=cl>yum -y install python2-pip ceph-deploy ceph
</span></span></code></pre></td></tr></table></div></div><h4 id=5安装ntp时间同步工具>5.安装NTP时间同步工具</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install ntp ntpdate ntp-doc -y
</span></span></code></pre></td></tr></table></div></div><p>确保时区是正确， 设置开机启动：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl <span class=nb>enable</span> ntpd
</span></span></code></pre></td></tr></table></div></div><p>并将时间每隔1小时自动校准同步。编辑 vi /etc/rc.d/rc.local 追加：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/usr/sbin/ntpdate ntp1.aliyun.com &gt; /dev/null 2&gt;<span class=p>&amp;</span>1<span class=p>;</span> /sbin/hwclock -w
</span></span></code></pre></td></tr></table></div></div><p>配置定时任务, 执行crontab -e 加入：</p><h3 id=免密码ssh登陆>免密码SSH登陆</h3><h4 id=6开放端口-非生产环境-可以直接禁用防火墙>6.开放端口， 非生产环境， 可以直接禁用防火墙：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl stop firewalld.service 
</span></span><span class=line><span class=cl>systemctl disable firewalld.service
</span></span></code></pre></td></tr></table></div></div><h4 id=7selinux设置>7.SELINUX设置</h4><p>SELinux 设为禁用：</p><p>永久生效：
编辑 vi /etc/selinux/config 修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>SELINUX</span><span class=o>=</span>disabled
</span></span></code></pre></td></tr></table></div></div><h4 id=8生成密钥>8.生成密钥</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>执行 ssh-keygen ，一直按默认提示点击生成 RSA 密钥信息。
</span></span></code></pre></td></tr></table></div></div><h4 id=9分发密钥至各机器节点>9.分发密钥至各机器节点</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh-copy-id root@master-139
</span></span><span class=line><span class=cl>ssh-copy-id root@node1-140
</span></span><span class=line><span class=cl>ssh-copy-id root@node2-141
</span></span></code></pre></td></tr></table></div></div><p><strong>注意：以上1-9步骤在所有节点上执行！！</strong></p><h2 id=集群搭建配置><strong>集群搭建配置</strong></h2><h4 id=1采用root身份进行安装在管理节点创建集群配置目录>1.采用root身份进行安装，在管理节点创建集群配置目录</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /usr/local/
</span></span><span class=line><span class=cl>mkdir ceph-cluster 
</span></span><span class=line><span class=cl><span class=nb>cd</span> ceph-cluster
</span></span></code></pre></td></tr></table></div></div><p>注意： 此目录作为 ceph 操作命令的基准目录， 会存储处理配置信息。</p><h4 id=2创建集群-包含三台机器节点>2.创建集群， 包含三台机器节点：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy new master-139 node1-140 node2-141
</span></span></code></pre></td></tr></table></div></div><p>创建成功后， 会生一个配置文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@master-139 ceph-cluster<span class=o>]</span><span class=c1># ll</span>
</span></span><span class=line><span class=cl>total <span class=m>16</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root  <span class=m>242</span> May <span class=m>15</span> 03:15 ceph.conf
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>5559</span> May <span class=m>15</span> 03:15 ceph-deploy-ceph.log
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> root root   <span class=m>73</span> May <span class=m>15</span> 03:15 ceph.mon.keyring
</span></span></code></pre></td></tr></table></div></div><h4 id=3如果接下来集群的安装配置出现问题-可以执行以下命令清除-再重新安装可选>3.如果接下来集群的安装配置出现问题， 可以执行以下命令清除， 再重新安装(可选)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy purge master-139 node1-140 node2-141
</span></span><span class=line><span class=cl>ceph-deploy purgedata master-139 node1-140 node2-141
</span></span><span class=line><span class=cl>ceph-deploy forgetkeys
</span></span></code></pre></td></tr></table></div></div><h4 id=4将三台节点的mon信息也删除可选>4.将三台节点的mon信息也删除（可选）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rm -rf /var/run/ceph/
</span></span></code></pre></td></tr></table></div></div><h4 id=5修改配置文件-有些配置后面需用到>5.修改配置文件， 有些配置后面需用到</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /usr/local/ceph-cluster/ceph.conf
</span></span><span class=line><span class=cl><span class=o>[</span>global<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=c1># 设置pool池默认分配数量 默认副本数为3 </span>
</span></span><span class=line><span class=cl>osd pool default <span class=nv>size</span> <span class=o>=</span> <span class=m>3</span> 
</span></span><span class=line><span class=cl><span class=c1># 容忍更多的时钟误差 </span>
</span></span><span class=line><span class=cl>mon clock drift <span class=nv>allowed</span> <span class=o>=</span> <span class=m>2</span> 
</span></span><span class=line><span class=cl>mon clock drift warn <span class=nv>backoff</span> <span class=o>=</span> <span class=m>30</span> 
</span></span><span class=line><span class=cl><span class=c1># 允许删除pool </span>
</span></span><span class=line><span class=cl><span class=nv>mon_allow_pool_delete</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=o>[</span>mgr<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># 开启WEB仪表盘 </span>
</span></span><span class=line><span class=cl>mgr <span class=nv>modules</span> <span class=o>=</span> dashboard
</span></span></code></pre></td></tr></table></div></div><p>第一项为副本数， 设为 3 份。
第二、三项为允许一定时间的漂移误差。</p><p><strong>设置完成后的配置如下</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>global<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>fsid</span> <span class=o>=</span> 67dcaf50-275b-442f-b69d-677fd8afcc94
</span></span><span class=line><span class=cl><span class=nv>mon_initial_members</span> <span class=o>=</span> master-139, node1-140, node2-141
</span></span><span class=line><span class=cl><span class=nv>mon_host</span> <span class=o>=</span> 10.4.7.139,10.4.7.140,10.4.7.141
</span></span><span class=line><span class=cl><span class=nv>auth_cluster_required</span> <span class=o>=</span> cephx
</span></span><span class=line><span class=cl><span class=nv>auth_service_required</span> <span class=o>=</span> cephx
</span></span><span class=line><span class=cl><span class=nv>auth_client_required</span> <span class=o>=</span> cephx
</span></span><span class=line><span class=cl><span class=c1># 设置pool池默认分配数量 默认副本数为3</span>
</span></span><span class=line><span class=cl>osd pool default <span class=nv>size</span> <span class=o>=</span> <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=c1># 容忍更多的时钟误差</span>
</span></span><span class=line><span class=cl>mon clock drift <span class=nv>allowed</span> <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>mon clock drift warn <span class=nv>backoff</span> <span class=o>=</span> <span class=m>30</span>
</span></span><span class=line><span class=cl><span class=c1># 允许删除pool</span>
</span></span><span class=line><span class=cl><span class=nv>mon_allow_pool_delete</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=o>[</span>mgr<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># 开启WEB仪表盘</span>
</span></span><span class=line><span class=cl>mgr <span class=nv>modules</span> <span class=o>=</span> dashboard
</span></span></code></pre></td></tr></table></div></div><h4 id=6执行安装>6.执行安装</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy install master-139 node1-140 node2-141
</span></span></code></pre></td></tr></table></div></div><p>如果出现错误：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph_deploy<span class=o>][</span>ERROR <span class=o>]</span> RuntimeError: Failed to execute command: ceph --version
</span></span></code></pre></td></tr></table></div></div><p>可以在各节点上单独进行安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum -y install ceph 
</span></span></code></pre></td></tr></table></div></div><p>如果没有仓库文件 ceph.repo ， 按上面的步骤手工创建。</p><h4 id=7初始monitor信息>7.初始monitor信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy mon create-initial <span class=c1>## ceph-deploy --overwrite-conf mon create-initial</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>初始化后生成以下信息</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>ceph_deploy.gatherkeys<span class=o>][</span>INFO  <span class=o>]</span> Storing ceph.client.admin.keyring
</span></span><span class=line><span class=cl><span class=o>[</span>ceph_deploy.gatherkeys<span class=o>][</span>INFO  <span class=o>]</span> Storing ceph.bootstrap-mds.keyring
</span></span><span class=line><span class=cl><span class=o>[</span>ceph_deploy.gatherkeys<span class=o>][</span>INFO  <span class=o>]</span> Storing ceph.bootstrap-mgr.keyring
</span></span><span class=line><span class=cl><span class=o>[</span>ceph_deploy.gatherkeys<span class=o>][</span>INFO  <span class=o>]</span> keyring <span class=s1>&#39;ceph.mon.keyring&#39;</span> already exists
</span></span><span class=line><span class=cl><span class=o>[</span>ceph_deploy.gatherkeys<span class=o>][</span>INFO  <span class=o>]</span> Storing ceph.bootstrap-osd.keyring
</span></span><span class=line><span class=cl><span class=o>[</span>ceph_deploy.gatherkeys<span class=o>][</span>INFO  <span class=o>]</span> Storing ceph.bootstrap-rgw.keyring
</span></span><span class=line><span class=cl><span class=o>[</span>ceph_deploy.gatherkeys<span class=o>][</span>INFO  <span class=o>]</span> Destroy temp directory /tmp/tmpuBxetx
</span></span><span class=line><span class=cl><span class=o>[</span>root@master-139 ceph-cluster<span class=o>]</span><span class=c1># ll</span>
</span></span><span class=line><span class=cl>total <span class=m>220</span>
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> root root    <span class=m>113</span> May <span class=m>15</span> 03:29 ceph.bootstrap-mds.keyring
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> root root    <span class=m>113</span> May <span class=m>15</span> 03:29 ceph.bootstrap-mgr.keyring
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> root root    <span class=m>113</span> May <span class=m>15</span> 03:29 ceph.bootstrap-osd.keyring
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> root root    <span class=m>113</span> May <span class=m>15</span> 03:29 ceph.bootstrap-rgw.keyring
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> root root    <span class=m>151</span> May <span class=m>15</span> 03:29 ceph.client.admin.keyring
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root    <span class=m>529</span> May <span class=m>15</span> 03:22 ceph.conf
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>167370</span> May <span class=m>15</span> 03:29 ceph-deploy-ceph.log
</span></span><span class=line><span class=cl>-rw------- <span class=m>1</span> root root     <span class=m>73</span> May <span class=m>15</span> 03:22 ceph.mon.keyring
</span></span></code></pre></td></tr></table></div></div><h4 id=8同步管理信息>8.同步管理信息</h4><p>下发配置文件和管理信息至各节点：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy admin master-139 node1-140 node2-141
</span></span></code></pre></td></tr></table></div></div><h4 id=9安装mgr管理守护进程-大于12x版本需安装-我们装的是最新版需执行>9.安装mgr(管理守护进程)， 大于12.x版本需安装， 我们装的是最新版，需执行：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy mgr create master-139 node1-140 node2-141
</span></span></code></pre></td></tr></table></div></div><h4 id=10查看当前ceph版本>10.查看当前ceph版本</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ceph -v</span>
</span></span><span class=line><span class=cl>ceph version 13.2.10 <span class=o>(</span>564bdc4ae87418a232fc901524470e1a0f76d641<span class=o>)</span> mimic <span class=o>(</span>stable<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>以上操作都在管理节点master-139上执行！！</strong></p><h3 id=安装osd对象存储设备>安装OSD(对象存储设备)</h3><p>注意： 新版本的 OSD 没有 prepare 与 activate 命令。
这里需要新的硬盘作为 OSD 存储设备， 关闭虚拟机， 增加一块硬盘， 不用格式化。</p><p>各节点都添加100G硬盘。</p><p>重启， fdisk -l 查看新磁盘名称：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Disk /dev/sdb: 107.4 GB, <span class=m>107374182400</span> bytes, <span class=m>209715200</span> sectors
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> sectors of <span class=m>1</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>512</span> bytes
</span></span><span class=line><span class=cl>Sector size <span class=o>(</span>logical/physical<span class=o>)</span>: <span class=m>512</span> bytes / <span class=m>512</span> bytes
</span></span><span class=line><span class=cl>I/O size <span class=o>(</span>minimum/optimal<span class=o>)</span>: <span class=m>512</span> bytes / <span class=m>512</span> bytes
</span></span></code></pre></td></tr></table></div></div><h4 id=1执行创建osd命令>1.执行创建OSD命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy osd create --data /dev/sdb master-139 
</span></span><span class=line><span class=cl>ceph-deploy osd create --data /dev/sdb node1-140 
</span></span><span class=line><span class=cl>ceph-deploy osd create --data /dev/sdb node2-141
</span></span></code></pre></td></tr></table></div></div><p>三台节点都需分别依次执行。</p><p>都切换到/usr/local/ceph-cluster下执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy gatherkeys master-139
</span></span></code></pre></td></tr></table></div></div><h4 id=2验证节点>2.验证节点：</h4><p>输入 ceph health 或 ceph -s 查看， 出现 HEALTH_OK 代表正常。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@master-139 ceph-cluster<span class=o>]</span><span class=c1># ceph -s </span>
</span></span><span class=line><span class=cl>  cluster:
</span></span><span class=line><span class=cl>    id:     4f74ac9a-b5f5-4bf5-9107-15ab8ea41f76
</span></span><span class=line><span class=cl>    health: HEALTH_OK
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  services:
</span></span><span class=line><span class=cl>    mon: <span class=m>3</span> daemons, quorum master-139,node1-140,node2-141
</span></span><span class=line><span class=cl>    mgr: master-139<span class=o>(</span>active<span class=o>)</span>, standbys: node1-140, node2-141
</span></span><span class=line><span class=cl>    osd: <span class=m>3</span> osds: <span class=m>3</span> up, <span class=m>3</span> in
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  data:
</span></span><span class=line><span class=cl>    pools:   <span class=m>0</span> pools, <span class=m>0</span> pgs
</span></span><span class=line><span class=cl>    objects: <span class=m>0</span>  objects, <span class=m>0</span> B
</span></span><span class=line><span class=cl>    usage:   3.0 GiB used, <span class=m>297</span> GiB / <span class=m>300</span> GiB avail
</span></span><span class=line><span class=cl>    pgs:     
</span></span></code></pre></td></tr></table></div></div><h4 id=3如果出现错误各节点上执行确保时间一致>3.如果出现错误，各节点上执行,确保时间一致。</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> ntpdate ntp1.aliyun.com
</span></span></code></pre></td></tr></table></div></div><h2 id=安装管理后台可选><strong>安装管理后台</strong>（可选）</h2><h4 id=1开启dashboard模块>1.开启dashboard模块</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph mgr module <span class=nb>enable</span> dashboard
</span></span></code></pre></td></tr></table></div></div><h4 id=2生成签名>2.生成签名</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph dashboard create-self-signed-cert
</span></span></code></pre></td></tr></table></div></div><h4 id=3创建目录>3.创建目录</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir mgr-dashboard
</span></span><span class=line><span class=cl><span class=o>[</span>root@master-139 mgr-dashboard<span class=o>]</span><span class=c1># pwd </span>
</span></span><span class=line><span class=cl>/usr/local/ceph-cluster/mgr-dashboard
</span></span></code></pre></td></tr></table></div></div><h4 id=4生成密钥对>4.生成密钥对</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /usr/local/ceph-cluster/mgr-dashboard
</span></span><span class=line><span class=cl>openssl req -new -nodes -x509 -subj <span class=s2>&#34;/O=IT/CN=ceph-mgr-dashboard&#34;</span> -days <span class=m>3650</span> -keyout dashboard.key -out dashboard.crt -extensions v3_ca
</span></span></code></pre></td></tr></table></div></div><h4 id=5启动dashboard>5.启动dashboard</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph mgr module disable dashboard 
</span></span><span class=line><span class=cl>ceph mgr module <span class=nb>enable</span> dashboard
</span></span></code></pre></td></tr></table></div></div><h4 id=6设置ip与port>6.设置IP与PORT</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph config <span class=nb>set</span> mgr mgr/dashboard/server_addr 10.4.7.139
</span></span><span class=line><span class=cl>ceph config <span class=nb>set</span> mgr mgr/dashboard/server_port <span class=m>18843</span>
</span></span></code></pre></td></tr></table></div></div><p>注意：ip为管理节点的主IP</p><h4 id=7关闭https>7.关闭HTTPS</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph config <span class=nb>set</span> mgr mgr/dashboard/ssl <span class=nb>false</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=8查看服务信息>8.查看服务信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@master-139 mgr-dashboard<span class=o>]</span><span class=c1># ceph mgr services</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;dashboard&#34;</span>: <span class=s2>&#34;https://master-139:8443/&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=9设置管理用户与密码>9.设置管理用户与密码</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph dashboard set-login-credentials admin admin
</span></span></code></pre></td></tr></table></div></div><h4 id=10访问>10.访问</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http://10.4.7.139:18843
</span></span></code></pre></td></tr></table></div></div><h2 id=创建cephfs>创建Cephfs</h2><p>集群创建完后， 默认没有文件系统， 我们创建一个 Cephfs 可以支持对外访问的文件系统。</p><h4 id=1创建两个存储池-执行两条命令>1.创建两个存储池, 执行两条命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph osd pool create cephfs_data <span class=m>128</span> 
</span></span><span class=line><span class=cl>ceph osd pool create cephfs_metadata <span class=m>64</span>
</span></span></code></pre></td></tr></table></div></div><p>少于 5 个 OSD 可把 pg_num 设置为 128
OSD 数量在 5 到 10 ，可以设置 pg_num 为 512
OSD 数量在 10 到 50 ，可以设置 pg_num 为 4096
OSD 数量大于 50 ，需要计算 pg_num 的值</p><p>通过下面命令可以列出当前创建的存储池：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@master-139 ceph-cluster<span class=o>]</span><span class=c1># ceph osd lspools</span>
</span></span><span class=line><span class=cl><span class=m>1</span> cephfs_data
</span></span><span class=line><span class=cl><span class=m>2</span> cephfs_metadata
</span></span></code></pre></td></tr></table></div></div><h4 id=2创建fs-名称为cephfs>2.创建fs, 名称为cephfs</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph fs new cephfs cephfs_metadata cephfs_data
</span></span></code></pre></td></tr></table></div></div><h4 id=3状态查看-以下信息代表正常>3.状态查看， 以下信息代表正常</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@master-139 ceph-cluster<span class=o>]</span><span class=c1># ceph fs ls </span>
</span></span><span class=line><span class=cl>name: cephfs, metadata pool: cephfs_metadata, data pools: <span class=o>[</span>cephfs_data <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@haproxy ceph-cluster<span class=o>]</span><span class=c1># ceph mds stat</span>
</span></span><span class=line><span class=cl>cephfs-1/1/1 up  <span class=o>{</span><span class=nv>0</span><span class=o>=</span><span class=nv>haproxy</span><span class=o>=</span>up:active<span class=o>}</span>, <span class=m>1</span> up:standby
</span></span></code></pre></td></tr></table></div></div><p>这里mds如果只显示cephfs-1/1/1 up 后面没内容说明mds没创建需要手动创建。如果不创建后面ceph挂载会报错。提示mds不存在。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@master-139 ceph-cluster<span class=o>]</span><span class=c1># ceph mds stat </span>
</span></span><span class=line><span class=cl>cephfs-0/0/1 up
</span></span><span class=line><span class=cl><span class=c1>#挂载时报错信息</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@node1-140 ceph-cluster<span class=o>]</span><span class=c1># ceph-fuse -k /etc/ceph/ceph.client.admin.keyring -m 10.4.7.139:6789 /usr/local/cephfs_directory </span>
</span></span><span class=line><span class=cl>ceph-fuse<span class=o>[</span>42676<span class=o>]</span>: starting ceph client
</span></span><span class=line><span class=cl>2022-05-15 03:43:48.136 7f84eb7cac00 -1 init, <span class=nv>newargv</span> <span class=o>=</span> 0x561dca3c0240 <span class=nv>newargc</span><span class=o>=</span><span class=m>7</span>
</span></span><span class=line><span class=cl>ceph-fuse<span class=o>[</span>42676<span class=o>]</span>: probably no MDS server is up?
</span></span><span class=line><span class=cl>ceph-fuse<span class=o>[</span>42676<span class=o>]</span>: ceph mount failed with <span class=o>(</span>65536<span class=o>)</span> Unknown error <span class=m>65536</span>
</span></span></code></pre></td></tr></table></div></div><p>手动创建mds</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-deploy mds create master-139 node1-140 node2-141
</span></span></code></pre></td></tr></table></div></div><p>附： 如果创建错误， 需要删除， 执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph fs rm cephfs --yes-i-really-mean-it 
</span></span><span class=line><span class=cl>ceph osd pool delete cephfs_data cephfs_data --yes-i-really-really-mean-it
</span></span></code></pre></td></tr></table></div></div><p>确保在ceph.conf中开启以下配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>mon<span class=o>]</span> mon allow pool <span class=nv>delete</span> <span class=o>=</span> <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=采用fuse挂载>采用fuse挂载</h3><p>先确定 ceph-fuse 命令能执行， 如果没有， 则安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum -y install ceph-fuse
</span></span></code></pre></td></tr></table></div></div><h4 id=1创建挂载目录>1.创建挂载目录</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p /usr/local/cephfs_directory
</span></span></code></pre></td></tr></table></div></div><h4 id=2挂载cephfs>2.挂载cephfs</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph-fuse -k /etc/ceph/ceph.client.admin.keyring -m 10.4.7.139:6789 /usr/local/cephfs_directory
</span></span></code></pre></td></tr></table></div></div><h4 id=3查看磁盘挂载信息>3.查看磁盘挂载信息</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#df -hT</span>
</span></span></code></pre></td></tr></table></div></div><p>/usr/local/cephfs_directory 目录已成功挂载。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@node1-140 ceph-cluster<span class=o>]</span><span class=c1># df -hT | grep cephfs </span>
</span></span><span class=line><span class=cl>ceph-fuse                  fuse.ceph-fuse   94G     <span class=m>0</span>   94G   0% /usr/local/cephfs_directory
</span></span></code></pre></td></tr></table></div></div><p>注意查看当前ceph 的主节点是谁。三台机器中如果有一台突然宕机，然后又恢复了。此时出问题的那台将成为主节点。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@node1-140 ceph-cluster<span class=o>]</span><span class=c1># ceph -s </span>
</span></span><span class=line><span class=cl>  cluster:
</span></span><span class=line><span class=cl>    id:     4f74ac9a-b5f5-4bf5-9107-15ab8ea41f76
</span></span><span class=line><span class=cl>    health: HEALTH_OK
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  services:
</span></span><span class=line><span class=cl>    mon: <span class=m>3</span> daemons, quorum master-139,node1-140,node2-141
</span></span><span class=line><span class=cl>    mgr: master-139<span class=o>(</span>active<span class=o>)</span>, standbys: node1-140, node2-141
</span></span><span class=line><span class=cl>    mds: cephfs-1/1/1 up  <span class=o>{</span><span class=nv>0</span><span class=o>=</span>master-139<span class=o>=</span>up:active<span class=o>}</span>, <span class=m>2</span> up:standby
</span></span><span class=line><span class=cl>    osd: <span class=m>3</span> osds: <span class=m>3</span> up, <span class=m>3</span> in
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  data:
</span></span><span class=line><span class=cl>    pools:   <span class=m>2</span> pools, <span class=m>192</span> pgs
</span></span><span class=line><span class=cl>    objects: <span class=m>21</span>  objects, 2.2 KiB
</span></span><span class=line><span class=cl>    usage:   3.0 GiB used, <span class=m>297</span> GiB / <span class=m>300</span> GiB avail
</span></span><span class=line><span class=cl>    pgs:     <span class=m>192</span> active+clean
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  io:
</span></span><span class=line><span class=cl>    client:   5.0 KiB/s wr, <span class=m>0</span> op/s rd, <span class=m>9</span> op/s wr
</span></span></code></pre></td></tr></table></div></div><p>active的是主节点， standbys是备用节点。</p><h2 id=ceph常用命令>ceph常用命令</h2><h4 id=ceph>ceph</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看机器的监控状态</span>
</span></span><span class=line><span class=cl>ceph health
</span></span><span class=line><span class=cl><span class=c1># 查看ceph的实时运行状态</span>
</span></span><span class=line><span class=cl>ceph -w
</span></span><span class=line><span class=cl><span class=c1># 检查信息状态信息</span>
</span></span><span class=line><span class=cl>ceph -s
</span></span><span class=line><span class=cl><span class=c1># 查看ceph存储空间</span>
</span></span><span class=line><span class=cl>ceph df
</span></span></code></pre></td></tr></table></div></div><h4 id=ceph认证>ceph认证</h4><h4 id=创建管理用户>创建管理用户</h4><p>为ceph创建一个admin用户并为admin用户创建一个密钥，把密钥保存到/etc/ceph目录下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph auth get-or-create client.admin mds <span class=s1>&#39;allow&#39;</span> osd <span class=s1>&#39;allow *&#39;</span> mon <span class=s1>&#39;allow *&#39;</span> &gt; /etc/ceph/ceph.client.admin.keyring
</span></span><span class=line><span class=cl>或
</span></span><span class=line><span class=cl>ceph auth get-or-create client.admin mds <span class=s1>&#39;allow&#39;</span> osd <span class=s1>&#39;allow *&#39;</span> mon <span class=s1>&#39;allow *&#39;</span> -o /etc/ceph/ceph.client.admin.keyring
</span></span></code></pre></td></tr></table></div></div><p>为osd.0创建一个用户并创建一个key</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph auth get-or-create osd.0 mon <span class=s1>&#39;allow rwx&#39;</span> osd <span class=s1>&#39;allow *&#39;</span> -o /var/lib/ceph/osd/ceph-0/keyring
</span></span></code></pre></td></tr></table></div></div><p>为mds.node1创建一个用户并创建一个key</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph auth get-or-create mds.node1 mon <span class=s1>&#39;allow rwx&#39;</span> osd <span class=s1>&#39;allow *&#39;</span> mds <span class=s1>&#39;allow *&#39;</span> -o /var/lib/ceph/mds/ceph-node1/keyring
</span></span></code></pre></td></tr></table></div></div><p>查看ceph集群中的认证用户及相关的key</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph auth list
</span></span></code></pre></td></tr></table></div></div><p>删除集群中的一个认证用户</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph auth del osd.0
</span></span></code></pre></td></tr></table></div></div><h4 id=集群相关>集群相关</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看集群的详细配置</span>
</span></span><span class=line><span class=cl>ceph daemon mon.node1 config show <span class=p>|</span> more
</span></span><span class=line><span class=cl><span class=c1># 查看集群健康状态细节</span>
</span></span><span class=line><span class=cl>ceph health detail
</span></span><span class=line><span class=cl><span class=c1># 查看ceph log日志所在的目录</span>
</span></span><span class=line><span class=cl>ceph-conf --name mon.node1 --show-config-value log_file
</span></span></code></pre></td></tr></table></div></div><h4 id=mon命令>mon命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph mon stat#查看mon的状态信息
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph mon dump#查看你ceph映射信息
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph mon remove node1 <span class=c1>#删除一个mon节点  ceph-deploy mon destroy {host-name [host-name]...}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph mon add node1 node1_ip <span class=c1>#添加一个mon节点  ceph-deploy mon create {host-name [host-name]...} </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mon节点的/var/lib/ceph/mon/ceph-node2/store.db文件内容一致，添加mon注意先改配置目录配置文件，再推送到所有节点
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph-deploy --overwrite-conf config push  node1 node2 node3
</span></span></code></pre></td></tr></table></div></div><h4 id=mds命令>mds命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph mds stat <span class=c1>#查看msd状态</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph mds dump <span class=c1>#msd的映射信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph mds rm <span class=m>0</span> mds.node1#删除一个mds节点
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph-deploy mds create <span class=o>{</span>host-name<span class=o>}[</span>:<span class=o>{</span>daemon-name<span class=o>}]</span> <span class=o>[{</span>host-name<span class=o>}[</span>:<span class=o>{</span>daemon-name<span class=o>}]</span> ...<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=osd命令>osd命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph osd stat <span class=c1>#查看osd状态</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd dump <span class=c1>#osd的映射信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd tree#查看osd目录树
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd down <span class=m>0</span>   <span class=c1>#down掉osd.0节点</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd rm 0#集群删除一个osd硬盘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd crush remove osd.4#删除标记
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd getmaxosd#查看最大osd个数
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd setmaxosd 10#设置osd的个数
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd out osd.3#把一个osd节点逐出集群
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd in osd.3#把逐出的osd加入集群
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pause#暂停osd （暂停后整个集群不再接收数据）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd unpause#再次开启osd （开启后再次接收数据）
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd lspools#查看ceph集群中的pool数量
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool create jiayuan 100#创建一个pool  这里的100指的是PG组
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool delete jiayuan  jiayuan  --yes-i-really-really-mean-it  <span class=c1>#集群名字需要重复两次</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rados df#显示集群中pool的详细信息
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool get data pg_num  <span class=c1>#查看data池的pg数量</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool <span class=nb>set</span> data target_max_bytes 100000000000000#设置data池的最大存储空间为100T（默认是1T<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool <span class=nb>set</span> data size <span class=m>3</span>  <span class=c1>#设置data池的副本数是3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool <span class=nb>set</span> data min_size <span class=m>2</span> <span class=c1>#设置data池能接受写操作的最小副本为2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool <span class=nb>set</span> data pg_num 100#设置一个pool的pg数量
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd pool <span class=nb>set</span> data pgp_num 100#设置一个pool的pgp数量
</span></span></code></pre></td></tr></table></div></div><h4 id=pg命令>pg命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph pg stat#查看pg状态
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph pg dump#查看pg组的映射信息
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph pg map 0.3f#查看一个pg的map
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph pg  0.26 query#查看pg详细信息
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph pg dump --format plain#显示一个集群中的所有的pg统计
</span></span></code></pre></td></tr></table></div></div><h4 id=rados和rbd命令>rados和rbd命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rados lspools#查看ceph集群中有多少个pool （只是查看pool<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rados df <span class=c1>#查看ceph集群中有多少个pool,并且每个pool容量及利用情况</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rados mkpool test#创建一个pool
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rados create test-object -p test#创建一个对象object 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rados rm test-object-1 -p test#删除一个对象object 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rados -p <span class=nb>test</span> ls
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd ls pool_name#查看ceph中一个pool里的所有镜像
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd info -p pool_name --image 74cb427c-cee9-47d0-b467-af217a67e60a <span class=c1>#查看ceph pool中一个镜像的信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd create -p <span class=nb>test</span> --size <span class=m>10000</span> zhanguo#在test池中创建一个命名为zhanguo的10000M的镜像
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd rm  -p <span class=nb>test</span>  lizhanguo <span class=c1>#删除一个镜像</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd resize -p <span class=nb>test</span> --size <span class=m>20000</span> zhanguo  <span class=c1>#调整一个镜像的尺寸</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=crush映射>CRUSH映射</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ceph osd getcrushmap -o MAP   <span class=c1>#获取一个CRUSH映射</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>crushtool -d MAP -o MAP.TXT   <span class=c1>#反编译一个CRUSH映射</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>crushtool -c MAP.TXT -o MAP   <span class=c1>#编译一个CRUSH映射</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ceph osd setcrushmap -i MAP    <span class=c1>#设置一个CRUSH映射</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=块设备的一些命令>块设备的一些命令</h4><p>单位为M，默认在rbd pool中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>创建块设备：rbd create <span class=o>{</span>image-name<span class=o>}</span>  --size <span class=o>{</span>megabytes<span class=o>}</span>  --pool <span class=o>{</span>pool-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>列出块设备：rbd ls <span class=o>{</span>poolname<span class=o>}</span> -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>检索块信息：rbd --image <span class=o>{</span>image-name<span class=o>}</span> info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>更改块大小：rbd resize --image <span class=o>{</span>image-name<span class=o>}</span> --size <span class=o>{</span>megabytes<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>删除块设备：rbd rm <span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>映射块设备：rbd map <span class=o>{</span>image-name<span class=o>}</span> --pool <span class=o>{</span>pool-name<span class=o>}</span> --id <span class=o>{</span>user-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>查看已映射块设备：rbd showmapped
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>取消映射：rbd unmap /dev/rbd/<span class=o>{</span>poolname<span class=o>}</span>/<span class=o>{</span>imagename<span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=快照和克隆相关命令>快照和克隆相关命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>创建快照：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> snap create --snap <span class=o>{</span>snap-name<span class=o>}</span> <span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd snap create <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>@<span class=o>{</span>snap-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>快照回滚：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> snap rollback --snap <span class=o>{</span>snap-name<span class=o>}</span> <span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd snap rollback <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>@<span class=o>{</span>snap-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>清除快照：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> snap purge <span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd snap purge <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>删除快照：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> snap rm --snap <span class=o>{</span>snap-name<span class=o>}</span> <span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd snap rm <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>@<span class=o>{</span>snap-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>列出快照：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> snap ls <span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd snap ls <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>保护快照：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> snap protect --image <span class=o>{</span>image-name<span class=o>}</span> --snap <span class=o>{</span>snapshot-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd snap protect <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>@<span class=o>{</span>snapshot-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>取消保护快照：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> snap unprotect --image <span class=o>{</span>image-name<span class=o>}</span> --snap <span class=o>{</span>snapshot-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd snap unprotect <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>@<span class=o>{</span>snapshot-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>快照克隆
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd clone <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>parent-image<span class=o>}</span>@<span class=o>{</span>snap-name<span class=o>}</span> <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>child-image-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>查看快照的克隆
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd --pool <span class=o>{</span>pool-name<span class=o>}</span> children --image <span class=o>{</span>image-name<span class=o>}</span> --snap <span class=o>{</span>snap-name<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rbd children <span class=o>{</span>pool-name<span class=o>}</span>/<span class=o>{</span>image-name<span class=o>}</span>@<span class=o>{</span>snapshot-name<span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=快照克隆相关例子>快照克隆相关例子</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>创建快照：rbd  snap create vms/yjk01@yjk01_s1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>列出快照：rbd snap list  --pool vms yjk01
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>快照回滚：rbd snap rollback vms/yjk01@yjk01_s1<span class=o>(</span>先卸载已挂载目录<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>删除快照：rbd snap rm vms/yjk01@yjk01_s2<span class=o>(</span>单个<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>清除快照：rbd snap purge vms/yjk01<span class=o>(</span>所有<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>保护快照：rbd snap protect vms/yjk01@yjk01_s1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>取消保护：rbd snap unprotect vms/yjk01@yjk01_s1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>快照克隆：rbd clone vms/yjk01@yjk01_s3 vms/yjk01_s3_clone1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>查看克隆：rbd children vms/yjk01@yjk01_s3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>克隆只能基于快照，并且只能快照处于保护状态，而且ceph仅支持克隆format 2映像。
</span></span></code></pre></td></tr></table></div></div><h2 id=日志文件汇总>日志文件汇总</h2><p>mon ,mgr , osd 等安装报错信息均在对应日志文件中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/usr/local/ceph-cluster/ceph-deploy-ceph.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># tree /var/log/ceph/</span>
</span></span><span class=line><span class=cl>/var/log/ceph/
</span></span><span class=line><span class=cl>├── ceph.audit.log
</span></span><span class=line><span class=cl>├── ceph-client.admin.log
</span></span><span class=line><span class=cl>├── ceph.log
</span></span><span class=line><span class=cl>├── ceph-mds.haproxy.log
</span></span><span class=line><span class=cl>├── ceph-mgr.haproxy.log
</span></span><span class=line><span class=cl>├── ceph-mon.haproxy.log
</span></span><span class=line><span class=cl>├── ceph-osd.0.log
</span></span><span class=line><span class=cl>└── ceph-volume.log
</span></span></code></pre></td></tr></table></div></div><h3 id=参考文档>参考文档</h3><p><a href=https://blog.csdn.net/fake_hydra/article/details/109235907 target=_blank rel="noopener noreffer">1</a></p><p><a href=https://mp.weixin.qq.com/s/nWZWhnaudueuJwmp-Ktuxw target=_blank rel="noopener noreffer">2</a></p><p><a href=https://blog.csdn.net/xiaoweite1/article/details/124059228 target=_blank rel="noopener noreffer">3</a></p><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2023-07-22T12:59:34 title="July 22, 2023">July 22, 2023</span>，文中内容可能已过时，请谨慎使用。</div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-07-22</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/ceph/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ceph%E9%9B%86%E7%BE%A4/>ceph集群</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/%E5%AE%89%E8%A3%85%E4%BB%BB%E6%84%8F%E7%89%88%E6%9C%ACpython/ class=prev rel=prev title=基于centos7/8安装任意版本python><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>基于centos7/8安装任意版本python</a>
<a href=/python%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%80%BB%E7%BB%93/ class=next rel=next title=Python数据结构总结>Python数据结构总结<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Peng</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:0},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"6P2DFXYAL4",algoliaIndex:"myblog",algoliaSearchKey:"97d66d369583b3cd4c58a5890d58ea96",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=/js/custom.js></script>
<script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script></body></html>