<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>CentOS7 常规命令 - Peng</title><meta name=Description content="One World,One Dream!"><meta property="og:title" content="CentOS7 常规命令"><meta property="og:description" content="CentOS 7 常规命令 文件类 常规 tar 打包解包 1 2 3 4 tar cvf FileName.tar DirName or FileName # 打包 tar xvf FileName.tar -C 指定位置目录 # 解包 tar gz 打包压缩 1 2 3 4 tar zcvf FileName.tar.gz DirName or FileName # 打包并压缩 tar zxvf FileName.tar.gz -C 指定"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.haipengv.com/centos7-%E5%B8%B8%E8%A7%84%E5%91%BD%E4%BB%A4/"><meta property="og:image" content="https://blog.haipengv.com/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-25T16:34:16+00:00"><meta property="article:modified_time" content="2022-02-25T16:34:16+00:00"><meta property="og:site_name" content="我的网站"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.haipengv.com/logo.png"><meta name=twitter:title content="CentOS7 常规命令"><meta name=twitter:description content="CentOS 7 常规命令 文件类 常规 tar 打包解包 1 2 3 4 tar cvf FileName.tar DirName or FileName # 打包 tar xvf FileName.tar -C 指定位置目录 # 解包 tar gz 打包压缩 1 2 3 4 tar zcvf FileName.tar.gz DirName or FileName # 打包并压缩 tar zxvf FileName.tar.gz -C 指定"><meta name=application-name content="我的网站"><meta name=apple-mobile-web-app-title content="我的网站"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.haipengv.com/centos7-%E5%B8%B8%E8%A7%84%E5%91%BD%E4%BB%A4/><link rel=prev href=https://blog.haipengv.com/shell%E8%84%9A%E6%9C%AC%E5%B8%B8%E7%94%A8%E5%8F%82%E8%80%83/><link rel=next href=https://blog.haipengv.com/centos7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CentOS7 常规命令","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.haipengv.com\/centos7-%E5%B8%B8%E8%A7%84%E5%91%BD%E4%BB%A4\/"},"genre":"posts","wordcount":2387,"url":"https:\/\/blog.haipengv.com\/centos7-%E5%B8%B8%E8%A7%84%E5%91%BD%E4%BB%A4\/","datePublished":"2022-02-25T16:34:16+00:00","dateModified":"2022-02-25T16:34:16+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Peng"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/links/>友链 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/links/ title>友链</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CentOS7 常规命令</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Peng</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-02-25>2022-02-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2387 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#文件类>文件类</a><ul><li><a href=#常规>常规</a></li><li><a href=#文件下载>文件下载</a></li><li><a href=#文件传输>文件传输</a></li><li><a href=#文件查找>文件查找</a></li></ul></li><li><a href=#运维类>运维类</a><ul><li><a href=#基础配置>基础配置</a></li><li><a href=#常规查询>常规查询</a></li><li><a href=#iptables>iptables</a></li><li><a href=#防火墙>防火墙</a><ul><li><a href=#常规命令>常规命令</a></li><li><a href=#更多命令>更多命令</a></li></ul></li></ul></li><li><a href=#系统类>系统类</a><ul><li><a href=#磁盘挂载>磁盘挂载</a><ul><li><a href=#磁盘分区格式化>磁盘分区格式化</a></li><li><a href=#磁盘挂载-1>磁盘挂载</a></li></ul></li><li><a href=#nfs>NFS</a><ul><li><a href=#服务端>服务端</a><ul><li><a href=#安装>安装</a></li><li><a href=#配置>配置</a></li></ul></li><li><a href=#客户端挂载>客户端挂载</a></li></ul></li><li><a href=#smb>SMB</a><ul><li><a href=#服务端-1>服务端</a><ul><li><a href=#安装启动>安装启动</a></li><li><a href=#共享文件夹>共享文件夹</a></li><li><a href=#配置-smbconf>配置 smb.conf</a></li><li><a href=#配置账号密码>配置账号密码</a></li><li><a href=#检查语法>检查语法</a></li><li><a href=#avahi>avahi</a></li></ul></li><li><a href=#客户端>客户端</a><ul><li><a href=#匿名挂载>匿名挂载</a></li><li><a href=#用户密码挂载>用户密码挂载</a></li><li><a href=#umount>umount</a></li></ul></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=centos-7-常规命令>CentOS 7 常规命令</h1><h2 id=文件类>文件类</h2><h3 id=常规>常规</h3><p>tar 打包解包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tar cvf FileName.tar DirName or FileName
</span></span><span class=line><span class=cl><span class=c1># 打包</span>
</span></span><span class=line><span class=cl>tar xvf FileName.tar -C 指定位置目录
</span></span><span class=line><span class=cl><span class=c1># 解包</span>
</span></span></code></pre></td></tr></table></div></div><p>tar gz 打包压缩</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tar zcvf FileName.tar.gz DirName or FileName
</span></span><span class=line><span class=cl><span class=c1># 打包并压缩</span>
</span></span><span class=line><span class=cl>tar zxvf FileName.tar.gz -C 指定位置目录
</span></span><span class=line><span class=cl><span class=c1># 解包</span>
</span></span></code></pre></td></tr></table></div></div><p>zip 压缩解压缩</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>zip FileName.zip FileName
</span></span><span class=line><span class=cl><span class=c1># 压缩文件</span>
</span></span><span class=line><span class=cl>zip -r DirName.zip DirName
</span></span><span class=line><span class=cl><span class=c1># 压缩目录</span>
</span></span><span class=line><span class=cl>unzip xxx.zip
</span></span><span class=line><span class=cl><span class=c1># 解压缩</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=文件下载>文件下载</h3><p>下载覆盖</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>wget https://xxx.com/xxx.zip -O /xxx/xxx.zip
</span></span><span class=line><span class=cl><span class=c1># -O 重命名并直接覆盖</span>
</span></span></code></pre></td></tr></table></div></div><p>下载指定路径比对新旧直接覆盖</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>wget -P /xxx/xxx -N https://xxx.com/xxx.zip
</span></span><span class=line><span class=cl><span class=c1># -P 指定下载路径,如不存在则自动创建.</span>
</span></span><span class=line><span class=cl><span class=c1># -N 只下载比本地新的文件并覆盖</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=文件传输>文件传输</h3><p>文件下载 - 从远程服务器下载文件到本服务器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>scp -P <span class=m>22</span> root@8.8.8.8:/root/1.zip /root
</span></span></code></pre></td></tr></table></div></div><p>文件上传 - 上传本地文件到远程服务器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>scp -P <span class=m>22</span> /root/st/1.zip root@8.8.8.8:/root
</span></span></code></pre></td></tr></table></div></div><p>目录下载 - 从远程服务器下载文件夹到本服务器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>scp -r -P <span class=m>22</span> root@8.8.8.8:/root/xx /root
</span></span></code></pre></td></tr></table></div></div><p>目录上传 - 上传本地文件夹到远程服务器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>scp -r -P <span class=m>22</span> /root/xx root@8.8.8.8:/root
</span></span></code></pre></td></tr></table></div></div><h3 id=文件查找>文件查找</h3><p>查询当前目录下及所有子目录下的某文件,并拷贝到当前文件夹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> cp <span class=o>{}</span> ./
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.*&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> cp <span class=o>{}</span> ./
</span></span></code></pre></td></tr></table></div></div><p>查询当前目录下及所有子目录下的某文件,并删除.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>find . -name <span class=s2>&#34;.DS_Store&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> rm <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=运维类>运维类</h2><h3 id=基础配置>基础配置</h3><p>允许 root 登陆及修改端口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /etc/ssh/sshd_config
</span></span><span class=line><span class=cl>Port <span class=m>22222</span>
</span></span><span class=line><span class=cl><span class=c1># 配置端口</span>
</span></span><span class=line><span class=cl>PermitRootLogin yes
</span></span><span class=line><span class=cl>PasswordAuthentication yes
</span></span><span class=line><span class=cl>ClientAliveInterval <span class=m>30</span>
</span></span><span class=line><span class=cl><span class=c1># 重启 sshd</span>
</span></span><span class=line><span class=cl>systemctl restart sshd
</span></span></code></pre></td></tr></table></div></div><p>yum 源</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum repolist
</span></span><span class=line><span class=cl>yum repolist all
</span></span><span class=line><span class=cl><span class=c1># 查看 yum 源</span>
</span></span><span class=line><span class=cl>yum -y install epel-release
</span></span><span class=line><span class=cl><span class=c1># 如无 epel/x86_64 推荐先安装 epel 源</span>
</span></span><span class=line><span class=cl>yum clean all
</span></span><span class=line><span class=cl>yum makecache
</span></span><span class=line><span class=cl><span class=c1># 清除并重建缓存</span>
</span></span><span class=line><span class=cl>yum update -y
</span></span><span class=line><span class=cl><span class=c1># 更新</span>
</span></span><span class=line><span class=cl><span class=c1># 如需使用 epel 源国内阿里云镜像加速,执行以下命令:</span>
</span></span><span class=line><span class=cl>mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup
</span></span><span class=line><span class=cl>mv /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.backup
</span></span><span class=line><span class=cl>wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
</span></span><span class=line><span class=cl>yum clean all
</span></span><span class=line><span class=cl>yum makecache
</span></span></code></pre></td></tr></table></div></div><p>修改网络信息</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> <span class=nb>cd</span>  /etc/sysconfig/network-scripts
</span></span><span class=line><span class=cl> <span class=c1># ls 查看当前网卡信息,可能为 ifcfg-eth0 ifcfg-ens192 等等.</span>
</span></span><span class=line><span class=cl> vi ifcfg-eth0
</span></span><span class=line><span class=cl> <span class=c1># 编辑修改网络信息</span>
</span></span><span class=line><span class=cl> service network restart
</span></span><span class=line><span class=cl> <span class=c1># 重启网络服务</span>
</span></span></code></pre></td></tr></table></div></div><p>时区及 ntp 时间同步</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tzselect
</span></span><span class=line><span class=cl><span class=c1># 选择时区</span>
</span></span><span class=line><span class=cl>mv /etc/localtime /etc/localtime.bak
</span></span><span class=line><span class=cl><span class=c1># 备份 localtime</span>
</span></span><span class=line><span class=cl>ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span><span class=line><span class=cl><span class=c1># 创建时区软链接,再次 date 检查时区.</span>
</span></span><span class=line><span class=cl>yum -y install ntpdate
</span></span><span class=line><span class=cl><span class=c1># 安装 ntpdate</span>
</span></span><span class=line><span class=cl>ntpdate cn.pool.ntp.org
</span></span><span class=line><span class=cl><span class=c1># 同步时间</span>
</span></span><span class=line><span class=cl><span class=c1># 备选 ntp 服务器</span>
</span></span><span class=line><span class=cl>cn.pool.ntp.org
</span></span><span class=line><span class=cl>ntp.aliyun.com
</span></span><span class=line><span class=cl>ntp1.aliyun.com
</span></span><span class=line><span class=cl>time1.cloud.tencent.com
</span></span></code></pre></td></tr></table></div></div><p>screen 常用命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum -y install screen
</span></span><span class=line><span class=cl><span class=c1># 安装 screen</span>
</span></span><span class=line><span class=cl>screen -S xxx
</span></span><span class=line><span class=cl><span class=c1># 新建名为 xxx 的 session</span>
</span></span><span class=line><span class=cl>screen -ls
</span></span><span class=line><span class=cl><span class=c1># 列出当前所有 session</span>
</span></span><span class=line><span class=cl>screen -r xxx
</span></span><span class=line><span class=cl><span class=c1># 恢复到 xxx 这个 session</span>
</span></span><span class=line><span class=cl>screen -d xxx
</span></span><span class=line><span class=cl><span class=c1># 远程分离 xxx 这个 session</span>
</span></span><span class=line><span class=cl>screen -d -r xxx
</span></span><span class=line><span class=cl><span class=c1># 结束当前 session 并恢复到 xxx 这个 session</span>
</span></span><span class=line><span class=cl>screen -S xxx -X quit
</span></span><span class=line><span class=cl><span class=c1># 远程删除 session</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=常规查询>常规查询</h3><p>清除历史登录记录</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>echo</span> &gt; /var/log/wtmp
</span></span></code></pre></td></tr></table></div></div><p>清除历史命令记录</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>history</span> -c <span class=o>&amp;&amp;</span> <span class=nb>history</span> -w
</span></span></code></pre></td></tr></table></div></div><p>一键清除并退出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>echo</span> &gt; /var/log/wtmp <span class=o>&amp;&amp;</span> <span class=nb>history</span> -c <span class=o>&amp;&amp;</span> <span class=nb>history</span> -w <span class=o>&amp;&amp;</span> <span class=nb>exit</span>
</span></span></code></pre></td></tr></table></div></div><p>查看目录占用空间</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>du -h --max-depth<span class=o>=</span><span class=m>1</span> /home
</span></span></code></pre></td></tr></table></div></div><p>端口占用查询</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>netstat -ntlp
</span></span><span class=line><span class=cl>netstat -ntlp <span class=p>|</span> grep <span class=m>80</span>
</span></span><span class=line><span class=cl><span class=c1># 查询80端口占用</span>
</span></span></code></pre></td></tr></table></div></div><p>CPU内存占用查询</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ps aux<span class=p>|</span>head -1<span class=p>;</span>ps aux<span class=p>|</span>grep -v PID<span class=p>|</span>sort -rn -k +3<span class=p>|</span>head
</span></span><span class=line><span class=cl><span class=c1># 获取占用CPU资源最多的10个进程</span>
</span></span><span class=line><span class=cl>ps aux<span class=p>|</span>head -1<span class=p>;</span>ps aux<span class=p>|</span>grep -v PID<span class=p>|</span>sort -rn -k +4<span class=p>|</span>head
</span></span><span class=line><span class=cl><span class=c1># 获取占用内存资源最多的10个进程</span>
</span></span></code></pre></td></tr></table></div></div><p>重新加载systemctl</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo systemctl daemon-reload
</span></span></code></pre></td></tr></table></div></div><h3 id=iptables>iptables</h3><p>使用 iptables 需禁用默认防火墙 firewalld</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum -y install iptables-services
</span></span><span class=line><span class=cl><span class=c1># 安装 iptables iptables-services</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl stop firewalld
</span></span><span class=line><span class=cl>systemctl disable firewalld
</span></span><span class=line><span class=cl><span class=c1># 禁用 firewall</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl start iptables
</span></span><span class=line><span class=cl>systemctl status iptables
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> iptables
</span></span><span class=line><span class=cl><span class=c1># 启用 iptables</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iptables -P INPUT ACCEPT
</span></span><span class=line><span class=cl>iptables -P OUTPUT ACCEPT
</span></span><span class=line><span class=cl>iptables -P FORWARD ACCEPT
</span></span><span class=line><span class=cl>iptables -F 
</span></span><span class=line><span class=cl>service iptables save
</span></span><span class=line><span class=cl><span class=c1># 设置默认规则并清空所有规则,保存设置.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 以下为快速执行</span>
</span></span><span class=line><span class=cl>iptables -P INPUT ACCEPT <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>iptables -P OUTPUT ACCEPT <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>iptables -P FORWARD ACCEPT <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>iptables -F <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>service iptables save
</span></span></code></pre></td></tr></table></div></div><h3 id=防火墙>防火墙</h3><h4 id=常规命令>常规命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo firewall-cmd --add-service<span class=o>=</span>http --permanent
</span></span><span class=line><span class=cl>sudo firewall-cmd --add-service<span class=o>=</span>https --permanent
</span></span><span class=line><span class=cl>sudo firewall-cmd --add-port<span class=o>=</span>80/tcp --permanent
</span></span><span class=line><span class=cl>sudo firewall-cmd --add-port<span class=o>=</span>443/tcp --permanent
</span></span><span class=line><span class=cl>sudo firewall-cmd --add-port<span class=o>=</span>4000-5000/tcp --permanent
</span></span><span class=line><span class=cl>sudo firewall-cmd --remove-port<span class=o>=</span>XXXX/tcp --permanent
</span></span><span class=line><span class=cl>sudo firewall-cmd --reload
</span></span><span class=line><span class=cl>sudo firewall-cmd --list-all
</span></span></code></pre></td></tr></table></div></div><h4 id=更多命令>更多命令</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看是否开启</span>
</span></span><span class=line><span class=cl>systemctl status firewalld.service
</span></span><span class=line><span class=cl><span class=c1># 打开防火墙</span>
</span></span><span class=line><span class=cl>systemctl start firewalld.service
</span></span><span class=line><span class=cl><span class=c1># 停用防火墙</span>
</span></span><span class=line><span class=cl>systemctl disable firewalld
</span></span><span class=line><span class=cl><span class=c1># 禁用防火墙</span>
</span></span><span class=line><span class=cl>systemctl stop firewalld.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 开机启动</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> firewalld
</span></span><span class=line><span class=cl><span class=c1># 取消开机启动</span>
</span></span><span class=line><span class=cl>systemctl disable firewalld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看运行状态</span>
</span></span><span class=line><span class=cl>firewall-cmd --state
</span></span><span class=line><span class=cl><span class=c1># 查看接口信息</span>
</span></span><span class=line><span class=cl>firewall-cmd --list-all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更新防火墙规则方法1:无需断开连接，动态更改规则</span>
</span></span><span class=line><span class=cl>firewall-cmd --reload
</span></span><span class=line><span class=cl><span class=c1># 更新防火墙规则方法2:断开连接，以重启的方式更改规则</span>
</span></span><span class=line><span class=cl>firewall-cmd --complete-reload
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看帮助</span>
</span></span><span class=line><span class=cl>firewall-cmd --help
</span></span><span class=line><span class=cl>--zone<span class=o>=</span>NAME <span class=c1># 指定 Zone</span>
</span></span><span class=line><span class=cl>--permanent <span class=c1># 为永久生效</span>
</span></span><span class=line><span class=cl>--timeout<span class=o>=</span>seconds <span class=c1># 持续一段时间，到期后自动移除，经常用于调试，且不能与 --permanent 同时使用</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 追加一个8181端口，永久有效</span>
</span></span><span class=line><span class=cl>firewall-cmd --add-port<span class=o>=</span>8181/tcp --permanent
</span></span><span class=line><span class=cl><span class=c1># 追加一段端口范围</span>
</span></span><span class=line><span class=cl>firewall-cmd --add-port<span class=o>=</span>6000-6600/tcp
</span></span><span class=line><span class=cl><span class=c1># 开放 ftp 服务</span>
</span></span><span class=line><span class=cl>firewall-cmd --add-service<span class=o>=</span>ftp
</span></span><span class=line><span class=cl><span class=c1># 添加eth0 接口至 public 信任等级，永久有效</span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --add-interface<span class=o>=</span>eth0 --permanent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 配置 public zone 的端口转发</span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --add-masquerade
</span></span><span class=line><span class=cl><span class=c1># 然后转发 tcp 22 端口至 9527</span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --add-forward-port<span class=o>=</span><span class=nv>port</span><span class=o>=</span>22:proto<span class=o>=</span>tcp:toport<span class=o>=</span><span class=m>9527</span>
</span></span><span class=line><span class=cl><span class=c1># 转发 22 端口数据至另一个 ip 的相同端口上</span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --add-forward-port<span class=o>=</span><span class=nv>port</span><span class=o>=</span>22:proto<span class=o>=</span>tcp:toaddr<span class=o>=</span>192.168.1.123
</span></span><span class=line><span class=cl><span class=c1># 转发 22 端口数据至另一 ip 的 9527 端口上</span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --add-forward-port<span class=o>=</span><span class=nv>port</span><span class=o>=</span>22:proto<span class=o>=</span>tcp:toport<span class=o>=</span>9527:toaddr<span class=o>=</span>192.168.1.100
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IP 封禁</span>
</span></span><span class=line><span class=cl>firewall-cmd --permanent --add-rich-rule<span class=o>=</span><span class=s2>&#34;rule family=&#39;ipv4&#39; source address=&#39;192.168.1.123&#39; reject&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 通过 ipset 来封禁 ip</span>
</span></span><span class=line><span class=cl>firewall-cmd --permanent --zone<span class=o>=</span>public --new-ipset<span class=o>=</span>blacklist --type<span class=o>=</span>hash:ip
</span></span><span class=line><span class=cl>firewall-cmd --permanent --zone<span class=o>=</span>public --ipset<span class=o>=</span>blacklist --add-entry<span class=o>=</span>192.168.1.123
</span></span><span class=line><span class=cl><span class=c1># 封禁网段</span>
</span></span><span class=line><span class=cl>firewall-cmd --permanent --zone<span class=o>=</span>public --new-ipset<span class=o>=</span>blacklist --type<span class=o>=</span>hash:net
</span></span><span class=line><span class=cl>firewall-cmd --permanent --zone<span class=o>=</span>public --ipset<span class=o>=</span>blacklist --add-entry<span class=o>=</span>192.168.1.0/24
</span></span><span class=line><span class=cl><span class=c1># 倒入 ipset 规则 blacklist，然后封禁 blacklist</span>
</span></span><span class=line><span class=cl>firewall-cmd --permanent --zone<span class=o>=</span>public --new-ipset-from-file<span class=o>=</span>/path/blacklist.xml
</span></span><span class=line><span class=cl>firewall-cmd --permanent --zone<span class=o>=</span>public --add-rich-rule<span class=o>=</span><span class=s1>&#39;rule source ipset=blacklist drop&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=系统类>系统类</h2><h3 id=磁盘挂载>磁盘挂载</h3><h4 id=磁盘分区格式化>磁盘分区格式化</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>fdisk -l
</span></span><span class=line><span class=cl><span class=c1># 查看到新硬盘 /dev/sdb</span>
</span></span><span class=line><span class=cl>fdisk /dev/sdb
</span></span><span class=line><span class=cl><span class=c1># 为磁盘分区,选择 n 开始分区,其他直接回车保持默认,结尾 w 保存.</span>
</span></span><span class=line><span class=cl>mkfs.ext4 /dev/sdb1
</span></span><span class=line><span class=cl><span class=c1># 格式化分区</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=磁盘挂载-1>磁盘挂载</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir /data
</span></span><span class=line><span class=cl><span class=c1># 创建挂载目录</span>
</span></span><span class=line><span class=cl>mount /dev/sdb1 /data
</span></span><span class=line><span class=cl><span class=c1># 挂载至 /data</span>
</span></span><span class=line><span class=cl>vi /etc/fstab
</span></span><span class=line><span class=cl><span class=c1># 配置开机自动挂载</span>
</span></span><span class=line><span class=cl>/dev/sdb1 /data ext4 defaults <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># 添加启动项后保存</span>
</span></span><span class=line><span class=cl>umount /data
</span></span><span class=line><span class=cl><span class=c1># 取消挂载,同时需再次编辑 /etc/fstab 删除开机自动挂载命令.</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=nfs>NFS</h3><h4 id=服务端>服务端</h4><h5 id=安装>安装</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum -y install nfs-utils
</span></span><span class=line><span class=cl>systemctl start rpcbind
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> rpcbind
</span></span><span class=line><span class=cl>systemctl start nfs
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> nfs
</span></span></code></pre></td></tr></table></div></div><h5 id=配置>配置</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /etc/exports
</span></span><span class=line><span class=cl><span class=c1># 配置挂载权限</span>
</span></span><span class=line><span class=cl>/share *<span class=o>(</span>rw,sync,no_root_squash,no_all_squash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># 所有网段</span>
</span></span><span class=line><span class=cl>/share 192.168.1.0/24<span class=o>(</span>rw,sync,no_root_squash,no_all_squash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># 指定网段</span>
</span></span><span class=line><span class=cl>/share 192.168.1.9<span class=o>(</span>rw,sync,no_root_squash,no_all_squash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># 指定 IP</span>
</span></span><span class=line><span class=cl>exportfs -r
</span></span><span class=line><span class=cl><span class=c1># 刷新配置</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=客户端挂载>客户端挂载</h4><p>用于挂载局域网内群晖 NFS 共享文件夹,需在群晖 DSM 内开启 NFS 服务,并编辑需挂载的共享文件夹,添加 NFS 权限设置<code>服务器名称或 IP 地址</code>为 <strong><code>\*</code></strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum -y install nfs-utils
</span></span><span class=line><span class=cl><span class=c1># 安装 NFS 工具</span>
</span></span><span class=line><span class=cl>mkdir /data
</span></span><span class=line><span class=cl><span class=c1># 创建本地目录</span>
</span></span><span class=line><span class=cl>mount -t nfs 192.168.1.8:/volume1/Downloads /data
</span></span><span class=line><span class=cl><span class=c1># 挂载目录</span>
</span></span><span class=line><span class=cl>vi /etc/fstab
</span></span><span class=line><span class=cl><span class=c1># 设置开机自动挂载</span>
</span></span><span class=line><span class=cl>192.168.1.8:/volume1/Downloads /data nfs defaults <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># 尾行添加挂载命令</span>
</span></span><span class=line><span class=cl>umount /data
</span></span><span class=line><span class=cl><span class=c1># 取消挂载,同时需再次编辑 /etc/fstab 删除开机自动挂载命令.</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=smb>SMB</h3><h4 id=服务端-1>服务端</h4><h5 id=安装启动>安装启动</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum -y install samba
</span></span><span class=line><span class=cl><span class=c1># 安装</span>
</span></span><span class=line><span class=cl>systemctl start smb
</span></span><span class=line><span class=cl><span class=c1># 启动</span>
</span></span><span class=line><span class=cl>systemctl status smb
</span></span><span class=line><span class=cl><span class=c1># 状态</span>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> smb
</span></span><span class=line><span class=cl><span class=c1># 开机自启动</span>
</span></span><span class=line><span class=cl>systemctl restart smb
</span></span><span class=line><span class=cl><span class=c1># 重启</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=共享文件夹>共享文件夹</h5><p>本文为匿名共享文件夹,无需配置账号密码.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir /data
</span></span><span class=line><span class=cl><span class=c1># 创建共享文件夹</span>
</span></span><span class=line><span class=cl>chown -R nobody:nobody /data
</span></span><span class=line><span class=cl><span class=c1># 赋予文件夹匿名用户权限</span>
</span></span><span class=line><span class=cl>vi /etc/sysconfig/selinux
</span></span><span class=line><span class=cl><span class=c1># OR</span>
</span></span><span class=line><span class=cl>vi /etc/selinux/config
</span></span><span class=line><span class=cl><span class=c1># 修改 SELINUX=disabled 后重启服务器</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=配置-smbconf>配置 smb.conf</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /etc/samba/smb.conf
</span></span><span class=line><span class=cl><span class=c1># 参考以下编辑 conf 文件:</span>
</span></span><span class=line><span class=cl><span class=o>[</span>global<span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nv>workgroup</span> <span class=o>=</span> WORKGROUP
</span></span><span class=line><span class=cl>    <span class=nv>security</span> <span class=o>=</span> user
</span></span><span class=line><span class=cl>    map to <span class=nv>guest</span> <span class=o>=</span> Bad User
</span></span><span class=line><span class=cl><span class=o>[</span>data<span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nv>comment</span> <span class=o>=</span> date
</span></span><span class=line><span class=cl>    <span class=nv>path</span> <span class=o>=</span> /data
</span></span><span class=line><span class=cl>    <span class=nv>public</span> <span class=o>=</span> yes
</span></span><span class=line><span class=cl>    <span class=nb>read</span> <span class=nv>only</span> <span class=o>=</span> No
</span></span></code></pre></td></tr></table></div></div><h5 id=配置账号密码>配置账号密码</h5><p><a href=https://cloud.tencent.com/developer/article/1691026 target=_blank rel="noopener noreffer">参考链接</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>useradd stille
</span></span><span class=line><span class=cl>smbpasswd -a stille
</span></span><span class=line><span class=cl>chown -R nobody:nobody share
</span></span><span class=line><span class=cl>chmod -R <span class=m>777</span> share
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vi /etc/samba/smb.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>global<span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nv>security</span> <span class=o>=</span> user
</span></span><span class=line><span class=cl>    <span class=nv>workgroup</span> <span class=o>=</span> SAMBA
</span></span><span class=line><span class=cl>    passdb <span class=nv>backend</span> <span class=o>=</span> tdbsam
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=o>[</span>share<span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nv>comment</span> <span class=o>=</span> share
</span></span><span class=line><span class=cl>    <span class=nv>path</span> <span class=o>=</span> /share
</span></span><span class=line><span class=cl>    <span class=nv>writable</span> <span class=o>=</span> no
</span></span><span class=line><span class=cl>    create <span class=nv>mask</span> <span class=o>=</span> <span class=m>0644</span>
</span></span><span class=line><span class=cl>    directory <span class=nv>mask</span> <span class=o>=</span> <span class=m>02755</span>
</span></span><span class=line><span class=cl>    valid <span class=nv>users</span> <span class=o>=</span> stille
</span></span><span class=line><span class=cl>    write <span class=nv>list</span> <span class=o>=</span> stille
</span></span></code></pre></td></tr></table></div></div><h5 id=检查语法>检查语法</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>testparm
</span></span><span class=line><span class=cl><span class=c1># 检查语法</span>
</span></span><span class=line><span class=cl>systemctl restart smb
</span></span><span class=line><span class=cl><span class=c1># 重启 smb 服务</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=avahi>avahi</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum install avahi-tools
</span></span><span class=line><span class=cl>systemctl start avahi-daemon
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> avahi-daemon
</span></span><span class=line><span class=cl>vi /etc/avahi/services/smb.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;service-group&gt;
</span></span><span class=line><span class=cl>&lt;name&gt;CENTOS&lt;/name&gt;
</span></span><span class=line><span class=cl>&lt;service&gt;
</span></span><span class=line><span class=cl>&lt;type&gt;_device-info._tcp&lt;/type&gt;
</span></span><span class=line><span class=cl>&lt;txt-record&gt;model<span class=o>=</span>Xserve&lt;/txt-record&gt;
</span></span><span class=line><span class=cl>&lt;/service&gt;
</span></span><span class=line><span class=cl>&lt;service&gt;
</span></span><span class=line><span class=cl>&lt;type&gt;_smb._tcp&lt;/type&gt;
</span></span><span class=line><span class=cl>&lt;port&gt;445&lt;/port&gt;
</span></span><span class=line><span class=cl>&lt;/service&gt;
</span></span><span class=line><span class=cl>&lt;/service-group&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl restart avahi-daemon
</span></span></code></pre></td></tr></table></div></div><h4 id=客户端>客户端</h4><h5 id=匿名挂载>匿名挂载</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mount -t cifs -o guest //192.168.1.8/share /share
</span></span><span class=line><span class=cl><span class=c1># 配置开机自动挂载</span>
</span></span><span class=line><span class=cl>vim /etc/fstab
</span></span><span class=line><span class=cl>//192.168.1.8/share  /share          cifs    defaults,guest  <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=用户密码挂载>用户密码挂载</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mount -t cifs -o <span class=nv>username</span><span class=o>=</span>xxxxx,password<span class=o>=</span><span class=s1>&#39;xxxxx&#39;</span>,iocharset<span class=o>=</span>utf-8 //192.168.1.8/share /share
</span></span><span class=line><span class=cl><span class=c1># 配置开机自动挂载</span>
</span></span><span class=line><span class=cl>vim /etc/fstab
</span></span><span class=line><span class=cl>//192.168.1.8/share  /share          cifs    defaults,username<span class=o>=</span>xxxxx,password<span class=o>=</span>xxxxx
</span></span></code></pre></td></tr></table></div></div><h5 id=umount>umount</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>umount /share
</span></span><span class=line><span class=cl><span class=c1># 遇到无法 umount 时</span>
</span></span><span class=line><span class=cl>yum install psmisc
</span></span><span class=line><span class=cl>fuser -mv /share
</span></span><span class=line><span class=cl><span class=nb>kill</span> -9 xxxx
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-02-25</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/centos7-%E5%B8%B8%E8%A7%84%E5%91%BD%E4%BB%A4/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/shell%E8%84%9A%E6%9C%AC%E5%B8%B8%E7%94%A8%E5%8F%82%E8%80%83/ class=prev rel=prev title=shell脚本常用参考><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>shell脚本常用参考</a>
<a href=/centos7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/ class=next rel=next title="CentOS7 升级内核">CentOS7 升级内核<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.115.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Peng</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>