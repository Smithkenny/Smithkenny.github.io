<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>VSFTP不同用户拥有不同权限 - Peng</title><meta name=Description content="One World,One Dream!"><meta property="og:title" content="VSFTP不同用户拥有不同权限"><meta property="og:description" content="VSFTP不同用户拥有不同权限 安装篇 操作系统环境 1 centos 7.9 mini 安装vsftp服务 1 2 3 4 5 6 yum install –y vsftpd ftp –安装 systemctl start vsftpd.service –启动 systemctl enable vsftpd.service –开机自启 vi /etc/selinux/conf SELINUX=enforce 改"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.haipengv.com/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/"><meta property="og:image" content="https://blog.haipengv.com/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-15T16:10:12+00:00"><meta property="article:modified_time" content="2022-10-15T16:10:12+00:00"><meta property="og:site_name" content="我的网站"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.haipengv.com/logo.png"><meta name=twitter:title content="VSFTP不同用户拥有不同权限"><meta name=twitter:description content="VSFTP不同用户拥有不同权限 安装篇 操作系统环境 1 centos 7.9 mini 安装vsftp服务 1 2 3 4 5 6 yum install –y vsftpd ftp –安装 systemctl start vsftpd.service –启动 systemctl enable vsftpd.service –开机自启 vi /etc/selinux/conf SELINUX=enforce 改"><meta name=application-name content="我的网站"><meta name=apple-mobile-web-app-title content="我的网站"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.haipengv.com/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/><link rel=prev href=https://blog.haipengv.com/linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/><link rel=next href=https://blog.haipengv.com/%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%85%B7-inxi/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"VSFTP不同用户拥有不同权限","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.haipengv.com\/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90\/"},"genre":"posts","wordcount":2180,"url":"https:\/\/blog.haipengv.com\/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90\/","datePublished":"2022-10-15T16:10:12+00:00","dateModified":"2022-10-15T16:10:12+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Peng"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/links/>友链 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/links/ title>友链</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">VSFTP不同用户拥有不同权限</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Peng</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-10-15>2022-10-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2180 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#vsftp不同用户拥有不同权限>VSFTP不同用户拥有不同权限</a></li></ul></li><li><a href=#安装篇>安装篇</a><ul><li><ul><li><a href=#操作系统环境>操作系统环境</a></li><li><a href=#安装vsftp服务>安装vsftp服务</a></li></ul></li></ul></li><li><a href=#实现篇>实现篇</a><ul><li><a href=#1要实现的功能>1.要实现的功能</a></li><li><a href=#2首先创建一个本地系统用户abcde并指定其家目录并建立相应的子目录>2.首先创建一个本地系统用户<code>abcde</code>并指定其家目录，并建立相应的子目录</a></li><li><a href=#3创建用户数据文件一行账号一行密码不要有空行不要有空格>3.创建用户数据文件：（一行账号一行密码，不要有空行，不要有空格）</a><ul><li><a href=#4修改pam配置>4、修改pam配置</a></li></ul></li><li><a href=#5创建本地系统用户abcde对应的虚拟账户>5、创建本地系统用户abcde对应的虚拟账户</a></li><li><a href=#6设置配置文件vsftpdconf>6、设置配置文件vsftpd.conf</a></li><li><a href=#7重新启动vsftpd>7、重新启动vsftpd</a></li><li><a href=#8测试>8.测试</a></li><li><a href=#9日常维护>9.日常维护</a></li><li><a href=#10加密连接>10.加密连接</a></li><li><a href=#vsftpd-425-security-bad-ip-connecting解决方法>vsftpd 425 Security: Bad IP connecting解决方法</a></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=vsftp不同用户拥有不同权限>VSFTP不同用户拥有不同权限</h3><h2 id=安装篇>安装篇</h2><h4 id=操作系统环境>操作系统环境</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>centos 7.9 mini
</span></span></code></pre></td></tr></table></div></div><h4 id=安装vsftp服务>安装vsftp服务</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum install –y vsftpd ftp –安装
</span></span><span class=line><span class=cl>systemctl start vsftpd.service –启动
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> vsftpd.service –开机自启
</span></span><span class=line><span class=cl>vi /etc/selinux/conf
</span></span><span class=line><span class=cl><span class=nv>SELINUX</span><span class=o>=</span>enforce 改成 <span class=nv>SELINUX</span><span class=o>=</span>disabled
</span></span><span class=line><span class=cl>getenforce - 查看是否为Disabled
</span></span></code></pre></td></tr></table></div></div><h2 id=实现篇>实现篇</h2><h3 id=1要实现的功能>1.要实现的功能</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>admin_root：/home/download/下的所有文件夹及文件具有上传、下载、删除权限
</span></span><span class=line><span class=cl>admin_001：/home/download/admin_001/下的文件具有上传、下载、删除权限
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>download_root：/home/download/下的所有文件夹及文件具有下载权限
</span></span><span class=line><span class=cl>download_001：/home/download/admin_001/下的文件具有下载权限
</span></span></code></pre></td></tr></table></div></div><h3 id=2首先创建一个本地系统用户abcde并指定其家目录并建立相应的子目录>2.首先创建一个本地系统用户<code>abcde</code>并指定其家目录，并建立相应的子目录</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>useradd -d /home/download abcde -s /sbin/nologin
</span></span><span class=line><span class=cl>mkdir -p /home/download/admin_001
</span></span><span class=line><span class=cl>chown -R abcde: /home/download
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /home/download
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /home/download/*
</span></span></code></pre></td></tr></table></div></div><h3 id=3创建用户数据文件一行账号一行密码不要有空行不要有空格>3.创建用户数据文件：（一行账号一行密码，不要有空行，不要有空格）</h3><p><strong>所有密码此处示例设为123456。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /etc/vsftpd/userlist.txt
</span></span><span class=line><span class=cl>admin_root
</span></span><span class=line><span class=cl><span class=m>123456</span>
</span></span><span class=line><span class=cl>admin_001
</span></span><span class=line><span class=cl><span class=m>123456</span>
</span></span><span class=line><span class=cl>download_root
</span></span><span class=line><span class=cl><span class=m>123456</span>
</span></span><span class=line><span class=cl>download_001
</span></span><span class=line><span class=cl><span class=m>123456</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>然后生成数据文件</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db_load：一般系统都有安装，db4，db4-devel，db4-utils ，如果没有的话可以安装：
</span></span><span class=line><span class=cl>yum -y install db4*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>db_load -T -t <span class=nb>hash</span> -f /etc/vsftpd/userlist.txt /etc/vsftpd/userlist.db
</span></span></code></pre></td></tr></table></div></div><h4 id=4修改pam配置>4、修改pam配置</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /etc/pam.d/vsftpd
</span></span></code></pre></td></tr></table></div></div><p><strong>将原来的全部注释掉，加入</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>auth sufficient /lib64/security/pam_userdb.so <span class=nv>db</span><span class=o>=</span>/etc/vsftpd/userlist
</span></span><span class=line><span class=cl>account sufficient /lib64/security/pam_userdb.so <span class=nv>db</span><span class=o>=</span>/etc/vsftpd/userlist
</span></span></code></pre></td></tr></table></div></div><p><strong>注意：<code>db=/etc/vsftpd/userlist</code> 后面的<code>.db</code>必须去掉，默认会自动匹配<code>*.db</code>文件，</strong>
<strong>这里只需要给数据文件名，就行了。</strong>
<strong>64位机需要使用<code>lib64</code>（这里折腾了好久，有的是<code>lib</code>有的是<code>lib64</code>）;</strong></p><h3 id=5创建本地系统用户abcde对应的虚拟账户>5、创建本地系统用户abcde对应的虚拟账户</h3><p><strong>虚拟用户需要通过本地系统用户来实现各种操作,因此要放在系统用户的同名文件夹下。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p /etc/vfstpd/abcde
</span></span><span class=line><span class=cl><span class=nb>cd</span> /etc/vfstpd/abcde
</span></span></code></pre></td></tr></table></div></div><p><strong>每一个虚拟用户都要有一个同名的文件，文件里记载其权限以及可操作的目录；</strong>
<strong>本例如下执行，两个&#187;和&#171;之间不要有空格</strong></p><p><strong>创建有上传下载权限的用户</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat &gt;&gt;admin_root<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>anon_world_readable_only=NO
</span></span></span><span class=line><span class=cl><span class=s>write_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>anon_mkdir_write_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>anon_upload_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>anon_other_write_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>local_root=/home/download
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt;&gt;admin_001<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>anon_world_readable_only=NO
</span></span></span><span class=line><span class=cl><span class=s>write_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>anon_mkdir_write_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>anon_upload_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>anon_other_write_enable=YES
</span></span></span><span class=line><span class=cl><span class=s>local_root=/home/download/admin_001
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>创建只有下载权限的用户</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat &gt;&gt;download_root<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>anon_world_readable_only=NO
</span></span></span><span class=line><span class=cl><span class=s>local_root=/home/download
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt;&gt;download_001<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>anon_world_readable_only=NO
</span></span></span><span class=line><span class=cl><span class=s>local_root=/home/download/admin_001
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=6设置配置文件vsftpdconf>6、设置配置文件vsftpd.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /etc/vsftpd/vsftpd.conf
</span></span></code></pre></td></tr></table></div></div><p><strong>修改内容如下：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>listen</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>connect_from_port_20</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>anonymous_enable</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>local_enable</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>write_enable</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>anon_upload_enable</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>anon_mkdir_write_enable</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>anon_other_write_enable</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>chroot_local_user</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>chroot_list_enable</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>chroot_list_file</span><span class=o>=</span>/etc/vsftpd/chroot_list
</span></span><span class=line><span class=cl><span class=nv>guest_enable</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>guest_username</span><span class=o>=</span>abcde
</span></span><span class=line><span class=cl><span class=nv>virtual_use_local_privs</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>allow_writeable_chroot</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>pam_service_name</span><span class=o>=</span>vsftpd
</span></span><span class=line><span class=cl><span class=nv>user_config_dir</span><span class=o>=</span>/etc/vsftpd/abcde
</span></span><span class=line><span class=cl><span class=nv>local_umask</span><span class=o>=</span><span class=m>022</span>
</span></span><span class=line><span class=cl><span class=nv>xferlog_enable</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>xferlog_file</span><span class=o>=</span>/var/log/vsftpd.log
</span></span><span class=line><span class=cl><span class=nv>pasv_promiscuous</span><span class=o>=</span>YES
</span></span></code></pre></td></tr></table></div></div><p><strong>touch /etc/vsftp/chroot_list</strong>
<strong>里面啥也不写。</strong></p><h3 id=7重新启动vsftpd>7、重新启动vsftpd</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>service vsftpd restart
</span></span></code></pre></td></tr></table></div></div><h3 id=8测试>8.测试</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>所有用户只能进入自己家目录不能进入上一级目录；
</span></span><span class=line><span class=cl>admin_root对于/home/download下的所有文件夹具有上传、下载、删除权限；
</span></span><span class=line><span class=cl>admin_001对于/home/download/下的同名文件夹具有上传、删除权限，无其他权限；
</span></span><span class=line><span class=cl>download_root对于/home/download下的所有文件夹具有下载权限，不能上传或删除任何内容，不能对其他任何文件夹操作；
</span></span><span class=line><span class=cl>download_001对于/home/download/下的admin_001文件夹分别具有下载权限，不能上传或删除任何内容，不能对其他任何文件夹操作。
</span></span></code></pre></td></tr></table></div></div><h3 id=9日常维护>9.日常维护</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>（1）更新帐号，先修改userlist.txt，再执行db_load
</span></span><span class=line><span class=cl>db_load -T -t <span class=nb>hash</span> -f /etc/vsftpd/userlist.txt /etc/vsftpd/userlist.db
</span></span><span class=line><span class=cl>（2）更新/etc/vsftpd/abcde/下不同用户对应的权限
</span></span><span class=line><span class=cl>（3）重启vsftpd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl start  vsftpd.service
</span></span></code></pre></td></tr></table></div></div><h3 id=10加密连接>10.加密连接</h3><p><strong>生成证书</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>openssl req -x509 -nodes -days <span class=m>365</span> -newkey rsa:1024 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> -keyout /etc/vsftpd/vsftpd.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> -out /etc/vsftpd/vsftpd.pem
</span></span></code></pre></td></tr></table></div></div><p><strong>其中"-days 365"声明证书的有效期是一年。</strong></p><p><strong>接下来的过程需要你输入一些相关的国家，地区，位置，组织名称，common name等信息。</strong></p><p><strong>回答这些信息以后系统会将生成完的证书vsftpd.pem文件保存在/etc/vsftpd目录下。</strong></p><p><strong>修改<code>/etc/vsftpd/vsftpd.conf</code>文件,增加以下内容</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>ssl_enable</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>allow_anon_ssl</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>force_local_data_ssl</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>force_local_logins_ssl</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>ssl_tlsv1</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>ssl_sslv2</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>ssl_sslv3</span><span class=o>=</span>NO
</span></span><span class=line><span class=cl><span class=nv>rsa_cert_file</span><span class=o>=</span>/etc/vsftpd/vsftpd.pem
</span></span></code></pre></td></tr></table></div></div><p><strong>如果设置force_local_logins_ssl=YES，那么会强制用户登录时采用支持TLS/SSL认证的ftp客户端。如果设置为NO的话，则用户可以选择使用ssl加密或者不加密。</strong></p><p><strong>此时选择不加密登录会有失败提示</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Non-anonymous sessions must use encryption.
</span></span></code></pre></td></tr></table></div></div><p><strong>重启服务</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>systemctl restart vsftpd
</span></span></code></pre></td></tr></table></div></div><p><strong>修改为其他端口</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>listen_port</span><span class=o>=</span><span class=m>10021</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=vsftpd-425-security-bad-ip-connecting解决方法>vsftpd 425 Security: Bad IP connecting解决方法</h3><p><strong>问题分析:</strong>
FTP客户端软件连接<code>vsftpd</code>服务报此错误，大概原因是在连接中变换了IP地址。</p><p><strong>问题解决</strong></p><p><strong>服务端添加：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vi /etc/vsftpd/vsftpd.conf
</span></span><span class=line><span class=cl><span class=nv>pasv_promiscuous</span><span class=o>=</span>YES
</span></span></code></pre></td></tr></table></div></div><p><strong>重启服务</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>systemctl restart vsftpd
</span></span></code></pre></td></tr></table></div></div><p><strong>pasv_promiscuous选项参数说明</strong>
此选项激活时，将关闭PASV模式的安全检查。该检查确保数据连接和控制连接是来自同一个IP地址。小心打开此选项。此选项唯一合理的用法是存在于由安全隧道方案构成的组织中。默认值为NO。
合理的用法是：在一些安全隧道配置环境下，或者更好地支持FXP时(才启用它)。</p><p><strong>FTP模式与数据端口</strong></p><p>FTP 分为两类，PORT FTP和PASV FTP，PORT FTP是一般形式的FTP。这两种FTP在建立控制连接时操作是一样的，都是由客户端首先和FTP服务器的控制端口(默认值为21)建立控制链接，并通过此链接进行传输操作指令。它们的区别在于使用数据传输端口(ftp- data)的方式。PORT FTP由FTP服务器指定数据传输所使用的端口，默认值为20。PASV FTP由FTP客户端决定数据传输的端口。 PASV FTP这种做法，主要是考虑到存在防火墙的环境下，由客户端与服务器进行沟通(客户端向服务器发出数据传输请求中包含了数据传输端口)，决定两者之间的数据传输端口更为方便一些。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-10-15</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/vsftp%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E4%B8%8D%E5%90%8C%E6%9D%83%E9%99%90/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/ class=prev rel=prev title=linux小技巧汇总><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>linux小技巧汇总</a>
<a href=/%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%85%B7-inxi/ class=next rel=next title=功能强大的硬件信息获取工具-inxi>功能强大的硬件信息获取工具-inxi<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.115.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Peng</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>