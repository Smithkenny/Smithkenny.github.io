<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>CKS初始环境搭建 - Peng</title><meta name=Description content="One World,One Dream!"><meta property="og:title" content="CKS初始环境搭建"><meta property="og:description" content="准备工作 k8s主机名 IP地址 系统版本号 k8s组件版本 CKS-master 10.4.7.180 ubuntu 20.04 1.24.4 CKS-node1 10.4.7.181 ubuntu 20.04 1.24.4 CKS-node2 10.4.7.182 ubuntu 20.04 1.24.4 配置前准备 1 2 3 4 5 6 7 8 9 10 11 12 13 # 开root用户设置密"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.haipengv.com/cks%E5%88%9D%E5%A7%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"><meta property="og:image" content="https://blog.haipengv.com/logo.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-22T23:02:12+00:00"><meta property="article:modified_time" content="2022-08-22T23:02:12+00:00"><meta property="og:site_name" content="我的网站"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.haipengv.com/logo.webp"><meta name=twitter:title content="CKS初始环境搭建"><meta name=twitter:description content="准备工作 k8s主机名 IP地址 系统版本号 k8s组件版本 CKS-master 10.4.7.180 ubuntu 20.04 1.24.4 CKS-node1 10.4.7.181 ubuntu 20.04 1.24.4 CKS-node2 10.4.7.182 ubuntu 20.04 1.24.4 配置前准备 1 2 3 4 5 6 7 8 9 10 11 12 13 # 开root用户设置密"><meta name=application-name content="我的网站"><meta name=apple-mobile-web-app-title content="我的网站"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.haipengv.com/cks%E5%88%9D%E5%A7%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/><link rel=prev href=https://blog.haipengv.com/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/><link rel=next href=https://blog.haipengv.com/%E4%BD%BF%E7%94%A8python%E5%AE%9E%E7%8E%B0unix%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CKS初始环境搭建","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.haipengv.com\/cks%E5%88%9D%E5%A7%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\/"},"genre":"posts","keywords":"cks","wordcount":2438,"url":"https:\/\/blog.haipengv.com\/cks%E5%88%9D%E5%A7%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\/","datePublished":"2022-08-22T23:02:12+00:00","dateModified":"2022-08-22T23:02:12+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Peng"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friends/><i class='fas fa-fw fa-fan fa-spin'></i> 友链 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Peng>Peng</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friends/ title><i class='fas fa-fw fa-fan fa-spin'></i>友链</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CKS初始环境搭建</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Peng</a>
</span>&nbsp;<span class=post-category>收录于 <a href=/categories/linux/><i class="far fa-folder fa-fw" aria-hidden=true></i>linux</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-08-22>2022-08-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 2438 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 5 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#准备工作>准备工作</a></li><li><a href=#配置前准备>配置前准备</a></li><li><a href=#配置域名>配置域名</a></li><li><a href=#域名解析>域名解析</a></li><li><a href=#初始化部分>初始化部分</a></li><li><a href=#vnc服务搭建选做>vnc服务搭建（选做）</a></li></ul></li><li><a href=#安装containerd>安装containerd</a><ul><li><a href=#运行时runc安装>运行时Runc安装</a></li><li><a href=#安装前准备>安装前准备</a></li><li><a href=#开始安装>开始安装</a></li><li><a href=#检测版本>检测版本</a></li><li><a href=#启动关闭服务及查看服务状态>启动、关闭服务及查看服务状态</a></li><li><a href=#更换国内镜像仓库>更换国内镜像仓库</a></li><li><a href=#安装cni插件选做>安装cni插件(选做)</a></li></ul></li><li><a href=#安装三件套kubectl-kubelet-kubeadm>安装三件套kubectl kubelet kubeadm</a><ul><li><a href=#运行crictl-images-时报错>运行crictl images 时报错</a></li><li><a href=#排错>排错</a></li><li><a href=#集群初始化cks-master上操作>集群初始化（cks-master上操作）</a><ul><li><a href=#各个节点加入集群>各个节点加入集群</a></li><li><a href=#安装cni插件calico>安装cni插件（calico）</a></li><li><a href=#更改calicoyaml-文件>更改calico.yaml 文件</a></li><li><a href=#重新分配coredns>重新分配coredns</a></li><li><a href=#延长证书有效期>延长证书有效期</a></li></ul></li><li><a href=#部署dashboardk8s-可视化页面>部署dashboard（k8s 可视化页面）</a><ul><li><a href=#登录前根据官方文档要先创建用户>登录前根据官方文档要先创建用户</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h3 id=准备工作>准备工作</h3><table><thead><tr><th style=text-align:center>k8s主机名</th><th style=text-align:center>IP地址</th><th style=text-align:center>系统版本号</th><th style=text-align:center>k8s组件版本</th></tr></thead><tbody><tr><td style=text-align:center>CKS-master</td><td style=text-align:center>10.4.7.180</td><td style=text-align:center>ubuntu 20.04</td><td style=text-align:center>1.24.4</td></tr><tr><td style=text-align:center>CKS-node1</td><td style=text-align:center>10.4.7.181</td><td style=text-align:center>ubuntu 20.04</td><td style=text-align:center>1.24.4</td></tr><tr><td style=text-align:center>CKS-node2</td><td style=text-align:center>10.4.7.182</td><td style=text-align:center>ubuntu 20.04</td><td style=text-align:center>1.24.4</td></tr></tbody></table><h3 id=配置前准备>配置前准备</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 开root用户设置密码</span>
</span></span><span class=line><span class=cl>sudo passwd root
</span></span><span class=line><span class=cl><span class=c1># 切换root用户</span>
</span></span><span class=line><span class=cl>su - root
</span></span><span class=line><span class=cl><span class=c1># 更新</span>
</span></span><span class=line><span class=cl>apt update 
</span></span><span class=line><span class=cl><span class=c1># 安装ssh</span>
</span></span><span class=line><span class=cl>apt install ssh -y 
</span></span><span class=line><span class=cl><span class=c1># 允许root用户远程登录</span>
</span></span><span class=line><span class=cl>PermitRootLogin yes
</span></span><span class=line><span class=cl>UseDNS no
</span></span><span class=line><span class=cl><span class=c1># 重启</span>
</span></span><span class=line><span class=cl>systemctl restart ssh
</span></span></code></pre></td></tr></table></div></div><h3 id=配置域名>配置域名</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 需要对应的机器执行如下命令</span>
</span></span><span class=line><span class=cl>hostnamectl set-hostname CKS-master
</span></span><span class=line><span class=cl>hostnamectl set-hostname CKS-node1
</span></span><span class=line><span class=cl>hostnamectl set-hostname CKS-node2
</span></span></code></pre></td></tr></table></div></div><h3 id=域名解析>域名解析</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;10.4.7.180 CKS-master\n10.4.7.181 CKS-node1\n10.4.7.182 CKS-node2&#34;</span> &gt;&gt; /etc/hosts
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 拷贝到远程集群机器</span>
</span></span><span class=line><span class=cl>scp /etc/hosts root@10.4.7.181:/etc/
</span></span><span class=line><span class=cl>scp /etc/hosts root@10.4.7.182:/etc/
</span></span></code></pre></td></tr></table></div></div><h3 id=初始化部分>初始化部分</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 关闭防火墙</span>
</span></span><span class=line><span class=cl>systemctl stop ufw.service <span class=o>&amp;&amp;</span> systemctl disable ufw.service
</span></span><span class=line><span class=cl>iptables -F 
</span></span><span class=line><span class=cl>iptables-save 
</span></span><span class=line><span class=cl><span class=c1># 关闭swap</span>
</span></span><span class=line><span class=cl>swapoff -a
</span></span><span class=line><span class=cl>sed -ri <span class=s1>&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab
</span></span></code></pre></td></tr></table></div></div><h3 id=vnc服务搭建选做>vnc服务搭建（选做）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 安装vnc远程服务</span>
</span></span><span class=line><span class=cl>apt install xfce4 xfce4-goodies -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 选lightdm</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt install tightvncserver -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置远程密码</span>
</span></span><span class=line><span class=cl>123qwe.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 开启远程发现空白</span>
</span></span><span class=line><span class=cl>vncserver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更改配置文件</span>
</span></span><span class=line><span class=cl>mv .vnc/xstartup .vnc/xstartup.bak
</span></span><span class=line><span class=cl>nano .vnc/xstartup
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>xrdb <span class=nv>$HOME</span>/.Xresources
</span></span><span class=line><span class=cl>startxfce4 <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 给权限</span>
</span></span><span class=line><span class=cl>chmod +x .vnc/xstartup
</span></span><span class=line><span class=cl><span class=c1># 杀进程</span>
</span></span><span class=line><span class=cl>vncserver -kill :2
</span></span><span class=line><span class=cl><span class=c1># 再次启动远程</span>
</span></span><span class=line><span class=cl>vncserver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试：用vncview连接</span>
</span></span><span class=line><span class=cl>ip:2
</span></span></code></pre></td></tr></table></div></div><h2 id=安装containerd>安装containerd</h2><h3 id=运行时runc安装>运行时Runc安装</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 下载二进制包 https://github.com/opencontainers/runc/releases/download/</span>
</span></span><span class=line><span class=cl>wget https://github.com/opencontainers/runc/releases/download/v1.1.3/runc.amd64
</span></span><span class=line><span class=cl><span class=c1># 执行Path和权限设置</span>
</span></span><span class=line><span class=cl>mv runc.amd64 /usr/local/sbin/runc 
</span></span><span class=line><span class=cl>chmod +x /usr/local/sbin/runc
</span></span></code></pre></td></tr></table></div></div><h3 id=安装前准备>安装前准备</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 添加加载内核模块</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | sudo tee /etc/modules-load.d/containerd.conf
</span></span></span><span class=line><span class=cl><span class=s>overlay
</span></span></span><span class=line><span class=cl><span class=s>br_netfilter
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=c1># 加载内核模块</span>
</span></span><span class=line><span class=cl>modprobe overlay
</span></span><span class=line><span class=cl>modprobe br_netfilter
</span></span><span class=line><span class=cl><span class=c1>#设置内核参数</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-iptables  = 1
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.ip_forward                 = 1
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=c1># 应用内核参数</span>
</span></span><span class=line><span class=cl>sysctl --system
</span></span></code></pre></td></tr></table></div></div><h3 id=开始安装>开始安装</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 下载二进制包 https://github.com/containerd/containerd/releases/</span>
</span></span><span class=line><span class=cl>wget https://github.com/containerd/containerd/releases/download/v1.6.8/containerd-1.6.8-linux-amd64.tar.gz
</span></span><span class=line><span class=cl><span class=c1># 解压</span>
</span></span><span class=line><span class=cl>tar -zxvf containerd-1.6.8-linux-amd64.tar.gz 
</span></span><span class=line><span class=cl><span class=c1># 执行文件放置系统Path</span>
</span></span><span class=line><span class=cl>mv ./bin/* /usr/local/bin/
</span></span><span class=line><span class=cl><span class=c1># systemd 服务启动脚本文件配置</span>
</span></span><span class=line><span class=cl>cat &gt; /lib/systemd/system/containerd.service <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s># Copyright The containerd Authors.
</span></span></span><span class=line><span class=cl><span class=s>#
</span></span></span><span class=line><span class=cl><span class=s># Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span class=line><span class=cl><span class=s># you may not use this file except in compliance with the License.
</span></span></span><span class=line><span class=cl><span class=s># You may obtain a copy of the License at
</span></span></span><span class=line><span class=cl><span class=s>#
</span></span></span><span class=line><span class=cl><span class=s>#     http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span class=line><span class=cl><span class=s>#
</span></span></span><span class=line><span class=cl><span class=s># Unless required by applicable law or agreed to in writing, software
</span></span></span><span class=line><span class=cl><span class=s># distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span class=line><span class=cl><span class=s># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span class=line><span class=cl><span class=s># See the License for the specific language governing permissions and
</span></span></span><span class=line><span class=cl><span class=s># limitations under the License.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[Unit]
</span></span></span><span class=line><span class=cl><span class=s>Description=containerd container runtime
</span></span></span><span class=line><span class=cl><span class=s>Documentation=https://containerd.io
</span></span></span><span class=line><span class=cl><span class=s>After=network.target local-fs.target
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[Service]
</span></span></span><span class=line><span class=cl><span class=s>ExecStartPre=-/sbin/modprobe overlay
</span></span></span><span class=line><span class=cl><span class=s>ExecStart=/usr/local/bin/containerd
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>Type=notify
</span></span></span><span class=line><span class=cl><span class=s>Delegate=yes
</span></span></span><span class=line><span class=cl><span class=s>KillMode=process
</span></span></span><span class=line><span class=cl><span class=s>Restart=always
</span></span></span><span class=line><span class=cl><span class=s>RestartSec=5
</span></span></span><span class=line><span class=cl><span class=s># Having non-zero Limit*s causes performance problems due to accounting overhead
</span></span></span><span class=line><span class=cl><span class=s># in the kernel. We recommend using cgroups to do container-local accounting.
</span></span></span><span class=line><span class=cl><span class=s>LimitNPROC=infinity
</span></span></span><span class=line><span class=cl><span class=s>LimitCORE=infinity
</span></span></span><span class=line><span class=cl><span class=s>LimitNOFILE=infinity
</span></span></span><span class=line><span class=cl><span class=s># Comment TasksMax if your systemd version does not supports it.
</span></span></span><span class=line><span class=cl><span class=s># Only systemd 226 and above support this version.
</span></span></span><span class=line><span class=cl><span class=s>TasksMax=infinity
</span></span></span><span class=line><span class=cl><span class=s>OOMScoreAdjust=-999
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[Install]
</span></span></span><span class=line><span class=cl><span class=s>WantedBy=multi-user.target
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=检测版本>检测版本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>runc -v
</span></span><span class=line><span class=cl>ctr -v
</span></span></code></pre></td></tr></table></div></div><h3 id=启动关闭服务及查看服务状态>启动、关闭服务及查看服务状态</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>systemctl start containerd
</span></span><span class=line><span class=cl>systemctl restart containerd
</span></span><span class=line><span class=cl>systemctl status containerd
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> containerd
</span></span></code></pre></td></tr></table></div></div><h3 id=更换国内镜像仓库>更换国内镜像仓库</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mkdir -p /etc/containerd/
</span></span><span class=line><span class=cl>containerd config default <span class=p>|</span> sudo tee /etc/containerd/config.toml
</span></span><span class=line><span class=cl>将
</span></span><span class=line><span class=cl>    <span class=nv>sandbox_image</span> <span class=o>=</span> <span class=s2>&#34;k8s.gcr.io/pause:3.6&#34;</span>
</span></span><span class=line><span class=cl>改为
</span></span><span class=line><span class=cl>    <span class=nv>sandbox_image</span> <span class=o>=</span> <span class=s2>&#34;registry.aliyuncs.com/google_containers/pause:3.6&#34;</span>
</span></span><span class=line><span class=cl>将
</span></span><span class=line><span class=cl>    <span class=nv>systemd_cgroup</span> <span class=o>=</span> <span class=nb>false</span>
</span></span><span class=line><span class=cl>改为
</span></span><span class=line><span class=cl>    <span class=nv>systemd_cgroup</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>重启containerd
</span></span><span class=line><span class=cl>systemctl restart containerd
</span></span></code></pre></td></tr></table></div></div><h3 id=安装cni插件选做>安装cni插件(选做)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz
</span></span><span class=line><span class=cl>mkdir -p /opt/cni/bin
</span></span><span class=line><span class=cl>tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz
</span></span></code></pre></td></tr></table></div></div><h2 id=安装三件套kubectl-kubelet-kubeadm>安装三件套kubectl kubelet kubeadm</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>apt-get update <span class=o>&amp;&amp;</span> apt-get install -y apt-transport-https
</span></span><span class=line><span class=cl>curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class=p>|</span> apt-key add - 
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list
</span></span></span><span class=line><span class=cl><span class=s>deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>apt-get update
</span></span><span class=line><span class=cl><span class=c1># 查看可用版本</span>
</span></span><span class=line><span class=cl>apt-cache madison kubelet 
</span></span><span class=line><span class=cl>apt-get install -y kubelet kubeadm kubectl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> kubelet
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># tab补全</span>
</span></span><span class=line><span class=cl>apt-get install bash-completion
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>kubectl completion bash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>kubeadm completion bash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># 加到.bashrc 里</span>
</span></span><span class=line><span class=cl>nano .bashrc
</span></span><span class=line><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>kubeadm completion bash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>kubectl completion bash<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 给crictl添加tab补全</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>crictl completion bash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># 加到.bashrc 里</span>
</span></span><span class=line><span class=cl>nano .bashrc
</span></span><span class=line><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>crictl completion bash<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=运行crictl-images-时报错>运行crictl images 时报错</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>WARN<span class=o>[</span>0000<span class=o>]</span> image connect using default endpoints: <span class=o>[</span>unix:///var/run/dockershim.sock unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock<span class=o>]</span>. As the default settings are now deprecated, you should <span class=nb>set</span> the endpoint instead. 
</span></span><span class=line><span class=cl>ERRO<span class=o>[</span>0000<span class=o>]</span> unable to determine image API version: rpc error: <span class=nv>code</span> <span class=o>=</span> Unavailable <span class=nv>desc</span> <span class=o>=</span> connection error: <span class=nv>desc</span> <span class=o>=</span> <span class=s2>&#34;transport: Error while dialing dial unix /var/run/dockershim.sock: connect: no such file or directory&#34;</span> 
</span></span><span class=line><span class=cl>E0820 17:31:44.920882    <span class=m>5408</span> remote_image.go:121<span class=o>]</span> <span class=s2>&#34;ListImages with filter from image service failed&#34;</span> <span class=nv>err</span><span class=o>=</span><span class=s2>&#34;rpc error: code = Unimplemented desc = unknown service runtime.v1alpha2.ImageService&#34;</span> <span class=nv>filter</span><span class=o>=</span><span class=s2>&#34;&amp;ImageFilter{Image:&amp;ImageSpec{Image:,Annotations:map[string]string{},},}&#34;</span>
</span></span><span class=line><span class=cl>FATA<span class=o>[</span>0000<span class=o>]</span> listing images: rpc error: <span class=nv>code</span> <span class=o>=</span> Unimplemented <span class=nv>desc</span> <span class=o>=</span> unknown service runtime.v1alpha2.ImageService 
</span></span></code></pre></td></tr></table></div></div><h3 id=排错>排错</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ll /run/containerd/
</span></span><span class=line><span class=cl>srw-rw----  <span class=m>1</span> root root   <span class=m>0</span> Aug <span class=m>20</span> 17:20 containerd.sock<span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>crictl config runtime-endpoint unix:///run/containerd/containerd.sock
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更改配置</span>
</span></span><span class=line><span class=cl>nano /etc/crictl.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>runtime-endpoint: <span class=s2>&#34;unix:///run/containerd/containerd.sock&#34;</span>
</span></span><span class=line><span class=cl>image-endpoint: <span class=s2>&#34;unix:///run/containerd/containerd.sock&#34;</span>
</span></span><span class=line><span class=cl>timeout: <span class=m>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重新加载</span>
</span></span><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl><span class=c1># 发现还是报错</span>
</span></span><span class=line><span class=cl>E0820 17:37:56.265740    <span class=m>5708</span> remote_image.go:121<span class=o>]</span> <span class=s2>&#34;ListImages with filter from image service failed&#34;</span> <span class=nv>err</span><span class=o>=</span><span class=s2>&#34;rpc error: code = Unimplemented desc = unknown service runtime.v1alpha2.ImageService&#34;</span> <span class=nv>filter</span><span class=o>=</span><span class=s2>&#34;&amp;ImageFilter{Image:&amp;ImageSpec{Image:,Annotations:map[string]string{},},}&#34;</span>
</span></span><span class=line><span class=cl>FATA<span class=o>[</span>0000<span class=o>]</span> listing images: rpc error: <span class=nv>code</span> <span class=o>=</span> Unimplemented <span class=nv>desc</span> <span class=o>=</span> unknown service runtime.v1alpha2.ImageService 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 这是因为还需要手动设置runtime_type</span>
</span></span><span class=line><span class=cl>nano /etc/containerd/config.toml
</span></span><span class=line><span class=cl><span class=o>[</span>plugins.<span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span>.containerd.default_runtime<span class=o>]</span> 下的
</span></span><span class=line><span class=cl>        <span class=nv>runtime_type</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>改成
</span></span><span class=line><span class=cl>        <span class=nv>runtime_type</span> <span class=o>=</span> <span class=s2>&#34;io.containerd.runtime.v1.linux&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重启containerd </span>
</span></span><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl>systemctl restart containerd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 正常了</span>
</span></span><span class=line><span class=cl>root@cks-master:~# crictl images
</span></span><span class=line><span class=cl>IMAGE               TAG                 IMAGE ID            SIZE
</span></span></code></pre></td></tr></table></div></div><h3 id=集群初始化cks-master上操作>集群初始化（cks-master上操作）</h3><p><code>kubeadm config print init-defaults > init.yaml nano init.yaml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>  advertiseAddress: 10.4.7.180
</span></span><span class=line><span class=cl>  name: cks-master
</span></span><span class=line><span class=cl>imageRepository: registry.aliyuncs.com/google_containers
</span></span><span class=line><span class=cl>kubernetesVersion: 1.24.4
</span></span></code></pre></td></tr></table></div></div><p><code>kubeadm init --config=init.yaml</code></p><h4 id=各个节点加入集群>各个节点加入集群</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubeadm join 10.4.7.180:6443 --token abcdef.0123456789abcdef <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--discovery-token-ca-cert-hash sha256:96f4398d1e19fbaed92c0401a2d38031f89470dc1faf84669306c6d85ba8cc45
</span></span></code></pre></td></tr></table></div></div><p>master 节点上输入以下命令，用kubectl 控制集群。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>  mkdir -p <span class=nv>$HOME</span>/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>  sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config
</span></span></code></pre></td></tr></table></div></div><h4 id=安装cni插件calico>安装cni插件（calico）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>https://projectcalico.docs.tigera.io/getting-started/kubernetes/self-managed-onprem/onpremises
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 小于50个node用这个连接</span>
</span></span><span class=line><span class=cl>curl https://raw.githubusercontent.com/projectcalico/calico/v3.24.0/manifests/calico.yaml -O
</span></span></code></pre></td></tr></table></div></div><h4 id=更改calicoyaml-文件>更改calico.yaml 文件</h4><p>nano 用<code>ctrl+ w</code>搜索。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>            - name: CALICO_IPV4POOL_CIDR
</span></span><span class=line><span class=cl>              value: <span class=s2>&#34;10.96.0.0/12&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>开始创建</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f calico.yaml
</span></span></code></pre></td></tr></table></div></div><p>等待慢慢创建pod</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get po -A 
</span></span></code></pre></td></tr></table></div></div><p>都running后集群搭建成功</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl get po -A -w
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kube-system   calico-kube-controllers-5b97f5d8cf-glx5x   1/1     Running   <span class=m>0</span>          15m
</span></span><span class=line><span class=cl>kube-system   calico-node-87vt9                          1/1     Running   <span class=m>0</span>          15m
</span></span><span class=line><span class=cl>kube-system   calico-node-dd8nk                          1/1     Running   <span class=m>0</span>          15m
</span></span><span class=line><span class=cl>kube-system   calico-node-jgmfk                          1/1     Running   <span class=m>0</span>          15m
</span></span><span class=line><span class=cl>kube-system   coredns-74586cf9b6-46xtt                   1/1     Running   <span class=m>0</span>          27m
</span></span><span class=line><span class=cl>kube-system   coredns-74586cf9b6-7jkkd                   1/1     Running   <span class=m>0</span>          27m
</span></span><span class=line><span class=cl>kube-system   etcd-cks-master                            1/1     Running   <span class=m>0</span>          27m
</span></span><span class=line><span class=cl>kube-system   kube-apiserver-cks-master                  1/1     Running   <span class=m>0</span>          27m
</span></span><span class=line><span class=cl>kube-system   kube-controller-manager-cks-master         1/1     Running   <span class=m>0</span>          27m
</span></span><span class=line><span class=cl>kube-system   kube-proxy-dhgbc                           1/1     Running   <span class=m>0</span>          24m
</span></span><span class=line><span class=cl>kube-system   kube-proxy-pvkgx                           1/1     Running   <span class=m>0</span>          27m
</span></span><span class=line><span class=cl>kube-system   kube-proxy-zckg5                           1/1     Running   <span class=m>0</span>          24m
</span></span><span class=line><span class=cl>kube-system   kube-scheduler-cks-master                  1/1     Running   <span class=m>0</span>          27m
</span></span></code></pre></td></tr></table></div></div><p>由于<code>coredns</code>都在被分配在同一个节点上，没冗余，需要重新分配在不同节点上。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl get po -A -owide <span class=p>|</span> grep coredns
</span></span><span class=line><span class=cl>kube-system   coredns-74586cf9b6-46xtt                   1/1     Running   <span class=m>0</span>          30m   10.106.109.130   cks-node2    &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>kube-system   coredns-74586cf9b6-7jkkd                   1/1     Running   <span class=m>0</span>          30m   10.106.109.131   cks-node2    &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><h4 id=重新分配coredns>重新分配coredns</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl -n kube-system rollout restart deployment coredns 
</span></span><span class=line><span class=cl>root@cks-master:~# kubectl get po -A -owide -w <span class=p>|</span> grep coredns 
</span></span><span class=line><span class=cl>kube-system   coredns-75ffbc4979-gjxjn                   1/1     Running   <span class=m>0</span>          2m37s   10.106.109.132   cks-node2    &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>kube-system   coredns-75ffbc4979-pbfmt                   1/1     Running   <span class=m>0</span>          2m37s   10.104.127.129   cks-node1    &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><h4 id=延长证书有效期>延长证书有效期</h4><p>证书默认1年后就会过期。可以通过如下方式修改为10年。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ <span class=nb>cd</span> /etc/kubernetes/pki
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看当前证书有效期</span>
</span></span><span class=line><span class=cl>$ <span class=k>for</span> i in <span class=k>$(</span>ls *.crt<span class=k>)</span><span class=p>;</span> <span class=k>do</span> <span class=nb>echo</span> <span class=s2>&#34;===== </span><span class=nv>$i</span><span class=s2> =====&#34;</span><span class=p>;</span> openssl x509 -in <span class=nv>$i</span> -text -noout <span class=p>|</span> grep -A <span class=m>3</span> <span class=s1>&#39;Validity&#39;</span> <span class=p>;</span> <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mkdir backup_key<span class=p>;</span> cp -rp ./* backup_key/
</span></span><span class=line><span class=cl>$ git clone https://github.com/yuyicai/update-kube-cert.git
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> update-kube-cert/ 
</span></span><span class=line><span class=cl>$ bash update-kubeadm-cert.sh all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重建管理服务</span>
</span></span><span class=line><span class=cl>$ kubectl -n kube-system delete po kube-apiserver-k8s-master kube-controller-manager-k8s-master kube-scheduler-k8s-master
</span></span></code></pre></td></tr></table></div></div><h3 id=部署dashboardk8s-可视化页面>部署dashboard（k8s 可视化页面）</h3><p>github上搜索dashboard</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>https://github.com/kubernetes/dashboard/blob/master/docs/user/installation.md
</span></span></code></pre></td></tr></table></div></div><p>下载默认配置文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.1/aio/deploy/recommended.yaml
</span></span></code></pre></td></tr></table></div></div><p>不用更改配置直接部署,等待部署完成。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f recommended.yaml
</span></span></code></pre></td></tr></table></div></div><p>默认部署后dashboard是ClusterIP 类型，只允许集群内部访问。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl -n kubernetes-dashboard get svc 
</span></span><span class=line><span class=cl>NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>dashboard-metrics-scraper   ClusterIP   10.96.205.151   &lt;none&gt;        8000/TCP   14m
</span></span><span class=line><span class=cl>kubernetes-dashboard        ClusterIP   10.110.3.32     &lt;none&gt;        443/TCP    14m
</span></span></code></pre></td></tr></table></div></div><p>更改类型为NodePort，暴露端口，可以在集群外部访问。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl -n kubernetes-dashboard edit svc kubernetes-dashboard
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>  - port: <span class=m>443</span>
</span></span><span class=line><span class=cl>    protocol: TCP
</span></span><span class=line><span class=cl>    targetPort: <span class=m>8443</span>
</span></span><span class=line><span class=cl>    nodePort: <span class=m>30003</span>
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    k8s-app: kubernetes-dashboard
</span></span><span class=line><span class=cl>  sessionAffinity: None
</span></span><span class=line><span class=cl>  type: Nodeport
</span></span></code></pre></td></tr></table></div></div><p>保存退出会自动重启pod</p><p>此时可以用ip+端口号形式访问dashboard.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl -n kubernetes-dashboard get svc -w 
</span></span><span class=line><span class=cl>NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>         AGE
</span></span><span class=line><span class=cl>dashboard-metrics-scraper   ClusterIP   10.96.205.151   &lt;none&gt;        8000/TCP        46m
</span></span><span class=line><span class=cl>kubernetes-dashboard        NodePort    10.110.3.32     &lt;none&gt;        443:30003/TCP   46m
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>https://10.4.7.180:30003
</span></span></code></pre></td></tr></table></div></div><p>然后使用token来登录</p><h4 id=登录前根据官方文档要先创建用户>登录前根据官方文档要先创建用户</h4><p>官网说明</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>admin.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: ServiceAccount
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: admin-user
</span></span><span class=line><span class=cl>  namespace: kubernetes-dashboard
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRoleBinding
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: admin-user
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span><span class=line><span class=cl>  kind: ClusterRole
</span></span><span class=line><span class=cl>  name: cluster-admin
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>- kind: ServiceAccount
</span></span><span class=line><span class=cl>  name: admin-user
</span></span><span class=line><span class=cl>  namespace: kubernetes-dashboard
</span></span></code></pre></td></tr></table></div></div><p>创建用户</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f admin.yaml
</span></span></code></pre></td></tr></table></div></div><p>查看</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl -n kubernetes-dashboard get sa
</span></span><span class=line><span class=cl>NAME                   SECRETS   AGE
</span></span><span class=line><span class=cl>admin-user             <span class=m>0</span>         66s
</span></span><span class=line><span class=cl>default                <span class=m>0</span>         56m
</span></span><span class=line><span class=cl>kubernetes-dashboard   <span class=m>0</span>         56m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1.24版本已经默认不支持自动创建token，需要手动创建</span>
</span></span><span class=line><span class=cl>root@cks-master:~# kubectl -n kubernetes-dashboard describe sa admin-user 
</span></span><span class=line><span class=cl>Name:                admin-user
</span></span><span class=line><span class=cl>Namespace:           kubernetes-dashboard
</span></span><span class=line><span class=cl>Labels:              &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:         &lt;none&gt;
</span></span><span class=line><span class=cl>Image pull secrets:  &lt;none&gt;
</span></span><span class=line><span class=cl>Mountable secrets:   &lt;none&gt;
</span></span><span class=line><span class=cl>Tokens:              &lt;none&gt;
</span></span><span class=line><span class=cl>Events:              &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><p>手动创建token</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>root@cks-master:~# kubectl -n kubernetes-dashboard create token admin-user 
</span></span><span class=line><span class=cl>eyJhbGciOiJSUzI1NiIsImtpZCI6ImVlLTUwa0JWcm5seXlfemJ2Ui15MnpuTXJQVXctLXVPWFBsc3IzQl92dTAifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjYxMDA4NzkzLCJpYXQiOjE2NjEwMDUxOTMsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJhZG1pbi11c2VyIiwidWlkIjoiNmE3YWU1ODAtNDhiNi00NGVmLWFmNzUtNjY2MTQzOGUzMTcyIn19LCJuYmYiOjE2NjEwMDUxOTMsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbi11c2VyIn0.kvcfZmYX_CbX6_qaV1GQrT6Z7FCjGwOvG40OZ1cMEUhNQdV9G5XuCjSMJ4FrnKsiNOcSLv6_wdwWMZpWIgvbWYbBJQQ7Q-0Djie_iPzbGbJKbEvEsaNMLqIb7liiM52nKl0TJJweQpIoUHHWf0oRiGDjSkms5QVqDmlddnr5i8z2NotwW7FyIfml1E_OZFCQ-vHnVlo8ONGflkJyAutqGxRghBOBMuInMKSXfpk3AaXf6cjtButHRVqp_jDgErVVkKqtRJrqSHoDwMBV7NRn__fqdrfCGiEVKYlucMdv78TgKPsK2313OE3Arbrf0q_prP3Cs6VAILHETGdmhNHFlA
</span></span></code></pre></td></tr></table></div></div><p>使用token登录dashboard</p><p>每次登录都需要重新创建token</p><p>k8s 不能干什么？</p><p>修改内核的应用</p><p>不建议部署数据库,很容易丢数据。</p><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2022-08-22T23:02:12 title="August 22, 2022">August 22, 2022</span>，文中内容可能已过时，请谨慎使用。</div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-08-22</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/cks%E5%88%9D%E5%A7%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/cks/>cks</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/ class=prev rel=prev title=python多线程><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>python多线程</a>
<a href=/%E4%BD%BF%E7%94%A8python%E5%AE%9E%E7%8E%B0unix%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2/ class=next rel=next title=使用python实现unix时间戳转换>使用python实现unix时间戳转换<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Peng</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:0},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"6P2DFXYAL4",algoliaIndex:"myblog",algoliaSearchKey:"97d66d369583b3cd4c58a5890d58ea96",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=/js/custom.js></script>
<script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script></body></html>